<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Gitå°ç™½æˆé•¿è®°</title>
      <link href="/2025/04/26/Git%E5%B0%8F%E7%99%BD%E6%88%90%E9%95%BF%E8%AE%B0/"/>
      <url>/2025/04/26/Git%E5%B0%8F%E7%99%BD%E6%88%90%E9%95%BF%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>Git æ˜¯ç°åœ¨æœ€ç«çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¼€å‘åˆä½œæ—¶å‡ ä¹äººäººéƒ½ç¦»ä¸å¼€å®ƒã€‚ä½†ç”¨ç€ç”¨ç€ï¼Œä»€ä¹ˆå·¥ä½œåŒºã€æš‚å­˜åŒºã€æœ¬åœ°ä»“åº“ã€è¿œç¨‹ä»“åº“å°±å®¹æ˜“ææ··ï¼›<code>git checkout</code>ã€<code>git reset</code>ã€<code>git revert</code> è¿™äº›å‘½ä»¤ä¹Ÿå¸¸å¸¸å‚»å‚»åˆ†ä¸æ¸…ã€‚åˆ«æ‹…å¿ƒï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æ¥å¸®ä½ æŠŠ Git ç†ä¸ªæ˜æ˜ç™½ç™½ï¼Œä¸€æ¬¡æ€§ææ‡‚å®ƒçš„è¿è¡Œé€»è¾‘å’Œå¸¸ç”¨å‘½ä»¤ï¼</p><h1 id="git-çš„å››ä¸ªæ ¸å¿ƒåŒºåŸŸä¸€æ¬¡è¯´æ¸…"><a class="markdownIt-Anchor" href="#git-çš„å››ä¸ªæ ¸å¿ƒåŒºåŸŸä¸€æ¬¡è¯´æ¸…"></a> ğŸš§ Git çš„å››ä¸ªæ ¸å¿ƒåŒºåŸŸï¼Œä¸€æ¬¡è¯´æ¸…ï¼</h1><p>åœ¨ä½¿ç”¨ Git æ—¶ï¼Œæœ€å®¹æ˜“æ··æ·†çš„å°±æ˜¯å®ƒé‚£å‡ ä¸ªã€ŒåŒºã€ï¼šå·¥ä½œåŒºã€æš‚å­˜åŒºã€æœ¬åœ°ä»“åº“ã€è¿œç¨‹ä»“åº“ã€‚åˆ«æ€¥ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥è®¤è¯†å®ƒä»¬ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426082223309.png" alt="image-20250426082223309" /></p><hr /><h2 id="ï¸-1-å·¥ä½œåŒºworking-directory"><a class="markdownIt-Anchor" href="#ï¸-1-å·¥ä½œåŒºworking-directory"></a> ğŸ—‚ï¸ 1. å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰</h2><p>è¿™æ˜¯ä½ <strong>æ¯å¤©æ‰“å¼€ç¼–è¾‘å™¨å†™ä»£ç çš„åœ°æ–¹</strong>ï¼Œä¹Ÿå°±æ˜¯é¡¹ç›®æ–‡ä»¶æ‰€åœ¨çš„çœŸå®ç›®å½•ã€‚</p><p>ğŸ“ ç‰¹ç‚¹ï¼š</p><ul><li>ä½ çœ‹åˆ°çš„æºä»£ç æ–‡ä»¶å°±å­˜åœ¨è¿™é‡Œï¼›</li><li>ä»»ä½•æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶éƒ½ä¼šé¦–å…ˆå‡ºç°åœ¨å·¥ä½œåŒºï¼›</li><li>è¿˜æ²¡è¢« Git è·Ÿè¸ªæˆ–æäº¤ã€‚</li></ul><p>ğŸ§  å¯ä»¥ç†è§£ä¸ºï¼šä½ çš„â€œå†™å­—å°â€ï¼Œä½ åœ¨ä¸Šé¢æ¶‚æ¶‚æ”¹æ”¹ï¼Œä½† Git è¿˜ä¸çŸ¥é“ä½ è¦ä¿å­˜å“ªäº›ã€‚</p><hr /><h2 id="ï¸-2-æš‚å­˜åŒºstaging-area-index"><a class="markdownIt-Anchor" href="#ï¸-2-æš‚å­˜åŒºstaging-area-index"></a> ğŸ—ƒï¸ 2. æš‚å­˜åŒºï¼ˆStaging Area / Indexï¼‰</h2><p>æš‚å­˜åŒºæ˜¯ä¸€ä¸ªä¸­è½¬ç«™ï¼Œ<strong>å‘Šè¯‰ Git å“ªäº›æ”¹åŠ¨ä½ å‡†å¤‡å¥½äº†ï¼Œè¦æäº¤</strong>ã€‚</p><p>ğŸ“ ç‰¹ç‚¹ï¼š</p><ul><li>é€šè¿‡ <code>git add</code> æŠŠå·¥ä½œåŒºçš„æ”¹åŠ¨æ”¾è¿›æ¥ï¼›</li><li>æ˜¯æäº¤ä¹‹å‰çš„â€œæ‰“åŒ…æ¸…å•â€ï¼›</li><li>æ²¡æœ‰ <code>add</code> çš„æ”¹åŠ¨ä¸ä¼šè¢«æäº¤ã€‚</li></ul><p>ğŸ§  å°±åƒä½ æ•´ç†å¥½æ–‡ä»¶ï¼Œå…ˆæ”¾è¿›äº†â€œå¾…å½’æ¡£ç›’å­â€ï¼Œå‡†å¤‡æ‰“åŒ…ã€‚</p><hr /><h2 id="3-æœ¬åœ°ä»“åº“local-repository"><a class="markdownIt-Anchor" href="#3-æœ¬åœ°ä»“åº“local-repository"></a> ğŸ“¦ 3. æœ¬åœ°ä»“åº“ï¼ˆLocal Repositoryï¼‰</h2><p>æœ¬åœ°ä»“åº“å°±æ˜¯ Git çœŸæ­£ä¿å­˜ä½ æäº¤è®°å½•çš„åœ°æ–¹ã€‚</p><p>ğŸ“ ç‰¹ç‚¹ï¼š</p><ul><li>é€šè¿‡ <code>git commit</code> æŠŠæš‚å­˜åŒºçš„å†…å®¹æäº¤è¿›æ¥ï¼›</li><li>ä¿å­˜åœ¨ <code>.git</code> æ–‡ä»¶å¤¹ä¸­ï¼›</li><li>å¯ä»¥éšæ—¶å›é€€ã€æŸ¥çœ‹å†å²è®°å½•ã€‚</li></ul><p>ğŸ§  å®ƒæ˜¯ä½ ç”µè„‘ä¸Šçš„â€œç‰ˆæœ¬æ—¶å…‰æœºâ€ã€‚</p><hr /><h2 id="4-è¿œç¨‹ä»“åº“remote-repository"><a class="markdownIt-Anchor" href="#4-è¿œç¨‹ä»“åº“remote-repository"></a> ğŸŒ 4. è¿œç¨‹ä»“åº“ï¼ˆRemote Repositoryï¼‰</h2><p>è¿œç¨‹ä»“åº“æ˜¯ä½ å’Œå…¶ä»–äººåä½œçš„åœ°æ–¹ï¼Œé€šå¸¸åœ¨ GitHubã€GitLabã€Gitee ç­‰å¹³å°ä¸Šã€‚</p><p>ğŸ“ ç‰¹ç‚¹ï¼š</p><ul><li>é€šè¿‡ <code>git push</code> æŠŠæœ¬åœ°ä»“åº“çš„æäº¤ä¸Šä¼ ï¼›</li><li>é€šè¿‡ <code>git pull</code> æ‹‰å–è¿œç¨‹çš„æœ€æ–°æ›´æ–°ï¼›</li><li>å¤šäººåä½œçš„æ ¸å¿ƒæ‰€åœ¨ã€‚</li></ul><p>ğŸ§  å°±åƒæ˜¯â€œäº‘ç«¯å¤‡ä»½ä¸­å¿ƒâ€ï¼Œä½ å¯ä»¥å’Œå°ä¼™ä¼´ä¸€èµ·åŒæ­¥ä»£ç ã€‚</p><h1 id="git-æ ¸å¿ƒå‘½ä»¤å…¨é¢ç†è§£"><a class="markdownIt-Anchor" href="#git-æ ¸å¿ƒå‘½ä»¤å…¨é¢ç†è§£"></a> ğŸš€Git æ ¸å¿ƒå‘½ä»¤å…¨é¢ç†è§£</h1><p>åœ¨æŒæ¡äº† Git çš„å››å¤§åŒºåŸŸåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦é€šè¿‡äº”ä¸ªéå¸¸é‡è¦çš„å‘½ä»¤ï¼š<strong>merge</strong>ã€<strong>rebase</strong>ã€<strong>reset</strong>ã€<strong>revert</strong> å’Œ <strong>checkout</strong>ï¼Œå½»åº•æ­å¼€ Git ç‰ˆæœ¬æ§åˆ¶çš„æœ¬è´¨ï¼Œå…¶ä¸­mergeå’Œrebaseä¸ºä¸€ç»„ï¼Œæ˜¯æ¶‰åŠåˆ†æ”¯åˆå¹¶çš„å‘½ä»¤ï¼Œresetã€revertå’Œcheckoutä¸ºä¸€ç»„ï¼Œæ˜¯æ¶‰åŠcommitæ“ä½œçš„å‘½ä»¤ã€‚</p><hr /><h2 id="1-git-merge-åˆå¹¶åˆ†æ”¯"><a class="markdownIt-Anchor" href="#1-git-merge-åˆå¹¶åˆ†æ”¯"></a> 1. <code>git merge</code> â€” åˆå¹¶åˆ†æ”¯ ğŸ”€</h2><p><code>git merge</code> ç”¨äºå°†ä¸¤ä¸ªåˆ†æ”¯çš„å†å²ç»“åˆåœ¨ä¸€èµ·ï¼Œäº§ç”Ÿä¸€æ¬¡æ–°çš„åˆå¹¶æäº¤ï¼ˆmerge commitï¼‰ã€‚</p><h3 id="ï¸-ä½¿ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#ï¸-ä½¿ç”¨åœºæ™¯"></a> âœï¸ ä½¿ç”¨åœºæ™¯ï¼š</h3><ul><li>å½“ä½ åœ¨å¼€å‘åˆ†æ”¯ä¸Šå®Œæˆäº†åŠŸèƒ½ï¼Œæƒ³è¦æŠŠå®ƒåˆå¹¶åˆ°ä¸»åˆ†æ”¯æ—¶ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œmergeæœ‰ä¸€ä¸ªæ˜¾è‘—ç‰¹å¾ï¼Œå°±æ˜¯<code>åˆå¹¶åˆ†æ”¯ï¼Œç„¶åäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„æäº¤ï¼ˆcommitï¼‰ï¼Œè¿™ä¸rebaseå­˜åœ¨å¾ˆå¤§çš„åŒºåˆ«</code>ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426214021207.png" alt="image-20250426214021207" /></p><h3 id="ï¸-å…¸å‹å‘½ä»¤"><a class="markdownIt-Anchor" href="#ï¸-å…¸å‹å‘½ä»¤"></a> ğŸ› ï¸ å…¸å‹å‘½ä»¤ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout main</span><br><span class="line">git merge feature-branch</span><br></pre></td></tr></table></figure><p>è¿™ä¼šæŠŠ <code>feature-branch</code> çš„ä¿®æ”¹åˆå¹¶åˆ° <code>main</code>ã€‚</p><h3 id="ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹"></a> âš¡ ç‰¹ç‚¹ï¼š</h3><ul><li><strong>ä¿ç•™åˆ†æ”¯å†å²</strong>ã€‚</li><li>å¯èƒ½å‡ºç°å†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³ã€‚</li></ul><hr /><h2 id="2-git-rebase-å˜åŸºæ“ä½œ"><a class="markdownIt-Anchor" href="#2-git-rebase-å˜åŸºæ“ä½œ"></a> 2. <code>git rebase</code> â€” å˜åŸºæ“ä½œ ğŸŒ±</h2><p><code>git rebase</code> çš„ä½œç”¨æ˜¯æŠŠä¸€ç³»åˆ—æäº¤â€œæ¬å®¶â€ï¼Œé‡æ–°åº”ç”¨åˆ°å¦ä¸€æ¡åˆ†æ”¯çº¿çš„åé¢ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯<strong>è®©æäº¤å†å²çœ‹èµ·æ¥åƒä¸€æ¡ç›´çº¿</strong>ã€‚</p><h3 id="ï¸-ä½¿ç”¨åœºæ™¯-2"><a class="markdownIt-Anchor" href="#ï¸-ä½¿ç”¨åœºæ™¯-2"></a> âœï¸ ä½¿ç”¨åœºæ™¯ï¼š</h3><ul><li>æƒ³è®©æäº¤å†å²æ›´æ¸…æ™°ç®€æ´ã€‚</li><li>éœ€è¦åœ¨åˆå¹¶ä»£ç å‰æ¸…ç†æäº¤è®°å½•ã€‚</li></ul><p>rebaseå‘½ä»¤â€œäººå¦‚å…¶åâ€œï¼Œå˜åŸºå‘½ä»¤é€šè¿‡å°†<code>featureåˆ†æ”¯ç›´æ¥ç§»åŠ¨åˆ°mainåˆ†æ”¯åé¢å®ç°åˆå¹¶ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä¹Ÿä¸ä¼šäº§ç”Ÿæ–°çš„æäº¤è®°å½•</code>ï¼Œè™½ç„¶mergeå’Œrebaseçš„å¤„ç†é€»è¾‘ä¸åŒï¼Œä½†æœ¬è´¨ä¸Šä¸¤ä¸ªå‘½ä»¤éƒ½å®Œæˆäº†å¯¹åˆ†æ”¯çš„åˆå¹¶ï¼Œè¿™æ˜¯å€¼å¾—æ³¨æ„çš„ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426214133974.png" alt="image-20250426214133974" /></p><h3 id="ï¸-å…¸å‹å‘½ä»¤-2"><a class="markdownIt-Anchor" href="#ï¸-å…¸å‹å‘½ä»¤-2"></a> ğŸ› ï¸ å…¸å‹å‘½ä»¤ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature-branch</span><br><span class="line">git rebase main</span><br></pre></td></tr></table></figure><p>è¿™è¡¨ç¤ºï¼šæŠŠ <code>feature-branch</code> çš„æäº¤æ”¾åˆ° <code>main</code> æœ€æ–°æäº¤ä¹‹åã€‚</p><h3 id="ç‰¹ç‚¹-2"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹-2"></a> âš¡ ç‰¹ç‚¹ï¼š</h3><ul><li><strong>å†å²æ›´å¹²å‡€</strong>ã€‚</li><li>æ”¹å˜æäº¤å†å²ï¼ˆâš ï¸ ä¸å»ºè®®åœ¨å…¬å…±åˆ†æ”¯ä¸Šåš rebaseï¼‰ã€‚</li></ul><hr /><h2 id="3-git-reset-å›é€€æ“ä½œ"><a class="markdownIt-Anchor" href="#3-git-reset-å›é€€æ“ä½œ"></a> 3. <code>git reset</code> â€” å›é€€æ“ä½œ âª</h2><p><code>git reset</code> ç”¨æ¥ç§»åŠ¨å½“å‰åˆ†æ”¯çš„æŒ‡é’ˆï¼ˆHEADï¼‰åˆ°ä¸€ä¸ªæŒ‡å®šçš„æäº¤ï¼Œå¹¶ä¸”æ ¹æ®å‚æ•°ï¼ˆ<code>--soft</code>ã€<code>--mixed</code>ã€<code>--hard</code>ï¼‰å†³å®šå¦‚ä½•å¤„ç†æš‚å­˜åŒºå’Œå·¥ä½œåŒºã€‚</p><h3 id="ï¸-ä½¿ç”¨åœºæ™¯-3"><a class="markdownIt-Anchor" href="#ï¸-ä½¿ç”¨åœºæ™¯-3"></a> âœï¸ ä½¿ç”¨åœºæ™¯ï¼š</h3><ul><li>æƒ³æ’¤é”€æœ€è¿‘çš„æäº¤æˆ–å–æ¶ˆæš‚å­˜æŸäº›æ–‡ä»¶ã€‚</li><li>æ¸…é™¤é”™è¯¯æäº¤ï¼Œé‡æ–°æ•´ç†æäº¤è®°å½•ã€‚</li></ul><p>ä½¿ç”¨resetçš„è¿‡ç¨‹ä¸­å¿…é¡»äº†è§£å·¥ä½œåŒºã€æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“çš„å˜åŒ–æƒ…å†µï¼Œä½†resetæ—¶ä¸ç®¡ä½¿ç”¨å“ªä¸ªå‚æ•°ï¼Œæœ¬åœ°ä»“åº“çš„æäº¤ä¸€å®šæ˜¯ä¼šè¢«ç§»é™¤çš„ã€‚åœ¨å®é™…æƒ…å†µä¸­ï¼Œä½¿ç”¨resetå¾€å¾€æ˜¯ä¸ºäº†å½»åº•çš„å›åˆ°æŸä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥å¾€å¾€æ­é…<code>--hard</code>å‚æ•°ä½¿ç”¨ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426220217412.png" alt="image-20250426220217412" /></p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨resetä¹‹åæƒ³è¦æœ¬åœ°ä»“åº“æ¢å¤åˆ°resetä¹‹å‰çš„æ–‡ä»¶å†…å®¹<code>ï¼ˆè¿™é‡Œä»…ä»…æŒ‡æ¢å¤æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯æ¢å¤æäº¤è®°å½•ï¼‰</code></p><ul><li>softï¼šå› ä¸ºsoftå‘½ä»¤åœ¨å·¥ä½œç›®å½•å’Œæš‚å­˜åŒºä¸­éƒ½ä¿æœ‰æ–‡ä»¶å†…å®¹ï¼Œæ‰€ä»¥ç›´æ¥<code>git commit</code>å°±å¯ä»¥æ¢å¤æœ¬åœ°ä»“åº“çš„æ–‡ä»¶å†…å®¹</li><li>mixedï¼šmixedåœ¨å·¥ä½œç›®å½•ä¸­ä¿æœ‰æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å…ˆ<code>git add</code>ç„¶å<code>git commit</code>æ¢å¤æœ¬åœ°ä»“åº“çš„æ–‡ä»¶å†…å®¹</li><li>hardï¼šé€šè¿‡å¯¹softå’Œmixedçš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“æ— è®ºæ˜¯softè¿˜æ˜¯mixedï¼Œåœ¨å·¥ä½œåŒºä¸­åŸæ¥çš„æ–‡ä»¶å†…å®¹ä¾ç„¶æ˜¯å­˜åœ¨ä¸”æœªè¢«ä¿®æ”¹çš„ï¼Œä½†æ˜¯hardä¿®æ”¹äº†ä»å·¥ä½œåŒºåˆ°æœ¬åœ°ä»“åº“çš„å…¨éƒ¨å†…å®¹ï¼Œæ‰€ä»¥è¯´hardå‚æ•°æ˜¯å±é™©çš„ã€‚ä½†æ˜¯ï¼ŒGitå®é™…ä¸Šè¿˜ç•™äº†ä¸€æ‰‹ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ï¼ŒGitæœ¬åœ°é¢å¤–ä¿å­˜äº†ä¸€ä¸ª<code>reflog</code>ï¼Œé€šè¿‡<code>reflog</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾å›resetä¹‹å‰çš„å†…å®¹ã€‚</li></ul><h3 id="ï¸-å¸¸è§å‘½ä»¤"><a class="markdownIt-Anchor" href="#ï¸-å¸¸è§å‘½ä»¤"></a> ğŸ› ï¸ å¸¸è§å‘½ä»¤ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset --soft HEAD~1   <span class="comment"># å›é€€ä¸€ä¸ªæäº¤ï¼Œä½†ä¿ç•™æ”¹åŠ¨</span></span><br><span class="line">git reset --mixed HEAD~1  <span class="comment"># å›é€€å¹¶å–æ¶ˆæš‚å­˜ï¼Œä½†ä¿ç•™å·¥ä½œåŒº</span></span><br><span class="line">git reset --hard HEAD~1   <span class="comment"># å…¨é¢å›é€€ï¼ˆæäº¤+æš‚å­˜åŒº+å·¥ä½œåŒºï¼‰</span></span><br></pre></td></tr></table></figure><h3 id="ç‰¹ç‚¹-3"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹-3"></a> âš¡ ç‰¹ç‚¹ï¼š</h3><ul><li><strong>æœ¬åœ°ä¿®æ”¹é£é™©å¤§ï¼Œæ…ç”¨ <code>--hard</code>ï¼</strong></li><li>åªå½±å“æœ¬åœ°ä»“åº“ï¼Œä¸è‡ªåŠ¨å½±å“è¿œç¨‹åˆ†æ”¯ã€‚</li></ul><hr /><h2 id="4-git-revert-æ’¤é”€æäº¤ä½†ä¿ç•™å†å²"><a class="markdownIt-Anchor" href="#4-git-revert-æ’¤é”€æäº¤ä½†ä¿ç•™å†å²"></a> 4. <code>git revert</code> â€” æ’¤é”€æäº¤ä½†ä¿ç•™å†å² ğŸ”„</h2><p><code>git revert</code> ç”¨äºç”Ÿæˆä¸€æ¡æ–°çš„æäº¤ï¼Œè¿™æ¡æäº¤<strong>ä¼šæŠµæ¶ˆæŒ‡å®šæäº¤çš„æ›´æ”¹</strong>ã€‚å’Œ <code>reset</code> ä¸åŒï¼Œå®ƒä¸ä¼šä¿®æ”¹å†å²è®°å½•ï¼Œè€Œæ˜¯é€šè¿‡æ–°å¢æäº¤æ¥â€œåè½¬â€æ—§æäº¤çš„æ•ˆæœã€‚</p><h3 id="ï¸-ä½¿ç”¨åœºæ™¯-4"><a class="markdownIt-Anchor" href="#ï¸-ä½¿ç”¨åœºæ™¯-4"></a> âœï¸ ä½¿ç”¨åœºæ™¯ï¼š</h3><ul><li>åœ¨å…¬å…±åˆ†æ”¯ä¸Šéœ€è¦æ’¤é”€æŸæ¬¡æäº¤ï¼Œä½†ä¸èƒ½ç ´åå†å²è®°å½•ã€‚</li></ul><p>å…³äºrevertï¼Œä½ éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œrevertæ˜¯é€šè¿‡æ–°å»ºä¸€ä¸ªcommitæ¥æ’¤é”€ä¹‹å‰commitçš„<code>å†…å®¹</code>ï¼Œåœ¨commit 6ä¸­ï¼Œ<code>åè½¬</code>äº†commit 3çš„å†…å®¹ï¼Œä»è€Œå®ç°æ’¤é”€ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426221746181.png" alt="image-20250426221746181" /></p><h3 id="ï¸-å…¸å‹å‘½ä»¤-3"><a class="markdownIt-Anchor" href="#ï¸-å…¸å‹å‘½ä»¤-3"></a> ğŸ› ï¸ å…¸å‹å‘½ä»¤ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;commit-id&gt;</span><br></pre></td></tr></table></figure><h3 id="ç‰¹ç‚¹-4"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹-4"></a> âš¡ ç‰¹ç‚¹ï¼š</h3><ul><li><strong>å®‰å…¨æ’¤é”€</strong>ï¼Œä¸ä¼šå¼•èµ·å†å²æ–­è£‚ã€‚</li><li>é€‚åˆå¤šäººåä½œé¡¹ç›®ã€‚</li></ul><hr /><h2 id="5-git-checkout-åˆ‡æ¢ä¸æ¢å¤"><a class="markdownIt-Anchor" href="#5-git-checkout-åˆ‡æ¢ä¸æ¢å¤"></a> 5. <code>git checkout</code> â€” åˆ‡æ¢ä¸æ¢å¤ ğŸ§³</h2><p><code>git checkout</code> æ˜¯ä¸€ä¸ªè¶…çº§å¸¸ç”¨çš„å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥ï¼š</p><ul><li><strong>åˆ‡æ¢åˆ†æ”¯</strong></li><li><strong>è¿˜åŸæ–‡ä»¶</strong></li><li><strong>æ£€å‡ºç‰¹å®šç‰ˆæœ¬çš„å†…å®¹</strong></li></ul><h3 id="ï¸-ä½¿ç”¨åœºæ™¯-5"><a class="markdownIt-Anchor" href="#ï¸-ä½¿ç”¨åœºæ™¯-5"></a> âœï¸ ä½¿ç”¨åœºæ™¯ï¼š</h3><ul><li>åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯å¼€å‘æ–°åŠŸèƒ½ã€‚</li><li>æ¢å¤å•ä¸ªæ–‡ä»¶åˆ°å†å²ç‰ˆæœ¬ã€‚</li></ul><p>åœ¨å…·ä½“ä»‹ç»ä¹‹å‰ï¼Œæˆ‘éœ€è¦æåŠä¸€ä¸ªæ¦‚å¿µâ€”â€”HEADæŒ‡é’ˆï¼Œåœ¨Gitä¸­ï¼ŒHEADæŒ‡é’ˆæ°¸è¿œæŒ‡å‘æˆ‘ä»¬æ­£åœ¨æ“ä½œçš„commitï¼Œåœ¨ä¸Šé¢å…³äºresetå’Œrevertçš„å‘½ä»¤å›¾ç‰‡ä¸­ï¼Œæˆ‘çœç•¥äº†HEADï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´å›¾ç‰‡ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426221331988.png" alt="image-20250426221331988" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426221852532.png" alt="image-20250426221852532" /></p><p>ä¸ºä»€ä¹ˆè¦æåŠHEADçš„æ¦‚å¿µå‘¢ï¼Œå› ä¸ºä½ å¯ä»¥è¿™æ ·ç†è§£ï¼Œ<code>git checkoutå°±æ˜¯git reset --hard</code>ï¼ŒåŒºåˆ«æ˜¯<code>git reset --hardä¼šåŒæ—¶ç§»åŠ¨headå’Œmainï¼Œä½†æ˜¯git checkoutåªç§»åŠ¨head</code>ã€‚æ­£å› å¦‚æ­¤ï¼Œæˆ‘ä»¬åªç§»åŠ¨äº†headï¼Œæ‰€ä»¥checkoutåå¯ä»¥éšæ—¶å›åˆ°åŸæ¥çš„commitï¼Œè€Œå¯¹äº<code>git reset --hard</code>è€Œè¨€ï¼Œå› ä¸ºæ°¸ä¹…ç§»åŠ¨äº†headå’Œmainï¼Œä¸å†æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘åŸæ¥çš„commitï¼Œæˆ‘ä»¬ä¹Ÿå°±æ— æ³•å†å›åˆ°åŸæ¥çš„commitäº†ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250426222348728.png" alt="image-20250426222348728" /></p><p>æ­¤å¤–ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œæˆ‘æåˆ°äº†<code>checkout</code>çš„æœ¬è´¨ä¸<code>reset --hard</code>æ˜¯å­˜åœ¨ç›¸ä¼¼ä¹‹å¤„çš„ï¼Œåœ¨checkoutä¹‹åæˆ‘ä»¬ä¼šä¸¢å¤±æ‰€æœ‰åŸæ¥çš„æ–‡ä»¶å†…å®¹ï¼Œåªæ˜¯å› ä¸ºcheckoutä¿ç•™äº†mainæŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å›åˆ°mainæ‰€åœ¨çš„ä½ç½®ï¼Œä½†æ˜¯<code>å·¥ä½œç›®å½•å’Œæš‚å­˜åŒºçš„å†…å®¹å¹¶ä¸ä¼šä¿å­˜</code>ï¼Œæ‰€åœ¨åœ¨checkoutä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜å¥½å·¥ä½œç›®å½•å’Œæš‚å­˜åŒºçš„å†…å®¹ï¼Œä½ å¯ä»¥é€šè¿‡ç›´æ¥commitæäº¤å½“å‰å†…å®¹æˆ–è€…ä½¿ç”¨git stashçš„æ–¹å¼ä¿å­˜å·¥ä½œç›®å½•å’Œæš‚å­˜åŒºçš„å†…å®¹ã€‚</p><h3 id="ï¸-å…¸å‹å‘½ä»¤-4"><a class="markdownIt-Anchor" href="#ï¸-å…¸å‹å‘½ä»¤-4"></a> ğŸ› ï¸ å…¸å‹å‘½ä»¤ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout HEAD~2 file.txt  <span class="comment"># æŠŠ file.txt è¿˜åŸåˆ°ä¸¤æ¬¡æäº¤å‰çš„ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><h3 id="ç‰¹ç‚¹-5"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹-5"></a> âš¡ ç‰¹ç‚¹ï¼š</h3><ul><li>ç»“åˆ <code>stash</code> ä½¿ç”¨ï¼Œå¯ä»¥çµæ´»ç®¡ç†ä¿®æ”¹ã€‚</li><li>å°å¿ƒä½¿ç”¨ï¼Œä¸è¦è¦†ç›–äº†å·¥ä½œåŒºçš„æ”¹åŠ¨ã€‚</li></ul><hr /><h1 id="å°ç»“"><a class="markdownIt-Anchor" href="#å°ç»“"></a> ğŸ å°ç»“</h1><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å…³é”®è¯</th></tr></thead><tbody><tr><td><code>merge</code></td><td>åˆå¹¶åˆ†æ”¯ï¼Œä¿ç•™å®Œæ•´å†å²</td><td>åˆå¹¶ã€å†²çªå¤„ç†</td></tr><tr><td><code>rebase</code></td><td>å˜åŸºæ“ä½œï¼Œæ•´ç†æäº¤</td><td>æ•´æ´ã€çº¿æ€§å†å²</td></tr><tr><td><code>reset</code></td><td>å›é€€æäº¤æˆ–å–æ¶ˆæš‚å­˜</td><td>æŒ‡é’ˆç§»åŠ¨ã€é£é™©æ“ä½œ</td></tr><tr><td><code>revert</code></td><td>æ’¤é”€æŸæ¬¡æäº¤å¹¶ç”Ÿæˆæ–°çš„æäº¤</td><td>å®‰å…¨æ’¤é”€ã€å¤šäººåä½œ</td></tr><tr><td><code>checkout</code></td><td>åˆ‡æ¢åˆ†æ”¯æˆ–æ¢å¤æ–‡ä»¶</td><td>åˆ†æ”¯ç®¡ç†ã€æ–‡ä»¶æ¢å¤</td></tr></tbody></table><p>æŒæ¡äº†è¿™äº”å¤§å‘½ä»¤ä¹‹åï¼Œä½ å°±çœŸæ­£ç†è§£äº† Git çš„â€œæ—¶é—´çº¿æ“ä½œè‰ºæœ¯â€ï¼ğŸ¨âœ¨<br />æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ç»“åˆå®é™…æ¡ˆä¾‹ï¼Œè¿›ä¸€æ­¥æ¼”ç»ƒè¿™äº›å‘½ä»¤ï¼Œä½“éªŒ Git çš„å¼ºå¤§ä¸çµæ´»ã€‚</p><p>æœ€åï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘æ¨èä½ ä¸€ä¸ªç»ƒä¹ Gitçš„å¥½å¹³å°ï¼š</p><ul><li><a href="https://learngitbranching.js.org/?locale=zh_CN">Learn Git Branching</a></li></ul><p>å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©</p>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³Ubuntu24å®‰è£…æœç‹—è¾“å…¥æ³•å¤±è´¥</title>
      <link href="/2025/03/09/%E8%A7%A3%E5%86%B3Ubuntu24%E5%AE%89%E8%A3%85%E6%90%9C%E7%8B%90%E8%BE%93%E5%85%A5%E6%B3%95%E5%A4%B1%E8%B4%A5/"/>
      <url>/2025/03/09/%E8%A7%A3%E5%86%B3Ubuntu24%E5%AE%89%E8%A3%85%E6%90%9C%E7%8B%90%E8%BE%93%E5%85%A5%E6%B3%95%E5%A4%B1%E8%B4%A5/</url>
      
        <content type="html"><![CDATA[<p>â€‹æ–°å®‰è£…äº†Ubuntu24ä¹‹åï¼Œæ— æ³•æˆåŠŸå®‰è£…æœç‹è¾“å…¥æ³•ï¼ŒåŸå› æ˜¯Ubuntu24ä½¿ç”¨çš„æ˜¯fcitx5ï¼Œç‰ˆæœ¬è¿‡æ–°ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯å¸è½½fcitx5ï¼Œå®‰è£…è€fcitx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove fcitx5 fcitx5-chinese-addons fcitx5-module-chttrans fcitx5-module-fullwidth fcitx5-module-punctuation</span><br><span class="line"><span class="built_in">sudo</span> apt install fcitx fcitx-data</span><br></pre></td></tr></table></figure><p>ç„¶åå‰©ä¸‹çš„å†…å®¹æŒ‰ç…§æœç‹å®˜ç½‘çš„å®‰è£…æ•™ç¨‹å®‰è£…å³å¯</p><p><a href="https://pinyin.sogou.com/linux/help.php">https://pinyin.sogou.com/linux/help.php</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>hexoç¯å¢ƒé…ç½®è®°å½•</title>
      <link href="/2025/03/09/hexo%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/03/09/hexo%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>è¯¥åšå®¢ç”¨äºè®°å½•å¦‚ä½•å¿«é€Ÿæ¢å¤åšå®¢ç¯å¢ƒ</p><h1>é…ç½®node</h1><h3 id="å®‰è£…nodeç¯å¢ƒ">å®‰è£…nodeç¯å¢ƒ</h3><p><a href="https://nodejs.cn/download/">https://nodejs.cn/download/</a></p><p>å®‰è£…æœ€æ–°ç‰ˆnodeï¼Œè§£å‹åé…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿›å…¥nodeçš„binç›®å½•åé“¾æ¥npmå’Œnodeåˆ°<code>/usr/local/bin</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s $(<span class="built_in">pwd</span>)/node /usr/local/bin/node</span><br><span class="line"><span class="built_in">ln</span> -s $(<span class="built_in">pwd</span>)/npm /usr/local/bin/npm</span><br></pre></td></tr></table></figure><p>ç„¶åé…ç½®<code>lib/node_modules</code>åˆ°ç¯å¢ƒå˜é‡ï¼Œ<code>node -g</code>å®‰è£…çš„åº”ç”¨ä¼šå®‰è£…åˆ°è¿™é‡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export \&quot;PATH=\$PATH:<span class="subst">$(pwd)</span>\&quot;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æ¢¯å­å¯ä»¥å®‰è£…ä¸€ä¸‹cnpm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm -registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><h1>é…ç½®Github SSH</h1><p>éå¸¸ç®€å•ï¼Œæœ¬åœ°ç”Ÿæˆå…¬é’¥ç§é’¥ä¹‹åå°†å…¬é’¥æ”¾åœ¨Github SSHä¸­å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;xxx@xxx.com&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰¾åˆ°<code>id_rsa.pub</code>æ”¾åˆ°Githubçš„sshé…ç½®ä¸­</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250309112054425.png" alt="image-20250309112054425"></p><h1>é…ç½®PicGo</h1><p>å®‰è£…PicGo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g picgo</span><br></pre></td></tr></table></figure><p>é…ç½®é˜¿é‡Œäº‘å›¾åºŠï¼Œåœ¨<code>~/.picgo/config.json</code>é‡Œå¡«å…¥å¯¹åº”ä¿¡æ¯å°±å¯ï¼Œåä¸œä¸€å¡«å…¥<code>oss-cn-hangzhou</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;aliyun&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="string">&quot;aliyun&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aliyun&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;accessKeyId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;accessKeySecret&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;area&quot;</span><span class="punctuation">:</span> <span class="string">&quot;oss-cn-hangzhou&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>æ’å…¥å›¾ç‰‡æ—¶</code>ä¸º<code>ä¸Šä¼ å›¾ç‰‡</code>ï¼Œè®¾ç½®<code>ä¸Šä¼ æœåŠ¡</code>æ˜¯<code>PicGo-Core</code>ï¼Œè¿™é‡Œtyporaå¯èƒ½ä¼šæŠ¥é”™æ‰¾ä¸åˆ°PicGo-Coreï¼Œæˆ‘ä»¬æ ¹æ®æŠ¥é”™å°†PicGoé“¾æ¥åˆ°ç›®æ ‡ç›®å½•å³å¯</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250309111834795.png" alt="image-20250309111834795"></p><h1>å®‰è£…hexo</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»githubä»“åº“ä¸­ä¸‹è½½ä¹‹å‰çš„blogï¼Œè·å–mainåˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b main https://github.com/jking412/jking412.github.io.git</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20250309112249369.png" alt="image-20250309112249369"></p><p>è¿›å…¥æ–‡ä»¶å¤¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> jking412.github.io</span><br><span class="line">npm install</span><br><span class="line"><span class="built_in">cp</span> -r butterfly themes</span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>å³å¯é…ç½®å¥½æœ¬åœ°hexoç¯å¢ƒ</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>opensslç”Ÿæˆè‡ªç­¾åè¯ä¹¦</title>
      <link href="/2024/01/27/openssl%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/"/>
      <url>/2024/01/27/openssl%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨opensslå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œæ­¥éª¤å¦‚ä¸‹</p><ol><li>åˆ›å»ºç§é’¥</li></ol><p>ç”±äºæ˜¯è‡ªç­¾åï¼Œè¯¥ç§é’¥ä¼šåŒæ—¶ç”¨äºç­¾åå’ŒæœåŠ¡å™¨æœ¬èº«ï¼Œé‡‡ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out my.key 2048</span><br></pre></td></tr></table></figure><ol start="2"><li>åŸºäºç§é’¥åˆ›å»ºcsrï¼ˆè¯ä¹¦è¯·æ±‚ç­¾åï¼‰ï¼Œcsrä¸­åŒ…å«æœåŠ¡å™¨å…¬é’¥</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key my.key -out my.csr -subj <span class="string">&quot;/C=CN/ST=shanghai/L=shanghai/O=example/OU=it/CN=domain1/CN=domain2&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/C= Country å›½å®¶</span><br><span class="line">/ST= State or Province çœ</span><br><span class="line">/L= Location or City åŸå¸‚</span><br><span class="line">/O= Organization ç»„ç»‡æˆ–ä¼ä¸š</span><br><span class="line">/OU= Organization Unit éƒ¨é—¨</span><br><span class="line">/CN= Common Name åŸŸåæˆ–IP</span><br></pre></td></tr></table></figure><ol start="3"><li>æœ€åä½¿ç”¨csrå’Œkeyæ¥ç”Ÿæˆè¯ä¹¦</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -<span class="keyword">in</span> my.csr -out my.crt -signkey my.key -days 3650</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lab1-æ·»åŠ å†…æ ¸æ¨¡å—</title>
      <link href="/2023/10/17/lab1-%E6%B7%BB%E5%8A%A0%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97/"/>
      <url>/2023/10/17/lab1-%E6%B7%BB%E5%8A%A0%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<p>ä»¥é¢˜ç›®ä¸€ä¸ºä¾‹è¿›è¡Œå†…æ ¸æ¨¡å—ç¼–ç¨‹ï¼š</p><blockquote><p>é¢˜ç›®1ï¼š</p><ol><li>è®¾è®¡ä¸€ä¸ªæ¨¡å—ï¼Œè¦æ±‚åˆ—å‡ºç³»ç»Ÿä¸­æ‰€æœ‰å†…æ ¸çº¿ç¨‹çš„ç¨‹åºåã€PIDã€è¿›ç¨‹çŠ¶æ€ã€è¿›ç¨‹ä¼˜å…ˆçº§ã€çˆ¶è¿›ç¨‹çš„PIDã€‚</li><li>è®¾è®¡ä¸€ä¸ªå¸¦å‚æ•°çš„æ¨¡å—ï¼Œå…¶å‚æ•°ä¸ºæŸä¸ªè¿›ç¨‹çš„PIDå·ï¼Œæ¨¡å—çš„åŠŸèƒ½æ˜¯åˆ—å‡ºè¯¥è¿›ç¨‹çš„å®¶æ—ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶è¿›ç¨‹ã€å…„å¼Ÿè¿›ç¨‹å’Œå­è¿›ç¨‹çš„ç¨‹åºåã€PIDå·ã€è¿›ç¨‹çŠ¶æ€ã€‚å…·ä½“å‚è§æ•™æP336</li></ol></blockquote><p>ç¯å¢ƒ: <code>ubuntu22</code></p><h1 id="è®¤è¯†å†…æ ¸æ¨¡å—ç¼–ç¨‹çš„åŸºæœ¬æ¡†æ¶"><a class="markdownIt-Anchor" href="#è®¤è¯†å†…æ ¸æ¨¡å—ç¼–ç¨‹çš„åŸºæœ¬æ¡†æ¶"></a> è®¤è¯†å†…æ ¸æ¨¡å—ç¼–ç¨‹çš„åŸºæœ¬æ¡†æ¶</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">hello_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¸…ç†å‡½æ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">hello_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°æ³¨å†Œ</span></span><br><span class="line">module_init(hello_init);  </span><br><span class="line">module_exit(hello_exit);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—è®¸å¯ç”³æ˜</span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);  </span><br></pre></td></tr></table></figure><p>æœ‰ä¸‹è¿°å‡ ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼š</p><ol><li>ä¸‰ä¸ªå¤´æ–‡ä»¶å¿…é¡»å¼•å…¥</li><li>å¿…é¡»æ³¨å†Œåˆå§‹åŒ–å’Œé€€å‡ºå‡½æ•°</li><li>å¿…é¡»æœ‰æ¨¡å—è®¸å¯ç”³æ˜</li></ol><p>æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨å†…æ ¸ä¸­<code>æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç”¨æˆ·æ€å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½é€‚ç”¨è¯¸å¦‚printf,strlenç­‰å‡½æ•°ï¼Œéœ€è¦ä½¿ç”¨ä¸“é—¨çš„å†…æ ¸å‡½æ•°</code></p><p>ä¸‹é¢æ˜¯Makefileæ¨¡æ¿ï¼Œä¸‹é¢æ˜¯æœ€åŸºæœ¬ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ¨¡æ¿ï¼Œå…¶ä¸­ä¸ºä¸€è¦æ³¨æ„çš„é—®é¢˜æ˜¯<code>obj-mçš„åå­—éœ€è¦ä¸ç¼–å†™å†…æ ¸ä»£ç æ–‡ä»¶çš„åå­—å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œobj-mæ˜¯module1.oï¼Œä½ çš„.cæ–‡ä»¶çš„åå­—åº”è¯¥æ˜¯module1.c</code></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">obj-m:=module1.o    </span></span><br><span class="line">KDIR:= /lib/modules/<span class="variable">$(<span class="built_in">shell</span> uname -r)</span>/build</span><br><span class="line">PWD:= <span class="variable">$(<span class="built_in">shell</span> pwd)</span> </span><br><span class="line"></span><br><span class="line"><span class="section">default:</span></span><br><span class="line"><span class="variable">$(MAKE)</span> -C <span class="variable">$(KDIR)</span> M=<span class="variable">$(PWD)</span> modules  </span><br><span class="line"><span class="section">clean:</span></span><br><span class="line"><span class="variable">$(MAKE)</span> -C <span class="variable">$(KDIR)</span> M=<span class="variable">$(PWD)</span> clean</span><br></pre></td></tr></table></figure><h1 id="ç¼–ç¨‹æ‰“å°è¿›ç¨‹ä¿¡æ¯"><a class="markdownIt-Anchor" href="#ç¼–ç¨‹æ‰“å°è¿›ç¨‹ä¿¡æ¯"></a> ç¼–ç¨‹æ‰“å°è¿›ç¨‹ä¿¡æ¯</h1><h2 id="ç¬¬ä¸€å°é¢˜"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€å°é¢˜"></a> ç¬¬ä¸€å°é¢˜</h2><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå…ˆæ”¾åœ¨è¿™é‡Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init_task.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">hello_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    pr_alert(<span class="string">&quot;list start !\n&quot;</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">    printk(KERN_ALERT<span class="string">&quot;åç§°\tè¿›ç¨‹å·\tçŠ¶æ€\tä¼˜å…ˆçº§\tçˆ¶è¿›ç¨‹å·&quot;</span>);</span><br><span class="line">    <span class="type">int</span> kernel_thread_num = <span class="number">0</span>;</span><br><span class="line">    for_each_process(p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;mm == <span class="literal">NULL</span>)&#123; <span class="comment">//å†…æ ¸çº¿ç¨‹çš„mmæˆå‘˜ä¸ºç©º</span></span><br><span class="line">            kernel_thread_num++;</span><br><span class="line">            pr_info(<span class="string">&quot;%s\t%d\t%ld\t%d\n&quot;</span>,p-&gt;comm,p-&gt;pid, p-&gt;stats,p-&gt;rt_priority,p-&gt;parent-&gt;pid);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pr_info(<span class="string">&quot;kernel thread num is %d\n&quot;</span>,kernel_thread_num);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¸…ç†å‡½æ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">hello_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°æ³¨å†Œ</span></span><br><span class="line">module_init(hello_init);  </span><br><span class="line">module_exit(hello_exit);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—è®¸å¯ç”³æ˜</span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);  </span><br></pre></td></tr></table></figure><p>ä»‹ç»ä¸€ä¸‹ä¸€äº›å‡½æ•°:</p><ol><li>pr_info,pr_alertâ€¦ï¼šç”¨äºå†…æ ¸æ‰“å°</li><li>for_each_processï¼šé€šè¿‡éå†init_task(0å·è¿›ç¨‹å¯¹åº”çš„è¿›ç¨‹æ ‡è¯†ç¬¦)æ¥éå†æ‰€æœ‰å†…æ ¸çº¿ç¨‹</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> for_each_process(p) \</span></span><br><span class="line"><span class="meta">    for (p = &amp;init_task ; (p = next_task(p)) != &amp;init_task ; )</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ€åæ‰“å°äº†å†…æ ¸çº¿ç¨‹çš„æ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡linuxå‘½ä»¤ç®€å•éªŒè¯ï¼Œæˆ‘ä»¬é€šè¿‡å†…æ ¸çº¿ç¨‹çš„ç»„idä¸º0è¿™ä¸€ç‰¹ç‚¹è®¡ç®—å†…æ ¸çº¿ç¨‹æ•°é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -e -o pgid | awk <span class="string">&#x27;$1 == 0&#x27;</span> | <span class="built_in">wc</span> -l</span></span><br></pre></td></tr></table></figure><p>æ˜“æ¯”è¾ƒå¾—åˆ°ä¸€è‡´çš„ç»“æœ</p><h2 id="ç¬¬äºŒå°é¢˜"><a class="markdownIt-Anchor" href="#ç¬¬äºŒå°é¢˜"></a> ç¬¬äºŒå°é¢˜</h2><p>ç¬¬äºŒå°é¢˜ä¹Ÿä¸éš¾ï¼Œä¸»è¦æ˜¯å¯¹å†…æ ¸æä¾›çš„ä¸€äº›å®çš„åº”ç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init_task.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">pid_t</span>  pid = <span class="number">1</span>;</span><br><span class="line">module_param(pid,<span class="type">int</span>,<span class="number">0644</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">hello_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    pr_alert(<span class="string">&quot;list start !\n&quot;</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span> =</span> pid_task(find_get_pid(pid), PIDTYPE_PID);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">parent</span> =</span> task-&gt;parent;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">sibling</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> *<span class="title">list</span>;</span></span><br><span class="line">    <span class="comment">// List it own process</span></span><br><span class="line">    pr_info(<span class="string">&quot;Root: Name: %s, PID: %d, State: %ld\n&quot;</span>,task-&gt;comm,task-&gt;pid,task-&gt;stats);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// List parent process</span></span><br><span class="line">    pr_info(<span class="string">&quot;Parent: Name: %s, PID: %d, State: %ld\n&quot;</span>, parent-&gt;comm, parent-&gt;pid, parent-&gt;stats);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// List child processes</span></span><br><span class="line">    list_for_each(<span class="built_in">list</span>, &amp;task-&gt;children) &#123;</span><br><span class="line">        sibling = list_entry(<span class="built_in">list</span>, <span class="keyword">struct</span> task_struct, sibling);</span><br><span class="line">        pr_info(<span class="string">&quot;Child: Name: %s, PID: %d, State: %ld\n&quot;</span>, sibling-&gt;comm, sibling-&gt;pid, sibling-&gt;stats);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// List sibling processes</span></span><br><span class="line">    list_for_each(<span class="built_in">list</span>, &amp;parent-&gt;children) &#123;</span><br><span class="line">        sibling = list_entry(<span class="built_in">list</span>, <span class="keyword">struct</span> task_struct, sibling);</span><br><span class="line">        <span class="keyword">if</span> (sibling != task) &#123;</span><br><span class="line">            pr_info(<span class="string">&quot;Sibling: Name: %s, PID: %d, State: %ld\n&quot;</span>, sibling-&gt;comm, sibling-&gt;pid, sibling-&gt;stats);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¸…ç†å‡½æ•°</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">hello_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°æ³¨å†Œ</span></span><br><span class="line">module_init(hello_init);  </span><br><span class="line">module_exit(hello_exit);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—è®¸å¯ç”³æ˜</span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);  </span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p><ol><li>module_param(name,type,perm)ï¼šå£°æ˜æ¨¡å—çš„åå­—ï¼Œåˆ†åˆ«ä¸ºå˜é‡åï¼Œå˜é‡ç±»å‹å’Œæƒé™</li><li>list_for_eachï¼šä¸€ä¸ªç”¨äºå¸®åŠ©éå†çš„å®</li><li>list_entryï¼šç”¨äºå¸®åŠ©ç±»å‹è½¬æ¢</li></ol>]]></content>
      
      
      <categories>
          
          <category> hdu-os-lab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨linuxä¸Šå®‰è£…wireshark</title>
      <link href="/2023/10/10/%E5%9C%A8linux%E4%B8%8A%E5%AE%89%E8%A3%85wireshark/"/>
      <url>/2023/10/10/%E5%9C%A8linux%E4%B8%8A%E5%AE%89%E8%A3%85wireshark/</url>
      
        <content type="html"><![CDATA[<p>wiresharkæ˜¯ä¸€æ¬¾å¾ˆå¥½ç”¨çš„æŠ“åŒ…å·¥å…·ï¼Œå®ƒå¯ä»¥å®‰è£…åœ¨windows,linux,macosç­‰å¹³å°ä¸Šï¼Œåœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œä¼šå‘Šè¯‰ä½ å¦‚ä½•å®‰è£…wiresharkåœ¨ubuntuä¸Š</p><h1 id="ç”¨aptå®‰è£…wireshark"><a class="markdownIt-Anchor" href="#ç”¨aptå®‰è£…wireshark"></a> ç”¨aptå®‰è£…wireshark</h1><p>å¯ä»¥ç›´æ¥ä½¿ç”¨aptå®‰è£…wiresharkï¼Œä½†æ˜¯è¿™æ ·æ— æ³•å®‰è£…æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥æœ€å¥½å…ˆæ‰‹åŠ¨æ·»åŠ ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> add-apt-repository ppa:wireshark-dev/stable</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt update</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install wireshark</span></span><br></pre></td></tr></table></figure><p>å®‰è£…æ—¶ä½ å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªé€‰é¡¹ï¼Œè®©ä½ æ˜¯å¦å…è®¸érootç”¨æˆ·æŠ“åŒ…ï¼Œé€‰æ‹©&quot;æ˜¯&quot;</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/20231010103445.png" alt="20231010103445" /></p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹å‡ºç°ï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> dpkg-reconfigure wireshark-common</span></span><br></pre></td></tr></table></figure><p>ä¹‹åæˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬çš„ç”¨æˆ·æ·»åŠ åˆ°wiresharkç”¨æˆ·ç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> usermod -aG wireshark $(<span class="built_in">whoami</span>)</span></span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯æœºå™¨å°±å¯ä»¥ä½¿ç”¨wiresharkäº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> wireshark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kube-proxyå·¥ä½œæœºåˆ¶æµ…æ</title>
      <link href="/2023/10/09/kube-proxy%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%E6%B5%85%E6%9E%90/"/>
      <url>/2023/10/09/kube-proxy%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%E6%B5%85%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>kube-proxyæ˜¯k8sä¸­çš„é‡è¦ç»„ä»¶ï¼Œåœ¨k8sçš„æ•´ä¸ªç½‘ç»œæ¨¡å‹ä¸­æœ‰ç€é‡è¦çš„ä½œç”¨ï¼Œkube-proxyæœ‰ç€å¤šç§å·¥ä½œæ¨¡å¼ï¼Œæœ¬åšå®¢åªè€ƒè™‘åœ¨<code>iptables</code>æ¨¡å¼ä¸‹å·¥ä½œçš„kube-proxy</p><h1 id="iptables"><a class="markdownIt-Anchor" href="#iptables"></a> iptables</h1><p>iptablesæ˜¯linuxä¸­è‘—åçš„é˜²ç«å¢™ï¼Œæœ‰ç€è¿‡æ»¤ï¼Œè½¬å‘ç­‰å¤šç§åŠŸèƒ½ï¼Œiptablesä¸­æœ‰å¤šå¼ tableï¼Œæ¯å¼ tableæœ‰ç€ä¸åŒçš„åŠŸèƒ½ï¼Œä¸€å¼ tableç”±å¤šæ¡chainç»„æˆï¼Œchainä¸­çš„è§„åˆ™å†³å®šäº†åŒ…æœ€åçš„èµ°å‘</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/20231009135911.png" alt="20231009135911" /></p><p>nat tableæœ‰PREROUTINGï¼ŒOUTPUTï¼ŒPOSTROUTINGç­‰chainsï¼Œè¿™äº›chainsä¸­æœ‰è‹¥å¹²rulesï¼Œchainsä¸­çš„rulesä¼šå†³å®šæµå…¥çš„åŒ…çš„èµ°å‘ï¼Œç‰¹æ®Šçš„ï¼Œæœ¬åœ°è¿›ç¨‹å‘å‡ºçš„åŒ…ä¼šèµ°å‘OUTPUTï¼Œè€Œå¤–éƒ¨çš„åŒ…ä¸ä¼š</p><h1 id="kube-proxyçš„å·¥ä½œæœºåˆ¶"><a class="markdownIt-Anchor" href="#kube-proxyçš„å·¥ä½œæœºåˆ¶"></a> kube-proxyçš„å·¥ä½œæœºåˆ¶</h1><p>kube-proxyæ¥å—api-serverçš„ä¿¡æ¯ï¼Œæ¥æ”¶åˆ°åœ°å€çš„æ˜ å°„ä¿¡æ¯ä»¥åä¿®æ”¹iptablesçš„å†…å®¹ï¼Œé€šè¿‡linuxçš„iptableså®ç°kubernetesçš„ç½‘ç»œ</p><p>å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹kube-proxyçš„å·¥ä½œæ¨¡å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl localhost:10249/proxyMode</span></span><br></pre></td></tr></table></figure><p>è¿”å›çš„å†…å®¹å°±æ˜¯kube-proxyçš„å·¥ä½œæ¨¡å¼</p><h2 id="kube-proxy-å·¥ä½œå®ä¾‹"><a class="markdownIt-Anchor" href="#kube-proxy-å·¥ä½œå®ä¾‹"></a> kube-proxy å·¥ä½œå®ä¾‹</h2><p>å…ˆåˆ›å»ºä¸€ä¸ªdeploymentå’Œservice</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-conf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">default.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    server &#123;</span></span><br><span class="line"><span class="string">      listen 80;</span></span><br><span class="line"><span class="string">      location / &#123;</span></span><br><span class="line"><span class="string">        default_type text/plain;</span></span><br><span class="line"><span class="string">        return 200</span></span><br><span class="line"><span class="string">          &#x27;srv : $server_addr:$server_port\nhost: $hostname\nuri : $request_method $host $request_uri\ndate: $time_iso8601\n&#x27;;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ngx-conf-vol</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ngx-conf</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      </span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ngx-conf-vol</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-svc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl apply -f ngx.yaml</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®Œæˆæˆ‘ä»¬æŸ¥çœ‹serviceçš„clusterIPå’Œä¸¤ä¸ªpodçš„ip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl get svc</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes   ClusterIP   10.43.0.1       &lt;none&gt;        443/TCP        2d15h</span><br><span class="line">ngx-svc      NodePort    10.43.120.124   &lt;none&gt;        80/TCP         4s</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl get pod -o wide</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME                      READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES</span><br><span class="line">ngx-dep-9bf586b97-kshgd   1/1     Running   0          98s   10.42.0.148   honor   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">ngx-dep-9bf586b97-zbwww   1/1     Running   0          98s   10.42.0.149   honor   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹kube-proxyåœ¨iptablesä¸­åˆ›å»ºçš„rules"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹kube-proxyåœ¨iptablesä¸­åˆ›å»ºçš„rules"></a> æŸ¥çœ‹kube-proxyåœ¨iptablesä¸­åˆ›å»ºçš„rules</h2><p>ç°åœ¨å¯ä»¥é€šè¿‡serviceçš„å›ºå®šipè®¿é—®åˆ°podï¼Œé‚£ä¹ˆiptablesä¸­çš„è§„åˆ™æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æŸ¥çœ‹åŒ…åœ¨chainsä¸­çš„æµå‘ï¼Œ<code>-Lå¯ä»¥é€‰æ‹©æ˜¾ç¤ºçš„chain</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> iptables -t nat -L PREROUTING</span></span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Chain PREROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">KUBE-SERVICES  all  --  anywhere             anywhere             /* kubernetes service portals */</span><br><span class="line">DOCKER     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL</span><br><span class="line">CNI-HOSTPORT-DNAT  all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°kube-proxyåœ¨iptablesä¸­åˆ›å»ºäº†<code>KUBE-SERVICES</code>çš„chain targetï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¸ªè¿™ä¸ªchain</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> iptables -t nat -L KUBE-SERVICES</span></span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Chain KUBE-SERVICES (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">KUBE-SVC-NPX46M4PTMTKRN6Y  tcp  --  anywhere             10.43.0.1            /* default/kubernetes:https cluster IP */ tcp dpt:https</span><br><span class="line">KUBE-SVC-DQYKF4NVSQPF2JO7  tcp  --  anywhere             10.43.120.124        /* default/ngx-svc cluster IP */ tcp dpt:http</span><br><span class="line">KUBE-NODEPORTS  all  --  anywhere             anywhere             /* kubernetes service nodeports; NOTE: this must be the last rule in this chain */ ADDRTYPE match dst-type LOCAL</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™é‡Œçš„<code>KUBE-SVC-DQYKF4NVSQPF2JO7</code>æŒ‡å®šäº†ç›®æ ‡ä¸º<code>10.43.120.124</code>çš„åŒ…ï¼Œè¿™ä¹Ÿæ˜¯serviceçš„ipï¼Œç»§ç»­è·Ÿè¸ªè¿™æ¡chains</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> iptables -t nat -L KUBE-SVC-DQYKF4NVSQPF2JO7</span></span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Chain KUBE-SVC-DQYKF4NVSQPF2JO7 (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">KUBE-MARK-MASQ  tcp  -- !10.42.0.0/16         10.43.120.124        /* default/ngx-svc cluster IP */ tcp dpt:http</span><br><span class="line">KUBE-SEP-WHP752REJFIVTA3A  all  --  anywhere             anywhere             /* default/ngx-svc -&gt; 10.42.0.148:80 */ statistic mode random probability 0.50000000000</span><br><span class="line">KUBE-SEP-KOUJFWPU7NB2K4H6  all  --  anywhere             anywhere             /* default/ngx-svc -&gt; 10.42.0.149:80 */</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªåŒ…ä¼šè¢«è½¬å‘åˆ°<code>10.42.0.148:80æˆ–è€…10.42.0.149:80</code>ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªpodæ‰€åœ¨çš„ipå’Œportï¼Œæœ€åæŸ¥çœ‹è¿™ä¸¤ä¸ªchain</p><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Chain KUBE-SEP-WHP752REJFIVTA3A (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">KUBE-MARK-MASQ  all  --  10.42.0.148          anywhere             /* default/ngx-svc */</span><br><span class="line">DNAT       tcp  --  anywhere             anywhere             /* default/ngx-svc */ tcp to:10.42.0.148:80</span><br><span class="line"></span><br><span class="line">Chain KUBE-SEP-KOUJFWPU7NB2K4H6 (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">KUBE-MARK-MASQ  all  --  10.42.0.149          anywhere             /* default/ngx-svc */</span><br><span class="line">DNAT       tcp  --  anywhere             anywhere             /* default/ngx-svc */ tcp to:10.42.0.149:80</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go initå‡½æ•°åˆ†æ</title>
      <link href="/2023/10/05/Go-init%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90/"/>
      <url>/2023/10/05/Go-init%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>Goçš„æ‰€æœ‰initå‡½æ•°ä¼šåœ¨mainå‡½æ•°æ‰§è¡Œä¹‹å‰è¿è¡Œï¼Œinitçš„æ‰§è¡Œæ˜¯runtimeå¸®åŠ©æˆ‘ä»¬å®Œæˆçš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹initçš„è¿è¡Œæœºåˆ¶ã€‚</p><h1 id="initå‡½æ•°çš„ç¼–è¯‘å¤„ç†"><a class="markdownIt-Anchor" href="#initå‡½æ•°çš„ç¼–è¯‘å¤„ç†"></a> initå‡½æ•°çš„ç¼–è¯‘å¤„ç†</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> initTask <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> pack the first 3 fields more tightly?</span></span><br><span class="line">state <span class="type">uintptr</span> <span class="comment">// 0 = uninitialized, 1 = in progress, 2 = done</span></span><br><span class="line">ndeps <span class="type">uintptr</span></span><br><span class="line">nfns  <span class="type">uintptr</span></span><br><span class="line"><span class="comment">// followed by ndeps instances of an *initTask, one per package depended on</span></span><br><span class="line"><span class="comment">// followed by nfns pcs, one per init function to run</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>initTaskæ˜¯initåˆå§‹åŒ–å·¥ä½œçš„å…³é”®ç»“æ„ä½“ï¼Œä¸€ä¸ªåŒ…ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„initTask:</p><ol><li><p>state: è¯¥åŒ…çš„åˆå§‹åŒ–å‡½æ•°æ˜¯å¦è¢«æ‰§è¡Œ</p><ul><li>0: æœªæ‰§è¡Œ</li><li>1: æ­£åœ¨æ‰§è¡Œ</li><li>2: æ‰§è¡Œå®Œæˆ</li></ul></li><li><p>ndeps: è¯¥åŒ…æœ‰å‡ ä¸ªä¾èµ–çš„åŒ…</p></li><li><p>nfns: åŒ…ä¸­çš„åˆå§‹åŒ–å‡½æ•°æ•°é‡</p></li></ol><p>è™½ç„¶æ¯ä¸ªåŒ…éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„initTaskï¼Œä½†æ˜¯Goåœ¨<code>ç¼–è¯‘ä¸­åªä¼šä¸ºmainåŒ…ç”Ÿæˆä¸€ä¸ªinitTaskç¬¦å·main..initTaskï¼Œå¹¶å°†å…¶ä¸­çš„initå‡½æ•°å‘½åä¸ºåŒ…å.init.0ï¼ŒåŒ…å.init.1...ï¼Œå…¶ä»–åŒ…çš„initTaskçš„ä½ç½®æˆ‘ä»¬å¯ä»¥é€šè¿‡mainåŒ…çš„initTaskçš„ä½ç½®æ‰¾åˆ°ï¼Œå…·ä½“å¦‚ä½•å¯»æ‰¾çš„ä¼šåœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­è¯´æ˜</code>ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç </p><p><code>main.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;awesomeProject/test&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">100</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">200</span></span><br><span class="line">b = a</span><br><span class="line">a = b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">200</span></span><br><span class="line">fmt.Println(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(test.A)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>test/test.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> A <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">100</span></span><br><span class="line">fmt.Println(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ç¼–è¯‘ä»¥åæŸ¥çœ‹ç¬¦å·è¡¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">readelf -s main | grep -E <span class="string">&#x27;main|test&#x27;</span></span></span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 658: 0000000000433180   816 FUNC    GLOBAL DEFAULT    1 runtime.main</span><br><span class="line"> 659: 00000000004334c0    53 FUNC    GLOBAL DEFAULT    1 runtime.main.func2</span><br><span class="line"> 822: 0000000000441780   500 FUNC    GLOBAL DEFAULT    1 runtime.testAtomic64</span><br><span class="line">1021: 0000000000458140    58 FUNC    GLOBAL DEFAULT    1 runtime.main.func1</span><br><span class="line">1300: 0000000000463560  1279 FUNC    GLOBAL DEFAULT    1 strconv.roundShortest</span><br><span class="line">1517: 00000000004805c0    58 FUNC    GLOBAL DEFAULT    1 main.init.0</span><br><span class="line">1518: 0000000000480600   179 FUNC    GLOBAL DEFAULT    1 main.init.1</span><br><span class="line">1519: 00000000004806c0   171 FUNC    GLOBAL DEFAULT    1 main.main</span><br><span class="line">1520: 0000000000514de0    56 OBJECT  GLOBAL DEFAULT    9 main..inittask</span><br><span class="line">1522: 0000000000558e58     8 OBJECT  GLOBAL DEFAULT   12 awesomeProject/test.A</span><br><span class="line">1716: 000000000052b148     8 OBJECT  GLOBAL DEFAULT   11 runtime.main_ini[...]</span><br><span class="line">1717: 0000000000558dec     1 OBJECT  GLOBAL DEFAULT   12 runtime.mainStarted</span><br><span class="line">1748: 0000000000558fb8     8 OBJECT  GLOBAL DEFAULT   12 runtime.test_z64</span><br><span class="line">1749: 0000000000558fb0     8 OBJECT  GLOBAL DEFAULT   12 runtime.test_x64</span><br><span class="line">1779: 000000000052b188     8 OBJECT  GLOBAL DEFAULT   11 runtime.testSigtrap</span><br><span class="line">1780: 000000000052b190     8 OBJECT  GLOBAL DEFAULT   11 runtime.testSigusr1</span><br><span class="line">1821: 0000000000514020    32 OBJECT  GLOBAL DEFAULT    9 internal/testlog[...]</span><br><span class="line">2110: 00000000004b5d20     8 OBJECT  GLOBAL DEFAULT    2 runtime.mainPC</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>main..inittask</code>ï¼Œ<code>main.init.0</code>ï¼Œ<code>main.init.1</code>ï¼Œgoåœ¨æ‰§è¡Œæ‰€æœ‰åŒ…initå‡½æ•°çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä»¥<code>mainåŒ…ä¸­çš„initä¸ºèµ·ç‚¹ï¼Œé€šè¿‡ä¾èµ–å…³ç³»éå†åˆ°æ‰€æœ‰çš„åŒ…</code></p><h1 id="æ·±å…¥initå‡½æ•°çš„æ‰§è¡Œæµç¨‹"><a class="markdownIt-Anchor" href="#æ·±å…¥initå‡½æ•°çš„æ‰§è¡Œæµç¨‹"></a> æ·±å…¥initå‡½æ•°çš„æ‰§è¡Œæµç¨‹</h1><p>go version: 1.20</p><p>æˆ‘ä»¬å…ˆæ¥æ‰¾åˆ°runtimeä¸­è°ƒç”¨initçš„éƒ¨åˆ†<br /><code>runtime/proc.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:linkname main_inittask main..inittask</span></span><br><span class="line"><span class="keyword">var</span> main_inittask initTask</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  doInit(&amp;main_inittask) <span class="comment">// Must be before defer.</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å‘ç°<code>main_inittaskè¿™ä¸ªå˜é‡é“¾æ¥çš„å°±æ˜¯main..inittaskï¼Œä¹Ÿå°±æ˜¯mainåŒ…çš„inittask</code></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»å¾—åˆ°äº†mainçš„inittaskï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ·±å…¥çœ‹çœ‹doInitæ˜¯å¦‚ä½•è¿è¡Œçš„<br /><code>runtime/proc.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doInit</span><span class="params">(t *initTask)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> t.state &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// fully initialized</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// initialization in progress</span></span><br><span class="line">throw(<span class="string">&quot;recursive call during initialization - linker skew&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>: <span class="comment">// not initialized yet</span></span><br><span class="line">t.state = <span class="number">1</span> <span class="comment">// initialization in progress</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; t.ndeps; i++ &#123;</span><br><span class="line">p := add(unsafe.Pointer(t), (<span class="number">3</span>+i)*goarch.PtrSize)</span><br><span class="line">t2 := *(**initTask)(p)</span><br><span class="line">doInit(t2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> t.nfns == <span class="number">0</span> &#123;</span><br><span class="line">t.state = <span class="number">2</span> <span class="comment">// initialization done</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">firstFunc := add(unsafe.Pointer(t), (<span class="number">3</span>+t.ndeps)*goarch.PtrSize)</span><br><span class="line"><span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; t.nfns; i++ &#123;</span><br><span class="line">p := add(firstFunc, i*goarch.PtrSize)</span><br><span class="line">f := *(*<span class="function"><span class="keyword">func</span><span class="params">()</span></span>)(unsafe.Pointer(&amp;p))</span><br><span class="line">f()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">t.state = <span class="number">2</span> <span class="comment">// initialization done</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¼€å§‹è§£è¯»è¿™ä¸€æ®µä»£ç ä¹‹å‰ï¼Œéœ€è¦å†æ¬¡è®¤è¯†ä¸€æ¬¡initTaskç»“æ„ä½“ï¼Œä½ åœ¨go1.20ä¸­çœ‹åˆ°çš„initTaskæ˜¯è¢«ä¼˜åŒ–è¿‡çš„ï¼Œå®é™…å†…å®¹å¦‚ä¸‹:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> initTask <span class="keyword">struct</span> &#123;</span><br><span class="line">    state <span class="type">uintptr</span> <span class="comment">// å½“å‰åŒ…åœ¨ç¨‹åºè¿è¡Œæ—¶çš„åˆå§‹åŒ–çŠ¶æ€ï¼š 0 = uninitialized, 1 = in progress, 2 = done</span></span><br><span class="line">    ndeps <span class="type">uintptr</span> <span class="comment">// å½“å‰åŒ…çš„ä¾èµ–åŒ…çš„æ•°é‡</span></span><br><span class="line">    nfns  <span class="type">uintptr</span> <span class="comment">// å½“å‰åŒ…çš„åˆå§‹åŒ–å‡½æ•°æ•°é‡</span></span><br><span class="line">    deps  [ndeps]*initTask <span class="comment">// å½“å‰åŒ…çš„ä¾èµ–åŒ…çš„initTaskæŒ‡é’ˆæ•°ç»„ï¼ˆä¸æ˜¯sliceï¼‰</span></span><br><span class="line">    fns   [nfns]<span class="function"><span class="keyword">func</span> <span class="params">()</span></span>    <span class="comment">// å½“å‰åŒ…çš„åˆå§‹åŒ–å‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼ˆä¸æ˜¯sliceï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªå±•å¼€ä»¥åçš„initTaskå’ŒdoInitå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºinitå‡½æ•°æ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹:</p><ol><li>å…ˆæ‰¾åˆ°mainåŒ…å¯¹åº”çš„initTask</li><li>é€’å½’å…ˆæ‰§è¡Œä¾èµ–åŒ…çš„initTaskï¼Œå› ä¸ºç»“æ„ä½“ä¸­æ²¡æœ‰æ˜¾ç¤ºå£°æ˜å‡ºå¯¹åº”çš„å­—æ®µï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±è¿ç®—å‡ºå­—æ®µæ‰€åœ¨çš„ä½ç½®</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ndepsæ˜¯ä¾èµ–åŒ…çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦æ‰§è¡Œçš„initTaskçš„æ•°é‡</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; t.ndeps; i++ &#123;</span><br><span class="line">  <span class="comment">// (3+i)*goarch.PtrSizeï¼Œ3æ˜¯è·³è¿‡initTaskçš„å‰ä¸‰ä¸ªå­—æ®µ</span></span><br><span class="line">  p := add(unsafe.Pointer(t), (<span class="number">3</span>+i)*goarch.PtrSize)</span><br><span class="line">  t2 := *(**initTask)(p)</span><br><span class="line">  doInit(t2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>æœ€åå†æ‰§è¡Œè‡ªå·±çš„åŒ…ä¸­çš„initå‡½æ•°</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·³è¿‡stateï¼Œndepsï¼Œnfnså’Œdeps</span></span><br><span class="line">firstFunc := add(unsafe.Pointer(t), (<span class="number">3</span>+t.ndeps)*goarch.PtrSize)</span><br><span class="line"><span class="comment">// æ‰§è¡Œæ¯ä¸ªinitå‡½æ•°</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="type">uintptr</span>(<span class="number">0</span>); i &lt; t.nfns; i++ &#123;</span><br><span class="line">  p := add(firstFunc, i*goarch.PtrSize)</span><br><span class="line">  f := *(*<span class="function"><span class="keyword">func</span><span class="params">()</span></span>)(unsafe.Pointer(&amp;p))</span><br><span class="line">  f()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é‡æ–°è®¤è¯†CæŒ‡é’ˆ</title>
      <link href="/2023/10/03/%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86C%E6%8C%87%E9%92%88/"/>
      <url>/2023/10/03/%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86C%E6%8C%87%E9%92%88/</url>
      
        <content type="html"><![CDATA[<p>æŒ‡é’ˆæ˜¯Cè¯­è¨€ä¸­çš„éš¾ç‚¹ï¼Œä½†å…¶æœ¬è´¨å’Œå…¶ä»–ç±»å‹å¹¶æ— ä¸åŒï¼Œä¸‹é¢æˆ‘ä»¬ä»å‡ ä¸ªæ–¹é¢æ¥é‡æ–°è®¤è¯†æŒ‡é’ˆã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘éœ€è¦ä½ å…ˆæŠ›å»å¯¹æŒ‡é’ˆç±»å‹çš„è®¤è¯†ï¼Œå…ˆå¿˜æ‰æŒ‡é’ˆçš„ç±»å‹ï¼Œè®¤è¯†çº¯ç²¹çš„æŒ‡é’ˆï¼Œç„¶åå†é‡æ–°è®¤è¯†å¸¦ç€ç±»å‹çš„æŒ‡é’ˆã€‚</p><h1 id="è®¤è¯†çº¯ç²¹çš„æŒ‡é’ˆ"><a class="markdownIt-Anchor" href="#è®¤è¯†çº¯ç²¹çš„æŒ‡é’ˆ"></a> è®¤è¯†çº¯ç²¹çš„æŒ‡é’ˆ</h1><p>æˆ‘ä»¬<code>å…ˆæŠ›å¼€æŒ‡é’ˆçš„ç±»å‹</code>ï¼Œçœ‹çœ‹æŒ‡é’ˆæ˜¯ä»€ä¹ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    <span class="type">int</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> *a;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> *b;</span><br><span class="line">    <span class="type">double</span> *c;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> * <span class="title">d</span>;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;int pointer = %d bytes\n&quot;</span>,<span class="keyword">sizeof</span>(a));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;unsigned int pointer = %d bytes\n&quot;</span>,<span class="keyword">sizeof</span>(b));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;double pointer = %d bytes\n&quot;</span>,<span class="keyword">sizeof</span>(c));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;struct pointer = %d bytes\n&quot;</span>,<span class="keyword">sizeof</span>(d));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>output:</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int pointer = 8 bytes</span><br><span class="line">unsigned int pointer = 8 bytes</span><br><span class="line">double pointer = 8 bytes</span><br><span class="line">struct pointer = 8 bytes</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>ä¸ç®¡ä»€ä¹ˆç±»å‹çš„æŒ‡é’ˆçš„éƒ½æ˜¯å ç”¨8ä¸ªå­—èŠ‚</code>(è¿™ä¸ªç»“æœåœ¨64ä½æœºå™¨ä¸Šéƒ½æ˜¯ä¸€è‡´çš„)ï¼Œè¿™ç§ç»“æœæ˜¯å®¹æ˜“ç†è§£çš„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒæŒ‡é’ˆå­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œæ‰€ä»¥ä¸ç®¡ä»€ä¹ˆç±»å‹çš„æŒ‡é’ˆéƒ½å¿…é¡»è¦èƒ½å¤Ÿè¡¨ç¤ºè¿™å°æœºå™¨ä¸Šæ‰€æœ‰çš„åœ°å€ï¼Œæ‰€ä»¥å¯¹äº32ä½çš„æœºå™¨ï¼ŒæŒ‡é’ˆéœ€è¦4ä¸ªå­—èŠ‚ï¼ŒåŒç†ï¼Œå¦‚æœæ˜¯64ä½æœºå™¨ï¼ŒæŒ‡é’ˆå°±æ˜¯8ä¸ªå­—èŠ‚ã€‚</p><blockquote><p>64ä½æœºå™¨ä¸­çš„64è¡¨ç¤ºè¯¥æœºå™¨æœ‰ç€64ä½çš„åœ°å€ç©ºé—´</p></blockquote><p>ä¸ºä»€ä¹ˆè¦è®²ä¸Šè¿°è¿™äº›å†…å®¹å‘¢ï¼Œå› ä¸ºä¸Šè¿°å†…å®¹è¡¨è¾¾äº†ä¸€ä¸ªé‡è¦ä¿¡æ¯ï¼Œ<code>æ‰€è°“æŒ‡é’ˆï¼Œå°±æ˜¯ä¸€ä¸ª8ä¸ªå­—èŠ‚çš„æ•°å€¼ï¼Œæ›´å…·ä½“ä¸€ç‚¹çš„è¯´ï¼Œè¿™ä¸ªæ•°å€¼ï¼Œå…¶å†…æ¶µæ˜¯ä¸€ä¸ªåœ°å€</code>ã€‚</p><p>å¯¹äºæŒ‡é’ˆçš„ä½¿ç”¨æ¥è¯´ï¼Œæ—¢ç„¶å…¶æœ¬è´¨æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¯¹å®ƒä»»æ„çš„èµ‹å€¼ï¼Œè‡³å°‘åœ¨è¯­æ³•ä¸Šæˆ‘ä»¬ä¸éœ€è¦å—åˆ°ä»»ä½•é™åˆ¶ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> *a;</span><br><span class="line">    a = <span class="number">10</span>;</span><br><span class="line">    a = <span class="number">100000000</span>;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    a = &amp;b;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è®¤è¯†å¼•ç”¨"><a class="markdownIt-Anchor" href="#è®¤è¯†å¼•ç”¨"></a> è®¤è¯†å¼•ç”¨(&amp;)</h1><p>å¯¹äºå¼•ç”¨çš„æœ¬è´¨å…¶å®ç›¸å½“çš„ç®€å•ï¼Œæˆ‘ä»¬èµ·åˆæ¥è§¦<code>&amp;</code>æ—¶å¯èƒ½æ˜¯åœ¨ä¸‹é¢ä¸¤ç§æƒ…æ™¯ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *a;</span><br><span class="line"><span class="type">int</span> b;</span><br><span class="line"><span class="comment">// é…åˆscanf</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b);</span><br><span class="line"><span class="comment">// é…åˆæŒ‡é’ˆä½¿ç”¨</span></span><br><span class="line">a = &amp;b;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº†æŒ‡é’ˆå…¶å®å°±æ˜¯ä¸€ä¸ª8å­—èŠ‚çš„å€¼ï¼Œé‚£ä¹ˆ<code>å¼•ç”¨ä¸€ä¸ªå˜é‡å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ª8å­—èŠ‚çš„å€¼</code>,ä¹Ÿå°±æ˜¯<code>&amp;bä¸1,2,3...è¿™æ ·çš„æ•°å€¼å¹¶æ— ä¸åŒ</code>ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è®¤è¯†åˆ°ï¼Œscanfä¸­ç¬¬äºŒä¸ªå‚æ•°æ¥å—çš„æ˜¯ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼Œè¿™ç§ç”¨æ³•å¹¶ä¸ä¸<code>&amp;</code>ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢çš„ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> a;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> b;</span><br><span class="line">    b = &amp;a;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,b);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a = %lld\n&quot;</span>,a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>input:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦å¯ä»¥è®¤è¯†åˆ°<code>æŒ‡é’ˆå’Œå¼•ç”¨å…¶å®å°±æ˜¯ä¸€ä¸ªå€¼è¿™ä¸€æœ¬è´¨</code>ã€‚</p><h1 id="æŒ‡é’ˆçš„ç±»å‹ä¸è§£å¼•ç”¨"><a class="markdownIt-Anchor" href="#æŒ‡é’ˆçš„ç±»å‹ä¸è§£å¼•ç”¨"></a> æŒ‡é’ˆçš„ç±»å‹ä¸è§£å¼•ç”¨(*)</h1><p>ä¸Šé¢çš„å†…å®¹éƒ½è¯•å›¾è®©ä½ å¿˜è®°æŒ‡é’ˆçš„ç±»å‹ï¼Œç†è§£æŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªå€¼è¿™ä¸ªæ¦‚å¿µï¼Œé‚£ä¹ˆæŒ‡é’ˆçš„ç±»å‹å¯¹äºæŒ‡é’ˆæ¥è¯´åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0x12345678</span>;</span><br><span class="line">    <span class="type">int</span> *p = &amp;a;</span><br><span class="line">    <span class="type">char</span> *q = &amp;a;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;*p = 0x%x\n&quot;</span>,*p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;*q = 0x%x\n&quot;</span>,*q);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹ç€ä¸‹é¢çš„å›¾ï¼ŒçŒœçŒœä¸Šé¢çš„è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-09-19-2047.png" alt="æ— æ ‡é¢˜-2023-09-19-2047" /></p><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*p = 0x12345678</span><br><span class="line">*q = 0x78</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œåº”è¯¥æ„è¯†åˆ°äº†ä¸€ç‚¹ï¼Œ<code>æŒ‡é’ˆçš„ç±»å‹å†³å®šäº†æŒ‡é’ˆåœ¨è§£å¼•ç”¨è·å–å¤šå°‘å­—èŠ‚çš„æ•°æ®</code>ï¼Œå› ä¸ºcharç±»å‹å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è§£å¼•ç”¨æ—¶æŒ‡é’ˆä¼šå‘ä¸Šçœ‹ä¸€ä¸ªå­—èŠ‚ï¼ŒåŒç†ï¼Œintç±»å‹å ç”¨å››ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è§£å¼•ç”¨æ—¶ä¼šå‘ä¸Šçœ‹å››ä¸ªå­—èŠ‚</p><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¯ä»¥å…ˆæ€»ç»“ä¸€ä¸‹ï¼ŒæŒ‡é’ˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†çœ‹:</p><ol><li>å…¶æœ¬èº«æ˜¯ä¸€ä¸ª8å­—èŠ‚çš„å€¼ï¼Œè¡¨ç¤ºä¸€ä¸ªåœ°å€</li><li>æŒ‡é’ˆçš„ç±»å‹è¡¨ç¤ºæŒ‡é’ˆåœ¨è§£å¼•ç”¨æ—¶è·å–å¤šå°‘å­—èŠ‚çš„æ•°æ®</li></ol><h1 id="æŒ‡é’ˆçš„å£°æ˜"><a class="markdownIt-Anchor" href="#æŒ‡é’ˆçš„å£°æ˜"></a> æŒ‡é’ˆçš„å£°æ˜</h1><p>å¦‚æœç†è§£äº†ä¸Šé¢çš„å†…å®¹ï¼Œé‚£ä¹ˆä½ å¯¹æŒ‡é’ˆå·²ç»è¶³å¤Ÿæ¸…æ¥šäº†ï¼Œä½†æ˜¯å®é™…ä¸Šå¯¹äºCåˆå­¦è€…è€Œè¨€ï¼ŒæŒ‡é’ˆæœ€éš¾çš„éƒ¨åˆ†ä¸åœ¨äºç†è§£å®ƒæœ¬èº«ï¼Œè€Œæ˜¯åœ¨è§£è¯»æŒ‡é’ˆçš„å£°æ˜ï¼Œä¸Šè¿™ä¸ªéƒ¨åˆ†ä¸æŒ‡é’ˆå…³ç³»å¹¶ä¸å¤§ï¼Œä½†æ˜¯å¾€å¾€ä»¤äººè´¹è§£</p><p>æ¯”å¦‚æˆ‘ä»¬æ—©æœŸé‡åˆ°çš„æŒ‡é’ˆæ•°ç»„å’Œæ•°ç»„æŒ‡é’ˆï¼Œä¸çŸ¥é“ä½ ç°åœ¨çœ‹åˆ°æ˜¯å¦å¯ä»¥åˆ†æ¸…æ¥šï¼Œæ˜¯æœ‰æŠ€å·§è¿˜æ˜¯é è®°å¿†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> (*p)[<span class="number">10</span>];</span><br></pre></td></tr></table></figure><p>å…³äºè¿™ä¸€å—çš„å†…å®¹ï¼Œè¯¦è§æˆ‘çš„å¦ä¸€åšå®¢ï¼Œæˆ‘å°±ä¸èµ˜è¿°äº†:  <a href="/2023/01/04/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%A3%B0%E6%98%8E/" title="Cè¯­è¨€å£°æ˜">Cè¯­è¨€å£°æ˜</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡åŒç³»ç»Ÿlinuxæœªåˆ é™¤å¹²å‡€å¯¼è‡´ç³»ç»Ÿæ— æ³•æ­£å¸¸å¯åŠ¨</title>
      <link href="/2023/09/21/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%8F%8C%E7%B3%BB%E7%BB%9Flinux%E6%9C%AA%E5%88%A0%E9%99%A4%E5%B9%B2%E5%87%80%E5%AF%BC%E8%87%B4%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E5%90%AF%E5%8A%A8/"/>
      <url>/2023/09/21/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%8F%8C%E7%B3%BB%E7%BB%9Flinux%E6%9C%AA%E5%88%A0%E9%99%A4%E5%B9%B2%E5%87%80%E5%AF%BC%E8%87%B4%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºè‡ªå·±ç”µè„‘çš„ç£ç›˜æ€»å…±åªæœ‰512Gï¼Œèƒ½åˆ†é…ç»™åŒç³»ç»Ÿlinuxçš„ç©ºé—´å®é™…ä¸Šä¸ä¼šå¤ªå¤šï¼Œæ‰€ä»¥æˆ‘å†³å®šå°†å…¶åˆ é™¤ï¼Œå®‰è£…åˆ°1Tå¤§å°SSDçš„Uç›˜ä¸Šï¼Œä½†æ˜¯åˆ é™¤ä»¥åç”±äºlinuxçš„åˆ†åŒºä¿¡æ¯è¿˜å­˜åœ¨ï¼Œæ‰€ä»¥å¼€æœºä»¥åå°†è¿›å…¥grubï¼Œæ­£å¸¸å¼€æœºåªèƒ½é€šè¿‡è¿›å…¥BIOSï¼Œæˆ–è®¸ä¹Ÿå¯ä»¥è°ƒæ­£åˆ†åŒºçš„å¯åŠ¨é¡ºåºï¼Œä½†æ˜¯æˆ‘çš„ç”µè„‘å¹¶ä¸å¯ä»¥ã€‚</p><p>ä¸‹é¢è®°å½•ä¸€ä¸‹å¦‚ä½•å½»åº•åˆ é™¤linuxä¿¡æ¯ã€‚</p><h1 id="é€šè¿‡diskpartå½»åº•åˆ é™¤linux"><a class="markdownIt-Anchor" href="#é€šè¿‡diskpartå½»åº•åˆ é™¤linux"></a> é€šè¿‡diskpartå½»åº•åˆ é™¤linux</h1><p>å…ˆé€šè¿‡å‘½ä»¤è¡Œæ‰“å¼€diskpart</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">diskpart</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">list disk</span></span><br></pre></td></tr></table></figure><p>é€‰æ‹©<code>windowsæ‰€åœ¨çš„ç£ç›˜</code>ï¼Œç„¶åæŸ¥çœ‹åˆ†åŒº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ select disk 0 # æ ¹æ®ä½ çš„å…·ä½“æƒ…å†µé€‰æ‹©</span><br><span class="line">$ list partition</span><br></pre></td></tr></table></figure><p>ç„¶åé€‰æ‹©<code>system</code>åˆ†åŒºï¼ŒæŠŠä»–æŒ‚è½½å‡ºæ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="keyword">select</span> partition 1</span></span><br><span class="line">assign letter=J</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>æˆ‘çš„ç”µè„‘</code>ä¸­æ‰“å¼€ï¼Œæ‰¾åˆ°<code>Jç›˜</code>,è¿›å…¥åˆ°å…¶ä¸­ï¼Œåˆ é™¤linuxçš„æ–‡ä»¶å¤¹å³å¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfileä¸­CMDå’ŒENTRYPOINTçš„åŒºåˆ«</title>
      <link href="/2023/09/14/Dockerfile%E4%B8%ADCMD%E5%92%8CENTRYPOINT%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2023/09/14/Dockerfile%E4%B8%ADCMD%E5%92%8CENTRYPOINT%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>CMDå’ŒENTRYPOINTçš„åŠŸèƒ½çœ‹èµ·æ¥æ¯”è¾ƒç±»ä¼¼ï¼Œä½†æ˜¯ä¸¤è€…è¿˜æ˜¯å­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚</p><h1 id="å®¹å™¨å¯åŠ¨å‘½ä»¤çš„æ„æˆ"><a class="markdownIt-Anchor" href="#å®¹å™¨å¯åŠ¨å‘½ä»¤çš„æ„æˆ"></a> å®¹å™¨å¯åŠ¨å‘½ä»¤çš„æ„æˆ</h1><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>docker ps</code>æŸ¥çœ‹å®¹å™¨çš„å¯åŠ¨ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID   IMAGE            COMMAND      CREATED       STATUS               PORTS     NAMES</span><br><span class="line">e77a3d7d7014   helloworld:1.0   &quot;/app/web&quot;   2 hours ago   Exited (2) 2 hours ago             competent_wescoff</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡<code>COMMAND</code>å­—æ®µæŸ¥çœ‹åˆ°å®¹å™¨çš„å¯åŠ¨å‘½ä»¤ä¸º<code>/app/web</code></p><p>å®é™…ä¸Š<code>COMMANDç”±ENTRYPOINT+CMD</code>æ„æˆ</p><p>æˆ‘ä»¬åœ¨<code>docker run</code>åé»˜è®¤è·Ÿéšçš„å‚æ•°ä¸º<code>CMD</code>çš„éƒ¨åˆ†ï¼Œå¦‚æœè¦ä¿®æ”¹<code>ENTRYPOINT</code>éœ€è¦æ˜¾å¼å¢åŠ <code>--entrypoint</code>å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run --entrypoint <span class="built_in">ls</span> helloworld -a</span></span><br><span class="line">CONTAINER ID   IMAGE        COMMAND   CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">106fc4a8833b   helloworld   &quot;ls -a&quot;   22 seconds ago   Exited (0) 22 seconds ago             boring_feynman</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯åŠ¨å‘½ä»¤è¢«æ›´æ”¹</p><h1 id="é€šè¿‡dockerfileé…ç½®å¯åŠ¨å‘½ä»¤"><a class="markdownIt-Anchor" href="#é€šè¿‡dockerfileé…ç½®å¯åŠ¨å‘½ä»¤"></a> é€šè¿‡Dockerfileé…ç½®å¯åŠ¨å‘½ä»¤</h1><p>ENTRYPOINTå’ŒCMDé™¤äº†å¯ä»¥åœ¨å¯åŠ¨æ—¶é…ç½®ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨Dockerfileä¸­é…ç½®ï¼Œä½†æ˜¯<code>å‘½ä»¤è¡Œçš„ä¼˜å…ˆçº§æ˜¯å¤§äºDockerfile</code>çš„</p><p>é…ç½®çš„æ–¹å¼æœ‰ä¸¤ç§</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> web /app/web</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;ls&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;-a&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿è¡Œä¸Šè¿°é•œåƒï¼Œå¯ä»¥å‘ç°å¯åŠ¨å‘½ä»¤ä¸º<code>ls -a</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ›¿æ¢ENTRYPOINTæˆ–è€…CMDéƒ¨åˆ†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run helloworld -l</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å¯åŠ¨å‘½ä»¤ä¸º<code>ls -l</code>ï¼ŒENTRYPOINTçš„æ›¿æ¢å°±ä¸å†æ¼”ç¤º</p><p>ç¬¬äºŒç§å’Œç¬¬ä¸€ç§ç±»ä¼¼ï¼Œä¸»è¦æ˜¯è¯´æ˜execå’ŒShellæ‰§è¡Œæ–¹å¼çš„åŒºåˆ«</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> web /app/web</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> <span class="built_in">ls</span> -a</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æ‰§è¡Œä¸Šé¢çš„é•œåƒï¼Œæˆ‘ä»¬ä¼šå‘ç°å¯åŠ¨å‘½ä»¤å˜æˆäº†<code>/bin/sh -c ls -a</code></p><p>ä¹Ÿå°±è¯´å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨<code>[]</code>ï¼Œé‚£ä¹ˆdockerä¼šç”¨<code>/bin/sh -c</code>çš„æ–¹å¼æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯shellæ‰§è¡Œï¼Œä½†æ˜¯å¦‚æœåŠ ä¸Š[]ï¼Œä¼šé€šè¿‡execç³»ç»Ÿè°ƒç”¨æ‰§è¡Œï¼Œ<code>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ç¬¬ä¸€ç§ï¼Œä¹Ÿå°±æ˜¯execæ–¹å¼</code></p><h1 id="ç»“åˆä½¿ç”¨cmdå’Œentrypoint"><a class="markdownIt-Anchor" href="#ç»“åˆä½¿ç”¨cmdå’Œentrypoint"></a> ç»“åˆä½¿ç”¨CMDå’ŒENTRYPOINT</h1><p>å¯ä»¥å‘ç°ENTRYPOINTé€šå¸¸æŒ‡å®šæ ¸å¿ƒå‘½ä»¤ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œè€ŒCMDåˆ™é€šå¸¸é…ç½®æˆå‚æ•°éƒ¨åˆ†ï¼Œåˆç†é…åˆè¿™ä¸¤ä¸ªéƒ¨åˆ†å¯ä»¥è®©Dockeré•œåƒæ›´åŠ çµæ´»</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡Goæ‰“åŒ…Dockeré•œåƒçš„é—®é¢˜</title>
      <link href="/2023/09/14/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1Go%E6%89%93%E5%8C%85Docker%E9%95%9C%E5%83%8F%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2023/09/14/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1Go%E6%89%93%E5%8C%85Docker%E9%95%9C%E5%83%8F%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>åœ¨Linuxç¯å¢ƒä¸‹ç¼–è¯‘å¥½Goæºæ–‡ä»¶ä»¥åæˆ‘å°è¯•å°†æœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°Dockeré•œåƒ<code>alpine</code>ä¸­ã€‚<br />è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„Go Webä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> r = gin.Default()</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">&quot;/ping&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK, <span class="string">&quot;pong&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">&quot;/produce&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line"><span class="string">&quot;msg&quot;</span>:   <span class="string">&quot;ok&quot;</span>,</span><br><span class="line"><span class="string">&quot;goods&quot;</span>: <span class="string">&quot;apple&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := r.Run(<span class="string">&quot;:3000&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;start error&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥åŠå¯¹åº”çš„Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> web /app/web</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/app/web&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>åœ¨æœ€åè¿è¡Œå®¹å™¨æ—¶å§‹ç»ˆå‡ºç°äº†<code>file not found</code>çš„è­¦å‘Šï¼Œå®¹å™¨ä¸€ç›´å¯åŠ¨å¤±è´¥ï¼Œæˆ‘å°è¯•é€šè¿‡execè¿›å…¥åˆ°å®¹å™¨å†…éƒ¨æŸ¥çœ‹æ–‡ä»¶ï¼Œå‘ç°æ–‡ä»¶ç¡®å®æ‹·è´åˆ°äº†æ­£ç¡®çš„ä½ç½®ï¼Œä½†æ˜¯æˆ‘åœ¨å®¹å™¨ä¸­æ— æ³•ä½¿ç”¨<code>./web</code>ä¹‹ç±»çš„æ–¹å¼å¯åŠ¨ã€‚</p><p>é‚£çœ‹æ¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«çš„é—®é¢˜ï¼Œå¾ˆå¿«å‘ç°é»˜è®¤æƒ…å†µä¸‹Goç¼–è¯‘å¤„çš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯éœ€è¦åŠ¨æ€é“¾æ¥ï¼Œè€Œ<code>alpineæ˜¯ä¸€ä¸ªç›¸å½“è½»é‡çš„Linuxï¼Œå…¶æœ¬èº«å¹¶ä¸åŒ…æ‹¬åŠ¨æ€é“¾æ¥æ‰€éœ€è¦çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨é™æ€é“¾æ¥</code></p><p>æ‰¾åˆ°é—®é¢˜ä¹‹åæˆ‘ä»¬åªè¦é™æ€ç¼–è¯‘å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">CGO_ENABLED=0 go build -a -ldflags <span class="string">&#x27;-extldflags &quot;-static&quot;&#x27;</span> .</span></span><br></pre></td></tr></table></figure><p>æœ€åå†æ¬¡é‡æ–°æ„å»ºå‘ç°é—®é¢˜æœç„¶è§£å†³</p>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goåˆ‡ç‰‡æ‰©å®¹</title>
      <link href="/2023/09/09/Go%E5%88%87%E7%89%87%E6%89%A9%E5%AE%B9/"/>
      <url>/2023/09/09/Go%E5%88%87%E7%89%87%E6%89%A9%E5%AE%B9/</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸‹çš„å†…å®¹ä¸ºGo1.20.2ç‰ˆæœ¬çš„æ‰©å®¹æ–¹å¼</p><p>Goæ•°ç»„çš„æ‰©å®¹æœºåˆ¶ç®€å•æ¥è¯´åˆ†ä¸ºä¸¤ç§æƒ…å†µ</p><ul><li><p>ä¸€ç§æ˜¯åŸæ¥çš„å®¹é‡å°äº256ï¼Œæ­¤æ—¶ä¼šå°†åŸæ¥çš„å®¹é‡ç¿»å€ä½œä¸ºæ–°çš„å®¹é‡</p></li><li><p>ä¸€ç§æ˜¯å®¹é‡å¤§äºç­‰äº256ï¼Œä¼šæŒ‰ç…§ä»¥ä¸‹æ–¹å¼æ‰©å®¹ç›´è‡³å¯ä»¥æ»¡è¶³éœ€æ±‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi><mi>c</mi><mi>a</mi><mi>p</mi><mo>+</mo><mo>=</mo><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mi>c</mi><mi>a</mi><mi>p</mi><mo>+</mo><mn>3</mn><mtext>âˆ—</mtext><mn>256</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">newcap+=(newcap+3âˆ—256)/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord">+</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord">âˆ—</span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">4</span></span></span></span></span></p></li></ul><p>è¿™æ˜¯å¤§è‡´çš„åˆ†é…æ–¹å¼ï¼Œå®é™…ä¸Šæƒ…å†µè¿˜è¦æ›´å¤æ‚ä¸€äº›ï¼Œæ¥ä¸‹æ¥é€šè¿‡åˆ‡ç‰‡æ‰©å®¹çš„ä»£ç æ¥åˆ†æä¸€äº›ç»†èŠ‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">newcap := oldCap</span><br><span class="line">doublecap := newcap + newcap</span><br><span class="line"><span class="keyword">if</span> newLen &gt; doublecap &#123;</span><br><span class="line">    newcap = newLen</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> threshold = <span class="number">256</span></span><br><span class="line">    <span class="keyword">if</span> oldCap &lt; threshold &#123;</span><br><span class="line">        newcap = doublecap</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Check 0 &lt; newcap to detect overflow</span></span><br><span class="line">        <span class="comment">// and prevent an infinite loop.</span></span><br><span class="line">        <span class="keyword">for</span> <span class="number">0</span> &lt; newcap &amp;&amp; newcap &lt; newLen &#123;</span><br><span class="line">            <span class="comment">// Transition from growing 2x for small slices</span></span><br><span class="line">            <span class="comment">// to growing 1.25x for large slices. This formula</span></span><br><span class="line">            <span class="comment">// gives a smooth-ish transition between the two.</span></span><br><span class="line">            newcap += (newcap + <span class="number">3</span>*threshold) / <span class="number">4</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Set newcap to the requested cap when</span></span><br><span class="line">        <span class="comment">// the newcap calculation overflowed.</span></span><br><span class="line">        <span class="keyword">if</span> newcap &lt;= <span class="number">0</span> &#123;</span><br><span class="line">            newcap = newLen</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æš‚æ—¶å¾—åˆ°çš„å®¹é‡ç»“æœ</p><table><thead><tr><th>æƒ…å†µ</th><th>newcap</th><th></th></tr></thead><tbody><tr><td>å®¹é‡ç¿»å€åä¸èƒ½æ»¡è¶³éœ€æ±‚</td><td>newcap = newLen</td><td></td></tr><tr><td>å®¹é‡ç¿»å€å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼ŒåŸå®¹é‡å°äº256</td><td>newcap = 2 * oldcap</td><td></td></tr><tr><td>å®¹é‡ç¿»å€å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼ŒåŸå®¹é‡å¤§äºç­‰äº256</td><td>newcap += (newcap + 3*256) / 4ç›´è‡³å¤§äºnewLen</td><td></td></tr></tbody></table><p>æˆ‘ä»¬æš‚æ—¶å¾—åˆ°äº†ä¸€ä¸ªnewcapï¼Œä½†å®é™…ä¸Šæœ€åæ‰©å®¹çš„è¿‡ç¨‹ä¸­è¿˜è¦å¯¹è¿™ä¸ªnewcapåšä¸€æ­¥æœ€åçš„å¤„ç†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lenmem = <span class="type">uintptr</span>(oldLen) * et.size</span><br><span class="line">newlenmem = <span class="type">uintptr</span>(newLen) * et.size</span><br><span class="line">capmem, overflow = math.MulUintptr(et.size, <span class="type">uintptr</span>(newcap))</span><br><span class="line">capmem = roundupsize(capmem)</span><br><span class="line">newcap = <span class="type">int</span>(capmem / et.size)</span><br><span class="line">capmem = <span class="type">uintptr</span>(newcap) * et.size</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒåœ¨è¿™ä¸ªroundupsizeå‡½æ•°ï¼Œè‡³äºä¸‹é¢çš„é­”æ³•æ•°ç»„å¦‚ä½•å¾—åˆ°å°±ä¸æ·±å…¥æ¢ç©¶äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> class_to_size = [_NumSizeClasses]<span class="type">uint16</span>&#123;<span class="number">0</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">24</span>, <span class="number">32</span>, <span class="number">48</span>, <span class="number">64</span>, <span class="number">80</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">128</span>, <span class="number">144</span>, <span class="number">160</span>, <span class="number">176</span>, <span class="number">192</span>, <span class="number">208</span>, <span class="number">224</span>, <span class="number">240</span>, <span class="number">256</span>, <span class="number">288</span>, <span class="number">320</span>, <span class="number">352</span>, <span class="number">384</span>, <span class="number">416</span>, <span class="number">448</span>, <span class="number">480</span>, <span class="number">512</span>, <span class="number">576</span>, <span class="number">640</span>, <span class="number">704</span>, <span class="number">768</span>, <span class="number">896</span>, <span class="number">1024</span>, <span class="number">1152</span>, <span class="number">1280</span>, <span class="number">1408</span>, <span class="number">1536</span>, <span class="number">1792</span>, <span class="number">2048</span>, <span class="number">2304</span>, <span class="number">2688</span>, <span class="number">3072</span>, <span class="number">3200</span>, <span class="number">3456</span>, <span class="number">4096</span>, <span class="number">4864</span>, <span class="number">5376</span>, <span class="number">6144</span>, <span class="number">6528</span>, <span class="number">6784</span>, <span class="number">6912</span>, <span class="number">8192</span>, <span class="number">9472</span>, <span class="number">9728</span>, <span class="number">10240</span>, <span class="number">10880</span>, <span class="number">12288</span>, <span class="number">13568</span>, <span class="number">14336</span>, <span class="number">16384</span>, <span class="number">18432</span>, <span class="number">19072</span>, <span class="number">20480</span>, <span class="number">21760</span>, <span class="number">24576</span>, <span class="number">27264</span>, <span class="number">28672</span>, <span class="number">32768</span>&#125;</span><br><span class="line"><span class="keyword">var</span> size_to_class8 = [smallSizeMax/smallSizeDiv + <span class="number">1</span>]<span class="type">uint8</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">21</span>, <span class="number">21</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">22</span>, <span class="number">22</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">23</span>, <span class="number">23</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">roundupsize</span><span class="params">(size <span class="type">uintptr</span>)</span></span> <span class="type">uintptr</span> &#123;</span><br><span class="line"><span class="keyword">if</span> size &lt; _MaxSmallSize &#123;</span><br><span class="line"><span class="keyword">if</span> size &lt;= smallSizeMax<span class="number">-8</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">uintptr</span>(class_to_size[size_to_class8[divRoundUp(size, smallSizeDiv)]])</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">uintptr</span>(class_to_size[size_to_class128[divRoundUp(size-smallSizeMax, largeSizeDiv)]])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> size+_PageSize &lt; size &#123;</span><br><span class="line"><span class="keyword">return</span> size</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> alignUp(size, _PageSize)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç è¯´æ˜è¿™ä¸ªå‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line">s = <span class="built_in">append</span>(s,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d, cap=%d&quot;</span>,<span class="built_in">len</span>(s),<span class="built_in">cap</span>(s))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>åˆ‡ç‰‡</th><th>len</th><th>cap</th></tr></thead><tbody><tr><td>s</td><td>2</td><td>2</td></tr></tbody></table><p>ç°åœ¨æˆ‘ä»¬å°†å®¹é‡ç¿»å€å¾—åˆ°4ï¼Œä½†æ˜¯ç°åœ¨éœ€æ±‚çš„é•¿åº¦æ˜¯5ï¼Œæ‰€ä»¥ç¿»å€ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œæœ€ånewcapç›´æ¥æ›´æ–°ä¸º5ã€‚</p><p>è¿™ä¸ªæ•°ç»„è¦40ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œä¼ å…¥å‚æ•°sizeä¸º40ï¼Œç„¶åæˆ‘ä»¬è®¡ç®—é€šè¿‡roundupsizeå¾—åˆ°æœ€ç»ˆç»“æœ</p><table><thead><tr><th>å¤„ç†è¿‡ç¨‹</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>divRoundUp(size, smallSizeDiv)</td><td>40 / 8 = 5</td></tr><tr><td>size_to_class8[5]</td><td>5</td></tr><tr><td>class_to_size[5]</td><td>48</td></tr></tbody></table><p>æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºæœ€åå¾—åˆ°çš„capç©ºé—´å¤§å°æ˜¯48å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯capä¸º6ï¼Œæ‰€ä»¥æ‰©å®¹çš„ç»“æœæœ€åä¸º6</p><p>æˆ‘ä»¬å¾—åˆ°æ•´ä¸ªæ‰©å®¹è¿‡ç¨‹</p><ol><li>çœ‹çœ‹ç¿»å€åŸå®¹é‡èƒ½å¦æ»¡è¶³éœ€æ±‚<ol><li>ä¸èƒ½ï¼Œåˆ™å…ˆå¾—åˆ°åˆæ­¥å®¹é‡ä¸ºéœ€æ±‚çš„é•¿åº¦</li><li>èƒ½<ol><li>åŸå®¹é‡å°äº256ï¼Œåˆæ­¥å®¹é‡ä¸ºåŸå®¹é‡ç¿»å€</li><li>åŸå®¹é‡å¤§äºç­‰äº256ï¼ŒæŒ‰ç…§å…¬å¼æ‰©å®¹ç›´è‡³æ»¡è¶³éœ€æ±‚</li></ol></li></ol></li><li>æœ€åå°†å®¹é‡roundupsize</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>xv6ä¸­åˆ›å»ºsyscall</title>
      <link href="/2023/09/08/xv6%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E2%80%94%E2%80%94bootloader/"/>
      <url>/2023/09/08/xv6%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E2%80%94%E2%80%94bootloader/</url>
      
        <content type="html"><![CDATA[<p>xv6çš„å¯åŠ¨è¿‡ç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºBIOS-&gt;bootloader-&gt;kernelï¼Œä¸‰ä¸ªç¯èŠ‚ï¼Œæœ¬å°èŠ‚ä¸»è¦è®²è¿°bootloaderçš„ç›¸å…³å†…å®¹ã€‚</p><p>BIOSçš„ä½œç”¨æ˜¯å°†ç£ç›˜çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„å†…å®¹ç§»å…¥åˆ°åœ°å€ä¸º0x7c00çš„ä½ç½®ï¼Œç„¶åæŠŠæ§åˆ¶æƒäº¤ç»™è¿™ä»½å†…å®¹ã€‚è¿™ä¸€ä»½å†…å®¹å°±æ˜¯bootloaderã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%A0%E6%A0%87%E9%A2%98-2023-05-02-1258.png" alt="æ— æ ‡é¢˜-2023-05-02-1258" /></p><p>bootloaderç”±bootasm.Så’Œbootmain.cç»„æˆï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä¸»è¦åˆ†æè¿™ä¸¤ä¸ªæ–‡ä»¶çš„ä»£ç ã€‚</p><h1 id="bootasms"><a class="markdownIt-Anchor" href="#bootasms"></a> bootasm.S</h1><p>ä»£ç ä¸ç®—é•¿ï¼Œæˆ‘ä»¬å…ˆè´´ä¸Šå®Œæ•´çš„ä»£ç ï¼š</p><p><code>bootasm.S</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;asm.h&quot;</span><br><span class="line">#include &quot;memlayout.h&quot;</span><br><span class="line">#include &quot;mmu.h&quot;</span><br><span class="line"></span><br><span class="line"># Start the first CPU: switch to 32-bit protected mode, jump into C.</span><br><span class="line"># The BIOS loads this code from the first sector of the hard disk into</span><br><span class="line"># memory at physical address 0x7c00 and starts executing in real mode</span><br><span class="line"># with %cs=0 %ip=7c00.</span><br><span class="line"></span><br><span class="line">.code16                       # Assemble for 16-bit mode</span><br><span class="line">.globl start</span><br><span class="line">start:</span><br><span class="line">  cli                         # BIOS enabled interrupts; disable</span><br><span class="line"></span><br><span class="line">  # Zero data segment registers DS, ES, and SS.</span><br><span class="line">  xorw    %ax,%ax             # Set %ax to zero</span><br><span class="line">  movw    %ax,%ds             # -&gt; Data Segment</span><br><span class="line">  movw    %ax,%es             # -&gt; Extra Segment</span><br><span class="line">  movw    %ax,%ss             # -&gt; Stack Segment</span><br><span class="line"></span><br><span class="line">  # Physical address line A20 is tied to zero so that the first PCs </span><br><span class="line">  # with 2 MB would run software that assumed 1 MB.  Undo that.</span><br><span class="line">seta20.1:</span><br><span class="line">  inb     $0x64,%al               # Wait for not busy</span><br><span class="line">  testb   $0x2,%al</span><br><span class="line">  jnz     seta20.1</span><br><span class="line"></span><br><span class="line">  movb    $0xd1,%al               # 0xd1 -&gt; port 0x64</span><br><span class="line">  outb    %al,$0x64</span><br><span class="line"></span><br><span class="line">seta20.2:</span><br><span class="line">  inb     $0x64,%al               # Wait for not busy</span><br><span class="line">  testb   $0x2,%al</span><br><span class="line">  jnz     seta20.2</span><br><span class="line"></span><br><span class="line">  movb    $0xdf,%al               # 0xdf -&gt; port 0x60</span><br><span class="line">  outb    %al,$0x60</span><br><span class="line"></span><br><span class="line">  # Switch from real to protected mode.  Use a bootstrap GDT that makes</span><br><span class="line">  # virtual addresses map directly to physical addresses so that the</span><br><span class="line">  # effective memory map doesn&#x27;t change during the transition.</span><br><span class="line">  lgdt    gdtdesc</span><br><span class="line">  movl    %cr0, %eax</span><br><span class="line">  orl     $CR0_PE, %eax</span><br><span class="line">  movl    %eax, %cr0</span><br><span class="line"></span><br><span class="line">//PAGEBREAK!</span><br><span class="line">  # Complete the transition to 32-bit protected mode by using a long jmp</span><br><span class="line">  # to reload %cs and %eip.  The segment descriptors are set up with no</span><br><span class="line">  # translation, so that the mapping is still the identity mapping.</span><br><span class="line">  ljmp    $(SEG_KCODE&lt;&lt;3), $start32</span><br><span class="line"></span><br><span class="line">.code32  # Tell assembler to generate 32-bit code now.</span><br><span class="line">start32:</span><br><span class="line">  # Set up the protected-mode data segment registers</span><br><span class="line">  movw    $(SEG_KDATA&lt;&lt;3), %ax    # Our data segment selector</span><br><span class="line">  movw    %ax, %ds                # -&gt; DS: Data Segment</span><br><span class="line">  movw    %ax, %es                # -&gt; ES: Extra Segment</span><br><span class="line">  movw    %ax, %ss                # -&gt; SS: Stack Segment</span><br><span class="line">  movw    $0, %ax                 # Zero segments not ready for use</span><br><span class="line">  movw    %ax, %fs                # -&gt; FS</span><br><span class="line">  movw    %ax, %gs                # -&gt; GS</span><br><span class="line"></span><br><span class="line">  # Set up the stack pointer and call into C.</span><br><span class="line">  movl    $start, %esp</span><br><span class="line">  call    bootmain</span><br><span class="line"></span><br><span class="line">  # If bootmain returns (it shouldn&#x27;t), trigger a Bochs</span><br><span class="line">  # breakpoint if running under Bochs, then loop.</span><br><span class="line">  movw    $0x8a00, %ax            # 0x8a00 -&gt; port 0x8a00</span><br><span class="line">  movw    %ax, %dx</span><br><span class="line">  outw    %ax, %dx</span><br><span class="line">  movw    $0x8ae0, %ax            # 0x8ae0 -&gt; port 0x8a00</span><br><span class="line">  outw    %ax, %dx</span><br><span class="line">spin:</span><br><span class="line">  jmp     spin</span><br><span class="line"></span><br><span class="line"># Bootstrap GDT</span><br><span class="line">.p2align 2                                # force 4 byte alignment</span><br><span class="line">gdt:</span><br><span class="line">  SEG_NULLASM                             # null seg</span><br><span class="line">  SEG_ASM(STA_X|STA_R, 0x0, 0xffffffff)   # code seg</span><br><span class="line">  SEG_ASM(STA_W, 0x0, 0xffffffff)         # data seg</span><br><span class="line"></span><br><span class="line">gdtdesc:</span><br><span class="line">  .word   (gdtdesc - gdt - 1)             # sizeof(gdt) - 1</span><br><span class="line">  .long   gdt                             # address gdt</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¤§è‡´åˆ†æä¸€ä¸‹ï¼š</p><ol><li><p>å…ˆæ˜¯å…³é—­äº†ä¸­æ–­ï¼Œå®šä¹‰äº†ä¸‹é¢çš„å‡½æ•°åï¼ˆstartï¼‰ï¼Œç„¶ååšäº†ä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.code16                       # Assemble for 16-bit mode</span><br><span class="line">.globl start</span><br><span class="line">start:</span><br><span class="line">  cli                         # BIOS enabled interrupts; disable</span><br><span class="line"></span><br><span class="line">  # Zero data segment registers DS, ES, and SS.</span><br><span class="line">  xorw    %ax,%ax             # Set %ax to zero</span><br><span class="line">  movw    %ax,%ds             # -&gt; Data Segment</span><br><span class="line">  movw    %ax,%es             # -&gt; Extra Segment</span><br><span class="line">  movw    %ax,%ss             # -&gt; Stack Segment</span><br></pre></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥æ˜¯å’ŒIOç«¯å£åšä¸€äº›äº¤äº’ï¼Œå› ä¸ºä¸€äº›å†å²åŸå› ï¼Œæ­¤æ—¶çš„CPUåªèƒ½è®¿é—®1Mçš„åœ°å€ç©ºé—´ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸‹é¢çš„æ“ä½œæ‰“å¼€A20åœ°å€çº¿ï¼Œæ‰å¯ä»¥è®¿é—®é«˜äº1Mçš„ç‰©ç†ç©ºé—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">seta20.1:</span><br><span class="line">  inb     $0x64,%al               # Wait for not busy</span><br><span class="line">  testb   $0x2,%al</span><br><span class="line">  jnz     seta20.1</span><br><span class="line"></span><br><span class="line">  movb    $0xd1,%al               # 0xd1 -&gt; port 0x64</span><br><span class="line">  outb    %al,$0x64</span><br><span class="line"></span><br><span class="line">seta20.2:</span><br><span class="line">  inb     $0x64,%al               # Wait for not busy</span><br><span class="line">  testb   $0x2,%al</span><br><span class="line">  jnz     seta20.2</span><br><span class="line"></span><br><span class="line">  movb    $0xdf,%al               # 0xdf -&gt; port 0x60</span><br><span class="line">  outb    %al,$0x60</span><br></pre></td></tr></table></figure></li><li><p>ä¸‹ä¸€æ­¥è½½å…¥<code>GDTï¼ˆå…¨å±€è¡¨ç¤ºç¬¦è¡¨ï¼‰</code>å¹¶ä¸”å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œæˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230502211630082.png" alt="image-20230502211630082" /></p></li></ol><p>è¿™æ˜¯<code>CR0</code>å¯„å­˜å™¨ï¼Œ<code>ç¬¬0ä½ä¸º1</code>æ˜¯è¡¨ç¤ºå¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œä¸‹é¢è¿™ä¸‰è¡Œæ±‡ç¼–å°†æœ€ä½ä¸ºç½®1ï¼Œå¼€å§‹ä¿æŠ¤æ¨¡å¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movl    %cr0, %eax</span><br><span class="line">orl     $CR0_PE, %eax</span><br><span class="line">movl    %eax, %cr0</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>$CR0_PE</code>åœ¨<code>mmu.h</code>ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CR0_PE          0x00000001      <span class="comment">// Protection Enable</span></span></span><br></pre></td></tr></table></figure><p>å…³äºä¿æŠ¤æ¨¡å¼çš„å…·ä½“ç»†èŠ‚è¯·è‡ªå·±äº†è§£ï¼Œä¸‹é¢ç»§ç»­åˆ†æGDTã€‚</p><p>å¯ä»¥çœ‹åˆ°ä¸‹é¢ä¸€è¡Œæ±‡ç¼–å°†GDTçš„ä¿¡æ¯è£…è½½åˆ°GDTRè¿™ä¸ªå¯„å­˜å™¨ä¸­ï¼Œè¿™ä¸ªå¯„å­˜å™¨ä½16ä½å­˜å‚¨æ®µé•¿ï¼Œé«˜32ä½å­˜å‚¨GDTçš„èµ·å§‹åœ°å€ã€‚æˆ‘ä»¬ç»“åˆä¸‹é¢çš„gdtdescï¼Œå‘ç°è¿™ä¸€æ®µå†…å®¹é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªwordï¼Œç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºæ®µé•¿ï¼Œåé¢åˆå®šä¹‰äº†ä¸€ä¸ªlongï¼Œä¿å­˜GDTçš„åœ°å€ï¼Œå³ç¬¦å·gdtæ‰€åœ¨çš„ä½ç½®ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230502212421240.png" alt="image-20230502212421240" /></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gdt:</span><br><span class="line">  SEG_NULLASM                             # null seg</span><br><span class="line">  SEG_ASM(STA_X|STA_R, 0x0, 0xffffffff)   # code seg</span><br><span class="line">  SEG_ASM(STA_W, 0x0, 0xffffffff)         # data seg</span><br><span class="line"></span><br><span class="line">gdtdesc:</span><br><span class="line">  .word   (gdtdesc - gdt - 1)             # sizeof(gdt) - 1</span><br><span class="line">  .long   gdt                             # address gdt</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†ç»§ç»­çœ‹SEG_NULLASMå’Œä¸‹é¢çš„å†…å®¹ï¼Œä»æ³¨é‡Šå¯ä»¥å‘ç°è¿™ä¸€æ®µå†…å®¹å®šä¹‰äº†ä¸‰ä¸ªæ®µæè¿°ç¬¦ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç©ºæ®µï¼Œåé¢åˆ†åˆ«æ˜¯ä»£ç æ®µå’Œæ•°æ®æ®µã€‚ä¸Šé¢ç”¨åˆ°çš„å®å®šä¹‰åœ¨<code>asm.h</code>ä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#define SEG_NULLASM                                             \</span><br><span class="line">        .word 0, 0;                                             \</span><br><span class="line">        .byte 0, 0, 0, 0</span><br><span class="line"></span><br><span class="line">// The 0xC0 means the limit is in 4096-byte units</span><br><span class="line">// and (for executable segments) 32-bit mode.</span><br><span class="line">#define SEG_ASM(type,base,lim)                                  \</span><br><span class="line">        .word (((lim) &gt;&gt; 12) &amp; 0xffff), ((base) &amp; 0xffff);      \</span><br><span class="line">        .byte (((base) &gt;&gt; 16) &amp; 0xff), (0x90 | (type)),         \</span><br><span class="line">                (0xC0 | (((lim) &gt;&gt; 28) &amp; 0xf)), (((base) &gt;&gt; 24) &amp; 0xff)</span><br><span class="line">                </span><br><span class="line">#define STA_X     0x8       // Executable segment</span><br><span class="line">#define STA_W     0x2       // Writeable (non-executable segments)</span><br><span class="line">#define STA_R     0x2       // Readable (executable segments)</span><br></pre></td></tr></table></figure><p>åœ¨åˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ®µæè¿°ç¬¦çš„ç»“æ„ï¼š</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230502213642606.png" alt="image-20230502213642606" /></p><p>SEG_NULLå¾ˆç®€å•ï¼Œå®šä¹‰äº†ä¸€ä¸ªç©ºæ®µï¼Œå†…å®¹éƒ½æ˜¯0ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹SEG_ASMã€‚é¦–å…ˆåé¢è·Ÿç€ä¸¤ä¸ªwordçš„å†…å®¹ï¼Œå¯ä»¥å‘ç°åˆ†åˆ«å¯¹åº”ç€æ®µæè¿°ç¬¦çš„ä½32ä½ï¼Œåˆ†åˆ«æ˜¯æ®µé™é•¿çš„å‰16ä½ï¼ˆlimçš„é«˜20ä½ä¸ºæ®µé™é•¿ï¼‰å’Œæ®µåŸºå€çš„å‰16ä½ã€‚åé¢åˆ™åˆ†å¼€å®šä¹‰äº†4ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯æ®µåŸºå€çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œç¬¬äºŒä¸ªå­—èŠ‚æŒ‡å®šäº†typeï¼Œå¹¶å°†På’ŒSèµ‹å€¼ä¸º1ï¼Œç¬¬ä¸‰ä¸ªå­—èŠ‚æŒ‡å®šæ®µé™é•¿çš„é«˜4ä½çš„åŒæ—¶å°†Gå’ŒXèµ‹å€¼ä¸º1ï¼Œè¿™å°†å¯åŠ¨å¤§é¡µæ¨¡å¼ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚åˆ™æŒ‡å®šå‰©ä½™çš„æ®µåŸºå€éƒ¨åˆ†ã€‚</p><ol start="4"><li><p>ä¸‹ä¸€æ­¥æ˜¯ä¸€ä¸ªè·³è½¬æŒ‡ä»¤ï¼Œä¹Ÿæ˜¯å®Œæˆäº†16ä½åˆ°32ä½çš„è½¬æ¢çš„ä¸€æ­¥ï¼Œè·³è½¬æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†æŒ‡å®šæ®µå¯„å­˜å™¨csçš„å€¼ï¼Œç¬¬äºŒä¸ªéƒ¨åˆ†æŒ‡å®šipå¯„å­˜å™¨çš„å€¼ï¼Œå…¶ä¸­<code>SEG_KCODE</code>å®šä¹‰åœ¨<code>mmu.h</code>ï¼Œè¡¨ç¤ºä»£ç æ®µ,è¿™é‡Œçš„å€¼å°†ä½œä¸ºGDTçš„ç´¢å¼•ï¼Œåœ¨ä½¿ç”¨æ—¶è¦å°†è¯¥å€¼å·¦ç§»ä¸‰ä½ï¼Œå› ä¸ºæ®µå¯„å­˜å™¨çš„ä½ä¸‰ä½è¡¨ç¤ºå…¶å®ƒä¿¡æ¯ï¼Œåé¢çš„<code>start32</code>åˆ™æ˜¯ä¸€ä¸ªæ ‡å·ï¼Œåœ¨è·³è½¬æŒ‡ä»¤ä¸‹æ–¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// various segment selectors.</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEG_KCODE 1  <span class="comment">// kernel code</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEG_KDATA 2  <span class="comment">// kernel data+stack</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEG_UCODE 3  <span class="comment">// user code</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEG_UDATA 4  <span class="comment">// user data+stack</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEG_TSS   5  <span class="comment">// this process&#x27;s task state</span></span></span><br></pre></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥æ˜¯åœ¨32ä½æ¨¡å¼ä¸‹è®¾ç½®å„ä¸ªæ®µçš„å€¼ï¼Œå…¶ä¸­<code>ds</code>ï¼Œ<code>es</code>ï¼Œ<code>ss</code>è®¾ç½®ä¸ºæ•°æ®æ®µï¼Œ<code>fs</code>å’Œ<code>gs</code>åˆ™è®¾ç½®ä¸ºç©ºæ®µï¼ˆå®ƒä»¬çš„ç´¢å¼•æ˜¯0ï¼Œåœ¨GDTä¸­ç¬¬0ä¸ªæ®µæ˜¯ç©ºæ®µï¼‰ï¼Œæœ€åå°†æ ˆåŸºå€å¯„å­˜å™¨<code>esp</code>è®¾ç½®ä¸º<code>start</code>ï¼Œä¹Ÿå°±æ˜¯bootasm.Sè£…è½½çš„ä½ç½®ï¼Œå³<code>0x7c00</code>ï¼Œæœ€åè·³è½¬åˆ°<code>bootmain.c</code>ã€‚</p></li></ol><p>åˆ°ç°åœ¨<code>bootasm.S</code>çš„éƒ¨åˆ†å°±å®Œæˆäº†ï¼Œç°åœ¨å†…å­˜ä¸­çš„æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230503075033430.png" alt="image-20230503075033430" /></p><h1 id="bootmainc"><a class="markdownIt-Anchor" href="#bootmainc"></a> bootmain.c</h1><p>ç›¸è¾ƒäºbootasm.Sï¼Œbootmain.cæ‰€åšçš„äº‹å¹¶æ²¡æœ‰é‚£ä¹ˆå¤šï¼Œè¯´çš„ç®€å•ä¸€ç‚¹å°±æ˜¯ä¸€èŠ‚äº‹â€”â€”å°†å†…æ ¸è½½å…¥åˆ°å†…å­˜ä¸­ã€‚å†…æ ¸æ–‡ä»¶æ˜¯ä¸€ä¸ªelfæ–‡ä»¶ï¼Œè½½å…¥å†…æ ¸å®é™…ä¸Šå°±æ˜¯è½½å…¥elfæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸€éƒ¨åˆ†å†…å®¹è¦æ±‚å¯¹ELFæ ¼å¼çš„æ–‡ä»¶æœ‰ä¸€å®šçš„äº†è§£ï¼Œä¸‹é¢æ˜¯å®Œæ•´çš„ä»£ç å’ŒELFæ–‡ä»¶æ ¼å¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Boot loader.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Part of the boot block, along with bootasm.S, which calls bootmain().</span></span><br><span class="line"><span class="comment">// bootasm.S has put the processor into protected 32-bit mode.</span></span><br><span class="line"><span class="comment">// bootmain() loads an ELF kernel image from the disk starting at</span></span><br><span class="line"><span class="comment">// sector 1 and then jumps to the kernel entry routine.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;types.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;elf.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;x86.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;memlayout.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SECTSIZE  512</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">readseg</span><span class="params">(uchar*, uint, uint)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">bootmain</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">elfhdr</span> *<span class="title">elf</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">proghdr</span> *<span class="title">ph</span>, *<span class="title">eph</span>;</span></span><br><span class="line">  <span class="type">void</span> (*entry)(<span class="type">void</span>);</span><br><span class="line">  uchar* pa;</span><br><span class="line"></span><br><span class="line">  elf = (<span class="keyword">struct</span> elfhdr*)<span class="number">0x10000</span>;  <span class="comment">// scratch space</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Read 1st page off disk</span></span><br><span class="line">  readseg((uchar*)elf, <span class="number">4096</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Is this an ELF executable?</span></span><br><span class="line">  <span class="keyword">if</span>(elf-&gt;magic != ELF_MAGIC)</span><br><span class="line">    <span class="keyword">return</span>;  <span class="comment">// let bootasm.S handle error</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Load each program segment (ignores ph flags).</span></span><br><span class="line">  ph = (<span class="keyword">struct</span> proghdr*)((uchar*)elf + elf-&gt;phoff);</span><br><span class="line">  eph = ph + elf-&gt;phnum;</span><br><span class="line">  <span class="keyword">for</span>(; ph &lt; eph; ph++)&#123;</span><br><span class="line">    pa = (uchar*)ph-&gt;paddr;</span><br><span class="line">    readseg(pa, ph-&gt;filesz, ph-&gt;off);</span><br><span class="line">    <span class="keyword">if</span>(ph-&gt;memsz &gt; ph-&gt;filesz)</span><br><span class="line">      stosb(pa + ph-&gt;filesz, <span class="number">0</span>, ph-&gt;memsz - ph-&gt;filesz);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Call the entry point from the ELF header.</span></span><br><span class="line">  <span class="comment">// Does not return!</span></span><br><span class="line">  entry = (<span class="type">void</span>(*)(<span class="type">void</span>))(elf-&gt;entry);</span><br><span class="line">  entry();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">waitdisk</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Wait for disk ready.</span></span><br><span class="line">  <span class="keyword">while</span>((inb(<span class="number">0x1F7</span>) &amp; <span class="number">0xC0</span>) != <span class="number">0x40</span>)</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read a single sector at offset into dst.</span></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">readsect</span><span class="params">(<span class="type">void</span> *dst, uint offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Issue command.</span></span><br><span class="line">  waitdisk();</span><br><span class="line">  outb(<span class="number">0x1F2</span>, <span class="number">1</span>);   <span class="comment">// count = 1</span></span><br><span class="line">  outb(<span class="number">0x1F3</span>, offset);</span><br><span class="line">  outb(<span class="number">0x1F4</span>, offset &gt;&gt; <span class="number">8</span>);</span><br><span class="line">  outb(<span class="number">0x1F5</span>, offset &gt;&gt; <span class="number">16</span>);</span><br><span class="line">  outb(<span class="number">0x1F6</span>, (offset &gt;&gt; <span class="number">24</span>) | <span class="number">0xE0</span>);</span><br><span class="line">  outb(<span class="number">0x1F7</span>, <span class="number">0x20</span>);  <span class="comment">// cmd 0x20 - read sectors</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Read data.</span></span><br><span class="line">  waitdisk();</span><br><span class="line">  insl(<span class="number">0x1F0</span>, dst, SECTSIZE/<span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read &#x27;count&#x27; bytes at &#x27;offset&#x27; from kernel into physical address &#x27;pa&#x27;.</span></span><br><span class="line"><span class="comment">// Might copy more than asked.</span></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">readseg</span><span class="params">(uchar* pa, uint count, uint offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  uchar* epa;</span><br><span class="line"></span><br><span class="line">  epa = pa + count;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Round down to sector boundary.</span></span><br><span class="line">  pa -= offset % SECTSIZE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Translate from bytes to sectors; kernel starts at sector 1.</span></span><br><span class="line">  offset = (offset / SECTSIZE) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If this is too slow, we could read lots of sectors at a time.</span></span><br><span class="line">  <span class="comment">// We&#x27;d write more to memory than asked, but it doesn&#x27;t matter --</span></span><br><span class="line">  <span class="comment">// we load in increasing order.</span></span><br><span class="line">  <span class="keyword">for</span>(; pa &lt; epa; pa += SECTSIZE, offset++)</span><br><span class="line">    readsect(pa, offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230503155720201.png" alt="image-20230503155720201" /></p><p>ä¸‹é¢å°±ä¸»è¦ä»‹ç»bootmainè¿™ä¸ªå‡½æ•°ã€‚</p><ol><li>å…ˆè¯»å…¥é™¤äº†ç¬¬ä¸€ä¸ªæ‰‡åŒºä»¥å¤–çš„å‰å…«ä¸ªæ‰‡åŒºã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readseg((uchar*)elf, <span class="number">4096</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li>ç„¶åæ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ˜¯elfæ ¼å¼ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(elf-&gt;magic != ELF_MAGIC)</span><br><span class="line">  <span class="keyword">return</span>;  <span class="comment">// let bootasm.S handle error</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ç„¶åæ‰¾åˆ°ç¨‹åºå¤´çš„ä½ç½®ï¼Œå¹¶æ ¹æ®ç¨‹åºå¤´è½½å…¥å…¨éƒ¨çš„æ®µã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ph = (<span class="keyword">struct</span> proghdr*)((uchar*)elf + elf-&gt;phoff);</span><br><span class="line">eph = ph + elf-&gt;phnum;</span><br><span class="line"><span class="keyword">for</span>(; ph &lt; eph; ph++)&#123;</span><br><span class="line">  pa = (uchar*)ph-&gt;paddr;</span><br><span class="line">  readseg(pa, ph-&gt;filesz, ph-&gt;off);</span><br><span class="line">  <span class="keyword">if</span>(ph-&gt;memsz &gt; ph-&gt;filesz)</span><br><span class="line">    stosb(pa + ph-&gt;filesz, <span class="number">0</span>, ph-&gt;memsz - ph-&gt;filesz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>æœ€åæ‰¾åˆ°å…¥å£å‡½æ•°ï¼Œæ‰§è¡Œå…¥å£å‡½æ•°ï¼Œè‡ªæ­¤å¼€å§‹ï¼Œæ§åˆ¶æƒäº¤ç»™å†…æ ¸ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">entry = (<span class="type">void</span>(*)(<span class="type">void</span>))(elf-&gt;entry);</span><br><span class="line">entry();</span><br></pre></td></tr></table></figure><p>bootloaderçš„å·¥ä½œåˆ°è¿™é‡Œå°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯kernelçš„å¤©ä¸‹äº†ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>xv6ç³»ç»Ÿå¯åŠ¨â€”â€”bootloader</title>
      <link href="/2023/09/08/xv6%E4%B8%AD%E5%88%9B%E5%BB%BAsyscall/"/>
      <url>/2023/09/08/xv6%E4%B8%AD%E5%88%9B%E5%BB%BAsyscall/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬ä»¥åœ¨xv6ä¸­æ·»åŠ ä¸€ä¸ªdateç³»ç»Ÿè°ƒç”¨ä¸ºä¾‹ï¼Œä»‹ç»åœ¨xv6ä¸­æ·»åŠ ç³»ç»Ÿè°ƒç”¨çš„æ–¹æ³•å’ŒåŸç†ã€‚</p><h1 id="date-syscallä»‹ç»"><a class="markdownIt-Anchor" href="#date-syscallä»‹ç»"></a> date syscallä»‹ç»</h1><p>dateç³»ç»Ÿè°ƒç”¨å¯ä»¥è·å–ç³»ç»Ÿå½“å‰çš„UTCæ—¶é—´ã€‚</p><p>åœ¨æˆ‘ä»¬å®Œæˆdateç³»ç»Ÿè°ƒç”¨åï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªç³»ç»Ÿè°ƒç”¨åšä¸€ä¸ªå°å°çš„å·¥å…·ï¼Œå¯ä»¥æ‰“å°å½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œå·¥å…·ä»£ç å¦‚ä¸‹ï¼š</p><p><code>date.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;types.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;user.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;date.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">rtcdate</span> <span class="title">r</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (date(&amp;r)) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="number">2</span>, <span class="string">&quot;date failed\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// your code to print the time in any format you like...</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜é‡<code>r</code>æ˜¯æˆ‘ä»¬è·å–åˆ°çš„æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ræ‰“å°æˆ‘ä»¬æƒ³è¦çš„æ—¶é—´æ ¼å¼ï¼Œç»“æ„ä½“rçš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rtcdate</span> &#123;</span></span><br><span class="line">  uint second;</span><br><span class="line">  uint minute;</span><br><span class="line">  uint hour;</span><br><span class="line">  uint day;</span><br><span class="line">  uint month;</span><br><span class="line">  uint year;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="æ·»åŠ ç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#æ·»åŠ ç³»ç»Ÿè°ƒç”¨"></a> æ·»åŠ ç³»ç»Ÿè°ƒç”¨</h1><p>é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è¦æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¥½å¤šåœ°æ–¹æ·»åŠ å¯¹åº”çš„ä»£ç ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“é—å¿˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿé‰´xv6ä¸­å·²ç»å†™å¥½çš„ç³»ç»Ÿè°ƒç”¨ï¼Œ<code>uptime</code>ç³»ç»Ÿè°ƒç”¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">grep -n <span class="built_in">uptime</span> *.[hcS]</span></span><br><span class="line">syscall.c:105:extern int sys_uptime(void);</span><br><span class="line">syscall.c:121:[SYS_uptime]  sys_uptime,</span><br><span class="line">syscall.h:15:#define SYS_uptime 14</span><br><span class="line">sysproc.c:83:sys_uptime(void)</span><br><span class="line">user.h:25:int uptime(void);</span><br><span class="line">usys.S:31:SYSCALL(uptime)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸éš¾å‘ç°æˆ‘ä»¬è¦åœ¨å…­ä¸ªåœ°æ–¹æ·»åŠ å¯¹åº”çš„ä»£ç ï¼Œé‚£ä¹ˆåŠ ä¸‹æ¥çš„äº‹æƒ…å°±æ˜¯ç…§è‘«èŠ¦ç”»ç“¢å³å¯ã€‚</p><ol><li><pre class="highlight"><code class="c"><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sys_uptime</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sys_date</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;&lt;!--codeï¿¼<span class="hljs-number">3</span>--&gt;</code></pre></li><li><pre class="highlight"><code class="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> SYS_close  21</span><span class="hljs-meta">#<span class="hljs-keyword">define</span> SYS_date   22</span>&lt;!--codeï¿¼<span class="hljs-number">4</span>--&gt;</code></pre></li><li><pre class="highlight"><code class="">SYSCALL(uptime)SYSCALL(date)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç¬¬å››éƒ¨åˆ†çš„å†…å®¹æ˜¯ç³»ç»Ÿè°ƒç”¨çš„å…·ä½“å®ç°ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦å€ŸåŠ©äºç³»ç»Ÿ`lapic.c`ä¸­ç»™æˆ‘ä»¬æä¾›çš„`cmostime`å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ª `struct rtcdate`æŒ‡é’ˆï¼Œå°†æ—¶é—´èµ‹å€¼åˆ°å…¶ä¸­ï¼Œæ­¤å¤–ï¼Œå‚æ•°æˆ‘ä»¬ä¹Ÿéœ€è¦å€ŸåŠ©äºxv6æä¾›çš„argptræ¥è·å–ã€‚</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">int</span><br><span class="line">date(void)</span><br><span class="line">&#123;</span><br><span class="line">    struct rtcdate *r;</span><br><span class="line">    if(argptr(0, (void*)&amp;r, sizeof(struct rtcdate)) &lt; 0)</span><br><span class="line">        return -1;</span><br><span class="line">    cmostime(r);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ol><h1 id="æ‰§è¡Œè¿‡ç¨‹åˆ†æ"><a class="markdownIt-Anchor" href="#æ‰§è¡Œè¿‡ç¨‹åˆ†æ"></a> æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h1><ol><li><p>æˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿè°ƒç”¨åœ¨ç”¨æˆ·æ€çš„å½¢å¼ï¼Œè¿™ä¸ªå‡½æ•°è¢«å®šä¹‰åœ¨<code>user.h</code>ä¸­ã€‚åªéœ€è¦å¼•å…¥<code>user.h</code>æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ã€‚</p></li><li><p>è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä½¿ç”¨æ±‡ç¼–å®ç°çš„ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªå®ç°æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬åœ¨ä¼ å…¥å‚æ•°ä¹‹åï¼Œæˆ‘ä»¬åœ¨<code>%eax</code>å¯„å­˜å™¨ä¸­ä¼ å…¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ï¼Œç„¶åä½¿ç”¨<code>int</code>æŒ‡ä»¤å³å¯ã€‚è¿™ä¸ªå®ç°åœ¨<code>usys.S</code>ä¸­ã€‚</p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SYSCALL(name) \</span></span><br><span class="line"><span class="meta">  .globl name; \</span></span><br><span class="line"><span class="meta">  name: \</span></span><br><span class="line"><span class="meta">    movl $SYS_ ## name, %eax; \</span></span><br><span class="line"><span class="meta">    int $T_SYSCALL; \</span></span><br><span class="line"><span class="meta">    ret</span></span><br><span class="line"></span><br><span class="line">SYSCALL(fork)</span><br><span class="line">SYSCALL(<span class="built_in">exit</span>)</span><br><span class="line">SYSCALL(wait)</span><br><span class="line">SYSCALL(pipe)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="3"><li>å…³äº<code>movl $SYS_ ## name, %eax;</code>åœ¨Cè¯­è¨€ä¸­ï¼Œä¸¤ä¸ª<code>#</code>è¡¨ç¤ºå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä»¥forkä¸ºä¾‹ï¼Œè¿™é‡Œçš„æŒ‡ä»¤å®é™…ä¸Šæ˜¯<code>movl $SYS_ fork, %eax;</code>ï¼Œè¿˜è®°å¾—æˆ‘è¯´<code>%eax</code>è¦ä¼ å…¥ç³»ç»Ÿè°ƒç”¨å·å—ï¼Œé‚£ä¹ˆ<code>SYS_fork</code>æ˜¯æ€ä¹ˆè½¬å˜æˆæ­£ç¡®çš„ç³»ç»Ÿè°ƒç”¨å·çš„å‘¢ï¼Œåœ¨<code>syscall.h</code>ä¸­ï¼š</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_fork    1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_exit    2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_wait    3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_pipe    4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_read    5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_kill    6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_exec    7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYS_fstat   8</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨é¢„ç¼–è¯‘åï¼ŒæŒ‡ä»¤å°±æ˜¯ï¼ˆforkä¸ºä¾‹ï¼‰ï¼Œ<code>movl 1,%eax</code>ã€‚</p><ol start="4"><li>ç„¶åï¼Œ<code>int</code>æŒ‡ä»¤ä¼šé™·å…¥å†…æ ¸ï¼Œå…·ä½“çš„ç»†èŠ‚æˆ‘ä»¬æš‚ä¸å…³ç³»ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šæ‰§è¡Œ<code>syscall.c</code>ä¸­çš„<code>syscall</code>å‡½æ•°</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">syscall</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> num;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">proc</span> *<span class="title">curproc</span> =</span> myproc();</span><br><span class="line"></span><br><span class="line">  num = curproc-&gt;tf-&gt;eax;</span><br><span class="line">  <span class="keyword">if</span>(num &gt; <span class="number">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) &#123;</span><br><span class="line">    curproc-&gt;tf-&gt;eax = syscalls[num]();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cprintf(<span class="string">&quot;%d %s: unknown sys call %d\n&quot;</span>,</span><br><span class="line">            curproc-&gt;pid, curproc-&gt;name, num);</span><br><span class="line">    curproc-&gt;tf-&gt;eax = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ ¸å¿ƒå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curproc-&gt;tf-&gt;eax = syscalls[num]();</span><br></pre></td></tr></table></figure><p>å…¶ä¸­numæ˜¯ç³»ç»Ÿè°ƒç”¨å·ï¼Œé‚£ä¹ˆsyscallsæ˜¯ä»€ä¹ˆå‘¢ï¼Œä¹Ÿæ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="title function_">int</span> <span class="params">(*syscalls[])</span><span class="params">(<span class="type">void</span>)</span> = &#123;</span><br><span class="line">[SYS_fork]    sys_fork,</span><br><span class="line">[SYS_exit]    sys_exit,</span><br><span class="line">...</span><br><span class="line">[SYS_write]   sys_write,</span><br><span class="line">[SYS_mknod]   sys_mknod,</span><br><span class="line">[SYS_unlink]  sys_unlink,</span><br><span class="line">[SYS_link]    sys_link,</span><br><span class="line">[SYS_mkdir]   sys_mkdir,</span><br><span class="line">[SYS_close]   sys_close,</span><br><span class="line">[SYS_date]    sys_date,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å·§å¦™åœ°åˆ©ç”¨äº†Cè¯­è¨€çš„å®ã€‚</p><ol start="5"><li>æœ€åï¼Œï¼ˆè¿˜æ˜¯ä»¥forkä¸ºä¾‹ï¼‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°ç³»ç»Ÿä¼šæ‰§è¡Œ<code>sys_fork</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¢«å®šä¹‰åœ¨<code>sysproc.c</code>ä¸­ï¼ˆäº‹å®ä¸Šå¯ä»¥è¢«å®šä¹‰åœ¨ä»»ä½•ä½ç½®ï¼‰</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">sys_fork</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> fork();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æœ‰æ„æ€çš„ä¸€ç‚¹ï¼Œç³»ç»Ÿè°ƒç”¨è°ƒç”¨åˆ°æœ€åç«Ÿç„¶è¿˜æ˜¯è°ƒç”¨<code>fork</code>ï¼Ÿï¼è¿™ä¸ªforkå·²ç»å’Œå‰é¢çš„forkå®Œå…¨ä¸åŒäº†ï¼Œç°åœ¨çš„forkæ˜¯ä¸€ä¸ªå†…æ ¸ä¸­çš„å‡½æ•°ï¼Œè¢«å®šä¹‰åœ¨<code>proc.c</code>ä¸­ï¼Œå‰é¢çš„è¿‡ç¨‹äº‹å®ä¸Šéƒ½å¯ä»¥ç†è§£ä¸ºå¯¹å†…æ ¸å‡½æ•°çš„åŒ…è£…ï¼Œé€šè¿‡ä¸Šé¢çš„ä¸€ç³»åˆ—è¿‡ç¨‹ï¼Œæˆ‘ä»¬æœ€ç»ˆå®ç°äº†åœ¨ç”¨æˆ·æ€<code>&quot;è°ƒç”¨&quot;</code>å†…æ ¸ä¸­å‡½æ•°ã€‚</p><blockquote><p>å¯ä»¥å‘ç°dateä¹Ÿæ˜¯åŒç†ï¼Œdateç³»ç»Ÿè°ƒç”¨æœ€ç»ˆæ˜¯è°ƒç”¨äº†<code>cmostime</code>å‡½æ•°ã€‚ä¸è¿‡çœ‹èµ·æ¥forkç³»ç»Ÿè°ƒç”¨ç”±äºç”¨æˆ·æ€å’Œå†…æ ¸æ€æœ‰ç€ç›¸åŒçš„åå­—çœ‹èµ·æ¥æ›´åŠ æœ‰è¶£ã€‚</p></blockquote><h1 id="å°†dateå·¥å…·åŠ å…¥åˆ°xv6ä¸­"><a class="markdownIt-Anchor" href="#å°†dateå·¥å…·åŠ å…¥åˆ°xv6ä¸­"></a> å°†dateå·¥å…·åŠ å…¥åˆ°xv6ä¸­</h1><p>æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†æˆ‘ä»¬çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæœ€åæˆ‘ä»¬åªéœ€è¦<code>make</code>ç¼–è¯‘å³å¯ï¼Œ<code>make</code>ä¼šå¸®åŠ©æˆ‘ä»¬æŠŠ<code>date.c</code>ç¼–è¯‘æˆ<code>_date</code>äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æœ€åï¼Œåœ¨ç¼–è¯‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ<code>_date</code>åŠ å…¥åˆ°<code>Makefile</code>çš„<code>UPROGS</code>ä¸­ï¼Œè¿™æ ·å‘½ä»¤æ‰èƒ½ç”Ÿæ•ˆã€‚</p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±æˆåŠŸä¸ºxv6æ·»åŠ äº†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨åˆ©ç”¨è¿™ä¸ªç³»ç»Ÿè°ƒç”¨åˆ¶ä½œäº†ä¸€ä¸ªæ‰“å°çš„æ—¶é—´çš„å·¥å…·ã€‚</p><blockquote><p>tipsï¼šåˆ†æ¸…æ¥šç³»ç»Ÿè°ƒç”¨å’Œshell å‘½ä»¤</p><p><code>date.cå’Œ_date</code>æ˜¯æˆ‘ä»¬åˆ©ç”¨dateç³»ç»Ÿè°ƒç”¨åˆ¶ä½œçš„ï¼Œæˆ‘ä»¬è¦æ³¨æ„æˆ‘ä»¬åœ¨xv6 shellä¸­ä½¿ç”¨çš„dateå‘½ä»¤æ˜¯<code>_date</code>äºŒè¿›åˆ¶æ–‡ä»¶è°ƒç”¨çš„ç»“æœï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨</p></blockquote><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">UPROGS=\</span><br><span class="line">_cat\</span><br><span class="line">_echo\</span><br><span class="line">_forktest\</span><br><span class="line">_grep\</span><br><span class="line">_init\</span><br><span class="line">_kill\</span><br><span class="line">_ln\</span><br><span class="line">_ls\</span><br><span class="line">_mkdir\</span><br><span class="line">_rm\</span><br><span class="line">_sh\</span><br><span class="line">_stressfs\</span><br><span class="line">_usertests\</span><br><span class="line">_wc\</span><br><span class="line">_zombie\</span><br><span class="line">_date\</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make qemu</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>sshçš„åŸç†</title>
      <link href="/2023/09/08/ssh%E7%9A%84%E5%8E%9F%E7%90%86/"/>
      <url>/2023/09/08/ssh%E7%9A%84%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>SSHæ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œç”¨äºè®¡ç®—æœºé—´çš„åŠ å¯†ç™»å½•ã€‚</p><h1 id="sshä¿è¯å®‰å…¨çš„åŸç†"><a class="markdownIt-Anchor" href="#sshä¿è¯å®‰å…¨çš„åŸç†"></a> sshä¿è¯å®‰å…¨çš„åŸç†</h1><p>SSHä¹‹æ‰€ä»¥èƒ½å¤Ÿä¿è¯å®‰å…¨ï¼ŒåŸå› åœ¨äºå®ƒé‡‡ç”¨äº†å…¬é’¥åŠ å¯†ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>è¿œç¨‹ä¸»æœºæ”¶åˆ°ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼ŒæŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™ç”¨æˆ·ã€‚</li><li>ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå…¬é’¥ï¼Œå°†ç™»å½•å¯†ç åŠ å¯†åï¼Œå‘é€å›æ¥ã€‚</li><li>è¿œç¨‹ä¸»æœºç”¨è‡ªå·±çš„ç§é’¥ï¼Œè§£å¯†ç™»å½•å¯†ç ï¼Œå¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±åŒæ„ç”¨æˆ·ç™»å½•ã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹æœ¬èº«æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯å®æ–½çš„æ—¶å€™å­˜åœ¨ä¸€ä¸ªé£é™©ï¼šå¦‚æœæœ‰äººæˆªè·äº†ç™»å½•è¯·æ±‚ï¼Œç„¶åå†’å……è¿œç¨‹ä¸»æœºï¼Œå°†ä¼ªé€ çš„å…¬é’¥å‘ç»™ç”¨æˆ·ï¼Œé‚£ä¹ˆç”¨æˆ·å¾ˆéš¾è¾¨åˆ«çœŸä¼ªã€‚å› ä¸ºä¸åƒhttpsåè®®ï¼ŒSSHåè®®çš„å…¬é’¥æ˜¯æ²¡æœ‰è¯ä¹¦ä¸­å¿ƒï¼ˆCAï¼‰å…¬è¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéƒ½æ˜¯è‡ªå·±ç­¾å‘çš„ã€‚</p><p>å¯ä»¥è®¾æƒ³ï¼Œå¦‚æœæ”»å‡»è€…æ’åœ¨ç”¨æˆ·ä¸è¿œç¨‹ä¸»æœºä¹‹é—´ï¼ˆæ¯”å¦‚åœ¨å…¬å…±çš„wifiåŒºåŸŸï¼‰ï¼Œç”¨ä¼ªé€ çš„å…¬é’¥ï¼Œè·å–ç”¨æˆ·çš„ç™»å½•å¯†ç ã€‚å†ç”¨è¿™ä¸ªå¯†ç ç™»å½•è¿œç¨‹ä¸»æœºï¼Œé‚£ä¹ˆSSHçš„å®‰å…¨æœºåˆ¶å°±è¡ç„¶æ— å­˜äº†ã€‚è¿™ç§é£é™©å°±æ˜¯è‘—åçš„&quot;ä¸­é—´äººæ”»å‡»&quot;ï¼ˆMan-in-the-middle attackï¼‰ã€‚</p><p>SSHåè®®æ˜¯å¦‚ä½•åº”å¯¹çš„å‘¢ï¼Ÿ</p><p>å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡ç™»å½•å¯¹æ–¹ä¸»æœºï¼Œç³»ç»Ÿä¼šå‡ºç°ä¸‹é¢çš„æç¤ºï¼š</p><blockquote><p>$ ssh user@host</p><p>The authenticity of host â€˜host (12.18.429.21)â€™ canâ€™t be established.</p><p>RSA key fingerprint is 98:2e:d7:e0ğŸ‡©ğŸ‡ª9f:ac:67:28:c2:42:2d:37:16:58:4d.</p><p>Are you sure you want to continue connecting (yes/no)?</p></blockquote><p>è¿™æ®µè¯çš„æ„æ€æ˜¯ï¼Œæ— æ³•ç¡®è®¤hostä¸»æœºçš„çœŸå®æ€§ï¼ŒåªçŸ¥é“å®ƒçš„å…¬é’¥æŒ‡çº¹ï¼Œé—®ä½ è¿˜æƒ³ç»§ç»­è¿æ¥å—ï¼Ÿ</p><p>æ‰€è°“&quot;å…¬é’¥æŒ‡çº¹&quot;ï¼Œæ˜¯æŒ‡å…¬é’¥é•¿åº¦è¾ƒé•¿ï¼ˆè¿™é‡Œé‡‡ç”¨RSAç®—æ³•ï¼Œé•¿è¾¾1024ä½ï¼‰ï¼Œå¾ˆéš¾æ¯”å¯¹ï¼Œæ‰€ä»¥å¯¹å…¶è¿›è¡ŒMD5è®¡ç®—ï¼Œå°†å®ƒå˜æˆä¸€ä¸ª128ä½çš„æŒ‡çº¹ã€‚ä¸Šä¾‹ä¸­æ˜¯98:2e:d7:e0ğŸ‡©ğŸ‡ª9f:ac:67:28:c2:42:2d:37:16:58:4dï¼Œå†è¿›è¡Œæ¯”è¾ƒï¼Œå°±å®¹æ˜“å¤šäº†ã€‚</p><p>å¾ˆè‡ªç„¶çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œç”¨æˆ·æ€ä¹ˆçŸ¥é“è¿œç¨‹ä¸»æœºçš„å…¬é’¥æŒ‡çº¹åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿå›ç­”æ˜¯æ²¡æœ‰å¥½åŠæ³•ï¼Œè¿œç¨‹ä¸»æœºå¿…é¡»åœ¨è‡ªå·±çš„ç½‘ç«™ä¸Šè´´å‡ºå…¬é’¥æŒ‡çº¹ï¼Œä»¥ä¾¿ç”¨æˆ·è‡ªè¡Œæ ¸å¯¹ã€‚</p><p>å‡å®šç»è¿‡é£é™©è¡¡é‡ä»¥åï¼Œç”¨æˆ·å†³å®šæ¥å—è¿™ä¸ªè¿œç¨‹ä¸»æœºçš„å…¬é’¥ã€‚</p><blockquote><p>Are you sure you want to continue connecting (yes/no)? yes</p></blockquote><p>ç³»ç»Ÿä¼šå‡ºç°ä¸€å¥æç¤ºï¼Œè¡¨ç¤ºhostä¸»æœºå·²ç»å¾—åˆ°è®¤å¯ã€‚</p><blockquote><p>Warning: Permanently added â€˜host,12.18.429.21â€™ (RSA) to the list of known hosts.</p></blockquote><p>ç„¶åï¼Œä¼šè¦æ±‚è¾“å…¥å¯†ç ã€‚</p><blockquote><p>Password: (enter password)</p></blockquote><p>å¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±å¯ä»¥ç™»å½•äº†ã€‚</p><p>å½“è¿œç¨‹ä¸»æœºçš„å…¬é’¥è¢«æ¥å—ä»¥åï¼Œå®ƒå°±ä¼šè¢«ä¿å­˜åœ¨æ–‡ä»¶$HOME/.ssh/known_hostsä¹‹ä¸­ã€‚ä¸‹æ¬¡å†è¿æ¥è¿™å°ä¸»æœºï¼Œç³»ç»Ÿå°±ä¼šè®¤å‡ºå®ƒçš„å…¬é’¥å·²ç»ä¿å­˜åœ¨æœ¬åœ°äº†ï¼Œä»è€Œè·³è¿‡è­¦å‘Šéƒ¨åˆ†ï¼Œç›´æ¥æç¤ºè¾“å…¥å¯†ç ã€‚</p><p>æ¯ä¸ªSSHç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„known_hostsæ–‡ä»¶ï¼Œæ­¤å¤–ç³»ç»Ÿä¹Ÿæœ‰ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯/etc/ssh/ssh_known_hostsï¼Œä¿å­˜ä¸€äº›å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä¿¡èµ–çš„è¿œç¨‹ä¸»æœºçš„å…¬é’¥ã€‚</p><h1 id="sshå…å¯†ç™»å½•"><a class="markdownIt-Anchor" href="#sshå…å¯†ç™»å½•"></a> sshå…å¯†ç™»å½•</h1><p>ä½¿ç”¨å¯†ç ç™»å½•ï¼Œæ¯æ¬¡éƒ½å¿…é¡»è¾“å…¥å¯†ç ï¼Œéå¸¸éº»çƒ¦ã€‚å¥½åœ¨SSHè¿˜æä¾›äº†å…¬é’¥ç™»å½•ï¼Œå¯ä»¥çœå»è¾“å…¥å¯†ç çš„æ­¥éª¤ã€‚</p><p>æ‰€è°“&quot;å…¬é’¥ç™»å½•&quot;ï¼ŒåŸç†å¾ˆç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹</p><ol><li>ç”¨æˆ·å°†è‡ªå·±çš„å…¬é’¥å‚¨å­˜åœ¨è¿œç¨‹ä¸»æœºä¸Š</li><li>ç™»å½•çš„æ—¶å€™ï¼Œè¿œç¨‹ä¸»æœºä¼šå‘ç”¨æˆ·å‘é€ä¸€æ®µéšæœºå­—ç¬¦ä¸²</li><li>ç”¨æˆ·ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†åï¼Œå†å‘å›æ¥</li><li>è¿œç¨‹ä¸»æœºç”¨äº‹å…ˆå‚¨å­˜çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¦‚æœæˆåŠŸï¼Œå°±è¯æ˜ç”¨æˆ·æ˜¯å¯ä¿¡çš„ï¼Œç›´æ¥å…è®¸ç™»å½•shellï¼Œä¸å†è¦æ±‚å¯†ç ã€‚</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mapreduceç®€ä»‹</title>
      <link href="/2023/09/08/mapreduce%E7%AE%80%E4%BB%8B/"/>
      <url>/2023/09/08/mapreduce%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<p>MapReduceæ˜¯ä¸€ä¸ªç¼–ç¨‹æ¨¡å‹ï¼Œç”¨äºå¤„ç†å’Œç”Ÿæˆå¤§æ•°æ®ã€‚ç”¨æˆ·é€šè¿‡ç¼–å†™Mapå‡½æ•°å¤„ç†è¾“å…¥é”®å€¼å¯¹ç”Ÿæˆä¸­é—´é”®å€¼å¯¹ï¼Œé€šè¿‡ç¼–å†™Reduceå‡½æ•°æ¥åˆå¹¶æ‰€æœ‰çš„ä¸­é—´é”®å€¼å¯¹å¹¶ç”Ÿæˆç»“æœã€‚åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå¤§éƒ¨åˆ†çš„ä»»åŠ¡éƒ½å¯ä»¥è¢«æŠ½è±¡æˆä¸€ä¸ªMapReduceæ¨¡å‹ï¼Œå¹¶é€šè¿‡è¿™ä¸ªæ¨¡å‹è§£å†³é—®é¢˜ã€‚</p><h1 id="mapreduceä»‹ç»"><a class="markdownIt-Anchor" href="#mapreduceä»‹ç»"></a> MapReduceä»‹ç»</h1><p>æˆ‘ä»¬æ‰€é‡åˆ°çš„å¤§å¤šæ•°è®¡ç®—é—®é¢˜éƒ½å¾ˆç›´è§‚ï¼Œä½†æ˜¯å½“è®¡ç®—çš„æ•°é‡ååˆ†åºå¤§æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€è¦å€ŸåŠ©äºæˆç™¾ä¸Šåƒçš„æœºå™¨å…±åŒè®¡ç®—æ¥åŠ é€Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œä½†åœ¨ä»ä¸€ä¸ªæœºå™¨æ‹“å±•åˆ°ä¸€ä¸ªé›†ç¾¤æ—¶æˆ‘ä»¬ä¼šé‡åˆ°æ¯”åŸæ¥å¤šå¾—å¤šçš„é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬è¯¥å¦‚ä½•å¹¶è¡ŒåŒ–è®¡ç®—ï¼Œå¦‚ä½•æŠŠæ•°æ®åˆ†å‘åˆ°æœºå™¨ä¸­ï¼Œå¦‚ä½•å¤„ç†æœºå™¨å®•æœºå¸¦æ¥çš„é—®é¢˜ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ã€‚</p><p>åˆ†å¸ƒå¼çš„è®¡ç®—å¸¦æ¥äº†å„ç§å„æ ·å¤æ‚çš„é—®é¢˜ï¼Œä½†MapReduceçš„å‡ºç°ç»™è§£å†³åˆ†å¸ƒå¼è®¡ç®—å¸¦æ¥äº†ä¸€ä¸ªè¶³å¤Ÿç®€æ´çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="ç¼–ç¨‹æ¨¡å‹"><a class="markdownIt-Anchor" href="#ç¼–ç¨‹æ¨¡å‹"></a> ç¼–ç¨‹æ¨¡å‹</h2><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Untitled%20(1).png" alt="Untitled (1)" />æ•´ä¸ªè®¡ç®—è¿‡ç¨‹æ¥å—ä¸€ç»„è¾“å…¥é”®å€¼å¯¹ï¼Œå¹¶è¾“å‡ºä¸€ç»„é”®å€¼å¯¹ã€‚æˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªè®¡ç®—è¿‡ç¨‹æä¾›ä¸¤ä¸ªå‡½æ•°ï¼Œ<code>Map</code>å’Œ<code>Reduce</code>ã€‚</p><p>Mapå‡½æ•°æ¥å—ä¸€ç»„é”®å€¼å¯¹è¾“å…¥å¹¶ç”Ÿäº§ä¸€ç»„ä¸­é—´é”®å€¼å¯¹ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„æ ‡å‡†æŠŠè¿™äº›é”®å€¼å¯¹åˆ†ç»„å¹¶ä¼ è¾“ç»™Reduceå‡½æ•°ã€‚</p><p>Reduceå‡½æ•°æ¥å—ä¸­é—´é”®å€¼å¯¹ä½œä¸ºè¾“å…¥ï¼Œåˆå¹¶è¿™äº›æ•°æ®å¹¶äº§ç”Ÿä¸€ç»„é”®å€¼å¯¹ä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚</p><h2 id="ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹"></a> ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªMapReduceå®ç°çš„ä¼ªä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">map(String key, String value):</span><br><span class="line">    // key: document name</span><br><span class="line">    // value: document contents</span><br><span class="line">    for each word w in value:</span><br><span class="line">EmitIntermediate(w, &quot;1&quot;);</span><br><span class="line"></span><br><span class="line">reduce(String key, Iterator values):</span><br><span class="line">    // key: a word</span><br><span class="line">    // values: a list of counts</span><br><span class="line">    int result = 0;</span><br><span class="line">    for each v in values:</span><br><span class="line">    result += ParseInt(v);</span><br><span class="line">    Emit(AsString(result));</span><br></pre></td></tr></table></figure><p>mapå‡½æ•°è·å–æ–‡ç« ä¸­çš„æ¯ä¸ªå•è¯ï¼Œå¹¶ç®€å•çš„ç»™æ¯ä¸ªkeyèµ‹å€¼ä¸º1ï¼Œç„¶åæŠŠè¿™äº›ç»“æœæäº¤ç»™reduceå‡½æ•°ï¼Œreduceå‡½æ•°åˆå¹¶ç›¸åŒçš„keyï¼Œè¾“å‡ºæœ€ç»ˆç»“æœã€‚</p><h2 id="å¸¸è§åº”ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#å¸¸è§åº”ç”¨åœºæ™¯"></a> å¸¸è§åº”ç”¨åœºæ™¯</h2><ol><li><p>Distributed Grepï¼šåœ¨å¤§è§„æ¨¡æ–‡æœ¬æ•°æ®ä¸­æŸ¥æ‰¾æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåŒ¹é…çš„è¡Œã€‚Map é˜¶æ®µå°†æ¯ä¸ªè¾“å…¥æ–‡ä»¶åˆ†å‰²ä¸ºå¤šä¸ªå—ï¼ŒReduce é˜¶æ®µå°†åŒ¹é…çš„è¡Œè¿›è¡Œæ±‡æ€»ã€‚</p></li><li><p>Count of URL Access Frequencyï¼šç»Ÿè®¡ Web æ—¥å¿—ä¸­æ¯ä¸ª URL çš„è®¿é—®é¢‘ç‡ï¼Œç”¨äºåˆ†æç”¨æˆ·è¡Œä¸ºå’Œç½‘ç«™æ€§èƒ½ã€‚Map é˜¶æ®µå°†æ¯ä¸ªæ—¥å¿—æ–‡ä»¶è§£æä¸ºé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®ä¸º URLï¼Œå€¼ä¸º 1ï¼ŒReduce é˜¶æ®µå°†ç›¸åŒ URL çš„å€¼ç›¸åŠ å¹¶è¾“å‡ºã€‚</p></li><li><p>Reverse Web-Link Graphï¼šå°† Web é¡µé¢ä¹‹é—´çš„é“¾æ¥å…³ç³»è½¬åŒ–ä¸ºåå‘çš„é¡µé¢åˆ°é“¾æ¥çš„å…³ç³»ï¼Œç”¨äºæœç´¢å¼•æ“æ’åç­‰åº”ç”¨ã€‚Map é˜¶æ®µå°†æ¯ä¸ªé¡µé¢è§£æä¸ºé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®ä¸ºé¡µé¢ URLï¼Œå€¼ä¸ºä¸è¯¥é¡µé¢ç›¸è¿çš„ URLï¼ŒReduce é˜¶æ®µå°†ç›¸åŒ URL çš„å€¼è¿›è¡Œåˆå¹¶ã€‚</p></li><li><p>Term-Vector per Hostï¼šä¸ºæ¯ä¸ªä¸»æœºè®¡ç®—å…¶åŒ…å«çš„æ–‡æœ¬æ•°æ®ä¸­æ¯ä¸ªå•è¯çš„é¢‘ç‡å‘é‡ï¼Œç”¨äºæ–‡æœ¬åˆ†ç±»å’Œä¿¡æ¯æ£€ç´¢ã€‚Map é˜¶æ®µå°†æ¯ä¸ªæ–‡æ¡£è§£æä¸ºé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®ä¸ºä¸»æœºåï¼Œå€¼ä¸ºå•è¯å’Œå‡ºç°æ¬¡æ•°çš„åˆ—è¡¨ï¼ŒReduce é˜¶æ®µå°†ç›¸åŒä¸»æœºåçš„åˆ—è¡¨è¿›è¡Œåˆå¹¶ã€‚</p></li><li><p>Inverted Indexï¼šä¸ºå¤§è§„æ¨¡æ–‡æœ¬æ•°æ®å»ºç«‹å€’æ’ç´¢å¼•ï¼Œç”¨äºæ”¯æŒå…¨æ–‡æœç´¢å’Œç›¸å…³æ€§æ’åºç­‰åº”ç”¨ã€‚Map é˜¶æ®µå°†æ¯ä¸ªæ–‡æ¡£è§£æä¸ºé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®ä¸ºå•è¯ï¼Œå€¼ä¸ºæ–‡æ¡£ ID å’Œå‡ºç°æ¬¡æ•°çš„åˆ—è¡¨ï¼ŒReduce é˜¶æ®µå°†ç›¸åŒå•è¯çš„åˆ—è¡¨è¿›è¡Œåˆå¹¶ã€‚</p></li><li><p>Distributed Sortï¼šå¯¹å¤§è§„æ¨¡æ•°æ®è¿›è¡Œæ’åºï¼Œç”¨äºæ•°æ®æ¸…æ´—ã€æ•°æ®åˆ†æç­‰åº”ç”¨ã€‚Map é˜¶æ®µå°†è¾“å…¥æ•°æ®åˆ†å‰²ä¸ºå¤šä¸ªå—ï¼Œå¹¶å¯¹æ¯ä¸ªå—è¿›è¡Œå†…éƒ¨æ’åºï¼ŒReduce é˜¶æ®µå°†å¤šä¸ªæœ‰åºå—è¿›è¡Œå½’å¹¶æ’åºã€‚</p></li></ol><h1 id="mapreduceå®ç°"><a class="markdownIt-Anchor" href="#mapreduceå®ç°"></a> MapReduceå®ç°</h1><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20230402194955138.png" alt="image-20230402194955138" /></p><h2 id="æ‰§è¡Œæµç¨‹"><a class="markdownIt-Anchor" href="#æ‰§è¡Œæµç¨‹"></a> æ‰§è¡Œæµç¨‹</h2><p>æˆ‘ä»¬æŠŠè¾“å…¥åˆ†æˆMä»½çš„splitï¼Œç„¶ååˆ†é…ç»™workeræ‰§è¡Œmapï¼Œåœ¨workeræ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬æ•´ç†workerçš„è¾“å‡ºçš„ä¸­é—´é”®å€¼å¯¹ï¼Œæ ¹æ®Reduceåˆ†åŒºçš„æ•°é‡åˆ†ä¸ºRä»½ï¼Œç„¶åå†äº¤ç»™Reduceå‡½æ•°æ‰§è¡Œã€‚</p><p>ä¸‹é¢æ˜¯å…·ä½“çš„æµç¨‹ï¼š</p><ol><li>é¦–å…ˆæˆ‘ä»¬æŠŠè¾“å…¥åˆ†æˆMä»½ï¼Œæ¯ä¸€ä»½çš„å¤§å°é€šå¸¸åœ¨16~64MèŒƒå›´å†…ï¼Œè¿™ç”±ç”¨æˆ·è®¾ç½®ã€‚</li><li>ç„¶åmasterèŠ‚ç‚¹åˆ†é…æœªå®Œæˆçš„ä»»åŠ¡ç»™ç©ºé—²çš„èŠ‚ç‚¹ã€‚</li><li>è¢«åˆ†é…åˆ°mapä»»åŠ¡çš„èŠ‚ç‚¹å¤„ç†è¾“å‡ºçš„é”®å€¼å¯¹ï¼Œå¹¶å°†ä¸­é—´é”®å€¼å¯¹ä¿å­˜åœ¨æœ¬åœ°ç¼“å­˜ä¸­ã€‚</li><li>ç„¶åæ‰§è¡Œmapä»»åŠ¡çš„èŠ‚ç‚¹ä¼šå®šæœŸå°†ç¼“å­˜ä¸­çš„å†…å®¹å†™åˆ°ç£ç›˜ï¼Œå¹¶å°†è¿™äº›å†…å®¹åˆ†æˆRä¸ªåŒºåŸŸï¼Œç„¶åå°†å®ƒä»¬çš„ä½ç½®å‘é€ç»™masterã€‚</li><li>å½“reduceèŠ‚ç‚¹è¢«é€šçŸ¥è¿™äº›æ–‡ä»¶çš„ä½ç½®ï¼Œå®ƒä¼šé€šè¿‡RPCæ¥è¯»å–æ–‡ä»¶çš„å†…å®¹ä»mapèŠ‚ç‚¹ä¸­ï¼Œç­‰reduceèŠ‚ç‚¹è¯»å–å®Œæ‰€æœ‰éœ€è¦çš„å†…å®¹ï¼Œå®ƒä¼šå¯¹ä¸­é—´é”®å€¼å¯¹è¿›è¡Œæ’åºã€‚</li><li>ç„¶åreduceèŠ‚ç‚¹ä¼šè¿­ä»£è¿™äº›é”®å€¼å¯¹ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªç»“æœæ–‡ä»¶ã€‚</li><li>æœ€åå½“æ‰€æœ‰çš„ä»»åŠ¡å®Œæˆï¼ŒmasterèŠ‚ç‚¹ä¼šé€šçŸ¥ç”¨æˆ·ç¨‹åºå¹¶è¿”å›ã€‚</li></ol><p>åœ¨æˆåŠŸçš„ç»“æŸæ‰§è¡Œä»¥åï¼Œæˆ‘ä»¬ä¼šè·å¾—Rä»½çš„è¾“å‡ºæ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»åˆå¹¶è¿™Rä»½æ–‡ä»¶ï¼Œå› ä¸ºå®ƒä»¬å¾€å¾€æ˜¯å…¶å®ƒåˆ†å¸ƒå¼è®¡ç®—çš„è¾“å…¥æˆ–è€…å®ƒä»¬å¯ä»¥è¢«å…¶å®ƒçš„åˆ†å¸ƒå¼åº”ç”¨å¤„ç†ã€‚</p><h2 id="ä¸»èŠ‚ç‚¹æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#ä¸»èŠ‚ç‚¹æ•°æ®ç»“æ„"></a> ä¸»èŠ‚ç‚¹æ•°æ®ç»“æ„</h2><p>MasterèŠ‚ç‚¹éœ€è¦ç»´æŠ¤ä¸€äº›æ•°æ®ç»“æ„ä»¥ä¿è¯æ•´ä¸ªè¿‡ç¨‹çš„æ­£ç¡®æ‰§è¡Œï¼Œä¸‹é¢æ˜¯éƒ¨åˆ†æ•°æ®ç»“æ„ï¼š</p><ol><li>Job å®ŒæˆçŠ¶æ€ï¼šè®°å½•æ¯ä¸ª map ä»»åŠ¡å’Œ reduce ä»»åŠ¡çš„å®ŒæˆçŠ¶æ€ï¼ŒçŠ¶æ€åŒ…æ‹¬æœªæ‰§è¡Œï¼Œæ­£åœ¨å¤„ç†å’Œå·²å®Œæˆã€‚</li><li>èµ„æºåˆ†é…è¡¨ï¼šè®°å½•æ¯ä¸ª worker èŠ‚ç‚¹çš„è´Ÿè½½çŠ¶å†µå’Œå¯ç”¨èµ„æºï¼Œä»¥ä¾¿äºè¿›è¡Œä»»åŠ¡è°ƒåº¦å’Œèµ„æºåˆ†é…ã€‚</li><li>ä¸­é—´ç»“æœä¿¡æ¯è¡¨ï¼šè®°å½•æ¯ä¸ª map ä»»åŠ¡äº§ç”Ÿçš„ä¸­é—´ç»“æœæ–‡ä»¶çš„ä½ç½®å’Œå¤§å°ï¼Œä»¥ä¾¿äº reduce ä»»åŠ¡èƒ½å¤Ÿè®¿é—®å’Œå¤„ç†ä¸­é—´ç»“æœã€‚</li></ol><h2 id="å®¹é”™"><a class="markdownIt-Anchor" href="#å®¹é”™"></a> å®¹é”™</h2><p>è¿™é‡Œæˆ‘ä»¬ä»…ä»…è®¨è®ºWorker Failureçš„æƒ…å†µï¼Œå¯¹äºMasterèŠ‚ç‚¹çš„å®¹é”™æˆ‘ä»¬ä¸äºˆè®¨è®ºã€‚</p><p>é¦–å…ˆï¼ŒmasterèŠ‚ç‚¹ä¼šå®šæ—¶å»pingå·¥ä½œèŠ‚ç‚¹ï¼Œå‡å¦‚åœ¨ä¸€æ®µé¢„å…ˆè®¾å®šå¥½çš„æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œmasterä¼šè®¤ä¸ºè¯¥å·¥ä½œèŠ‚ç‚¹å·²ç»å®•æœºï¼Œæ‰€æœ‰ç”±è¯¥èŠ‚ç‚¹å®Œæˆçš„mapä»»åŠ¡éƒ½ä¼šè¢«è®¾ç½®ä¸ºç©ºé—²çŠ¶æ€ï¼Œç”±è¯¥èŠ‚ç‚¹æ­£åœ¨æ‰§è¡Œçš„mapæˆ–reduceä»»åŠ¡éƒ½ä¼šè¢«è®¾ç½®ä¸ºæœªå®Œæˆï¼Œè¿™äº›è¢«é‡æ–°è®¾ç½®ä¸ºæœªå®Œæˆçš„ä»»åŠ¡ä¼šè¢«é‡æ–°æ‰§è¡Œã€‚</p><p>æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡éœ€è¦é‡æ–°æ‰§è¡Œå¾ˆå®¹æ˜“ç†è§£ï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ‰€æœ‰è¢«è¯¥èŠ‚ç‚¹æ‰§è¡Œå®Œæˆçš„mapèŠ‚ç‚¹éƒ½éœ€è¦é‡æ–°æ‰§è¡Œã€‚è¿™æ˜¯å› ä¸ºåœ¨MapReduceæ¨¡å‹ä¸­ï¼Œmapå‡½æ•°æ‰§è¡Œçš„ç»“æœä¼šè¢«æ”¾åœ¨æœ¬æœºçš„æœ¬åœ°ç£ç›˜ä¸­ï¼Œè€Œreduceå‡½æ•°çš„æ‰§è¡Œç»“æœä¼šè¢«æ”¾ç½®åœ¨è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¦‚ä½•æ‰§è¡Œmapçš„æœºå™¨å®•æœºï¼Œé‚£ä¹ˆæ‰§è¡Œçš„ç»“æœå°†æ— æ³•è¢«è®¿é—®ï¼Œæ‰€ä»¥å¿…é¡»é‡æ–°æ‰§è¡Œï¼Œè€Œreduceå‡½æ•°çš„æ‰§è¡Œç»“æœç”±äºä¿å­˜åœ¨è¿œç¨‹ï¼Œæ‰€ä»¥æ— éœ€é‡æ–°æ‰§è¡Œã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€çš„å†…å­˜æ¨¡å‹</title>
      <link href="/2023/09/08/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"/>
      <url>/2023/09/08/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<ul><li>ç¨‹åºä¸ºä»€ä¹ˆè¦è¢«ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åæ‰å¯ä»¥è¿è¡Œ</li><li>ç¼–è¯‘å™¨åœ¨æŠŠCè¯­è¨€è½¬æ¢æˆæœºå™¨ç çš„è¿‡ç¨‹ä¸­åšäº†ä»€ä¹ˆ</li><li>æœ€åç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶é‡Œé¢æ˜¯ä»€ä¹ˆï¼Œé™¤äº†æœºå™¨ç è¿˜æœ‰ä»€ä¹ˆï¼Œæ˜¯å¦‚ä½•ç»„ç»‡çš„</li><li>#include&lt;stdio.h&gt;æ˜¯ä»€ä¹ˆæ„æ€ï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆï¼ŒCè¯­è¨€åº“æ˜¯å¦‚ä½•å®ç°çš„</li><li>ä¸åŒç¼–è¯‘å™¨å’Œä¸åŒç¡¬ä»¶å¹³å°ä»¥åŠä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œæœ€ç»ˆç¼–è¯‘å‡ºæ¥çš„ç»“æœç›¸åŒå—ï¼Œä¸ºä»€ä¹ˆ</li><li>HelloWorldæ˜¯å¦‚ä½•è¿è¡Œèµ·æ¥çš„ï¼Œæ“ä½œç³»ç»Ÿå¦‚ä½•è£…è½½å®ƒï¼Œå®ƒä»å“ªå¼€å§‹ï¼Œä»å“ªç»“æŸ</li><li>å¦‚æœæ²¡æœ‰æ“ä½œç³»ç»Ÿæˆ‘ä»¬å¦‚ä½•å®ç°HelloWorldï¼Œæˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Œå¦‚ä½•å®ç°</li><li>printfæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå®ƒä¸ºä»€ä¹ˆå¯ä»¥æœ‰ä¸å®šæ•°é‡çš„å‚æ•°ï¼Œä¸ºä»€ä¹ˆæœ€åå¯ä»¥åœ¨ç»ˆç«¯ä¸Šè¾“å‡ºå­—ç¬¦ä¸²</li><li>HelloWorldç¨‹åºè¿è¡Œæ—¶åœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆæ ·çš„</li></ul><h1 id="cè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#cè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹"></a> Cè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹</h1><p>å¤ä¹ å¤§ä¸€</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/20180415062914966.png" alt="" /></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>httpsç®€è¿°</title>
      <link href="/2023/09/08/https%E7%AE%80%E8%BF%B0/"/>
      <url>/2023/09/08/https%E7%AE%80%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<p>åœ¨äº†è§£httpsä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹éå¯¹ç§°åŠ å¯†ã€‚</p><h1 id="éå¯¹ç§°åŠ å¯†çš„æ•°å­¦åŸç†"><a class="markdownIt-Anchor" href="#éå¯¹ç§°åŠ å¯†çš„æ•°å­¦åŸç†"></a> éå¯¹ç§°åŠ å¯†çš„æ•°å­¦åŸç†</h1><p>éå¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯åŠ å¯†å’Œè§£å¯†ç”¨åˆ°çš„ä¸æ˜¯ä¸€ä¸ªå¯†é’¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»éå¯¹ç§°åŠ å¯†çš„æ•°å­¦åŸç†ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 ^ 2 mod 7 = 25 mod 7 = x</span><br></pre></td></tr></table></figure><p>æ˜“çŸ¥x = 4ï¼Œç„¶åï¼Œæˆ‘ä»¬å°†xçš„ä½ç½®åˆ‡æ¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 ^ x mod 7 = 4</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡æšä¸¾ï¼Œä¼¼ä¹ä¹Ÿå¯ä»¥å¾—åˆ°ç­”æ¡ˆï¼Œx  = 2ï¼Œä½†æ˜¯å¦‚ä½•æ¨¡æ•°å­—å˜å¾—å¾ˆå¤§å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 ^ x mod 56374677648 = 4</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„è®¡ç®—é‡ä¼šå˜å¾—éå¸¸å·¨å¤§ï¼Œå³ä½¿æ˜¯è®¡ç®—æœºä¹Ÿè¦èŠ±è´¹æ•°å¹´çš„æ—¶é—´æ‰èƒ½è®¡ç®—å¾—å‡ºï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™æ˜¯æ— æ³•è®¡ç®—çš„ã€‚</p><p>ä¸Šé¢çš„è®¡ç®—æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå°±æ˜¯å°†5ï¼ˆåŸæ–‡ï¼‰åŠ å¯†æˆäº†4ï¼ˆå¯†æ–‡ï¼‰ï¼Œæˆ‘ä»¬åœ¨å·²çŸ¥xçš„æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“å°±å¯ä»¥åŠ å¯†ï¼Œä½†æ˜¯åä¹‹ï¼Œæˆ‘ä»¬åœ¨ä»…çŸ¥é“5ï¼ˆåŸæ–‡ï¼‰å’Œ4ï¼ˆå¯†æ–‡ï¼‰çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾ˆéš¾æ¨å‡ºxçš„å€¼ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸å¯é€†çš„è¿‡ç¨‹ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æŠŠxåˆ†æˆpå’Œq</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 ^ (p * q) mod 56374677648 = 4</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(åŸæ–‡) ^ (p * q) mod N = å¯†æ–‡</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæœ€é‡è¦çš„ä¸€æ­¥æ˜¯ç»“åˆæ¬§æ‹‰å…¬å¼ï¼Œå¯ä»¥å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(åŸæ–‡) ^ (p) mod N = å¯†æ–‡</span><br><span class="line">(å¯†æ–‡) ^ (q) mod N = åŸæ–‡</span><br></pre></td></tr></table></figure><p>på’Œqå°±æ˜¯æˆ‘ä»¬è¯´çš„å…¬é’¥å’Œå¯†é’¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¬é’¥å’Œå¯†é’¥äº‹å®ä¸Šæ˜¯å¯ä»¥äº’æ¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œä¹Ÿå¯ä¼šåè¿‡æ¥ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œé€šè¿‡ä¸Šé¢çš„è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ‹¥æœ‰å…¬é’¥çš„ä¸€æ–¹å¦‚æœè§£å¯†äº†å¯†æ–‡ï¼ŒåŒæ—¶æ‹¥æœ‰åŸæ–‡å’Œå¯†æ–‡ï¼Œä¹Ÿæ˜¯å‡ ä¹ä¸å¯èƒ½è§£å‡ºç§é’¥çš„ã€‚</p><h1 id="httpsçš„åŸç†"><a class="markdownIt-Anchor" href="#httpsçš„åŸç†"></a> httpsçš„åŸç†</h1><p>â€‹httpså³åœ¨httpä¹‹ä¸Šæ·»åŠ ä¸€ä¸ªtlså±‚ï¼Œç›®å‰å¸¸ç”¨çš„tlsç‰ˆæœ¬ä¸º1.2ç‰ˆæœ¬ã€‚</p><h2 id="httpsåŠ å¯†è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#httpsåŠ å¯†è¿‡ç¨‹"></a> httpsåŠ å¯†è¿‡ç¨‹</h2><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/6401.png" alt="6401" /></p><p>åŠ å¯†è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li>ç¬¬ä¸€é˜¶æ®µæ˜¯TLSå››æ¬¡æ¡æ‰‹ï¼ŒåŒæ–¹äº¤æ¢ä¸€äº›ä¿¡æ¯ï¼Œæœ€åä¼šå¾—åˆ°ä¸€ä¸ª<code>ä¼šè¯å¯†é’¥</code></li><li>ç¬¬äºŒé˜¶æ®µæ˜¯åŒæ–¹åˆ©ç”¨<code>ä¼šè¯å¯†é’¥</code>é€šä¿¡</li></ol><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹TLSå››æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/640.png" alt="640" /></p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼š</p><p>å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯ï¼šTLSç‰ˆæœ¬+åŠ å¯†å¥—ä»¶+<code>å®¢æˆ·ç«¯éšæœºæ•°</code></p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼š</p><p>æœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯ï¼šTLSç‰ˆæœ¬+æœåŠ¡å™¨è¯ä¹¦+<code>æœåŠ¡ç«¯éšæœºæ•°</code></p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼š</p><ol><li>æ­¤æ—¶å®¢æˆ·ç«¯å†æ¬¡ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå«åš<code>pre_master_key</code>ï¼Œä»æœåŠ¡å™¨è¯ä¹¦ä¸­å–å‡ºå…¬é’¥ï¼Œç”¨å…¬é’¥åŠ å¯†<code>pre_master_key</code>ï¼Œå‘é€ç»™æœåŠ¡ç«¯</li><li>å®¢æˆ·ç«¯æ­¤æ—¶å·²ç»æ‹¥æœ‰ä¸‰ä¸ªéšæœºæ•°ï¼Œå®¢æˆ·ç«¯éšæœºæ•°+æœåŠ¡ç«¯éšæœºæ•°+pre_master_keyï¼Œå®¢æˆ·ç«¯ä¼šæŠŠè¿™ä¸‰ä¸ªéšæœºæ•°è®¡ç®—å¾—åˆ°ä¸€ä¸ª<code>ä¼šè¯å¯†é’¥</code>ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡ç«¯ï¼Œåé¢ä¼šé‡‡ç”¨è¿™ä¸ªä¼šè¯å¯†é’¥è¿›è¡Œé€šä¿¡</li><li>å®¢æˆ·ç«¯ä¼šæŠŠè¿„ä»Šä¸ºæ­¢çš„æ‰€æœ‰é€šä¿¡å†…å®¹ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ï¼Œç”¨<code>ä¼šè¯å¯†é’¥</code>åŠ å¯†å‘ç»™æœåŠ¡å™¨æ ¡éªŒï¼Œå®¢æˆ·ç«¯è¿™è¾¹çš„æ¡æ‰‹æµç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå› æ­¤ä¹Ÿå«åš<code>FinishedæŠ¥æ–‡</code></li></ol><p>ç¬¬å››æ¬¡æ¡æ‰‹ï¼š</p><ol><li>æœåŠ¡ç«¯é€šè¿‡åŒæ ·æ–¹æ³•æŠŠä¸‰ä¸ªéšæœºæ•°è®¡ç®—å¾—åˆ°<code>ä¼šè¯å¯†é’¥</code>ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œåé¢ä¼šç”¨è¿™ä¸ªä¼šè¯å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚</li><li>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸€æ ·ï¼Œå°†è¿„ä»Šä¸ºæ­¢çš„é€šä¿¡å†…å®¹ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ï¼Œå‘ç»™å®¢æˆ·ç«¯æ ¡éªŒï¼Œæ­¤æ—¶æœåŠ¡ç«¯çš„æ¡æ‰‹æµç¨‹ä¹Ÿç»“æŸäº†ï¼Œå› æ­¤è¿™ä¹Ÿæ˜¯<code>FinishedæŠ¥æ–‡</code></li></ol><p>åœ¨æ¡æ‰‹ç»“æŸä»¥åï¼Œæˆ‘ä»¬å‘ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‹¥æœ‰åŒä¸€ä¸ª<code>ä¼šè¯å¯†é’¥</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤è€…åœ¨é€šä¿¡é˜¶æ®µä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†è€Œä¸æ˜¯éå¯¹ç§°åŠ å¯†ã€‚</p><h2 id="ä¸ºä»€ä¹ˆé€šä¿¡é˜¶æ®µè¦ä½¿ç”¨å¯¹ç§°åŠ å¯†"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆé€šä¿¡é˜¶æ®µè¦ä½¿ç”¨å¯¹ç§°åŠ å¯†"></a> ä¸ºä»€ä¹ˆé€šä¿¡é˜¶æ®µè¦ä½¿ç”¨å¯¹ç§°åŠ å¯†</h2><p>å› ä¸ºå¯¹ç§°åŠ å¯†çš„é€Ÿåº¦è¦å¿«äºéå¯¹ç§°åŠ å¯†</p><h2 id="æœåŠ¡å™¨è¯ä¹¦æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#æœåŠ¡å™¨è¯ä¹¦æ˜¯ä»€ä¹ˆ"></a> æœåŠ¡å™¨è¯ä¹¦æ˜¯ä»€ä¹ˆ</h2><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å‘é€çš„éšæœºæ•°éƒ½æ˜¯æ˜æ–‡çš„ï¼Œæ‰€æœ‰å¾ˆå®¹æ˜“è¢«è·å–ï¼Œå…³é”®å°±åœ¨äº<code>pre_master_key</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•ä¿è¯è¿™ä¸ª<code>pre_master_key</code>çš„å®‰å…¨æ€§å‘¢ï¼Œå…³é”®åœ¨äºå®¢æˆ·ç«¯è¦ç¡®ä¿æœåŠ¡å™¨å…¬é’¥æ˜¯çœŸæ­£æ¥è‡ªæœåŠ¡å™¨çš„ã€‚</p><p>å¦‚æœé»‘å®¢åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ›¿æ¢äº†æœåŠ¡å™¨çš„å…¬é’¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code>pre_master_key</code>å°†ä¼šè¢«æˆªå–ã€‚é‚£ä¹ˆå®¢æˆ·ç«¯æ˜¯å¦‚ä½•ä¿è¯å…¬é’¥æ¥è‡ªæœåŠ¡å™¨å‘¢ï¼Œå®é™…ä¸Šå¦‚æœåªä¾é æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æœ¬èº«ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— è§£çš„é—®é¢˜ï¼Œå› ä¸ºåŒæ–¹åœ¨çœŸæ­£åŠ å¯†é€šä¿¡ä¹‹å‰ï¼ŒåŒæ–¹æ˜¯äº’ç›¸ä¸ä¿¡ä»»çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åˆéœ€è¦ä¸€æ¬¡å—ä¿¡ä»»çš„é€šä¿¡æ¥å¼€å¯åŠ å¯†é€šä¿¡ï¼ˆè¿™æ¬¡å—ä¿¡ä»»çš„é€šä¿¡å»ºç«‹åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸ä¿¡ä»»çš„å‰æä¸‹ï¼‰ï¼Œåœ¨httpsçš„åŠ å¯†è¿‡ç¨‹ä¸­ï¼Œè¿™æ¬¡å—ä¿¡ä»»çš„é€šä¿¡å°±æ˜¯å®¢æˆ·ç«¯æ¥å—æœåŠ¡ç«¯çš„æœåŠ¡è¯ä¹¦ï¼Œä»è¿™ä¸€æ¬¡é€šä¿¡è¿‡åï¼Œå®¢æˆ·ç«¯å¯ä»¥åŠ å¯†å‡º<code>pre_master_key</code>ï¼Œè¿™ä¸ªåŠ å¯†åçš„<code>pre_master_key</code>åªæœ‰æœåŠ¡ç«¯å¯ä»¥è§£å¯†ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯å¯ä»¥æ”¾å¿ƒçš„å‘é€ç»™æœåŠ¡ç«¯ï¼Œä¹‹åçš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹çš„é€šä¿¡éƒ½æ˜¯å¯ä»¥ä¿¡ä»»çš„ã€‚</p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³ä»…ä»…ä¾èµ–å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤æ–¹æ˜¯ä¸å¯è¡Œçš„ï¼Œé‚£ä¹ˆæ€ä¹ˆè§£å†³åŒæ–¹äº’ç›¸ä¸ä¿¡ä»»çš„é—®é¢˜å‘¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹æœºæ„**æƒå¨æ•°å­—è¯ä¹¦æœºæ„ï¼ˆCAï¼‰**æ¥è§£å†³ï¼ŒCAæœºæ„ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†æœåŠ¡å™¨å…¬é’¥ï¼Œå¾—åˆ°æœåŠ¡å™¨è¯ä¹¦ï¼ŒæœåŠ¡å™¨æŠŠè¿™ä¸ªæœåŠ¡å™¨è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ‹¿ç€CAçš„å…¬é’¥è§£å¯†æœåŠ¡å™¨è¯ä¹¦ç„¶åè·å–æœåŠ¡å™¨å…¬é’¥ï¼Œè¿™æ ·å°±è§£å†³äº†åŒæ–¹ä¸ä¿¡ä»»çš„é—®é¢˜ï¼Œå› ä¸ºå®¢æˆ·ç«¯å¯¹CAæœºæ„æ˜¯ä¿¡ä»»çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¼šä¿¡ä»»ç”±CAç§é’¥åŠ å¯†çš„æœåŠ¡å™¨è¯ä¹¦ã€‚</p><p>æ‰€æœ‰æœåŠ¡å™¨è¯ä¹¦å°±æ˜¯ç”¨ç§é’¥åŠ å¯†çš„æœåŠ¡å™¨å…¬é’¥ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªè¯ä¹¦ä¸­è¿˜æœ‰å…¶å®ƒå†…å®¹ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨åŸŸåã€‚</p><h2 id="å¦‚ä½•è·å–caå…¬é’¥"><a class="markdownIt-Anchor" href="#å¦‚ä½•è·å–caå…¬é’¥"></a> å¦‚ä½•è·å–CAå…¬é’¥</h2><p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº†å®¢æˆ·ç«¯ç”¨CAå…¬é’¥è§£å¯†æœåŠ¡å™¨è¯ä¹¦è·å¾—æœåŠ¡å™¨å…¬é’¥ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯æ€ä¹ˆè·å¾—CAå…¬é’¥å‘¢ï¼Œæˆ‘ä»¬çŸ¥é“CAæ˜¯å…¬å¼€çš„ï¼Œè€ŒCAæœºæ„çš„æ•°é‡åˆä¸æ˜¯å¤ªå¤šï¼Œæ‰€ä»¥è¿™äº›CAå…¬é’¥ä¼šæå‰é¢„è£…åœ¨æ“ä½œç³»ç»Ÿæˆ–è€…æµè§ˆå™¨ä¸­ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨ä¸‰ä¸ªéšæœºæ•°"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨ä¸‰ä¸ªéšæœºæ•°"></a> ä¸ºä»€ä¹ˆè¦ç”¨ä¸‰ä¸ªéšæœºæ•°</h2><p>å› ä¸ºåªç”Ÿæˆä¸€ä¸ªéšæœºæ•°é‡å¤çš„æ¦‚ç‡æ¯”è¾ƒå¤§ï¼Œè€Œä¸‰ä¸ªéšæœºæ•°ä¼šå¤§å¤§å¢åŠ <code>ä¼šè¯å¯†é’¥</code>çš„éšæœºåº¦</p><h2 id="ä¸ºä»€ä¹ˆè¦ç»™å‡ºæ‘˜è¦"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆè¦ç»™å‡ºæ‘˜è¦"></a> ä¸ºä»€ä¹ˆè¦ç»™å‡ºæ‘˜è¦</h2><p>é¿å…äº¤æµçš„å†…å®¹è¢«ç¯¡æ”¹</p><h2 id="æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠå‡ å¯¹å…¬é’¥å’Œç§é’¥"><a class="markdownIt-Anchor" href="#æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠå‡ å¯¹å…¬é’¥å’Œç§é’¥"></a> æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠå‡ å¯¹å…¬é’¥å’Œç§é’¥</h2><ol><li>æœåŠ¡å™¨å…¬é’¥å’Œç§é’¥</li><li>CAå…¬é’¥å’Œç§é’¥</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>80386å†…å­˜ç®¡ç†</title>
      <link href="/2023/09/08/80386%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
      <url>/2023/09/08/80386%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>80386è½¬æ¢é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€ç»è¿‡ä¸‹é¢çš„ä¸¤æ­¥ï¼š</p><ol><li>æ®µç¿»è¯‘ï¼ŒæŠŠä¸€ä¸ªé€»è¾‘åœ°å€ï¼ˆåŒ…å«ä¸€ä¸ªæ®µé€‰æ‹©å­å’Œæ®µåç§»é‡ï¼‰è½¬æ¢æˆä¸€ä¸ªçº¿æ€§åœ°å€</li><li>é¡µç¿»è¯‘ï¼ŒæŠŠä¸€ä¸ªçº¿æ€§åœ°å€å‡†æ¢æˆä¸€ä¸ªç‰©ç†åœ°å€ï¼Œè¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼Œå–å†³äºç³»ç»Ÿè½¯ä»¶çš„è®¾è®¡è€…ï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹æ®µç¿»è¯‘æ˜¯å¿…é¡»çš„è€Œé¡µç¿»è¯‘æ˜¯å¯é€‰çš„</li></ol><p>è¿™äº›è½¬æ¢å¯¹åº”ç”¨ç¨‹åºè€Œè¨€éƒ½æ˜¯ä¸å¯è§çš„ï¼Œä¸‹å›¾æè¿°äº†ä¸¤ç§ç¿»è¯‘çš„è¿‡ç¨‹ã€‚<img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-02-2158.png" alt="æ— æ ‡é¢˜-2023-04-02-2158" /></p><h1 id="æ®µç¿»è¯‘"><a class="markdownIt-Anchor" href="#æ®µç¿»è¯‘"></a> æ®µç¿»è¯‘</h1><p>ä¸‹å›¾å±•ç°äº†æ®µç¿»è¯‘çš„ç»†èŠ‚ï¼Œæ˜¾ç¤ºäº†å¤„ç†å™¨å¦‚ä½•æŠŠä¸€ä¸ªé€»è¾‘åœ°å€è½¬æ¢æˆä¸€ä¸ªçº¿æ€§åœ°å€</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-02-2243.png" alt="æ— æ ‡é¢˜-2023-04-02-2243" /></p><p>ä¸ºäº†æ‰§è¡Œæ®µç¿»è¯‘ï¼Œå¤„ç†å™¨éœ€è¦ä½¿ç”¨ä¸‹é¢è¿™äº›æ•°æ®ç»“æ„</p><ul><li>æ®µæè¿°ç¬¦</li><li>æ®µæè¿°ç¬¦è¡¨</li><li>æ®µé€‰æ‹©å­</li><li>æ®µå¯„å­˜å™¨</li></ul><h2 id="æ®µæè¿°ç¬¦"><a class="markdownIt-Anchor" href="#æ®µæè¿°ç¬¦"></a> æ®µæè¿°ç¬¦</h2><p>æ®µæè¿°ç¬¦æä¾›äº†æä¾›äº†æ®µç¿»è¯‘æ‰€éœ€è¦çš„æ•°æ®ï¼Œæ®µæ®µæè¿°ç¬¦ç”±ç¼–è¯‘å™¨ï¼Œé“¾æ¥å™¨ï¼Œè£…è½½å™¨æˆ–è€…æ“ä½œç³»ç»Ÿåˆ›å»ºï¼Œä¸èƒ½ç”±åº”ç”¨ç¨‹åºç¼–å†™è€…åˆ›å»ºï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªæ®µæ®µæè¿°ç¬¦çš„å¸¸è§ç»“æ„ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-03-1003.png" alt="æ— æ ‡é¢˜-2023-04-03-1003" /></p><p>å¯ä»¥çœ‹åˆ°DPLä¹‹åçš„ä¸€ä½æŠŠæ®µæè¿°ç¬¦åˆ†ä¸ºäº†ä¸¤ç§ç±»å‹ï¼Œç¬¬ä¸€ç§ç”¨äºå­˜æ”¾ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œç¬¬äºŒç§ç”¨äºç³»ç»Ÿæ®µã€‚</p><p>æ¥ä¸‹æ¥è§£é‡Šä¸€äº›æ¯”è¾ƒé‡è¦çš„ä½ï¼š</p><ol><li>BASEï¼šç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œè¡¨ç¤º4GBç©ºé—´å†…æ®µçš„ä½ç½®ã€‚</li><li>LIMITï¼šæŒ‡å®šäº†ç«¯çš„å¤§å°ï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆäº†ä¸€ä¸ª20ä½å¤§å°çš„æ•°å­—ã€‚å…·ä½“è¡¨ç¤ºçš„å¤§å°è¿˜è¦æ ¹æ®Gï¼ˆgranularityï¼Œç²’åº¦ï¼‰ä½æ¥å†³å®šã€‚</li><li>Gï¼ˆgranularityï¼‰ï¼šå¦‚æœè¯¥ä½è¢«è®¾ç½®ä¸º0ï¼ŒLIMITçš„ä¸€ä¸ªå•å…ƒå¤§å°ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤º0~1MBå¤§å°çš„ç©ºé—´ï¼Œå¦‚æœè¯¥ä½è¢«è®¾ç½®ä¸º1ï¼ŒLIMITä¸€ä¸ªå•å…ƒå¤§å°ä¸º4KBï¼Œè¡¨ç¤º0 ~ 4GBå¤§å°çš„ç©ºé—´ã€‚</li><li>TYPEï¼šåŒºåˆ†å„ç§ç±»å‹çš„æ®µæè¿°ç¬¦</li><li>DPLï¼ˆdescriptor privilege levelï¼‰ï¼šè¢«ç”¨ä½œä¿æŠ¤æ¨¡å¼</li><li>Pï¼ˆpresentï¼‰ï¼šè¡¨ç¤ºæ®µæè¿°ç¬¦æ˜¯å¦æœ‰æ•ˆï¼Œä¸‹å›¾æè¿°äº†ä¸€ä¸ªæ— æ•ˆçš„æ®µæ®µæè¿°ç¬¦ï¼Œå…¶ä¸­è¢«æ ‡è®°ä¸ºAVAIABLEçš„ä½ç½®å¯ä»¥è¢«æ“ä½œç³»ç»Ÿä¿®æ”¹ã€‚</li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-03-1036.png" alt="æ— æ ‡é¢˜-2023-04-03-1036" /></p><ol start="7"><li>Aï¼ˆaccessedï¼‰ï¼šè¡¨ç¤ºæ®µæè¿°ç¬¦æ˜¯å¦å¯ä»¥è¢«è®¿é—®</li></ol><h2 id="æ®µæè¿°ç¬¦è¡¨"><a class="markdownIt-Anchor" href="#æ®µæè¿°ç¬¦è¡¨"></a> æ®µæè¿°ç¬¦è¡¨</h2><p>æ®µæè¿°ç¬¦å‚¨å­˜åœ¨ä¸‹é¢ä¸¤ç§æ®µæè¿°ç¬¦è¡¨ä¸­ï¼š</p><ul><li>The global descriptor tableï¼ˆGDTï¼‰</li><li>A local descriptortable ï¼ˆLDTï¼‰</li></ul><p>ä¸€ä¸ªæ®µæè¿°ç¬¦è¡¨çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª8å­—èŠ‚çš„æ®µæè¿°ç¬¦ï¼Œä¸€ä¸ªæ®µæ®µæè¿°ç¬¦è¡¨æœ€å¤šå¯ä»¥æœ‰8192ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>13</mn></msup></mrow><annotation encoding="application/x-tex">2^{13}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span>ï¼‰ä¸ªå…ƒç´ ï¼ŒåŒæ—¶è¦æ³¨æ„çš„æ˜¯å…¨å±€æ®µæ®µæè¿°ç¬¦è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹å¤„ç†å™¨æ¥è¯´æ˜¯ä¸å¯ç”¨çš„ã€‚</p><p>é‚£ä¹ˆå¤„ç†å™¨æ€ä¹ˆçŸ¥é“æ®µæè¿°ç¬¦è¡¨æ‰€åœ¨çš„ä½ç½®çš„å‘¢ï¼Œæ“ä½œç³»ç»ŸæŠŠGDTå’ŒLDTçš„åœ°å€è£…åœ¨ä¸€ä¸ª<code>GDTR</code>å’Œ<code>LDTR</code>å¯„å­˜å™¨ä¸­ï¼Œè¿™ä¸ªå¯„å­˜å™¨å­˜æ”¾ç€æ®µæè¿°ç¬¦è¡¨çš„åœ°å€å’Œæ®µæè¿°è¡¨çš„é•¿åº¦ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡ä»¤LGDTå’ŒSGDTæŠŠç»™å®šçš„æ•°æ®è£…è½½åˆ°GDTå¯„å­˜å™¨ä¸­ï¼Œé€šè¿‡LLDTå’ŒSLDTæŠŠç»™å®šçš„æ•°æ®è£…è½½åˆ°LDTå¯„å­˜å™¨ä¸­ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-03-1718.png" alt="æ— æ ‡é¢˜-2023-04-03-1718" /></p><h2 id="æ®µé€‰æ‹©å­"><a class="markdownIt-Anchor" href="#æ®µé€‰æ‹©å­"></a> æ®µé€‰æ‹©å­</h2><p>æ®µé€‰æ‹©å­å‚¨å­˜äº†æ®µæè¿°ç¬¦è¡¨çš„ç´¢å¼•é€‰æ‹©æ®µæè¿°ç¬¦çš„ç±»å‹ã€‚æ®µé€‰æ‹©å­åœ¨æŒ‡é’ˆå˜é‡ä¸­å¯¹äºåº”ç”¨ç¨‹åºå¯èƒ½æ˜¯å¯è§çš„ï¼Œä½†æ˜¯å®ƒçš„å€¼å¾€å¾€ç”±é“¾æ¥å™¨æŒ‡å®šï¼Œä¸‹å›¾å±•ç¤ºäº†æ®µé€‰æ‹©å­çš„ç»“æ„ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-03-1736.png" alt="æ— æ ‡é¢˜-2023-04-03-1736" /></p><ul><li>indexï¼šæ®µæè¿°ç¬¦è¡¨çš„ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰ï¼Œç”¨äºæŒ‡å®šé€‰æ‹©æ®µæè¿°ç¬¦è¡¨ä¸­å“ªä¸ªå…ƒç´ ï¼Œå› ä¸ºindexæ˜¯ä¸€ä¸ª13ä½çš„æ•°å­—ï¼Œæ‰€ä»¥ä¸€ä¸ªæ®µæè¿°ç¬¦æœ€å¤šå¯ä»¥æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>13</mn></msup></mrow><annotation encoding="application/x-tex">2^{13}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span>ä¸ªå…ƒç´ ã€‚</li><li>TIï¼ˆtable indicatorï¼‰ï¼Œç”¨äºæŒ‡å®šä»GDTè¿˜æ˜¯LDTä¸­é€‰æ‹©ï¼Œ0é€‰æ‹©GDTï¼Œ1é€‰æ‹©LDTã€‚</li><li>RPLï¼ˆRequested Privilege Levelï¼‰ï¼Œç”¨äºä¿æŠ¤æ¨¡å¼ã€‚</li></ul><p>ç”±äºå…¨å±€æ®µæè¿°ç¬¦è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸å¯ç”¨ï¼Œæ‰€ä»¥å½“INDEXå’ŒTIéƒ½è¢«è®¾ç½®ä¸º0æ—¶æˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªç©ºæ®µé€‰æ‹©å­ã€‚</p><h2 id="æ®µå¯„å­˜å™¨"><a class="markdownIt-Anchor" href="#æ®µå¯„å­˜å™¨"></a> æ®µå¯„å­˜å™¨</h2><p>80386ä¼šæŠŠæ®µå¯„å­˜å™¨å¯¹åº”çš„æ®µæè¿°ç¬¦ä¿¡æ¯å‚¨å­˜åœ¨æ®µå¯„å­˜å™¨ä¸­ï¼Œè¿™é¿å…äº†é¢‘ç¹è®¿é—®å†…å­˜ï¼Œä¸‹é¢æ˜¯æ®µå¯„å­˜å™¨çš„ç»“æ„ï¼Œåº”ç”¨ç¨‹åºå¯è§å’Œå¯æ“æ§çš„å®é™…ä¸Šåªæœ‰16ä½ï¼Œå‰©ä¸‹çš„ä½ç”±å¤„ç†å™¨å¤„ç†ï¼Œä¼šæŠŠæ®µå¯„å­˜å™¨å¯¹åº”çš„ä¿¡æ¯å‚¨å­˜åœ¨æ®µå¯„å­˜å™¨ä¸­ï¼Œç”±äºè¿™ç§æœºåˆ¶çš„å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å®é™…ä¸Šè®¿é—®æ•°æ®çš„æ•ˆç‡è¿˜æ˜¯ç›¸å½“é«˜çš„ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-03-17.png" alt="æ— æ ‡é¢˜-2023-04-03-17" /></p><h1 id="é¡µç¿»è¯‘"><a class="markdownIt-Anchor" href="#é¡µç¿»è¯‘"></a> é¡µç¿»è¯‘</h1><p>åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œ80386æŠŠä¸€ä¸ªé€»è¾‘åœ°å€é€šè¿‡æ®µç¿»è¯‘è½¬æ¢æˆäº†ä¸€ä¸ªçº¿æ€§åœ°å€ï¼Œåœ¨ç¬¬äºŒä¸ªé˜¶æ®µï¼Œ80386ä¼šé€šè¿‡ä¹Ÿé¡µç¿»è¯‘æŠŠä¸€ä¸ªçº¿æ€§åœ°å€ç¿»è¯‘æˆçœŸå®çš„ç‰©ç†åœ°å€ã€‚</p><h2 id="é¡µå¸§"><a class="markdownIt-Anchor" href="#é¡µå¸§"></a> é¡µå¸§</h2><p>é¡µå¸§æ˜¯åœ¨åœ°å€ä¸Šè¿ç»­çš„4KBå¤§å°çš„å•å…ƒã€‚</p><h2 id="çº¿æ€§åœ°å€"><a class="markdownIt-Anchor" href="#çº¿æ€§åœ°å€"></a> çº¿æ€§åœ°å€</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¿æ€§åœ°å€ä¼šè¢«æ‹†åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†çš„å€¼è¢«ç”¨ä½œé¡µç›®å½•çš„ç´¢å¼•ï¼Œç¬¬äºŒä¸ªéƒ¨åˆ†çš„å€¼è¢«ç”¨ä½œé¡µè¡¨çš„ç´¢å¼•ï¼Œç¬¬ä¸‰ä¸ªå€¼è¢«ç”¨ä½œé¡µçš„åç§»é‡ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-04-0108.png" alt="æ— æ ‡é¢˜-2023-04-04-0108" /></p><p>æ•´ä¸ªç¿»è¯‘çš„è¿‡ç¨‹ç”±ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-04-0111.png" alt="æ— æ ‡é¢˜-2023-04-04-0111" /></p><h2 id="é¡µç›®å½•"><a class="markdownIt-Anchor" href="#é¡µç›®å½•"></a> é¡µç›®å½•</h2><p>é¡µç›®å½•æ˜¯ä¸€ä¸ªé•¿åº¦çš„1Kçš„32ä½çš„æ•°ç»„ï¼Œæ€»å…±å ç”¨4KBçš„ç©ºé—´ï¼Œæ­£å¥½æ˜¯ä¸€é¡µã€‚é¡µç›®å½•çš„æ¯ä¸ªå…ƒç´ å®šä½äº†ä¸€ä¸ªé¡µè¡¨æ‰€åœ¨çš„ä½ç½®ï¼Œé¡µè¡¨ä¹Ÿæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º1Kçš„32ä½æ•°ç»„ï¼Œä¸€ä¸ªé¡µè¡¨æ€»å…±å ç”¨4KBç©ºé—´ï¼Œå®šä½äº†ä¸€ä¸ªé¡µæ‰€åœ¨çš„ä½ç½®ã€‚åœ¨ä¸€ä¸ª32ä½è™šæ‹Ÿåœ°å€ä¸­å‰10ä½è¡¨ç¤ºé¡µç›®å½•çš„ç´¢å¼•ï¼Œä¸­é—´10ä½è¡¨ç¤ºé¡µè¡¨çš„ç´¢å¼•ï¼Œæœ€å12ä½è¡¨ç¤ºé¡µå†…åç§»é‡ï¼Œæ­£å¥½è¡¨ç¤º32ä½ç©ºé—´ã€‚</p><p>32ä½çš„è™šæ‹Ÿåœ°å€åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯è¿™ä¸‰ä¸ªéƒ¨åˆ†å¹¶æ²¡æœ‰é¡µç›®å½•çš„åœ°å€ï¼Œæ‰€ä»¥ç¡¬ä»¶æ˜¯æ€ä¹ˆçŸ¥é“é¡µç›®å½•çš„åœ°å€çš„å‘¢ã€‚ç¡¬ä»¶ä¾èµ–çš„æ˜¯CR3å¯„å­˜å™¨ï¼Œä¹Ÿå«åšpage directory base register(PDBR)ï¼Œè¿™ä¸ªå¯„å­˜å™¨å­˜æ”¾äº†é¡µç›®å½•çš„é¦–åœ°å€ï¼Œå€ŸåŠ©äºè¿™ä¸ªå¯„å­˜å™¨æˆ‘ä»¬å¯ä»¥å®Œæˆæ•´ä¸ªç¿»è¯‘æ“ä½œã€‚</p><p>é¡µç›®å½•çš„ç»“æ„å’Œé¡µè¡¨ç±»ä¼¼ï¼Œå¯ä»¥åœ¨é¡µè¡¨éƒ¨åˆ†æ‰¾åˆ°é¡µè¡¨çš„ç»“æ„ã€‚</p><h2 id="é¡µè¡¨"><a class="markdownIt-Anchor" href="#é¡µè¡¨"></a> é¡µè¡¨</h2><p>é¡µè¡¨çš„ç»“æ„å’Œé¡µç›®å½•ç›¸ä¼¼ï¼Œéƒ½æ˜¯å ç”¨ä¸€é¡µçš„ç©ºé—´ï¼Œæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º1Kçš„32ä½æ•°ç»„ã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªé¡µè¡¨å®ä½“æœ‰æ•ˆå’Œæ— æ•ˆæ—¶çš„æ ¼å¼ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-14-2104.png" alt="æ— æ ‡é¢˜-2023-04-14-2104" /></p><ul><li><p>Pï¼šæœ€ä½1ä½è¡¨ç¤ºå­˜åœ¨ä½Presntï¼Œå½“è¯¥ä½ä¸º1æ—¶è¡¨ç¤ºè¯¥é¡µè¡¨å®ä½“å­˜åœ¨ï¼Œå½“è¯¥ä½1ä¸º0æ—¶è¡¨ç¤ºé¡µè¡¨å®ä½“ä¸å­˜åœ¨ã€‚</p></li><li><p>R/Wï¼šè¯»å†™æƒé™</p></li><li><p>U/Sï¼šæƒé™ç­‰çº§</p></li><li><p>Dï¼šdirtyï¼Œè„é¡µ</p></li><li><p>Aï¼šaccessï¼Œæ˜¯å¦å¯ä»¥è¢«è®¿é—®</p></li><li><p>AVAILABLEï¼šå¯ä»¥è¢«æ“ä½œç³»ç»Ÿä¿®æ”¹çš„éƒ¨åˆ†</p></li></ul><h2 id="é¡µç¿»è¯‘ç¼“å­˜"><a class="markdownIt-Anchor" href="#é¡µç¿»è¯‘ç¼“å­˜"></a> é¡µç¿»è¯‘ç¼“å­˜</h2><h2 id="tlb"><a class="markdownIt-Anchor" href="#tlb"></a> TLB</h2><p>è¿˜æ˜¯ä»°èµ–äºå±€éƒ¨æ€§åŸç†ï¼Œé¡µç¿»è¯‘ç¼“å­˜TLBï¼ˆtranslation look-aside bufferï¼‰çš„å­˜åœ¨å¤§å¤§åŠ é€Ÿäº†é¡µç¿»è¯‘çš„è¿‡ç¨‹ã€‚</p><h1 id="ç»“åˆæ®µç¿»è¯‘å’Œé¡µç¿»è¯‘æœºåˆ¶"><a class="markdownIt-Anchor" href="#ç»“åˆæ®µç¿»è¯‘å’Œé¡µç¿»è¯‘æœºåˆ¶"></a> ç»“åˆæ®µç¿»è¯‘å’Œé¡µç¿»è¯‘æœºåˆ¶</h1><p>äº†è§£äº†æ®µç¿»è¯‘å’Œé¡µç¿»è¯‘çš„æœºåˆ¶ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„ç¿»è¯‘è¿‡ç¨‹ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-14-2105.png" alt="æ— æ ‡é¢˜-2023-04-14-2105" /></p><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸¤ç§æœºåˆ¶ç»“åˆèµ·æ¥ï¼Œæˆ‘ä»¬æœ‰å¤šç§æ¶æ„å¯ä»¥é€‰æ‹©ã€‚</p><h2 id="å¹³å¦æ¶æ„"><a class="markdownIt-Anchor" href="#å¹³å¦æ¶æ„"></a> å¹³å¦æ¶æ„</h2><p>è¿™æ˜¯ä¸€ç§ç®€å•çš„æ¶æ„ï¼Œåœ¨å¹³å¦æ¶æ„ä¸­ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨æ®µï¼Œä»…ä»…é€šè¿‡32ä½çš„åç§»é‡æ¥è¡¨ç¤ºåœ°å€ã€‚åœ¨80386ä¸­æˆ‘ä»¬ä¸èƒ½ç¦æ­¢æ®µæœºåˆ¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠæ®µå…¨éƒ¨è®¾ç½®ä¸º0å®ç°ç›¸åŒçš„æ•ˆæœã€‚</p><h2 id="ä¸€ä¸ªæ®µè·¨è¶Šå¤šä¸ªé¡µ"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªæ®µè·¨è¶Šå¤šä¸ªé¡µ"></a> ä¸€ä¸ªæ®µè·¨è¶Šå¤šä¸ªé¡µ</h2><p>80386å…è®¸ä¸€ä¸ªæ®µå¤§å°æˆ–è€…å°äºä¸€ä¸ªé¡µï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå ç”¨ç©ºé—´å¤§å°ä¸º132KBçš„æ•°æ®ç»“æ„æ—¶ï¼Œæˆ‘ä»¬æ˜¾ç„¶æ— æ³•åœ¨1ä¸ªé¡µå†…æ”¾ä¸‹å¦‚æ­¤å¤šçš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦133ä¸ªé¡µæ‰èƒ½æ”¾ä¸‹å…¨éƒ¨çš„å†…å®¹ã€‚</p><h2 id="ä¸€ä¸ªé¡µè·¨è¶Šå¤šä¸ªæ®µ"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªé¡µè·¨è¶Šå¤šä¸ªæ®µ"></a> ä¸€ä¸ªé¡µè·¨è¶Šå¤šä¸ªæ®µ</h2><p>ä»å¦ä¸€ä¸ªæ–¹é¢æ¥è¯´ï¼Œæ®µä¹Ÿå¯ä»¥æ¯”é¡µå°ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°æ®ç»“æ„â€”â€”ä¿¡å·ï¼Œå› ä¸ºæ®µçš„ä¿æŠ¤å’Œå…±äº«æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½è¦ä¸ºæ¯ä¸ªä¿¡å·éƒ½å»åˆ†é…ä¸€ä¸ªæ®µï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªæ®µéƒ½åˆ†é…ä¸€ä¸ªé¡µï¼Œå¯èƒ½ä¼šæœ‰è¾ƒå¤§çš„ç©ºé—´æµªè´¹ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹æŠŠå¤šä¸ªæ®µåˆ†é…åœ¨ä¸€ä¸ªé¡µä¸­æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚</p><h2 id="éå¯¹é½çš„é¡µè¾¹ç•Œå’Œæ®µè¾¹ç•Œ"><a class="markdownIt-Anchor" href="#éå¯¹é½çš„é¡µè¾¹ç•Œå’Œæ®µè¾¹ç•Œ"></a> éå¯¹é½çš„é¡µè¾¹ç•Œå’Œæ®µè¾¹ç•Œ</h2><p>80386ä¸å¼ºåˆ¶é¡µå’Œæ®µçš„è¾¹ç•Œå¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µå¯èƒ½åŒæ—¶åŒ…å«ä¸€ä¸ªæ®µçš„å¼€å§‹å’Œä¸€ä¸ªæ®µçš„ç»“æŸã€‚</p><h2 id="å¯¹é½çš„é¡µè¾¹ç•Œå’Œæ®µè¾¹ç•Œ"><a class="markdownIt-Anchor" href="#å¯¹é½çš„é¡µè¾¹ç•Œå’Œæ®µè¾¹ç•Œ"></a> å¯¹é½çš„é¡µè¾¹ç•Œå’Œæ®µè¾¹ç•Œ</h2><p>ä½†æ˜¯å¯¹é½çš„è¾¹ç•Œä¼šè®©è½¯ä»¶è®¾è®¡æ›´åŠ ç®€å•ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªæ®µåˆ†é…ä¸€ä¸ªå›ºå®šå¤§å°çš„é¡µï¼Œè¿™æ ·é¡µå’Œæ®µçš„å…³ç³»å°±å¾ˆéå¸¸æ¸…æ™°ã€‚</p><h2 id="ä¸€ä¸ªæ®µå¯¹åº”ä¸€æ•´ä¸ªé¡µè¡¨"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªæ®µå¯¹åº”ä¸€æ•´ä¸ªé¡µè¡¨"></a> ä¸€ä¸ªæ®µå¯¹åº”ä¸€æ•´ä¸ªé¡µè¡¨</h2><p>è¿™ç§æ–¹å¼é‡‡ç”¨äº†ä¸€ä¸ªæ›´åŠ ç®€å•çš„æ˜ å°„æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªæ®µåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æè¿°ç¬¦ï¼Œè¿™æ ·ä¸€ä¸ªæ®µå°±å¯ä»¥å¯¹åº”ä¸€ä¸ªé¡µè¡¨ï¼Œè¿™æ ·çš„æ®µæœ€å¤§å¯ä»¥æ‹¥æœ‰1Kä¸ªæ•°çš„é¡µï¼Œä¹Ÿå°±æ˜¯4MBå¤§å°çš„ç©ºé—´ï¼Œè¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯è¶³å¤Ÿçš„ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%A0%E6%A0%87%E9%A2%98-2023-04-15-2313.png" alt="æ— æ ‡é¢˜-2023-04-15-2313" /></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¶ä½œisoé•œåƒæ–‡ä»¶</title>
      <link href="/2023/08/15/%E5%88%B6%E4%BD%9Ciso%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6/"/>
      <url>/2023/08/15/%E5%88%B6%E4%BD%9Ciso%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ•™ç¨‹ä¼šéµç…§<strong>El-Torito</strong>æ ‡å‡†ç”ŸæˆISOæ–‡ä»¶ã€‚</p><h1 id="ç¼–å†™å†…æ ¸æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ç¼–å†™å†…æ ¸æ–‡ä»¶"></a> ç¼–å†™å†…æ ¸æ–‡ä»¶</h1><p>è¿™é‡Œæˆ‘ä»¬ç®€å•çš„å†™ä¸€ä¸ªæ‰“å°helloworldçš„æ±‡ç¼–å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#define print(x) movb $0x0E, %ah; \</span><br><span class="line">                 movb $(x), %al; \</span><br><span class="line">                 int $0x10</span><br><span class="line"></span><br><span class="line">.globl start</span><br><span class="line">start:</span><br><span class="line">    .code16</span><br><span class="line">    cli</span><br><span class="line">    cld</span><br><span class="line"></span><br><span class="line">    print(&#x27;H&#x27;)</span><br><span class="line">    print(&#x27;e&#x27;)</span><br><span class="line">    print(&#x27;l&#x27;)</span><br><span class="line">    print(&#x27;l&#x27;)</span><br><span class="line">    print(&#x27;o&#x27;)</span><br><span class="line">    print(&#x27; &#x27;)</span><br><span class="line">    print(&#x27;W&#x27;)</span><br><span class="line">    print(&#x27;o&#x27;)</span><br><span class="line">    print(&#x27;r&#x27;)</span><br><span class="line">    print(&#x27;l&#x27;)</span><br><span class="line">    print(&#x27;d&#x27;)</span><br><span class="line">    print(&#x27;!&#x27;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç¼–è¯‘ä¸Šè¿°æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc -nostdinc -c -o boot.o boot.S</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ld -N -e start -Ttext 0x7C00 -o boot.out boot.o</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">objcopy -S -O binary -j .text boot.out boot.out</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°†å†…å®¹æ”¾åœ¨æ–°çš„ä½ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p prepared_for_iso/boot</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> boot.out prepared_for_iso/boot/loader.sys</span> </span><br></pre></td></tr></table></figure><h1 id="åˆ›å»ºisoæ–‡ä»¶"><a class="markdownIt-Anchor" href="#åˆ›å»ºisoæ–‡ä»¶"></a> åˆ›å»ºisoæ–‡ä»¶</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">xorriso -as mkisofs -R -J -c boot/bootcat \</span></span><br><span class="line"><span class="language-bash">          -b boot/loader.sys -no-emul-boot -boot-load-size 4 \</span></span><br><span class="line"><span class="language-bash">          -o ./bootable.iso ./prepared_for_iso</span></span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å¯ä»¥ç”¨qemuæˆ–è€…vmwareå¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">qemu-system-i386 -cdrom bootable.iso</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œç¬”è®°</title>
      <link href="/2023/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0/"/>
      <url>/2023/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="12-å› ç‰¹ç½‘æ¦‚è¿°"><a class="markdownIt-Anchor" href="#12-å› ç‰¹ç½‘æ¦‚è¿°"></a> 1.2 å› ç‰¹ç½‘æ¦‚è¿°</h1><h2 id="ç½‘ç»œäº’è”ç½‘å’Œå› ç‰¹ç½‘"><a class="markdownIt-Anchor" href="#ç½‘ç»œäº’è”ç½‘å’Œå› ç‰¹ç½‘"></a> ç½‘ç»œï¼Œäº’è”ç½‘å’Œå› ç‰¹ç½‘</h2><ul><li>ç½‘ç»œç”±è‹¥å¹²<code>èŠ‚ç‚¹</code>å’Œè¿æ¥è¿™äº›èŠ‚ç‚¹çš„<code>é“¾è·¯</code>ç»„æˆ</li><li>å¤šä¸ªç½‘ç»œå¯ä»¥ç”±è·¯ç”±å™¨äº’è¿èµ·æ¥ï¼Œè¿™æ ·å°±æ„æˆäº†èŒƒå›´æ›´å¤§çš„ç½‘ç»œï¼Œå³äº’è”ç½‘</li><li>å› ç‰¹ç½‘æ˜¯å…¨çƒæœ€å¤§çš„è®¡ç®—æœºç½‘ç»œ</li></ul><h2 id="å› ç‰¹ç½‘çš„ç»„æˆ"><a class="markdownIt-Anchor" href="#å› ç‰¹ç½‘çš„ç»„æˆ"></a> å› ç‰¹ç½‘çš„ç»„æˆ</h2><ul><li>è¾¹ç¼˜éƒ¨åˆ†<ul><li>ç”±æ‰€æœ‰è¿æ¥åœ¨å› ç‰¹ç½‘ä¸Šçš„ä¸»æœºç»„æˆ</li></ul></li><li>æ ¸å¿ƒéƒ¨åˆ†<ul><li>ç”±å¤§é‡ç½‘ç»œå’Œè¿æ¥è¿™äº›ç½‘ç»œçš„è·¯ç”±å™¨ç»„æˆ</li></ul></li></ul><h1 id="13-ä¸‰ç§äº¤æ¢æ–¹å¼"><a class="markdownIt-Anchor" href="#13-ä¸‰ç§äº¤æ¢æ–¹å¼"></a> 1.3 ä¸‰ç§äº¤æ¢æ–¹å¼</h1><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230812093319695.png" alt="image-20230812093319695" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lab-2(mit-6.828)</title>
      <link href="/2023/07/16/lab-2-mit-6-828/"/>
      <url>/2023/07/16/lab-2-mit-6-828/</url>
      
        <content type="html"><![CDATA[<h1 id="exercise-1"><a class="markdownIt-Anchor" href="#exercise-1"></a> Exercise 1</h1><p>è¦æ±‚å®Œæˆçš„å‡½æ•°å†…å®¹å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> *</span><br><span class="line"><span class="title function_">boot_alloc</span><span class="params">(<span class="type">uint32_t</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *nextfree;<span class="comment">// virtual address of next byte of free memory</span></span><br><span class="line"><span class="type">char</span> *result;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Initialize nextfree if this is the first time.</span></span><br><span class="line"><span class="comment">// &#x27;end&#x27; is a magic symbol automatically generated by the linker,</span></span><br><span class="line"><span class="comment">// which points to the end of the kernel&#x27;s bss segment:</span></span><br><span class="line"><span class="comment">// the first virtual address that the linker did *not* assign</span></span><br><span class="line"><span class="comment">// to any kernel code or global variables.</span></span><br><span class="line"><span class="keyword">if</span> (!nextfree) &#123;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> end[];</span><br><span class="line">nextfree = ROUNDUP((<span class="type">char</span> *) end, PGSIZE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Allocate a chunk large enough to hold &#x27;n&#x27; bytes, then update</span></span><br><span class="line"><span class="comment">// nextfree.  Make sure nextfree is kept aligned</span></span><br><span class="line"><span class="comment">// to a multiple of PGSIZE.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// LAB 2: Your code here.</span></span><br><span class="line">result = nextfree;</span><br><span class="line">nextfree += ROUNDUP(n, PGSIZE);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">mem_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint32_t</span> cr0;</span><br><span class="line"><span class="type">size_t</span> n;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Find out how much memory the machine has (npages &amp; npages_basemem).</span></span><br><span class="line">i386_detect_memory();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove this line when you&#x27;re ready to test this function.</span></span><br><span class="line"><span class="comment">// panic(&quot;mem_init: This function is not finished\n&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// create initial page directory.</span></span><br><span class="line">kern_pgdir = (<span class="type">pde_t</span> *) boot_alloc(PGSIZE);</span><br><span class="line"><span class="built_in">memset</span>(kern_pgdir, <span class="number">0</span>, PGSIZE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Recursively insert PD in itself as a page table, to form</span></span><br><span class="line"><span class="comment">// a virtual page table at virtual address UVPT.</span></span><br><span class="line"><span class="comment">// (For now, you don&#x27;t have understand the greater purpose of the</span></span><br><span class="line"><span class="comment">// following line.)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Permissions: kernel R, user R</span></span><br><span class="line">kern_pgdir[PDX(UVPT)] = PADDR(kern_pgdir) | PTE_U | PTE_P;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Allocate an array of npages &#x27;struct PageInfo&#x27;s and store it in &#x27;pages&#x27;.</span></span><br><span class="line"><span class="comment">// The kernel uses this array to keep track of physical pages: for</span></span><br><span class="line"><span class="comment">// each physical page, there is a corresponding struct PageInfo in this</span></span><br><span class="line"><span class="comment">// array.  &#x27;npages&#x27; is the number of physical pages in memory.  Use memset</span></span><br><span class="line"><span class="comment">// to initialize all fields of each struct PageInfo to 0.</span></span><br><span class="line"><span class="comment">// Your code goes here:</span></span><br><span class="line">pages = (<span class="keyword">struct</span> PageInfo*)boot_alloc(npages * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> PageInfo));</span><br><span class="line"><span class="built_in">memset</span>(pages,<span class="number">0</span>,npages * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> PageInfo));</span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Now that we&#x27;ve allocated the initial kernel data structures, we set</span></span><br><span class="line"><span class="comment">// up the list of free physical pages. Once we&#x27;ve done so, all further</span></span><br><span class="line"><span class="comment">// memory management will go through the page_* functions. In</span></span><br><span class="line"><span class="comment">// particular, we can now map memory using boot_map_region</span></span><br><span class="line"><span class="comment">// or page_insert</span></span><br><span class="line">page_init();</span><br><span class="line">check_page_free_list(<span class="number">1</span>);</span><br><span class="line">check_page_alloc();</span><br><span class="line">check_page();</span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">page_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// The example code here marks all physical pages as free.</span></span><br><span class="line"><span class="comment">// However this is not truly the case.  What memory is free?</span></span><br><span class="line"><span class="comment">//  1) Mark physical page 0 as in use.</span></span><br><span class="line"><span class="comment">//     This way we preserve the real-mode IDT and BIOS structures</span></span><br><span class="line"><span class="comment">//     in case we ever need them.  (Currently we don&#x27;t, but...)</span></span><br><span class="line"><span class="comment">//  2) The rest of base memory, [PGSIZE, npages_basemem * PGSIZE)</span></span><br><span class="line"><span class="comment">//     is free.</span></span><br><span class="line"><span class="comment">//  3) Then comes the IO hole [IOPHYSMEM, EXTPHYSMEM), which must</span></span><br><span class="line"><span class="comment">//     never be allocated.</span></span><br><span class="line"><span class="comment">//  4) Then extended memory [EXTPHYSMEM, ...).</span></span><br><span class="line"><span class="comment">//     Some of it is in use, some is free. Where is the kernel</span></span><br><span class="line"><span class="comment">//     in physical memory?  Which pages are already in use for</span></span><br><span class="line"><span class="comment">//     page tables and other data structures?</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Change the code to reflect this.</span></span><br><span class="line"><span class="comment">// NB: DO NOT actually touch the physical memory corresponding to</span></span><br><span class="line"><span class="comment">// free pages!</span></span><br><span class="line"><span class="type">void</span> * kern_used = boot_alloc(<span class="number">0</span>);</span><br><span class="line"><span class="type">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; npages; i++) &#123;</span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">pages[i].pp_ref = <span class="number">1</span>;</span><br><span class="line">pages[i].pp_link = <span class="literal">NULL</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(i &lt; npages_basemem || i &lt; IOPHYSMEM &gt;&gt; PGSHIFT)&#123;</span><br><span class="line">pages[i].pp_ref = <span class="number">0</span>;</span><br><span class="line">pages[i].pp_link = page_free_list;</span><br><span class="line">page_free_list = &amp;pages[i];</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(i &gt;= IOPHYSMEM &gt;&gt; PGSHIFT &amp;&amp; i &lt; EXTPHYSMEM &gt;&gt; PGSHIFT)&#123;</span><br><span class="line">pages[i].pp_ref = <span class="number">1</span>;</span><br><span class="line">pages[i].pp_link = <span class="literal">NULL</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(i &lt;= PADDR(kern_used) &gt;&gt; PGSHIFT)&#123;</span><br><span class="line">pages[i].pp_ref = <span class="number">1</span>;</span><br><span class="line">pages[i].pp_link = <span class="literal">NULL</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">pages[i].pp_ref = <span class="number">0</span>;</span><br><span class="line">pages[i].pp_link = page_free_list;</span><br><span class="line">page_free_list = &amp;pages[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> PageInfo *</span><br><span class="line"><span class="title function_">page_alloc</span><span class="params">(<span class="type">int</span> alloc_flags)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fill this function in</span></span><br><span class="line"><span class="keyword">if</span>(page_free_list == <span class="literal">NULL</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PageInfo</span> *<span class="title">pp</span> =</span> page_free_list;</span><br><span class="line"><span class="keyword">if</span>(alloc_flags &amp; ALLOC_ZERO)&#123;</span><br><span class="line"><span class="built_in">memset</span>(page2kva(pp), <span class="number">0</span>, PGSIZE);</span><br><span class="line">&#125;</span><br><span class="line">page_free_list = pp-&gt;pp_link;</span><br><span class="line">pp-&gt;pp_link = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">page_free</span><span class="params">(<span class="keyword">struct</span> PageInfo *pp)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fill this function in</span></span><br><span class="line"><span class="comment">// Hint: You may want to panic if pp-&gt;pp_ref is nonzero or</span></span><br><span class="line"><span class="comment">// pp-&gt;pp_link is not NULL.</span></span><br><span class="line"><span class="keyword">if</span>(pp-&gt;pp_ref != <span class="number">0</span> || pp-&gt;pp_link != <span class="literal">NULL</span>)&#123;</span><br><span class="line">panic(<span class="string">&quot;page ref is not null&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">pp-&gt;pp_link = page_free_list;</span><br><span class="line">page_free_list = pp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="exercise-4"><a class="markdownIt-Anchor" href="#exercise-4"></a> Exercise 4</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pte_t</span> *</span><br><span class="line"><span class="title function_">pgdir_walk</span><span class="params">(<span class="type">pde_t</span> *pgdir, <span class="type">const</span> <span class="type">void</span> *va, <span class="type">int</span> create)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fill this function in</span></span><br><span class="line"><span class="type">uint32_t</span> pde = pgdir[PDX(va)];</span><br><span class="line"><span class="keyword">if</span>(!(pde &amp; PTE_P))&#123;</span><br><span class="line"><span class="keyword">if</span> (!create)<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PageInfo</span> * <span class="title">page</span> =</span> page_alloc(ALLOC_ZERO);</span><br><span class="line"><span class="keyword">if</span>(page == <span class="literal">NULL</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">page-&gt;pp_ref++;</span><br><span class="line">pgdir[PDX(va)] = page2pa(page) | PTE_W | PTE_U | PTE_P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">pte_t</span> * pte = (<span class="type">pte_t</span>*)(KADDR(PTE_ADDR((pgdir[PDX(va)])))) + PTX(va);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pte;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line"><span class="title function_">boot_map_region</span><span class="params">(<span class="type">pde_t</span> *pgdir, <span class="type">uintptr_t</span> va, <span class="type">size_t</span> size, <span class="type">physaddr_t</span> pa, <span class="type">int</span> perm)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fill this function in</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">size_t</span> i = <span class="number">0</span>;i &lt; size;i+=PGSIZE)&#123;</span><br><span class="line"><span class="type">pte_t</span> * pte = pgdir_walk(pgdir,(<span class="type">void</span>*)(va+i),<span class="number">1</span>);</span><br><span class="line">*pte = (pa+i)|perm|PTE_P;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">page_insert</span><span class="params">(<span class="type">pde_t</span> *pgdir, <span class="keyword">struct</span> PageInfo *pp, <span class="type">void</span> *va, <span class="type">int</span> perm)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fill this function in</span></span><br><span class="line"><span class="type">pte_t</span> * pte = pgdir_walk(pgdir,va,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(pte == <span class="literal">NULL</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> -E_NO_MEM;</span><br><span class="line">&#125;</span><br><span class="line">pp-&gt;pp_ref++;</span><br><span class="line"><span class="keyword">if</span>((*pte) &amp; PTE_P)&#123;</span><br><span class="line">tlb_invalidate(pgdir,va);</span><br><span class="line">page_remove(pgdir,va);</span><br><span class="line">&#125;</span><br><span class="line">*pte = (page2pa(pp) | perm | PTE_P);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> PageInfo *</span><br><span class="line"><span class="title function_">page_lookup</span><span class="params">(<span class="type">pde_t</span> *pgdir, <span class="type">void</span> *va, <span class="type">pte_t</span> **pte_store)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fill this function in</span></span><br><span class="line"><span class="type">pte_t</span> * pte = pgdir_walk(pgdir,va,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(pte == <span class="literal">NULL</span> || !(*pte &amp; PTE_P))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pte_store != <span class="literal">NULL</span>)&#123;</span><br><span class="line">pte_store = &amp;pte;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PageInfo</span> * <span class="title">page</span> =</span> pa2page(PTE_ADDR(*pte));</span><br><span class="line"><span class="keyword">return</span> page;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">page_remove</span><span class="params">(<span class="type">pde_t</span> *pgdir, <span class="type">void</span> *va)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fill this function in</span></span><br><span class="line"><span class="type">pte_t</span> * pte = pgdir_walk(pgdir,va,<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PageInfo</span> * <span class="title">page</span> =</span> page_lookup(pgdir,va,&amp;pte);</span><br><span class="line"><span class="keyword">if</span>(page == <span class="literal">NULL</span>)&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">page_decref(page);</span><br><span class="line">tlb_invalidate(pgdir,va);</span><br><span class="line"><span class="keyword">if</span>(pte)&#123;</span><br><span class="line">*pte = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="exercise-5"><a class="markdownIt-Anchor" href="#exercise-5"></a> Exercise 5</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boot_map_region(kern_pgdir, UPAGES, PTSIZE, PADDR(pages), PTE_U);</span><br><span class="line">boot_map_region(kern_pgdir, KSTACKTOP - KSTKSIZE, KSTKSIZE, PADDR(bootstack), PTE_W);</span><br><span class="line">boot_map_region(kern_pgdir, KERNBASE, (<span class="number">0xffffffff</span> - KERNBASE), <span class="number">0</span>, PTE_W);</span><br></pre></td></tr></table></figure><h2 id="question"><a class="markdownIt-Anchor" href="#question"></a> Question</h2><p>What entries (rows) in the page directory have been filled in at this point? What addresses do they map and where do they point? In other words, fill out this table as much as possible:</p><table><thead><tr><th>Entry</th><th>Base Virtual Address</th><th>Points to (logically):</th></tr></thead><tbody><tr><td>1023</td><td></td><td>Page table for top 4MB of phys memory</td></tr><tr><td>1022</td><td></td><td>KERN</td></tr><tr><td>.</td><td></td><td>ä»¥ä¸Šéƒ½æ˜¯kernel</td></tr><tr><td>960</td><td>0xf0000000</td><td>KERNBASE</td></tr><tr><td>959</td><td>0xefc00000</td><td>kernel stack</td></tr><tr><td>957</td><td>0xef400000</td><td>UVPT</td></tr><tr><td>956</td><td>0xef000000</td><td>UPAGES</td></tr><tr><td>.</td><td>?</td><td>?</td></tr><tr><td>2</td><td>0x00800000</td><td>?</td></tr><tr><td>1</td><td>0x00400000</td><td>?</td></tr><tr><td>0</td><td>0x00000000</td><td>[see next question]</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> mit-6.828 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>lab-1(mit-6.828)</title>
      <link href="/2023/07/15/lab-1-mit-6-828/"/>
      <url>/2023/07/15/lab-1-mit-6-828/</url>
      
        <content type="html"><![CDATA[<h1 id="exercise-3"><a class="markdownIt-Anchor" href="#exercise-3"></a> Exercise 3</h1><ol><li>At what point does the processor start executing 32-bit code? What exactly causes the switch from 16- to 32-bit mode?</li></ol><p>ä»è¿™ä¸€è¡Œå¼€å§‹æ‰§è¡Œ32è¡Œä»£ç </p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715070948942.png" alt="image-20230715070948942" /></p><p>å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œå¼€å¯32ä½æ¨¡å¼</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715071443430.png" alt="image-20230715071443430" /></p><ol start="2"><li>What is the <em>last</em> instruction of the boot loader executed, and what is the <em>first</em> instruction of the kernel it just loaded?</li></ol><p>bootloaderæ‰§è¡Œçš„æœ€åä¸€è¡Œä»£ç </p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715071644168.png" alt="image-20230715071644168" /></p><p>kernelçš„ç¬¬ä¸€æ¡æŒ‡ä»¤</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715071742600.png" alt="image-20230715071742600" /></p><ol start="3"><li><em>Where</em> is the first instruction of the kernel?</li></ol><p>åŒä¸Š</p><ol start="4"><li>How does the boot loader decide how many sectors it must read in order to fetch the entire kernel from disk? Where does it find this information?</li></ol><p>bootloaderé¦–å…ˆè¯»å–é™¤äº†å¯åŠ¨æ‰‡åŒºï¼ˆç¬¬0æ‰‡åŒºï¼‰ä¹‹å¤–çš„å‰8ä¸ªæ‰‡åŒº</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715073251117.png" alt="image-20230715073251117" /></p><p>è¿™æ¬¡è¯»å–çš„å¤§å°å·²ç»è¶³å¤Ÿäº†ï¼Œè¶³å¤Ÿè¯»å…¥å†…æ ¸çš„ELF headeråˆ°å†…å­˜ä¸­ï¼Œæœ‰äº†ELF headerä¹‹åï¼Œå¯ä»¥é€šè¿‡ELF headerçš„ä¿¡æ¯è·å–Program headerï¼ŒProgram headerè®°å½•äº†è¦è¯»å…¥éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œæ ¹æ®è¿™ä¸ªä¿¡æ¯ï¼Œbootloaderå°†æ•´ä¸ªå†…æ ¸è£…è½½è¿›å…¥å†…æ ¸</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715073638805.png" alt="image-20230715073638805" /></p><h1 id="exercise-7"><a class="markdownIt-Anchor" href="#exercise-7"></a> Exercise 7</h1><p>ç›®å‰ï¼Œè¿˜æ²¡æœ‰å¼€å¯åˆ†é¡µï¼Œæ— æ³•è®¿é—®<code>0xf0100000</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715075107352.png" alt="image-20230715075107352" /></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å¯åˆ†é¡µï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªåœ°å€å®é™…æ˜ å°„çš„å†…å­˜æ˜¯ä¸€æ ·çš„</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715075330528.png" alt="image-20230715075330528" /></p><h1 id="exercise-8"><a class="markdownIt-Anchor" href="#exercise-8"></a> Exercise 8</h1><p>è¿™ä¸ªéƒ¨åˆ†å‚ç…§å…¶ä»–16è¿›åˆ¶çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä»£ç </p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715080543059.png" alt="image-20230715080543059" /></p><p>following question:</p><ol><li>Explain the interface between <code>printf.c</code> and <code>console.c</code>. Specifically, what function does <code>console.c</code> export? How is this function used by <code>printf.c</code>?</li></ol><p><code>console.c</code>å¯¼å‡ºäº† <code>putch</code> è¿™ä¸ªå‡½æ•°</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715081240430.png" alt="image-20230715081240430" /></p><p><code>printf.c</code>ä¸­é€šè¿‡å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼è°ƒç”¨è¿™ä¸ªå‡½æ•°</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715081507658.png" alt="image-20230715081507658" /></p><ol start="2"><li>Explain the following from<code>console.c</code></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>      <span class="keyword">if</span> (crt_pos &gt;= CRT_SIZE) &#123;</span><br><span class="line"><span class="number">2</span>              <span class="type">int</span> i;</span><br><span class="line"><span class="number">3</span>              memmove(crt_buf, crt_buf + CRT_COLS, (CRT_SIZE - CRT_COLS) * <span class="keyword">sizeof</span>(<span class="type">uint16_t</span>));</span><br><span class="line"><span class="number">4</span>              <span class="keyword">for</span> (i = CRT_SIZE - CRT_COLS; i &lt; CRT_SIZE; i++)</span><br><span class="line"><span class="number">5</span>                      crt_buf[i] = <span class="number">0x0700</span> | <span class="string">&#x27; &#x27;</span>;</span><br><span class="line"><span class="number">6</span>              crt_pos -= CRT_COLS;</span><br><span class="line"><span class="number">7</span>      &#125;</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œè¿™é‡Œçš„ä»£ç çš„ä½œç”¨æ˜¯å½“éœ€è¦æ˜¾ç¤ºçš„å†…å®¹è¶…è¿‡å±å¹•æ—¶ï¼Œå°†æ•´ä½“çš„å†…å®¹ä¸Šç§»ä¸€è¡Œ</p><h2 id="challenge"><a class="markdownIt-Anchor" href="#challenge"></a> Challenge</h2><h2 id="æ§åˆ¶å‘½ä»¤"><a class="markdownIt-Anchor" href="#æ§åˆ¶å‘½ä»¤"></a> æ§åˆ¶å‘½ä»¤</h2><p>æˆ‘ä»¬å¸¸ç”¨çš„<code>printf</code>å‡½æ•°è¾“å‡ºæ¥çš„é¢œè‰²æ˜¯ç»ˆç«¯çš„é…è‰²ã€‚å¦‚æœæƒ³è¦è¾“å‡ºä¸åŒçš„é¢œè‰²è¿›è¡ŒåŒºåˆ†ï¼Œå°±éœ€è¦ç”¨åˆ°<code>printf</code>çš„æ§åˆ¶å‘½ä»¤ï¼š<code>\033[m</code>ã€‚</p><p>æ§åˆ¶å‘½ä»¤ä»¥<code>\033[</code>å¼€å¤´ï¼Œä»¥<code>m</code>ç»“å°¾ï¼Œè€Œä¸­é—´åˆ™æ˜¯å±æ€§ç ï¼Œå±æ€§ä»£ç ä¹‹é—´ä½¿ç”¨<code>;</code>åˆ†éš”ï¼Œå¦‚<code>\033[1;34;42m</code>ã€‚è€Œå±æ€§ä»£ç çš„å«ä¹‰è§ä¸‹é¢çš„è¡¨æ ¼ã€‚</p><h2 id="printfå±æ€§ä»£ç "><a class="markdownIt-Anchor" href="#printfå±æ€§ä»£ç "></a> printfå±æ€§ä»£ç </h2><p>è¿™é‡Œåˆ—ä¸¾äº†ä¸‰ç±»å±æ€§ä»£ç ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€éƒ¨åˆ†ã€‚</p><h3 id="é€šç”¨æ ¼å¼æ§åˆ¶"><a class="markdownIt-Anchor" href="#é€šç”¨æ ¼å¼æ§åˆ¶"></a> é€šç”¨æ ¼å¼æ§åˆ¶</h3><table><thead><tr><th>å±æ€§ä»£ç </th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>0</td><td>é‡ç½®æ‰€æœ‰å±æ€§</td></tr><tr><td>1</td><td>é«˜äº®/åŠ ç²—</td></tr><tr><td>2</td><td>æš—æ·¡</td></tr><tr><td>4</td><td>ä¸‹åˆ’çº¿</td></tr><tr><td>5</td><td>é—ªçƒ</td></tr><tr><td>7</td><td>åè½¬</td></tr><tr><td>8</td><td>éšè—</td></tr></tbody></table><h3 id="å‰æ™¯è‰²"><a class="markdownIt-Anchor" href="#å‰æ™¯è‰²"></a> å‰æ™¯è‰²</h3><table><thead><tr><th>å±æ€§ä»£ç </th><th>é¢œè‰²</th></tr></thead><tbody><tr><td>30</td><td>é»‘è‰²</td></tr><tr><td>31</td><td>çº¢è‰²</td></tr><tr><td>32</td><td>ç»¿è‰²</td></tr><tr><td>33</td><td>é»„è‰²</td></tr><tr><td>34</td><td>è“è‰²</td></tr><tr><td>35</td><td>å“çº¢</td></tr><tr><td>36</td><td>é’è‰²</td></tr></tbody></table><h3 id="èƒŒæ™¯è‰²"><a class="markdownIt-Anchor" href="#èƒŒæ™¯è‰²"></a> èƒŒæ™¯è‰²</h3><table><thead><tr><th>å±æ€§ä»£ç </th><th>é¢œè‰²</th></tr></thead><tbody><tr><td>40</td><td>é»‘è‰²</td></tr><tr><td>41</td><td>çº¢è‰²</td></tr><tr><td>42</td><td>ç»¿è‰²</td></tr><tr><td>43</td><td>é»„è‰²</td></tr><tr><td>44</td><td>è“è‰²</td></tr><tr><td>45</td><td>å“çº¢</td></tr><tr><td>46</td><td>é’è‰²</td></tr></tbody></table><p>æ ¹æ®å¦‚ä¸ŠANSIè½¬ä¹‰åºåˆ—çš„æ ‡å‡†ï¼Œæˆ‘å®ç°äº†éƒ¨åˆ†é¢œè‰²ï¼Œä¿®æ”¹éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹</p><p><code>printfmt.c</code>ä¸­çš„<code>vprintfmt</code>å‡½æ•°ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RESET 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BOLD 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FBLACK 30</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FRED  31</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FGREEN  32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FYELLOW  33</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FBLUE 34</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FDEFAULT 39</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BBLACK 40</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BRED  41</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BGREEN 42</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BYELLOW 43</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BBLUE 44</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BDEFAULT 49</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESC <span class="string">&#x27;\033&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> START <span class="string">&#x27;[&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> END <span class="string">&#x27;m&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELIMITER <span class="string">&#x27;;&#x27;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// default black background, white foreground</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> color = <span class="number">0x0700</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">parse_str2int</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line"><span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = start ; i &lt; end ; i++)&#123;</span><br><span class="line">result *= <span class="number">10</span>;</span><br><span class="line">result += s[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">set_color</span><span class="params">(<span class="type">int</span> r)</span>&#123;</span><br><span class="line"><span class="comment">// cprintf(&quot;r : %d\n&quot;, r);</span></span><br><span class="line"><span class="keyword">if</span>(r / <span class="number">10</span> == <span class="number">3</span>)&#123;</span><br><span class="line">color &amp;= <span class="number">0xf0ff</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(r / <span class="number">10</span> == <span class="number">4</span>)&#123;</span><br><span class="line">color &amp;= <span class="number">0x0fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (r)&#123;</span><br><span class="line"><span class="keyword">case</span> RESET:</span><br><span class="line">color = <span class="number">0x0700</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BOLD:</span><br><span class="line">color |= <span class="number">0x0800</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> FBLACK:</span><br><span class="line">color |= <span class="number">0x0000</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> FBLUE:</span><br><span class="line">color |= <span class="number">0x0100</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> FGREEN:</span><br><span class="line">color |= <span class="number">0x0200</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> FRED:</span><br><span class="line">color |= <span class="number">0x0400</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> FYELLOW:</span><br><span class="line">color |= <span class="number">0x0600</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> FDEFAULT:</span><br><span class="line">color |= <span class="number">0x0700</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BBLACK:</span><br><span class="line">color |= <span class="number">0x0000</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BBLUE:</span><br><span class="line">color |= <span class="number">0x1000</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BGREEN:</span><br><span class="line">color |= <span class="number">0x2000</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BRED:</span><br><span class="line">color |= <span class="number">0x4000</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BYELLOW:</span><br><span class="line">color |= <span class="number">0x6000</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BDEFAULT:</span><br><span class="line">color |= <span class="number">0x7000</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// cprintf(&quot;color : %x\n&quot;, color);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">vprintfmt</span><span class="params">(<span class="type">void</span> (*putch)(<span class="type">int</span>, <span class="type">void</span>*), <span class="type">void</span> *putdat, <span class="type">const</span> <span class="type">char</span> *fmt, va_list ap)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="type">const</span> <span class="type">char</span> *p;</span><br><span class="line"><span class="keyword">register</span> <span class="type">int</span> ch, err;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> num;</span><br><span class="line"><span class="type">int</span> base, lflag, width, precision, altflag;</span><br><span class="line"><span class="type">char</span> padc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">while</span> ((ch = *(<span class="type">unsigned</span> <span class="type">char</span> *) fmt++) != <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (ch == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span> (ch == ESC) &#123;</span><br><span class="line"><span class="keyword">if</span>(*fmt++ != START)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> * str = fmt;</span><br><span class="line"><span class="type">int</span> startidx = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((ch = *(<span class="type">unsigned</span> <span class="type">char</span> *) fmt++) != END)&#123;</span><br><span class="line"><span class="keyword">if</span>(ch == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> endidx = fmt - str - <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> s = startidx;</span><br><span class="line"><span class="type">int</span> e = endidx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = startidx ; i &lt; endidx ; i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(str[i] == DELIMITER)&#123;</span><br><span class="line">e = i;</span><br><span class="line"><span class="type">int</span> result = parse_str2int(str, s, e);</span><br><span class="line">s = i + <span class="number">1</span>;</span><br><span class="line">set_color(result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> result = parse_str2int(str, s, endidx);</span><br><span class="line">set_color(result);</span><br><span class="line">putch(color, putdat);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">putch(ch, putdat);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Process a %-escape sequence</span></span><br><span class="line">padc = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">width = <span class="number">-1</span>;</span><br><span class="line">precision = <span class="number">-1</span>;</span><br><span class="line">lflag = <span class="number">0</span>;</span><br><span class="line">altflag = <span class="number">0</span>;</span><br><span class="line">reswitch:</span><br><span class="line"><span class="keyword">switch</span> (ch = *(<span class="type">unsigned</span> <span class="type">char</span> *) fmt++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// flag to pad on the right</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">padc = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line"><span class="keyword">goto</span> reswitch;</span><br><span class="line"></span><br><span class="line"><span class="comment">// flag to pad with 0&#x27;s instead of spaces</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">padc = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="keyword">goto</span> reswitch;</span><br><span class="line"></span><br><span class="line"><span class="comment">// width field</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line"><span class="keyword">for</span> (precision = <span class="number">0</span>; ; ++fmt) &#123;</span><br><span class="line">precision = precision * <span class="number">10</span> + ch - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">ch = *fmt;</span><br><span class="line"><span class="keyword">if</span> (ch &lt; <span class="string">&#x27;0&#x27;</span> || ch &gt; <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">goto</span> process_precision;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">precision = va_arg(ap, <span class="type">int</span>);</span><br><span class="line"><span class="keyword">goto</span> process_precision;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line"><span class="keyword">if</span> (width &lt; <span class="number">0</span>)</span><br><span class="line">width = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">goto</span> reswitch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;#&#x27;</span>:</span><br><span class="line">altflag = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">goto</span> reswitch;</span><br><span class="line"></span><br><span class="line">process_precision:</span><br><span class="line"><span class="keyword">if</span> (width &lt; <span class="number">0</span>)</span><br><span class="line">width = precision, precision = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">goto</span> reswitch;</span><br><span class="line"></span><br><span class="line"><span class="comment">// long flag (doubled for long long)</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">lflag++;</span><br><span class="line"><span class="keyword">goto</span> reswitch;</span><br><span class="line"></span><br><span class="line"><span class="comment">// character</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">putch(va_arg(ap, <span class="type">int</span>), putdat);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error message</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">err = va_arg(ap, <span class="type">int</span>);</span><br><span class="line"><span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">err = -err;</span><br><span class="line"><span class="keyword">if</span> (err &gt;= MAXERROR || (p = error_string[err]) == <span class="literal">NULL</span>)</span><br><span class="line">printfmt(putch, putdat, <span class="string">&quot;error %d&quot;</span>, err);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">printfmt(putch, putdat, <span class="string">&quot;%s&quot;</span>, p);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// string</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line"><span class="keyword">if</span> ((p = va_arg(ap, <span class="type">char</span> *)) == <span class="literal">NULL</span>)</span><br><span class="line">p = <span class="string">&quot;(null)&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (width &gt; <span class="number">0</span> &amp;&amp; padc != <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> (width -= strnlen(p, precision); width &gt; <span class="number">0</span>; width--)</span><br><span class="line">putch(padc, putdat);</span><br><span class="line"><span class="keyword">for</span> (; (ch = *p++) != <span class="string">&#x27;\0&#x27;</span> &amp;&amp; (precision &lt; <span class="number">0</span> || --precision &gt;= <span class="number">0</span>); width--)</span><br><span class="line"><span class="keyword">if</span> (altflag &amp;&amp; (ch &lt; <span class="string">&#x27; &#x27;</span> || ch &gt; <span class="string">&#x27;~&#x27;</span>))</span><br><span class="line">putch(<span class="string">&#x27;?&#x27;</span>, putdat);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">putch(ch, putdat);</span><br><span class="line"><span class="keyword">for</span> (; width &gt; <span class="number">0</span>; width--)</span><br><span class="line">putch(<span class="string">&#x27; &#x27;</span>, putdat);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (signed) decimal</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">num = getint(&amp;ap, lflag);</span><br><span class="line"><span class="keyword">if</span> ((<span class="type">long</span> <span class="type">long</span>) num &lt; <span class="number">0</span>) &#123;</span><br><span class="line">putch(<span class="string">&#x27;-&#x27;</span>, putdat);</span><br><span class="line">num = -(<span class="type">long</span> <span class="type">long</span>) num;</span><br><span class="line">&#125;</span><br><span class="line">base = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">goto</span> number;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unsigned decimal</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">num = getuint(&amp;ap, lflag);</span><br><span class="line">base = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">goto</span> number;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (unsigned) octal</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;o&#x27;</span>:</span><br><span class="line"><span class="comment">// Replace this with your code.</span></span><br><span class="line">num = getuint(&amp;ap, lflag);</span><br><span class="line">base = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pointer</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">putch(<span class="string">&#x27;0&#x27;</span>, putdat);</span><br><span class="line">putch(<span class="string">&#x27;x&#x27;</span>, putdat);</span><br><span class="line">num = (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)</span><br><span class="line">(<span class="type">uintptr_t</span>) va_arg(ap, <span class="type">void</span> *);</span><br><span class="line">base = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">goto</span> number;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (unsigned) hexadecimal</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">num = getuint(&amp;ap, lflag);</span><br><span class="line">base = <span class="number">16</span>;</span><br><span class="line">number:</span><br><span class="line">printnum(putch, putdat, num, base, width, padc);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// escaped &#x27;%&#x27; character</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">putch(ch, putdat);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unrecognized escape sequence - just print it literally</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">putch(<span class="string">&#x27;%&#x27;</span>, putdat);</span><br><span class="line"><span class="keyword">for</span> (fmt--; fmt[<span class="number">-1</span>] != <span class="string">&#x27;%&#x27;</span>; fmt--)</span><br><span class="line"><span class="comment">/* do nothing */</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>console.c</code>çš„<code>cga_putc</code>å‡½æ•°ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> color = <span class="number">0x0700</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line"><span class="title function_">cga_putc</span><span class="params">(<span class="type">int</span> c)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// if no attribute given, then use black on white</span></span><br><span class="line"><span class="keyword">if</span> (!(c &amp; ~<span class="number">0xFF</span>))&#123;</span><br><span class="line">c |= color;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">color = c;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (c &amp; <span class="number">0xff</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;\b&#x27;</span>:</span><br><span class="line"><span class="keyword">if</span> (crt_pos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">crt_pos--;</span><br><span class="line">crt_buf[crt_pos] = (c &amp; ~<span class="number">0xff</span>) | <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">crt_pos += CRT_COLS;</span><br><span class="line"><span class="comment">/* fallthru */</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;\r&#x27;</span>:</span><br><span class="line">crt_pos -= (crt_pos % CRT_COLS);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;\t&#x27;</span>:</span><br><span class="line">cons_putc(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">cons_putc(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">cons_putc(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">cons_putc(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">cons_putc(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">crt_buf[crt_pos++] = c;<span class="comment">/* write the character */</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// What is the purpose of this?</span></span><br><span class="line"><span class="keyword">if</span> (crt_pos &gt;= CRT_SIZE) &#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">memmove(crt_buf, crt_buf + CRT_COLS, (CRT_SIZE - CRT_COLS) * <span class="keyword">sizeof</span>(<span class="type">uint16_t</span>));</span><br><span class="line"><span class="keyword">for</span> (i = CRT_SIZE - CRT_COLS; i &lt; CRT_SIZE; i++)</span><br><span class="line">crt_buf[i] = <span class="number">0x0700</span> | <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">crt_pos -= CRT_COLS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* move that little blinky thing */</span></span><br><span class="line">outb(addr_6845, <span class="number">14</span>);</span><br><span class="line">outb(addr_6845 + <span class="number">1</span>, crt_pos &gt;&gt; <span class="number">8</span>);</span><br><span class="line">outb(addr_6845, <span class="number">15</span>);</span><br><span class="line">outb(addr_6845 + <span class="number">1</span>, crt_pos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæµ‹è¯•éƒ¨åˆ†ä»£ç å’Œå®ç°æ•ˆæœå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715125445351.png" alt="image-20230715125445351" /></p><p>æ‰“å°å‡ºçº¢è‰²å‰æ™¯+ç»¿è‰²èƒŒæ™¯+é«˜äº®</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715125504804.png" alt="image-20230715125504804" /></p><h1 id="exercise-9"><a class="markdownIt-Anchor" href="#exercise-9"></a> Exercise 9</h1><p>æ ˆçš„ç»“æŸåœ°å€æ˜¯dataæ®µçš„å¼€å§‹ï¼Œå¤§å°ä¸º8ä¸ªé¡µï¼Œ32KB</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715154242652.png" alt="image-20230715154242652" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715154459904.png" alt="image-20230715154459904" /></p><h1 id="exercise-10"><a class="markdownIt-Anchor" href="#exercise-10"></a> Exercise 10</h1><p>ä¸‹é¢æ˜¯Cè¯­è¨€å‡½æ•°è°ƒç”¨æ—¶æ ˆçš„å†…å­˜å›¾</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/v2-88c6f207393b2d475335ebe11a32994b.png" alt="v2-88c6f207393b2d475335ebe11a32994b" /></p><h1 id="exercise-11"><a class="markdownIt-Anchor" href="#exercise-11"></a> Exercise 11</h1><p>åœ¨<code>entry.S</code>ä¸­å°†ebpåˆå§‹åŒ–ä¸º0,è¯´æ˜å½“ebpä¸º0æ—¶æ ˆå¸§å°±ç»“æŸäº†ï¼Œæ ¹æ®ç»ƒä¹ 10çš„æ¨¡å‹ï¼Œå¯ä»¥éå†æ‰€æœ‰çš„æ ˆå¸§</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">mon_backtrace</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv, <span class="keyword">struct</span> Trapframe *tf)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Your code here.</span></span><br><span class="line"><span class="type">uint32_t</span> ebp,eip;</span><br><span class="line"><span class="keyword">for</span>(ebp = read_ebp();ebp != <span class="number">0</span> ; ebp = *((<span class="type">uint32_t</span>*)ebp))&#123;</span><br><span class="line">eip = *(<span class="type">uint32_t</span>*)(ebp + <span class="number">4</span>);</span><br><span class="line">cprintf(<span class="string">&quot;ebp %x eip %x args &quot;</span>,ebp,eip);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt; <span class="number">7</span> ; i++)&#123;</span><br><span class="line">cprintf(<span class="string">&quot;%08x &quot;</span>,*((<span class="type">uint32_t</span>*)(ebp + i * <span class="number">4</span>)));</span><br><span class="line">&#125;</span><br><span class="line">cprintf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°è¾“å‡ºå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230715173226989.png" alt="image-20230715173226989" /></p><h1 id="exercise-12"><a class="markdownIt-Anchor" href="#exercise-12"></a> Exercise 12</h1><p>è¿™ä¸ªç»ƒä¹ åªéœ€è¦æ·»åŠ è°ƒè¯•ä¿¡æ¯çš„æ‰“å°å³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">mon_backtrace</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv, <span class="keyword">struct</span> Trapframe *tf)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Your code here.</span></span><br><span class="line"><span class="type">uint32_t</span> ebp,eip;</span><br><span class="line"><span class="keyword">for</span>(ebp = read_ebp();ebp != <span class="number">0</span> ; ebp = *((<span class="type">uint32_t</span>*)ebp))&#123;</span><br><span class="line">eip = *(<span class="type">uint32_t</span>*)(ebp + <span class="number">4</span>);</span><br><span class="line">cprintf(<span class="string">&quot;ebp %x eip %x args &quot;</span>,ebp,eip);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt; <span class="number">7</span> ; i++)&#123;</span><br><span class="line">cprintf(<span class="string">&quot;%08x &quot;</span>,*((<span class="type">uint32_t</span>*)(ebp + i * <span class="number">4</span>)));</span><br><span class="line">&#125;</span><br><span class="line">cprintf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Eipdebuginfo</span> <span class="title">info</span>;</span></span><br><span class="line">debuginfo_eip(eip,&amp;info);</span><br><span class="line">cprintf(<span class="string">&quot;\t%s:%d: %.*s+%d\n&quot;</span>,info.eip_file,info.eip_line,info.eip_fn_namelen,info.eip_fn_name,info.eip_fn_addr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mit-6.828 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>linuxæ­å»ºdosboxç¯å¢ƒ</title>
      <link href="/2023/06/29/linux%E6%90%AD%E5%BB%BAdosbox%E7%8E%AF%E5%A2%83/"/>
      <url>/2023/06/29/linux%E6%90%AD%E5%BB%BAdosbox%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>dosboxèƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨ç°ä»£osä¸Šä½¿ç”¨æ—©æœŸdosç¯å¢ƒã€‚</p><p>dosç¯å¢ƒä¸‹çš„æ±‡ç¼–æ˜¯æ¯”è¾ƒå‹å¥½çš„ï¼Œdosæœ¬èº«ç®€å•çš„æœºåˆ¶ä¹Ÿæœ‰åˆ©äºæˆ‘ä»¬å¯¹ç³»ç»Ÿæœ‰åˆæ­¥çš„ç†è§£ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥åœ¨linuxç¯å¢ƒä¸­æ­å»ºdosboxå’Œå…¶æ±‡ç¼–ç¯å¢ƒã€‚</p><h1 id="å®‰è£…dosbox"><a class="markdownIt-Anchor" href="#å®‰è£…dosbox"></a> å®‰è£…dosbox</h1><p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·å®‰è£…dosboxå³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install dosbox <span class="comment"># ubuntu</span></span></span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä»¥åæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›é…ç½®ã€‚</p><p>æˆ‘ä»¬éœ€è¦æŒ‚è½½ä¸€ä¸ªå®¿ä¸»æœºçš„ä½ç½®åˆ°dosboxçš„dç›˜ï¼Œè¿™æ ·å¯ä»¥å®ç°ä¸¤è€…ä¹‹é—´æ–‡ä»¶çš„äº’é€šã€‚</p><p>æˆ‘ä»¬æ‰¾åˆ°dosboxçš„é…ç½®æ–‡ä»¶<code>~/.dosbox/dosbox-[version].conf</code>ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount d éœ€è¦è¢«æŒ‚è½½çš„ä½ç½®</span><br><span class="line">d:    </span><br></pre></td></tr></table></figure><h1 id="æ±‡ç¼–ç¯å¢ƒæ­å»º"><a class="markdownIt-Anchor" href="#æ±‡ç¼–ç¯å¢ƒæ­å»º"></a> æ±‡ç¼–ç¯å¢ƒæ­å»º</h1><p>åœ¨æœ¬åšå®¢ä¸­æˆ‘ä»¬ä½¿ç”¨nasmæ¥ä½œä¸ºç¼–è¯‘å™¨ã€‚</p><p>æˆ‘ä»¬å…ˆä¸‹è½½nasmå’Œdebugå·¥å…·ï¼Œç‚¹å‡»ä¸‹é¢çš„é“¾æ¥ä¸‹è½½ã€‚</p><p><a href="https://sky-public-resource.oss-cn-hangzhou.aliyuncs.com/nasm-dos.tar.gz">https://sky-public-resource.oss-cn-hangzhou.aliyuncs.com/nasm-dos.tar.gz</a></p><p>ä¸‹è½½å®Œæˆä»¥åæˆ‘ä»¬å°†å‹ç¼©åŒ…ä¸­çš„å†…å®¹è§£å‹åˆ°æˆ‘ä»¬æŒ‚è½½çš„ç›®å½•ï¼Œè¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntuç¾åŒ–macosä¸»é¢˜</title>
      <link href="/2023/06/08/ubuntu%E7%BE%8E%E5%8C%96macos%E4%B8%BB%E9%A2%98/"/>
      <url>/2023/06/08/ubuntu%E7%BE%8E%E5%8C%96macos%E4%B8%BB%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘çªç„¶æƒ³ç¾åŒ–ä¸€ä¸‹è‡ªå·±ubuntuçš„é£æ ¼ï¼Œæƒ³è¯•ä¸€è¯•macosé£æ ¼çš„ubuntuï¼Œæœ¬åšå®¢è®°å½•è¿™æ¬¡çš„ç¾åŒ–è¿‡ç¨‹ã€‚</p><p>è§†é¢‘å‚è€ƒï¼š</p><p><a href="https://www.bilibili.com/video/BV1gT411m7FF/?spm_id_from=333.337.search-card.all.click">https://www.bilibili.com/video/BV1gT411m7FF/?spm_id_from=333.337.search-card.all.click</a></p><p>æ­¤å¤–å…ˆä¸‹è½½ä¸€ä¸‹éœ€è¦çš„æ–‡ä»¶ï¼š</p><p><a href="https://sky-public-resource.oss-cn-hangzhou.aliyuncs.com/ubunmac.zip">https://sky-public-resource.oss-cn-hangzhou.aliyuncs.com/ubunmac.zip</a></p><p>ä¸‹é¢æ˜¯ç¾åŒ–è¿‡ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install gnome-tweaks gnome-shell-extensions -y</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€ç«ç‹æµè§ˆå™¨ï¼Œåœ¨æ’ä»¶æœç´¢<code>gnome shell</code>å¹¶å®‰è£…</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230609082608796.png" alt="image-20230609082608796" /></p><p>ç„¶åè¿›å…¥<code>gnome</code>æ’ä»¶ä¸‹è½½ç½‘å€ä¸‹è½½gnomeæ’ä»¶</p><p><a href="https://extensions.gnome.org/">https://extensions.gnome.org/</a></p><p>ä¸‹è½½æ’ä»¶</p><ul><li><code>User Themes</code></li></ul><p>è§£å‹ä¹‹å‰ä¸‹è½½çš„<code>WhiteSur-gtk-theme-master.zip</code></p><p>è¿›å…¥åˆ°ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./install.sh -t all -N glassy -s 220</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> ./tweaks.sh -g</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å®¶ç›®å½•ä¸‹æ–°å»º<code>.icons</code>ç›®å½•ï¼Œå°†<code>Mkos-Big-Sur-master</code>æ–‡ä»¶è§£å‹åˆ°ç›®å½•ä¸‹ã€‚</p><p>è¿›å…¥åˆ°<code>è®¾ç½®å¤–è§‚</code>ï¼Œä¿®æ”¹é…ç½®å¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230609085510969.png" alt="image-20230609085510969" /></p><p>ç„¶åæ‰“å¼€èœå•ï¼Œæ‰“å¼€ä¼˜åŒ–ï¼Œè®¾ç½®å¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230609085931409.png" alt="image-20230609085931409" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230609090010154.png" alt="image-20230609090010154" /></p><p>é‡æ–°å›åˆ°æˆ‘ä»¬çš„<code>gnome</code>æ’ä»¶ç½‘é¡µï¼Œä¸‹è½½å¦‚ä¸‹æ’ä»¶</p><ul><li><p><code>Blur my shell</code></p><p>ä¿®æ”¹é…ç½®å¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230609090224061.png" alt="image-20230609090224061" /></p></li><li><p><code>frippery move clock</code></p></li><li><p><code>lock screen background  </code></p></li></ul><p>å†æ›´æ¢æ¡Œé¢å£çº¸ä¸ºå‹ç¼©åŒ…ä¸­çš„å›¾ç‰‡</p><p>æ¥ä¸‹æ¥æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nautilus</span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ°<code>/usr/share/plymouth/themes</code></p><p>ä¿®æ”¹<code>default.plymouth</code>ä¸­çš„é…ç½®</p><p><code>WatermarkVerticalAlignment=.5</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tmuxä½¿ç”¨æ•™ç¨‹</title>
      <link href="/2023/06/07/tmux%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2023/06/07/tmux%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä¼ ç»Ÿçš„ç»ˆç«¯ä½¿ç”¨ä¸­ï¼Œä¸€ä¸ªç»ˆç«¯çª—å£æ˜¯ä¸ä¸€ä¸ªä¼šè¯ç»‘å®šçš„ï¼Œä¼šè¯æ˜¯ä¸ç»ˆç«¯ä¸­å¯åŠ¨çš„è¿›ç¨‹æ˜¯è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœä½ å…³é—­äº†ä¸€ä¸ªç»ˆç«¯ï¼Œé‚£ä¹ˆå…¶å†…éƒ¨çš„è¿›ç¨‹ä¹Ÿä¼šç»ˆæ­¢ï¼Œè€Œ<code>tmux</code>å°±æ˜¯ä¸€ä¸ªå¯ä»¥å°†ç»ˆç«¯ä¸ä¼šè¯è§£ç»‘çš„å·¥å…·ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œ<code>tmux</code>å¯ä»¥å¯¹ç»ˆç«¯è¿›è¡Œå„ç§å„æ ·çš„æ“ä½œã€‚</p><h1 id="å¿«é€Ÿå¼€å§‹"><a class="markdownIt-Anchor" href="#å¿«é€Ÿå¼€å§‹"></a> å¿«é€Ÿå¼€å§‹</h1><p>Tmuxä¸€èˆ¬éœ€è¦è‡ªå·±å®‰è£…ï¼Œç”¨åŒ…ç®¡ç†å·¥å…·ç›´æ¥å®‰è£…å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu æˆ– Debian</span></span><br><span class="line">$ <span class="built_in">sudo</span> apt-get install tmux</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS æˆ– Fedora</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum install tmux</span><br><span class="line"></span><br><span class="line"><span class="comment"># Mac</span></span><br><span class="line">$ brew install tmux</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¾“å…¥<code>tmux</code>ï¼Œå°±å¯ä»¥è¿›å…¥<code>tmux</code>çª—å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tmux</span></span><br></pre></td></tr></table></figure><p>æŒ‰ä¸‹<code>exit</code>å¯ä»¥é€€å‡º<code>tmux</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨tmuxçª—å£ä¸­è¾“å…¥<code>tmux detach</code>å¯ä»¥å°†ä¼šè¯ä¸ç»ˆç«¯åˆ†ç¦»ï¼Œç„¶åé€€å‡ºtmux</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tmux detach</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™é‡æ–°æ¥å…¥ä¼šè¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tmux attach -t 0</span></span><br></pre></td></tr></table></figure><h1 id="ä¼šè¯ç®¡ç†"><a class="markdownIt-Anchor" href="#ä¼šè¯ç®¡ç†"></a> ä¼šè¯ç®¡ç†</h1><h3 id="31-æ–°å»ºä¼šè¯"><a class="markdownIt-Anchor" href="#31-æ–°å»ºä¼šè¯"></a> 3.1 æ–°å»ºä¼šè¯</h3><p>ç¬¬ä¸€ä¸ªå¯åŠ¨çš„ Tmux çª—å£ï¼Œç¼–å·æ˜¯<code>0</code>ï¼Œç¬¬äºŒä¸ªçª—å£çš„ç¼–å·æ˜¯<code>1</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¿™äº›çª—å£å¯¹åº”çš„ä¼šè¯ï¼Œå°±æ˜¯ 0 å·ä¼šè¯ã€1 å·ä¼šè¯ã€‚</p><p>ä½¿ç”¨ç¼–å·åŒºåˆ†ä¼šè¯ï¼Œä¸å¤ªç›´è§‚ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ä¸ºä¼šè¯èµ·åã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux new -s &lt;session-name&gt;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢å‘½ä»¤æ–°å»ºä¸€ä¸ªæŒ‡å®šåç§°çš„ä¼šè¯ã€‚</p><h3 id="32-åˆ†ç¦»ä¼šè¯"><a class="markdownIt-Anchor" href="#32-åˆ†ç¦»ä¼šè¯"></a> 3.2 åˆ†ç¦»ä¼šè¯</h3><p>åœ¨ Tmux çª—å£ä¸­ï¼ŒæŒ‰ä¸‹<code>Ctrl+b d</code>æˆ–è€…è¾“å…¥<code>tmux detach</code>å‘½ä»¤ï¼Œå°±ä¼šå°†å½“å‰ä¼šè¯ä¸çª—å£åˆ†ç¦»ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux detach</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢å‘½ä»¤æ‰§è¡Œåï¼Œå°±ä¼šé€€å‡ºå½“å‰ Tmux çª—å£ï¼Œä½†æ˜¯ä¼šè¯å’Œé‡Œé¢çš„è¿›ç¨‹ä»ç„¶åœ¨åå°è¿è¡Œã€‚</p><p><code>tmux ls</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„ Tmux ä¼šè¯ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">$ tmux list-session</span><br></pre></td></tr></table></figure></blockquote><h3 id="33-æ¥å…¥ä¼šè¯"><a class="markdownIt-Anchor" href="#33-æ¥å…¥ä¼šè¯"></a> 3.3 æ¥å…¥ä¼šè¯</h3><p><code>tmux attach</code>å‘½ä»¤ç”¨äºé‡æ–°æ¥å…¥æŸä¸ªå·²å­˜åœ¨çš„ä¼šè¯ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ä¼šè¯ç¼–å·</span></span><br><span class="line">$ tmux attach -t 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¼šè¯åç§°</span></span><br><span class="line">$ tmux attach -t &lt;session-name&gt;</span><br></pre></td></tr></table></figure></blockquote><h3 id="34-æ€æ­»ä¼šè¯"><a class="markdownIt-Anchor" href="#34-æ€æ­»ä¼šè¯"></a> 3.4 æ€æ­»ä¼šè¯</h3><p><code>tmux kill-session</code>å‘½ä»¤ç”¨äºæ€æ­»æŸä¸ªä¼šè¯ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ä¼šè¯ç¼–å·</span></span><br><span class="line">$ tmux kill-session -t 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¼šè¯åç§°</span></span><br><span class="line">$ tmux kill-session -t &lt;session-name&gt;</span><br></pre></td></tr></table></figure></blockquote><h3 id="35-åˆ‡æ¢ä¼šè¯"><a class="markdownIt-Anchor" href="#35-åˆ‡æ¢ä¼šè¯"></a> 3.5 åˆ‡æ¢ä¼šè¯</h3><p><code>tmux switch</code>å‘½ä»¤ç”¨äºåˆ‡æ¢ä¼šè¯ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ä¼šè¯ç¼–å·</span></span><br><span class="line">$ tmux switch -t 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¼šè¯åç§°</span></span><br><span class="line">$ tmux switch -t &lt;session-name&gt;</span><br></pre></td></tr></table></figure></blockquote><h3 id="36-é‡å‘½åä¼šè¯"><a class="markdownIt-Anchor" href="#36-é‡å‘½åä¼šè¯"></a> 3.6 é‡å‘½åä¼šè¯</h3><p><code>tmux rename-session</code>å‘½ä»¤ç”¨äºé‡å‘½åä¼šè¯ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux rename-session -t 0 &lt;new-name&gt;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢å‘½ä»¤å°†0å·ä¼šè¯é‡å‘½åã€‚</p><h3 id="37-ä¼šè¯å¿«æ·é”®"><a class="markdownIt-Anchor" href="#37-ä¼šè¯å¿«æ·é”®"></a> 3.7 ä¼šè¯å¿«æ·é”®</h3><p>ä¸‹é¢æ˜¯ä¸€äº›ä¼šè¯ç›¸å…³çš„å¿«æ·é”®ã€‚</p><blockquote><ul><li><code>Ctrl+b d</code>ï¼šåˆ†ç¦»å½“å‰ä¼šè¯ã€‚</li><li><code>Ctrl+b s</code>ï¼šåˆ—å‡ºæ‰€æœ‰ä¼šè¯ã€‚</li><li><code>Ctrl+b $</code>ï¼šé‡å‘½åå½“å‰ä¼šè¯ã€‚</li></ul></blockquote><h1 id="çª—æ ¼ç®¡ç†"><a class="markdownIt-Anchor" href="#çª—æ ¼ç®¡ç†"></a> çª—æ ¼ç®¡ç†</h1><p>Tmux å¯ä»¥å°†çª—å£åˆ†æˆå¤šä¸ªçª—æ ¼ï¼ˆpaneï¼‰ï¼Œæ¯ä¸ªçª—æ ¼è¿è¡Œä¸åŒçš„å‘½ä»¤ã€‚ä»¥ä¸‹å‘½ä»¤éƒ½æ˜¯åœ¨ Tmux çª—å£ä¸­æ‰§è¡Œã€‚</p><p><code>tmux split-window</code>å‘½ä»¤ç”¨æ¥åˆ’åˆ†çª—æ ¼ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ’åˆ†ä¸Šä¸‹ä¸¤ä¸ªçª—æ ¼</span></span><br><span class="line">$ tmux split-window</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†å·¦å³ä¸¤ä¸ªçª—æ ¼</span></span><br><span class="line">$ tmux split-window -h</span><br></pre></td></tr></table></figure></blockquote><h3 id="52-ç§»åŠ¨å…‰æ ‡"><a class="markdownIt-Anchor" href="#52-ç§»åŠ¨å…‰æ ‡"></a> 5.2 ç§»åŠ¨å…‰æ ‡</h3><p><code>tmux select-pane</code>å‘½ä»¤ç”¨æ¥ç§»åŠ¨å…‰æ ‡ä½ç½®ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…‰æ ‡åˆ‡æ¢åˆ°ä¸Šæ–¹çª—æ ¼</span></span><br><span class="line">$ tmux select-pane -U</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…‰æ ‡åˆ‡æ¢åˆ°ä¸‹æ–¹çª—æ ¼</span></span><br><span class="line">$ tmux select-pane -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…‰æ ‡åˆ‡æ¢åˆ°å·¦è¾¹çª—æ ¼</span></span><br><span class="line">$ tmux select-pane -L</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…‰æ ‡åˆ‡æ¢åˆ°å³è¾¹çª—æ ¼</span></span><br><span class="line">$ tmux select-pane -R</span><br></pre></td></tr></table></figure></blockquote><h3 id="53-äº¤æ¢çª—æ ¼ä½ç½®"><a class="markdownIt-Anchor" href="#53-äº¤æ¢çª—æ ¼ä½ç½®"></a> 5.3 äº¤æ¢çª—æ ¼ä½ç½®</h3><p><code>tmux swap-pane</code>å‘½ä»¤ç”¨æ¥äº¤æ¢çª—æ ¼ä½ç½®ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“å‰çª—æ ¼ä¸Šç§»</span></span><br><span class="line">$ tmux swap-pane -U</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰çª—æ ¼ä¸‹ç§»</span></span><br><span class="line">$ tmux swap-pane -D</span><br></pre></td></tr></table></figure></blockquote><h3 id="54-çª—æ ¼å¿«æ·é”®"><a class="markdownIt-Anchor" href="#54-çª—æ ¼å¿«æ·é”®"></a> 5.4 çª—æ ¼å¿«æ·é”®</h3><p>ä¸‹é¢æ˜¯ä¸€äº›çª—æ ¼æ“ä½œçš„å¿«æ·é”®ã€‚</p><blockquote><ul><li><code>Ctrl+b %</code>ï¼šåˆ’åˆ†å·¦å³ä¸¤ä¸ªçª—æ ¼ã€‚</li><li><code>Ctrl+b &quot;</code>ï¼šåˆ’åˆ†ä¸Šä¸‹ä¸¤ä¸ªçª—æ ¼ã€‚</li><li><code>Ctrl+b &lt;arrow key&gt;</code>ï¼šå…‰æ ‡åˆ‡æ¢åˆ°å…¶ä»–çª—æ ¼ã€‚<code>&lt;arrow key&gt;</code>æ˜¯æŒ‡å‘è¦åˆ‡æ¢åˆ°çš„çª—æ ¼çš„æ–¹å‘é”®ï¼Œæ¯”å¦‚åˆ‡æ¢åˆ°ä¸‹æ–¹çª—æ ¼ï¼Œå°±æŒ‰æ–¹å‘é”®<code>â†“</code>ã€‚</li><li><code>Ctrl+b ;</code>ï¼šå…‰æ ‡åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªçª—æ ¼ã€‚</li><li><code>Ctrl+b o</code>ï¼šå…‰æ ‡åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—æ ¼ã€‚</li><li><code>Ctrl+b &#123;</code>ï¼šå½“å‰çª—æ ¼ä¸ä¸Šä¸€ä¸ªçª—æ ¼äº¤æ¢ä½ç½®ã€‚</li><li><code>Ctrl+b &#125;</code>ï¼šå½“å‰çª—æ ¼ä¸ä¸‹ä¸€ä¸ªçª—æ ¼äº¤æ¢ä½xç½®ã€‚</li><li><code>Ctrl+b Ctrl+o</code>ï¼šæ‰€æœ‰çª—æ ¼å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œç¬¬ä¸€ä¸ªçª—æ ¼å˜æˆæœ€åä¸€ä¸ªçª—æ ¼ã€‚</li><li><code>Ctrl+b Alt+o</code>ï¼šæ‰€æœ‰çª—æ ¼å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œæœ€åä¸€ä¸ªçª—æ ¼å˜æˆç¬¬ä¸€ä¸ªçª—æ ¼ã€‚</li><li><code>Ctrl+b x</code>ï¼šå…³é—­å½“å‰çª—æ ¼ã€‚</li><li><code>Ctrl+b !</code>ï¼šå°†å½“å‰çª—æ ¼æ‹†åˆ†ä¸ºä¸€ä¸ªç‹¬ç«‹çª—å£ã€‚</li><li><code>Ctrl+b z</code>ï¼šå½“å‰çª—æ ¼å…¨å±æ˜¾ç¤ºï¼Œå†ä½¿ç”¨ä¸€æ¬¡ä¼šå˜å›åŸæ¥å¤§å°ã€‚</li><li><code>Ctrl+b Ctrl+&lt;arrow key&gt;</code>ï¼šæŒ‰ç®­å¤´æ–¹å‘è°ƒæ•´çª—æ ¼å¤§å°ã€‚</li><li><code>Ctrl+b q</code>ï¼šæ˜¾ç¤ºçª—æ ¼ç¼–å·ã€‚</li></ul></blockquote><h1 id="çª—å£ç®¡ç†"><a class="markdownIt-Anchor" href="#çª—å£ç®¡ç†"></a> çª—å£ç®¡ç†</h1><p>é™¤äº†å°†ä¸€ä¸ªçª—å£åˆ’åˆ†æˆå¤šä¸ªçª—æ ¼ï¼ŒTmux ä¹Ÿå…è®¸æ–°å»ºå¤šä¸ªçª—å£ã€‚</p><h3 id="61-æ–°å»ºçª—å£"><a class="markdownIt-Anchor" href="#61-æ–°å»ºçª—å£"></a> 6.1 æ–°å»ºçª—å£</h3><p><code>tmux new-window</code>å‘½ä»¤ç”¨æ¥åˆ›å»ºæ–°çª—å£ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tmux new-window</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªæŒ‡å®šåç§°çš„çª—å£</span></span><br><span class="line">$ tmux new-window -n &lt;window-name&gt;</span><br></pre></td></tr></table></figure></blockquote><h3 id="62-åˆ‡æ¢çª—å£"><a class="markdownIt-Anchor" href="#62-åˆ‡æ¢çª—å£"></a> 6.2 åˆ‡æ¢çª—å£</h3><p><code>tmux select-window</code>å‘½ä»¤ç”¨æ¥åˆ‡æ¢çª—å£ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šç¼–å·çš„çª—å£</span></span><br><span class="line">$ tmux select-window -t &lt;window-number&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šåç§°çš„çª—å£</span></span><br><span class="line">$ tmux select-window -t &lt;window-name&gt;</span><br></pre></td></tr></table></figure></blockquote><h3 id="63-é‡å‘½åçª—å£"><a class="markdownIt-Anchor" href="#63-é‡å‘½åçª—å£"></a> 6.3 é‡å‘½åçª—å£</h3><p><code>tmux rename-window</code>å‘½ä»¤ç”¨äºä¸ºå½“å‰çª—å£èµ·åï¼ˆæˆ–é‡å‘½åï¼‰ã€‚</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux rename-window &lt;new-name&gt;</span><br></pre></td></tr></table></figure></blockquote><h3 id="64-çª—å£å¿«æ·é”®"><a class="markdownIt-Anchor" href="#64-çª—å£å¿«æ·é”®"></a> 6.4 çª—å£å¿«æ·é”®</h3><p>ä¸‹é¢æ˜¯ä¸€äº›çª—å£æ“ä½œçš„å¿«æ·é”®ã€‚</p><blockquote><ul><li><code>Ctrl+b c</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çª—å£ï¼ŒçŠ¶æ€æ ä¼šæ˜¾ç¤ºå¤šä¸ªçª—å£çš„ä¿¡æ¯ã€‚</li><li><code>Ctrl+b p</code>ï¼šåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªçª—å£ï¼ˆæŒ‰ç…§çŠ¶æ€æ ä¸Šçš„é¡ºåºï¼‰ã€‚</li><li><code>Ctrl+b n</code>ï¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£ã€‚</li><li><code>Ctrl+b &lt;number&gt;</code>ï¼šåˆ‡æ¢åˆ°æŒ‡å®šç¼–å·çš„çª—å£ï¼Œå…¶ä¸­çš„<code>&lt;number&gt;</code>æ˜¯çŠ¶æ€æ ä¸Šçš„çª—å£ç¼–å·ã€‚</li><li><code>Ctrl+b w</code>ï¼šä»åˆ—è¡¨ä¸­é€‰æ‹©çª—å£ã€‚</li><li><code>Ctrl+b ,</code>ï¼šçª—å£é‡å‘½åã€‚</li></ul></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> tmux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vimçš„åŸºæœ¬ç”¨æ³•</title>
      <link href="/2023/06/07/vim%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/"/>
      <url>/2023/06/07/vim%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>vimæ˜¯ä¸€æ¬¾Linuxä¸‹çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨ç»ˆç«¯ç¯å¢ƒä¸‹ç¼–è¾‘æ–‡æœ¬æ—¶ï¼Œvimå°±æ˜¯æˆ‘ä»¬æœ€å¥½çš„é€‰æ‹©ã€‚vimçœ‹èµ·æ¥ä¼¼ä¹å¯¹åˆå­¦è€…ä¸å¤ªå‹ï¼Œä½†æ˜¯æƒ³è¦ä¸Šæ‰‹ä½¿ç”¨vimå¹¶ä¸å›°éš¾ã€‚</p><h1 id="è®¤è¯†vim"><a class="markdownIt-Anchor" href="#è®¤è¯†vim"></a> è®¤è¯†vim</h1><p>æˆ‘ä»¬å…ˆæ¥å®è§‚çš„è®¤è¯†vimï¼Œvimå¸¸ç”¨çš„æœ‰å››ä¸ªæ¨¡å¼ï¼š</p><ol><li>æ­£å¸¸æ¨¡å¼ï¼ˆNormal-modeï¼‰</li><li>æ’å…¥æ¨¡å¼ï¼ˆInsert-modeï¼‰</li><li>å‘½ä»¤æ¨¡å¼ï¼ˆCommand-modeï¼‰</li><li>å¯è§†æ¨¡å¼ï¼ˆVisual-modeï¼‰</li></ol><h2 id="æ­£å¸¸æ¨¡å¼"><a class="markdownIt-Anchor" href="#æ­£å¸¸æ¨¡å¼"></a> æ­£å¸¸æ¨¡å¼</h2><p>å½“æˆ‘ä»¬å¯åŠ¨vimæ—¶ï¼Œvimå°±å¤„äºæ­£å¸¸æ¨¡å¼ï¼Œåœ¨æ­£å¸¸æ¨¡å¼ä¸‹æˆ‘ä»¬ä¸èƒ½ç›´æ¥ç¼–è¾‘æ–‡ä»¶ï¼Œåªèƒ½é€šè¿‡å‘½ä»¤çš„å½¢å¼ä½¿ç”¨å¤åˆ¶ï¼Œç²˜è´´ï¼Œå‰ªåˆ‡ç­‰æ“ä½œæ¥ç¼–è¾‘æ–‡ä»¶ã€‚</p><p>åœ¨å…¶å®ƒä»»ä½•æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡æŒ‰ä¸‹<code>Esc</code>é”®æ¥è¿”å›æ­£å¸¸æ¨¡å¼ï¼ˆå¦‚æœä¸è¡Œå°±æŒ‰ä¸¤ä¸‹ï¼‰ï¼Œ<code>å…¶å®ƒæ¨¡å¼éƒ½éœ€è¦åœ¨æ­£å¸¸æ¨¡å¼</code>ä¸‹æŒ‰ä¸‹ç›¸åº”çš„é”®ä½è§¦å‘ã€‚</p><h2 id="æ’å…¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#æ’å…¥æ¨¡å¼"></a> æ’å…¥æ¨¡å¼</h2><p>åœ¨æ­£å¸¸æ¨¡å¼ä¸‹æˆ‘ä»¬æŒ‰ä¸‹ä¸€äº›é”®ä½å°±å¯ä»¥è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œè¿™äº›æŒ‰é”®è¾ƒå¤šï¼Œæˆ‘ä»¬åœ¨åŸºæœ¬æ“ä½œä¸­è¯¦ç»†ä»‹ç»è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹ã€‚</p><p>æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯<code>i</code>å¥ï¼ŒæŒ‰ä¸‹<code>i</code>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åƒå¹³æ—¶ç¼–è¾‘æ–‡ä»¶ä¸€æ ·æ“ä½œæˆ‘ä»¬çš„æ–‡ä»¶ã€‚</p><h2 id="å‘½ä»¤æ¨¡å¼"><a class="markdownIt-Anchor" href="#å‘½ä»¤æ¨¡å¼"></a> å‘½ä»¤æ¨¡å¼</h2><p>åœ¨æŒ‰ä¸‹<code>/</code>æˆ–è€…<code>:</code>é”®ä¹‹åvimä¼šè¿›å…¥å‘½ä»¤æ¨¡å¼ï¼Œåœ¨å‘½ä»¤æ¨¡å¼ä¸‹æˆ‘ä»¬å¯ä»¥æ‰§è¡Œvimæä¾›ç»™æˆ‘ä»¬çš„æŒ‡ä»¤ï¼Œå…·ä½“çš„æŒ‡ä»¤ä¼šåœ¨ä¸‹é¢ä»‹ç»ã€‚</p><h2 id="å¯è§†æ¨¡å¼"><a class="markdownIt-Anchor" href="#å¯è§†æ¨¡å¼"></a> å¯è§†æ¨¡å¼</h2><p>æŒ‰ä¸‹<code>v</code>é”®å³å¯è¿›å…¥å¯è§†æ¨¡å¼ï¼Œåœ¨å¯è§†æ¨¡å¼ä¸‹æˆ‘ä»¬å¯ä»¥æ“ä½œå—çŠ¶åŒºåŸŸã€‚</p><h1 id="vimçš„åŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#vimçš„åŸºæœ¬æ“ä½œ"></a> vimçš„åŸºæœ¬æ“ä½œ</h1><p>ä¸‹é¢å°±å¼€å§‹ä»‹ç»æˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨vim</p><h2 id="å¿«é€Ÿå¼€å§‹"><a class="markdownIt-Anchor" href="#å¿«é€Ÿå¼€å§‹"></a> å¿«é€Ÿå¼€å§‹</h2><p>æˆ‘ä»¬å…ˆæ¥ä»‹ç»å¦‚ä½•ä½¿ç”¨vimæ‰“å¼€ï¼Œç¼–è¾‘ï¼Œä¿å­˜æ–‡ä»¶ï¼Œå¦‚æœåªæ˜¯æƒ³åœ¨vimä¸‹ç®€å•çš„ä¿®æ”¹æ–‡ä»¶ï¼Œè¿™ä¸ªéƒ¨åˆ†çš„å‡ ä¸ªå‘½ä»¤å°±è¶³å¤Ÿäº†ã€‚</p><ul><li>vimæ‰“å¼€æ–‡ä»¶ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim file</span></span><br></pre></td></tr></table></figure><ul><li>vimä¿®æ”¹æ–‡ä»¶ï¼š</li></ul><p>æˆ‘ä»¬åœ¨vimæ­£å¸¸æ¨¡å¼ä¸‹æŒ‰ä¸‹<code>i</code>è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæ­¤æ—¶ä½ å¯ä»¥æ­£å¸¸ç¼–è¾‘æ–‡ä»¶ã€‚</p><ul><li>ä¿å­˜æ–‡ä»¶</li></ul><p>å…ˆé€€å‡ºè‡³æ­£å¸¸æ¨¡å¼ï¼Œç„¶åè¾“å…¥<code>:</code>è¿›å…¥å‘½ä»¤æ¨¡å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥é”®å…¥vimå‘½ä»¤ï¼š</p><ol><li><code>w</code>ï¼šä¿å­˜æ–‡ä»¶</li><li><code>q</code>ï¼šé€€å‡ºæ–‡ä»¶</li><li><code>!</code>ï¼šå¼ºåˆ¶æ“ä½œ</li></ol><p>å¦‚æœä¸è€ƒè™‘æ•ˆç‡é—®é¢˜ï¼Œä¸Šé¢çš„ä¸‰ä¸ªæ“ä½œå·²ç»å¯ä»¥æ»¡è¶³ä½ å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚</p><p>ä½†æ˜¯vimçœŸæ­£çš„å¼ºå¤§ä¹‹å¤„å°±æ˜¯å¼ºå¤§çš„ç¼–è¾‘èƒ½åŠ›ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­äº†è§£vimçš„æ“ä½œã€‚</p><h2 id="vimå¤šçª—å£æ“ä½œ"><a class="markdownIt-Anchor" href="#vimå¤šçª—å£æ“ä½œ"></a> vimå¤šçª—å£æ“ä½œ</h2><p>vimæ‰“å¼€å¤šä¸ªæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim file1 file2 file3 ...</span> </span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å°±åŒæ—¶æ‰“å¼€äº†å¤šä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼æ“ä½œè¿™äº›æ‰“å¼€çš„æ–‡ä»¶ï¼š</p><p>æŸ¥çœ‹vimæ‰“å¼€çš„æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:ls</span><br></pre></td></tr></table></figure><p>é€‰æ‹©æ˜¾ç¤ºå…¶å®ƒæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€‰æ‹©è¿›å…¥ç¬¬äºŒä¸ªæ–‡ä»¶</span></span><br><span class="line">:b2</span><br><span class="line"><span class="comment"># è¿›å…¥ä¸‹ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶</span></span><br><span class="line">:bn</span><br><span class="line"><span class="comment"># è¿›å…¥ä¸Šä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶</span></span><br><span class="line">:bp</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†å±å‘½ä»¤åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­æ˜¾ç¤ºå¤šä¸ªæ–‡ä»¶</p><p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å·¦å³åˆ†å±ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim -O file1 file2 ...</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¸‹åˆ†å±ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim -o file1 file2 ...</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·åˆ†å±ä¸å¤ªçµæ´»ï¼Œä½¿ç”¨vimå†…ç½®å‘½ä»¤æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œé¦–å…ˆæˆ‘ä»¬è¦è®°ä½ä¸€ä¸ªé‡è¦çš„ç»„åˆé”®<code>Ctrl + w</code>ï¼Œè¿™æ˜¯å¾ˆå¤šåˆ†å±æ“ä½œçš„å‰ç½®æŒ‰é”®ã€‚</p><p>å…ˆæŒ‰ä¸‹<code>Ctrl + w</code>ï¼Œç„¶åæ¾å¼€ä»¥åå†æŒ‰ä¸‹<code>s</code>ï¼Œå°†å½“å‰æ–‡ä»¶ä¸Šä¸‹åˆ†å‰²ã€‚</p><p><code>Ctrl + w</code>ï¼Œ<code>s</code>ï¼šä¸Šä¸‹åˆ†å‰²æ–‡ä»¶ã€‚</p><p><code>Ctrl + w v</code>ï¼šå·¦å³åˆ†å‰²æ–‡ä»¶</p><p><code>:sp file</code>ï¼šä¸Šä¸‹å±•ç¤ºå½“å‰æ–‡ä»¶å’Œæ–°æ‰“å¼€æ–‡ä»¶</p><p><code>:vsp file</code>ï¼šå·¦å³å±•ç¤ºå½“å‰æ–‡ä»¶å’Œæ–°æ‰“å¼€æ–‡ä»¶</p><p>æˆ‘ä»¬ç°åœ¨å·²ç»å¼€å¯å¤šä¸ªçª—å£ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çµæ´»çš„ç§»åŠ¨å…‰æ ‡ä»¥æ“ä½œå¤šçª—å£</p><p>1.åˆ‡æ¢å·¦å³åˆ†å±çš„å…‰æ ‡ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w h</span><br></pre></td></tr></table></figure><p>å°†å½“å‰å…‰æ ‡å®šä½åˆ°å·¦è¾¹çš„å±å¹•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w l</span><br></pre></td></tr></table></figure><p>å°†å½“å‰çš„å…‰æ ‡å®šä½åˆ°å³è¾¹çš„å±å¹•</p><p>2.ç§»åŠ¨å·¦å³åˆ†å± ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w H</span><br></pre></td></tr></table></figure><p>å°†å½“å‰çš„åˆ†å±ç§»åŠ¨åˆ°å·¦è¾¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w L</span><br></pre></td></tr></table></figure><p>å°†å½“å‰çš„åˆ†å±ç§»åŠ¨åˆ°å³è¾¹</p><p>3.åˆ‡æ¢ä¸Šä¸‹åˆ†å±çš„å…‰æ ‡ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w j</span><br></pre></td></tr></table></figure><p>å°†å½“å‰çš„å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹é¢çš„åˆ†å±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w k</span><br></pre></td></tr></table></figure><p>å°†å½“å‰å…‰æ ‡ç§»åŠ¨åˆ°ä¸Šé¢çš„åˆ†å±</p><p>4.ç§»åŠ¨ä¸Šä¸‹åˆ†å±ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w J</span><br></pre></td></tr></table></figure><p>å°†å½“å‰çš„åˆ†å±ç§»åŠ¨åˆ°ä¸‹é¢çš„åˆ†å±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + w K</span><br></pre></td></tr></table></figure><p>å°†å½“å‰çš„åˆ†å±ç§»åŠ¨åˆ°ä¸Šé¢çš„åˆ†å±</p><h1 id="vimçš„æ¨¡å¼"><a class="markdownIt-Anchor" href="#vimçš„æ¨¡å¼"></a> vimçš„æ¨¡å¼</h1><p>ä¸‹é¢æ¥æ›´è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹æ­£å¸¸æ¨¡å¼ï¼Œæ’å…¥æ¨¡å¼ï¼Œå‘½ä»¤æ¨¡å¼å’Œå¯è§†æ¨¡å¼çš„ç”¨æ³•ã€‚</p><h2 id="æ­£å¸¸æ¨¡å¼-2"><a class="markdownIt-Anchor" href="#æ­£å¸¸æ¨¡å¼-2"></a> æ­£å¸¸æ¨¡å¼</h2><p>æ­£å¸¸æ¨¡å¼æ˜¯vimçš„é»˜è®¤æ¨¡å¼ï¼Œåœ¨æ­£å¸¸æ¨¡å¼ä¸­æœ‰å¾ˆå¤šå¿«æ·é”®ï¼Œæ˜¯å¦ç†Ÿç»ƒæŒæ¡è¿™äº›å¿«æ·é”®å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†æˆ‘ä»¬vimçš„æ•ˆç‡ã€‚</p><h3 id="ç§»åŠ¨å…‰æ ‡"><a class="markdownIt-Anchor" href="#ç§»åŠ¨å…‰æ ‡"></a> ç§»åŠ¨å…‰æ ‡</h3><p><code>h</code>ï¼šå·¦</p><p><code>j</code>ï¼šä¸‹</p><p><code>k</code>ï¼šä¸Š</p><p><code>l</code>ï¼šå³</p><h3 id="è¡Œå†…ç§»åŠ¨å…‰æ ‡"><a class="markdownIt-Anchor" href="#è¡Œå†…ç§»åŠ¨å…‰æ ‡"></a> è¡Œå†…ç§»åŠ¨å…‰æ ‡</h3><p><code>0 </code>ç§»åŠ¨åˆ°è¡Œå¤´</p><p><code>^</code> ç§»åŠ¨åˆ°æœ¬è¡Œçš„ç¬¬ä¸€ä¸ªä¸æ˜¯ blank å­—ç¬¦</p><p><code>$</code> ç§»åŠ¨åˆ°è¡Œå°¾</p><p><code>g_</code> ç§»åŠ¨åˆ°æœ¬è¡Œæœ€åä¸€ä¸ªä¸æ˜¯ blank å­—ç¬¦çš„ä½ç½®</p><p><code>w</code> å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„å¼€å¤´</p><p><code>e</code> å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„ç»“å°¾</p><p><code>fa</code> ç§»åŠ¨åˆ°æœ¬è¡Œä¸‹ä¸€ä¸ªä¸º a çš„å­—ç¬¦å¤„ï¼Œfb ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä¸º b çš„å­—ç¬¦å¤„</p><p><code>nfa</code> ç§»åŠ¨åˆ°æœ¬è¡Œå…‰æ ‡å¤„å¼€å§‹çš„ç¬¬ n ä¸ª å­—ç¬¦ä¸º a çš„åœ°æ–¹ï¼ˆn æ˜¯ 1ï¼Œ2ï¼Œ3ï¼Œ4 â€¦ æ•°å­—ï¼‰</p><p><code>Fa</code> åŒ <code>fa</code> ä¸€æ ·ï¼Œå…‰æ ‡ç§»åŠ¨æ–¹å‘åŒ <code>fa</code> ç›¸å</p><p><code>nFa</code> åŒ <code>nfa</code> ç±»ä¼¼ï¼Œå…‰æ ‡ç§»åŠ¨æ–¹å‘åŒ <code>nfa</code>ç›¸å</p><p><code>ta</code> ç§»åŠ¨å…‰æ ‡è‡³ a å­—ç¬¦çš„å‰ä¸€ä¸ªå­—ç¬¦</p><p><code>nta</code> ç§»åŠ¨åˆ°ç¬¬äºŒä¸ª a å­—ç¬¦çš„å‰ä¸€ä¸ªå­—ç¬¦å¤„</p><p><code>Ta</code> åŒ <code>ta</code> ç§»åŠ¨å…‰æ ‡æ–¹å‘ç›¸å</p><p><code>nTa</code> åŒ <code>nta</code> ç§»åŠ¨å…‰æ ‡æ–¹å‘ç›¸å</p><p><code>;</code> å’Œ<code>,</code> å½“ä½¿ç”¨ f, F, t ,T, å…³é”®å­—æŒ‡å®šå­—ç¬¦è·³è½¬çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>ï¼›</code>å¯ä»¥å¿«é€Ÿè·³è½¬åˆ°ä¸‹ä¸€ä¸ªæŒ‡å®šçš„å­—ç¬¦ï¼Œ<code>, </code>æ˜¯è·³åˆ°å‰ä¸€ä¸ªæŒ‡å®šçš„å­—ç¬¦</p><h3 id="è·¨è¡Œç§»åŠ¨å…‰æ ‡"><a class="markdownIt-Anchor" href="#è·¨è¡Œç§»åŠ¨å…‰æ ‡"></a> è·¨è¡Œç§»åŠ¨å…‰æ ‡</h3><p><code>nG </code>å…‰æ ‡å®šä½åˆ°ç¬¬ n è¡Œçš„è¡Œé¦–</p><p><code>gg </code>å…‰æ ‡å®šä½åˆ°ç¬¬ä¸€è¡Œçš„è¡Œé¦–</p><p><code>G </code>å…‰æ ‡å®šä½åˆ°æœ€åä¸€è¡Œçš„è¡Œé¦–</p><p><code>H </code>å…‰æ ‡å®šä½åˆ°å½“å‰å±å¹•çš„ç¬¬ä¸€è¡Œè¡Œé¦–</p><p><code>M</code> å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰å±å¹•çš„ä¸­é—´</p><p><code>L</code> å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰å±å¹•çš„å°¾éƒ¨</p><p><code>zt</code> æŠŠå½“å‰è¡Œç§»åŠ¨åˆ°å½“å‰å±å¹•çš„æœ€ä¸Šæ–¹ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€è¡Œ</p><p><code>zz</code> æŠŠå½“å‰è¡Œç§»åŠ¨åˆ°å½“å‰å±å¹•çš„ä¸­é—´</p><p><code>zb</code> æŠŠå½“å‰è¡Œç§»åŠ¨åˆ°å½“å‰å±å¹•çš„å°¾éƒ¨</p><p><code>%</code> åŒ¹é…æ‹¬å·ç§»åŠ¨ï¼ŒåŒ…æ‹¬ ( , { , [ éœ€è¦æŠŠå…‰æ ‡å…ˆç§»åŠ¨åˆ°æ‹¬å·ä¸Š</p><p><code>*</code> å’Œ <code>#</code> åŒ¹é…å…‰æ ‡å½“å‰æ‰€åœ¨çš„å•è¯ï¼Œç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªï¼ˆæˆ–è€…ä¸Šä¸€ä¸ªï¼‰åŒ¹é…çš„å•è¯ï¼ˆ <code>*</code> æ˜¯ä¸‹ä¸€ä¸ªï¼Œ<code>#</code> æ˜¯ä¸Šä¸€ä¸ªï¼‰</p><h3 id="ç¿»é¡µ"><a class="markdownIt-Anchor" href="#ç¿»é¡µ"></a> ç¿»é¡µ</h3><p><code>ctrl+f</code> æŸ¥çœ‹ä¸‹ä¸€é¡µå†…å®¹</p><p><code>ctrl+b</code> æŸ¥çœ‹ä¸Šä¸€é¡µå†…å®¹</p><h3 id="å¤åˆ¶ç²˜è´´åˆ é™¤"><a class="markdownIt-Anchor" href="#å¤åˆ¶ç²˜è´´åˆ é™¤"></a> å¤åˆ¶ï¼Œç²˜è´´ï¼Œåˆ é™¤</h3><p>ä¸‰ä¸ªé‡è¦çš„å¿«æ·é”® <code>d</code> , <code>y</code> , <code>p</code></p><p><code>d</code> æ˜¯åˆ é™¤çš„æ„æ€ï¼Œé€šå¸¸æ­é…ä¸€ä¸ªå­—ç¬¦ ( åˆ é™¤èŒƒå›´ ) å®ç°åˆ é™¤åŠŸèƒ½ï¼Œå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p><p><code>dw</code> åˆ é™¤ä¸€ä¸ªå•è¯</p><p><code>dnw</code> åˆ é™¤ n ä¸ªå•è¯ï¼Œ</p><p><code>dfa</code> åˆ é™¤å…‰æ ‡å¤„åˆ°ä¸‹ä¸€ä¸ª a çš„å­—ç¬¦å¤„ï¼ˆ fa å®šä½å…‰æ ‡åˆ° a å¤„ ï¼‰</p><p><code>dnfa</code> åˆ é™¤å…‰æ ‡å¤„åˆ°ç¬¬ n ä¸ª a çš„å­—ç¬¦å¤„</p><p><code>dd</code> åˆ é™¤ä¸€æ•´è¡Œ</p><p><code>ndd</code> åˆ é™¤å…‰æ ‡å¤„å¼€å§‹çš„ n è¡Œ</p><p><code>d$</code> åˆ é™¤å…‰æ ‡åˆ°æœ¬è¡Œçš„ç»“å°¾</p><p><code>dH</code> åˆ é™¤å±å¹•æ˜¾ç¤ºçš„ç¬¬ä¸€è¡Œæ–‡æœ¬åˆ°å…‰æ ‡æ‰€åœ¨çš„è¡Œ</p><p><code>dG</code> åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œåˆ°æ–‡æœ¬çš„ç»“æŸ</p><p><code>y</code> æ˜¯å¤åˆ¶çš„æ„æ€ï¼Œé€šå¸¸æ­é…ä¸€ä¸ªå­—ç¬¦ï¼ˆå¤åˆ¶èŒƒå›´ï¼‰å®ç°å¤åˆ¶çš„åŠŸèƒ½ï¼Œå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yw` å¤åˆ¶ä¸€ä¸ªå•è¯ï¼Œè¿˜æœ‰ `ynw</span><br><span class="line">yfa` å¤åˆ¶å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ª a çš„å­—ç¬¦å¤„,è¿˜æœ‰`ynfa</span><br><span class="line">yy` å¤åˆ¶ä¸€è¡Œï¼Œè¿˜æœ‰ `nyy</span><br></pre></td></tr></table></figure><p><code>y$</code> å¤åˆ¶å…‰æ ‡åˆ°æœ¬å·çš„ç»“å°¾</p><p><code>yH</code> å¤åˆ¶å±å¹•æ˜¾ç¤ºçš„ç¬¬ä¸€è¡Œæ–‡æœ¬åˆ°å…‰æ ‡æ‰€åœ¨çš„è¡Œ</p><p><code>yG</code> å¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡Œåˆ°æ–‡æœ¬çš„ç»“æŸ</p><p><code>p</code> ï¼Œ<code>P</code>æ˜¯é»è´´çš„æ„æ€ï¼Œå½“æ‰§è¡Œå®Œå¤åˆ¶æˆ–è€…é»è´´çš„å‘½ä»¤ä»¥åï¼ŒVIM ä¼šæŠŠæ–‡æœ¬å¯„å­˜èµ·æ¥ã€‚</p><p><code>p</code> åœ¨å…‰æ ‡åå¼€å§‹é»è´´</p><p><code>P</code> å¤§å†™çš„ P å…‰æ ‡å‰å¼€å§‹ç²˜è´´</p><h3 id="æ’¤é”€ä¸æ¢å¤"><a class="markdownIt-Anchor" href="#æ’¤é”€ä¸æ¢å¤"></a> æ’¤é”€ä¸æ¢å¤</h3><p><code>u</code> æ’¤é”€åˆšæ‰çš„æ“ä½œ</p><p><code>ctrl + r</code> æ¢å¤æ’¤é”€æ“ä½œ</p><h3 id="å¤§å°å†™è½¬æ¢"><a class="markdownIt-Anchor" href="#å¤§å°å†™è½¬æ¢"></a> å¤§å°å†™è½¬æ¢</h3><p><code>~</code>å°†å…‰æ ‡ä¸‹çš„å­—æ¯æ”¹å˜å¤§å°å†™<br /><code>3~</code>å°†å…‰æ ‡ä½ç½®å¼€å§‹çš„3ä¸ªå­—æ¯æ”¹å˜å…¶å¤§å°å†™<br /><code>g~~</code>æ”¹å˜å½“å‰è¡Œå­—æ¯çš„å¤§å°å†™<br /><code>gUU</code> å°†å½“å‰è¡Œçš„å­—æ¯æ”¹æˆå¤§å†™<br /><code>guu</code> å°†å½“å‰è¡Œçš„å­—æ¯å…¨æ”¹æˆå°å†™</p><p><code>3gUU</code> å°†ä»å…‰æ ‡å¼€å§‹åˆ°ä¸‹é¢3è¡Œå­—æ¯æ”¹æˆå¤§å†™<br /><code>gUw</code> å°†å…‰æ ‡ä¸‹çš„å•è¯æ”¹æˆå¤§å†™ã€‚<br /><code>guw</code> å°†å…‰æ ‡ä¸‹çš„å•è¯æ”¹æˆå°å†™</p><h2 id="æ’å…¥æ¨¡å¼-2"><a class="markdownIt-Anchor" href="#æ’å…¥æ¨¡å¼-2"></a> æ’å…¥æ¨¡å¼</h2><p>è¯·è®°ä½ä¸‹é¢å‡ ä¸ªå¸¸ç”¨å¯åŠ¨å½•å…¥æ–‡æœ¬çš„é”®ç›˜å­—ç¬¦ <code>i,I,a,A,o,O,s,S</code> ã€‚</p><p><code>i</code>æ˜¯åœ¨å…‰æ ‡æ‰€åœ¨çš„å­—ç¬¦ä¹‹å‰æ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><p><code>I</code> æ˜¯åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œé¦–æ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><p><code>a</code> æ˜¯åœ¨å…‰æ ‡æ‰€åœ¨çš„å­—ç¬¦ä¹‹åæ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><p><code>A</code> æ˜¯åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œå°¾æ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><p><code>o</code> æ˜¯å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹ä¸€è¡Œè¡Œé¦–æ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><p><code>O</code> æ˜¯å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸Šä¸€è¡Œè¡Œé¦–æ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><p><code>s</code> åˆ é™¤å…‰æ ‡æ‰€åœ¨å¤„çš„å­—ç¬¦ç„¶åæ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><p><code>S</code> åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œï¼Œåœ¨å½“å‰è¡Œçš„è¡Œé¦–å¼€å§‹æ’å…¥éœ€è¦å½•å…¥çš„æ–‡æœ¬ã€‚</p><h2 id="å‘½ä»¤æ¨¡å¼-2"><a class="markdownIt-Anchor" href="#å‘½ä»¤æ¨¡å¼-2"></a> å‘½ä»¤æ¨¡å¼</h2><p>ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„å†…ç½®å‘½ä»¤</p><p><code>set nu</code>ï¼šæ’å…¥è¡Œå·</p><p><code>set nonu</code>ï¼šåˆ é™¤è¡Œå·</p><p><code>:n</code>ï¼šè·³è½¬è‡³nè¡Œ</p><p><code>/&#123;ç›®æ ‡å­—ç¬¦ä¸²&#125;</code>ï¼šæŸ¥æ‰¾ç›®æ ‡å­—ç¬¦ä¸²ï¼Œåœ¨æ‰§è¡Œè¯¥å‘½ä»¤åï¼ŒæŒ‰ä¸‹<code>n</code>è·³è½¬è‡³ä¸‹ä¸€ä¸ªåŒ¹é…ï¼Œ<code>N</code>è·³è½¬è‡³ä¸Šä¸€ä¸ªåŒ¹é…</p><p><code>:n1,n2d</code>ï¼šåˆ é™¤<code>n1~n2</code>èŒƒå›´å†…çš„è¡Œ</p><p><code>:&#123;ä½œç”¨èŒƒå›´&#125;s/&#123;ç›®æ ‡&#125;/&#123;æ›¿æ¢&#125;/&#123;æ›¿æ¢çš„æ ‡å¿—&#125;</code>ï¼šè¿™æ˜¯æ›¿æ¢å‘½ä»¤çš„æ ¼å¼</p><p><code>:s/&#123;target&#125;/&#123;replace&#125;/g</code>ï¼šæ›¿æ¢å½“å‰è¡Œæ‰€æœ‰çš„ç›®æ ‡å­—ç¬¦ä¸²</p><p><code>:%s/&#123;target&#125;/&#123;replace&#125;/g</code>ï¼šæ›¿æ¢å…¨å±€çš„åŒ¹é…å­—ç¬¦ä¸²</p><p><code>:s/&#123;target&#125;/&#123;replace&#125;</code>ï¼šåªæ›¿æ¢å½“å‰è¡ŒåŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªç›®æ ‡å­—ç¬¦ä¸²</p><p><code>:%s/&#123;target&#125;/&#123;replace&#125;</code>ï¼šæ›¿æ¢å…¨å±€æ¯ä¸€ä¸ªçš„ç¬¬ä¸€ä¸ªåŒ¹é…å­—ç¬¦ä¸²ï¼ˆä¸æ˜¯å…¨å±€çš„ç¬¬ä¸€ä¸ªï¼‰</p><p><code>:n1,n2s/&#123;target&#125;/&#123;replace&#125;/g</code>ï¼šæ›¿æ¢<code>n1~n2</code>èŒƒå›´å†…çš„åŒ¹é…å­—ç¬¦ä¸²</p><p><code>:'&lt;,'&gt;s/&#123;target&#125;/&#123;replace&#125;/g</code>ï¼šåœ¨å¯è§†æ¨¡å¼ä¸‹ï¼Œåœ¨æˆ‘ä»¬é€‰æ‹©ä¸­åŒºåŸŸä»¥åç›´æ¥æŒ‰ä¸‹<code>:</code>ä¼šè¡¥å…¨ä¸º<code>:'&lt;,'&gt;</code>ï¼Œä¼šæ›¿æ¢é€‰ä¸­åŒºåŸŸçš„åŒ¹é…å­—ç¬¦ä¸²</p><p><code>:!command</code>ï¼šåœ¨å‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡ŒLinuxå‘½ä»¤</p><p><code>:r !command</code>ï¼šå°†å‘½ä»¤çš„æ‰§è¡Œç»“æœå†™å…¥åˆ°å…‰æ ‡ä½ç½®</p><h2 id="å¯è§†æ¨¡å¼-2"><a class="markdownIt-Anchor" href="#å¯è§†æ¨¡å¼-2"></a> å¯è§†æ¨¡å¼</h2><p>åœ¨å¯è§†æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>hjkl</code>ä¸Šä¸‹å·¦å³ç§»åŠ¨åŒºåŸŸï¼Œè¿™ä¸æ­£å¸¸æ¨¡å¼ä¸€è‡´ã€‚</p><p><code>h</code>ï¼šå·¦</p><p><code>j</code>ï¼šä¸‹</p><p><code>k</code>ï¼šä¸Š</p><p><code>l</code>ï¼šå³</p><p>åœ¨é€‰å¥½åŒºåŸŸåï¼Œæˆ‘ä»¬å¯ä»¥é€€å‡ºå¯è§†æ¨¡å¼è¿›è¡Œå¤åˆ¶ï¼Œåˆ é™¤ç­‰æ“ä½œã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºriscv32ç¯å¢ƒ</title>
      <link href="/2023/06/03/%E6%90%AD%E5%BB%BAriscv32%E7%8E%AF%E5%A2%83/"/>
      <url>/2023/06/03/%E6%90%AD%E5%BB%BAriscv32%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>hduç»™æˆ‘ä»¬æä¾›çš„è™šæ‹Ÿæœºéå¸¸åºå¤§ï¼Œè€Œä¸”æ”¾åœ¨ç™¾åº¦ç½‘ç›˜ä¸ŠğŸ˜‹ï¼Œæå¤§çš„å ç”¨äº†æˆ‘ä»¬çš„æ—¶é—´ï¼Œé‡‘é’±è¿˜æœ‰æœ¬åœ°ç©ºé—´ï¼Œè™½ç„¶ä¸æ¸…æ¥šå­¦æ ¡çš„è™šæ‹Ÿæœºåˆ°åº•æä¾›äº†å¤šå°‘ä¸œè¥¿ï¼Œä½†å®é™…ä¸Šriscv32æ‰€éœ€çš„ç¯å¢ƒå¹¶ä¸ç®—å¤ªå¤šï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆä¸åœ¨æœ¬åœ°è‡ªå·±æ­å»ºä¸€ä¸ªå‘¢ï¼Ÿ</p><p>ä»¥ä¸‹æ“ä½œå‡åœ¨<code>ubuntu 22.04</code>ä¸‹æ‰§è¡Œã€‚</p><p>è¦æ­å»ºç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦ç¼–è¯‘riscv32çš„ç¯å¢ƒå’Œè¿è¡Œriscv32çš„ç¯å¢ƒï¼Œä¸‹é¢æˆ‘ä»¬å°±åˆ†ä¸¤ä¸ªéƒ¨åˆ†æ¥æ­å»ºç¯å¢ƒã€‚</p><h1 id="riscv-gnu-tool"><a class="markdownIt-Anchor" href="#riscv-gnu-tool"></a> riscv-gnu-tool</h1><p>åœ¨å®éªŒä¸­æˆ‘ä»¬éœ€è¦riscv32çš„æ±‡ç¼–ï¼Œåæ±‡ç¼–ç­‰æ“ä½œï¼Œè¿™ä¸€éƒ¨åˆ†çš„ç¯å¢ƒç”±riscv-gnu-toolæä¾›ï¼Œè¿™ä¸€éƒ¨åˆ†çš„å·¥å…·æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸‹è½½ã€‚</p><p><a href="https://github.com/riscv-collab/riscv-gnu-toolchain/releases/tag/2023.06.02">https://github.com/riscv-collab/riscv-gnu-toolchain/releases/tag/2023.06.02</a></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230603132556554.png" alt="image-20230603132556554" /></p><p>ä¸‹è½½è§£å‹åå³å¯</p><h1 id="qemuæ¨¡æ‹Ÿå™¨"><a class="markdownIt-Anchor" href="#qemuæ¨¡æ‹Ÿå™¨"></a> qemuæ¨¡æ‹Ÿå™¨</h1><p>æˆ‘ä»¬é€šè¿‡qemuæ¥æä¾›riscv32çš„è¿è¡Œç¯å¢ƒï¼Œé¦–å…ˆæˆ‘ä»¬ä¸‹è½½qemuçš„æºä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget https://download.qemu.org/qemu-8.0.2.tar.xz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar xvJf qemu-8.0.2.tar.xz</span></span><br></pre></td></tr></table></figure><p>ä¸‹è½½ä¸€äº›ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev \</span><br><span class="line">                 gawk build-essential bison flex texinfo gperf libtool patchutils bc \</span><br><span class="line">                 zlib1g-dev libexpat-dev git \</span><br><span class="line">                 libglib2.0-dev libfdt-dev libpixman-1-dev \</span><br><span class="line">                 libncurses5-dev libncursesw5-dev</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªbuildè¾“å‡ºç›®å½•ï¼Œæœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶ä¼šæ”¾åœ¨buildç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> build</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> qemu-8.0.2</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./configure --target-list=riscv32-linux-user --prefix=<span class="variable">$&#123;buildæ‰€åœ¨ä½ç½®&#125;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make install</span></span><br></pre></td></tr></table></figure><p>ç­‰å¾…ç¼–è¯‘å®Œæˆï¼Œæˆ‘ä»¬è¿›å…¥buildç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ../build/bin</span></span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ªhello.cæµ‹è¯•æˆ‘ä»¬çš„ç¯å¢ƒ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">riscv32-unknown-elf-gcc hello.c -o hello</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./qemu-riscv32 hello</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¾“å‡ºå°±æˆåŠŸå•¦ğŸ˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> hdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> riscv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lab2-ç¼–è¯‘å†…æ ¸å¹¶æ·»åŠ ç³»ç»Ÿè°ƒç”¨</title>
      <link href="/2023/06/02/lab2-%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8%E5%B9%B6%E6%B7%BB%E5%8A%A0%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/"/>
      <url>/2023/06/02/lab2-%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8%E5%B9%B6%E6%B7%BB%E5%8A%A0%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç°é…ç½®å¥½åŸºæœ¬çš„ç¯å¢ƒï¼Œè¯·ä½ å…ˆå®Œæˆä¸‹é¢åšå®¢ä¸­çš„qemuå’Œbusyboxéƒ¨åˆ†</p><a href="/2023/06/02/%E7%BC%96%E8%AF%91x86_64%20linux%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%9C%A8qemu%E4%B8%8A/" title="ç¼–è¯‘x86_64 linuxå¹¶è¿è¡Œåœ¨qemuä¸Š">ç¼–è¯‘x86_64 linuxå¹¶è¿è¡Œåœ¨qemuä¸Š</a><p>å› ä¸ºå†…æ ¸éœ€è¦æ·»åŠ ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°ç¼–è¯‘ã€‚</p><p>æœ¬å®éªŒå‡åœ¨<code>ubuntu 22.04</code>ä¸‹è¿›è¡Œï¼Œç¼–è¯‘çš„å†…æ ¸ç‰ˆæœ¬æ˜¯<code>5.19</code>ï¼ˆä½ç‰ˆæœ¬å†…æ ¸ä¼šåœ¨æ·»åŠ ç³»ç»Ÿè°ƒç”¨æ—¶ç•¥æœ‰ä¸åŒï¼‰ã€‚</p><h1 id="æ·»åŠ ç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#æ·»åŠ ç³»ç»Ÿè°ƒç”¨"></a> æ·»åŠ ç³»ç»Ÿè°ƒç”¨</h1><ol><li></li></ol><p><code>linux-5.19/arch/x86/entry/syscalls/syscall_64.tbl</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602230645731.png" alt="image-20230602230645731" /></p><p>æ·»åŠ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">33564mysetnicesys_mysetnice</span><br></pre></td></tr></table></figure><ol start="2"><li></li></ol><p><code>linux-5.19/include/linux/syscalls.h</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602231000337.png" alt="image-20230602231000337" /></p><p>æ·»åŠ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asmlinkage <span class="type">long</span> <span class="title function_">sys_mysetnice</span><span class="params">(<span class="type">pid_t</span> pid, <span class="type">int</span> flag, <span class="type">int</span> nicevaluse, <span class="type">void</span> __user* prio, <span class="type">void</span> __user* nice)</span>;</span><br></pre></td></tr></table></figure><ol start="3"><li></li></ol><p><code>linux-5.19/kernel/sys.c</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602231154502.png" alt="image-20230602231154502" /></p><p>åœ¨æœ€åä¸€ä¸ª<code>#endif</code>å‰åŠ ä¸Šä¸‹é¢çš„ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç½®äºsys.cçš„æœ€æœ«ç«¯ï¼ˆåœ¨â€˜#endifâ€™ä¹‹å‰</span></span><br><span class="line">SYSCALL_DEFINE5(mysetnice, <span class="type">pid_t</span>, pid, <span class="type">int</span>, flag, <span class="type">int</span>, nicevalue, <span class="type">void</span> __user *,</span><br><span class="line">prio, <span class="type">void</span> __user *, nice) &#123;</span><br><span class="line">    <span class="type">int</span> cur_prio, cur_nice;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pid</span> *<span class="title">ppid</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">pcb</span>;</span></span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡è¿›ç¨‹PIDå·æ‰¾åˆ°è¿›ç¨‹çš„PIDç»“æ„ä½“ï¼Œå¦‚æœppidä¸ºç©ºæŒ‡é’ˆåˆ™ä»£è¡¨ä¸å­˜åœ¨ä¸è¿›ç¨‹å·ä¸pidç›¸åŒçš„è¿›ç¨‹ï¼Œæ­¤æ—¶è¿”å›EFAULTï¼ˆ</span></span><br><span class="line">    <span class="comment">// æˆ‘ç¼–è¯‘çš„æ—¶å€™è¿™ä¸ªifåˆ¤æ–­å¹¶æ²¡æœ‰åŠ è¿›å»ï¼Œæƒ³åšå‡ºä¸Šè¿°åˆ¤æ–­çš„å¯ä»¥å°†æ³¨é‡Šåˆ å»ï¼Œå°±é€»è¾‘æœ¬èº«è€Œè¨€æ²¡æœ‰é—®é¢˜-_-</span></span><br><span class="line">    <span class="comment">// ä½†æˆ‘æ— æ³•ä¿è¯æœ€åæ˜¯å¦ä¼šå‡ºé—®é¢˜ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰è‡ªå·±å°è¯•è¿‡</span></span><br><span class="line">    ppid = find_get_pid(pid);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    if (ppid == NULL)</span></span><br><span class="line"><span class="comment">        return EFAULT;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡è¿›ç¨‹çš„PIDç»“æ„ä½“ï¼Œæ‰¾åˆ°ä¸ä¹‹å¯¹åº”çš„è¿›ç¨‹æ§åˆ¶å—</span></span><br><span class="line">    pcb = pid_task(ppid, PIDTYPE_PID);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœflag=1åˆ™ä¿®æ”¹è¿›ç¨‹çš„niceå€¼ä¸ºnicevalue</span></span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">1</span>) &#123;</span><br><span class="line">    set_user_nice(pcb, nicevalue);</span><br><span class="line">    &#125;  <span class="comment">// flagæ—¢ä¸ä¸º1ä¹Ÿä¸ä¸º0çš„æ—¶å€™ï¼Œå³flagå‡ºé”™ï¼Œæ­¤æ—¶è¿”å›EFAULT</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (flag != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> EFAULT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è¿›ç¨‹å½“å‰çš„æœ€æ–°niceå€¼å’Œprioå€¼</span></span><br><span class="line">    cur_prio = task_prio(pcb);</span><br><span class="line">    cur_nice = task_nice(pcb);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”±äºç³»ç»Ÿè°ƒç”¨æ˜¯åœ¨å†…æ ¸æ€ä¸‹è¿è¡Œçš„ï¼Œæ‰€æœ‰æ•°æ®å‡ä¸ºå†…æ ¸ç©ºé—´çš„æ•°æ®ï¼Œ</span></span><br><span class="line">    <span class="comment">// åˆ©ç”¨copy_to_user()å‡½æ•°å°†å†…æ ¸ç©ºé—´çš„æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´</span></span><br><span class="line">    res = copy_to_user(prio, &amp;cur_prio, <span class="keyword">sizeof</span>(cur_prio));</span><br><span class="line">    res = copy_to_user(nice, &amp;cur_nice, <span class="keyword">sizeof</span>(cur_nice));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¼–è¯‘å†…æ ¸"><a class="markdownIt-Anchor" href="#ç¼–è¯‘å†…æ ¸"></a> ç¼–è¯‘å†…æ ¸</h1><p>å†…æ ¸çš„ç¼–è¯‘æ­¥éª¤ä¸<a href="/2023/06/02/%E7%BC%96%E8%AF%91x86_64%20linux%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%9C%A8qemu%E4%B8%8A/" title="ç¼–è¯‘x86_64 linuxå¹¶è¿è¡Œåœ¨qemuä¸Š">ç¼–è¯‘x86_64 linuxå¹¶è¿è¡Œåœ¨qemuä¸Š</a>çš„ç¼–è¯‘æ­¥éª¤ç›¸åŒï¼Œä¸äºˆä»‹ç»ã€‚</p><h1 id="æµ‹è¯•æ·»åŠ çš„ç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#æµ‹è¯•æ·»åŠ çš„ç³»ç»Ÿè°ƒç”¨"></a> æµ‹è¯•æ·»åŠ çš„ç³»ç»Ÿè°ƒç”¨</h1><p>qemuè¯·åŠ¡å¿…ä½¿ç”¨å¸¦åŠ¨æ€é“¾æ¥åº“çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> mount rootfs-lib.img rootfs-lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> rootfs-lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> vim sys-demo.c</span></span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;unistd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys/syscall.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SYSCALL_MYSETNICE_ 335</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFALUT 14</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> pid, flag, nicevalue;</span><br><span class="line">    <span class="type">int</span> prev_prio, prev_nice, cur_prio, cur_nice;</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please input variable(pid, flag, nicevalue): &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;pid, &amp;flag, &amp;nicevalue);</span><br><span class="line">    </span><br><span class="line">    result = syscall(_SYSCALL_MYSETNICE_, pid, <span class="number">0</span>, nicevalue, &amp;prev_prio,</span><br><span class="line">                     &amp;prev_nice);</span><br><span class="line">    <span class="keyword">if</span> (result == EFALUT)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        syscall(_SYSCALL_MYSETNICE_, pid, <span class="number">1</span>, nicevalue, &amp;cur_prio, &amp;cur_nice);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Original priority is: [%d], original nice is [%d]\n&quot;</span>, prev_prio,</span><br><span class="line">               prev_nice);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Current priority is : [%d], current nice is [%d]\n&quot;</span>, cur_prio,</span><br><span class="line">               cur_nice);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (flag == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Current priority is : [%d], current nice is [%d]\n&quot;</span>, prev_prio,</span><br><span class="line">               prev_nice);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> gcc sys-demo.c -o sys-demo</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">qemu-system-x86_64 -kernel linux-5.19/arch/x86/boot/bzImage -boot c -m 2048M -hda rootfs-lib.img -append <span class="string">&quot;root=/dev/sda rw console=ttyS0,115200 acpi=off nokaslr&quot;</span> -serial stdio -display none</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨qemuä¹‹åå¯åŠ¨<code>sys-demo</code>å³å¯</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602232324866.png" alt="image-20230602232324866" /></p>]]></content>
      
      
      <categories>
          
          <category> hdu-os-lab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–è¯‘x86_64 linuxå¹¶è¿è¡Œåœ¨qemuä¸Š</title>
      <link href="/2023/06/02/%E7%BC%96%E8%AF%91x86_64%20linux%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%9C%A8qemu%E4%B8%8A/"/>
      <url>/2023/06/02/%E7%BC%96%E8%AF%91x86_64%20linux%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%9C%A8qemu%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<p>æœ¬èŠ‚å†…å®¹å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•è‡ªå·±ç¼–è¯‘å†…æ ¸å¹¶ä¸”å°†è¿™ä¸ªå†…æ ¸è¿è¡Œåœ¨qemuæ¨¡æ‹Ÿå™¨ä¸Šã€‚åœ¨æˆåŠŸè¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±çš„ä¿®æ”¹å¹¶éªŒè¯æˆ‘ä»¬çš„å†…æ ¸ï¼Œä»¥ä¸‹æ“ä½œå‡åœ¨<code>Ubntun 22.04</code>ä¸‹å®Œæˆã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬æœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„ä¸œè¥¿ï¼š</p><ol><li>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šé‡åˆ°å„ç§å„æ ·çš„ç¯å¢ƒé—®é¢˜ï¼Œé€ æˆçš„åŸå› å¯èƒ½æ˜¯å¤šæ ·çš„ï¼Œå°¤å…¶æ˜¯åœ¨é‡åˆ°è¿™æ ·æ¯”è¾ƒå¤æ‚çš„ä»»åŠ¡æ—¶ï¼Œæ‰€ä»¥ä½ ç°åœ¨æœ€å¥½å°±åšå¥½é•¿æ—¶é—´ä½œæˆ˜çš„å¿ƒç†å‡†å¤‡ï¼Œ<code>æ›´é‡è¦çš„æ˜¯ä¼šè‡ªå·±ä½¿ç”¨æœç´¢å¼•æ“</code>ï¼ˆè¿˜åœ¨ç”¨baiduçš„èµ¶ç´§åŸ‹äº†ğŸ˜­ï¼‰ï¼Œä¸è¦æƒ³ç€è·Ÿç€åšå°±èƒ½è§£å†³é—®é¢˜ï¼Œä¸‹é¢æˆ‘åˆ—å‡ºäº†ä¸€äº›é«˜é¢‘çš„ç¯å¢ƒé—®é¢˜ï¼Œå½“ä½ é‡åˆ°é—®é¢˜æ—¶å¯ä»¥å›å¤´è¿‡æ¥çœ‹çœ‹ï¼š<ul><li>å½“ä½ åœ¨ç¼–è¯‘å†…æ ¸æ—¶å‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œå¤§æ¦‚ç‡æ˜¯ç¼ºå°‘æŸä¸ªåŒ…ï¼Œè¿™ä¸ªæ—¶å€™å»ç½‘ä¸Šæœç´¢ï¼Œå®‰è£…å¯¹åº”çš„åŒ…ä¸€èˆ¬å°±èƒ½è§£å†³é—®é¢˜äº†ã€‚</li><li>ç²—å¿ƒå¯¼è‡´çš„é”™è¯¯ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼Œä½ ææœ‰å¯èƒ½åœ¨æŸä¸€æ­¥è¾“é”™äº†å†…å®¹è€Œå¯¼è‡´æ•´ä¸ªå†…å®¹çš„å´©åï¼Œè¿™ä¸ªä¸€èˆ¬éš¾ä»¥æ£€æŸ¥ï¼Œåªèƒ½æ›´åŠ ç»†å¿ƒï¼Œå°½é‡ä½¿ç”¨å¤åˆ¶è€Œä¸æ˜¯è‡ªå·±è¾“å…¥ã€‚</li><li>â€¦</li></ul></li><li>ä¸è¦å®Œå…¨ç›¸ä¿¡æ•™ç¨‹ï¼Œä¸€æ–¹é¢æ˜¯æ•™ç¨‹æœ¬èº«çš„é—®é¢˜ï¼Œä¸€æ–¹é¢æ˜¯æˆ‘ä»¬çš„ç¯å¢ƒå¹¶ä¸å®Œå…¨ç›¸åŒã€‚</li></ol><p>ä¸ºäº†å®Œæˆæˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦ç¼–è¯‘å®Œæˆä¸‰ä¸ªé¡¹ç›®ï¼š</p><ol><li>linuxï¼šæä¾›å†…æ ¸</li><li>qemuï¼šæä¾›æ¨¡æ‹Ÿç¯å¢ƒ</li><li>busyboxï¼šæä¾›æ ¹æ–‡ä»¶ç³»ç»Ÿå’Œä¸€äº›åŸºæœ¬çš„ç³»ç»Ÿå·¥å…·</li></ol><p>ä¸‹é¢æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥</p><h1 id="linux"><a class="markdownIt-Anchor" href="#linux"></a> linux</h1><p>æˆ‘ä»¬å»ä¸‹é¢è¿™ä¸ªç½‘ç«™ä¸‹è½½linuxæºç </p><p><a href="https://github.com/torvalds/linux">https://github.com/torvalds/linux</a></p><p>ä¸ºäº†ä½¿é‡åˆ°ç¯å¢ƒé—®é¢˜çš„å¯èƒ½æ€§å°½å¯èƒ½å°ï¼Œæˆ‘ä»¬ä¸‹è½½ä¸æˆ‘ä»¬å½“å‰ç³»ç»Ÿç‰ˆæœ¬ç›¸ä¼¼çš„å†…æ ¸ï¼Œç”¨<code>uname -r</code>æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602153004363.png" alt="image-20230602153004363" /></p><p>å¯ä»¥çœ‹åˆ°æˆ‘çš„linuxå†…æ ¸ç‰ˆæœ¬æ˜¯5.19ï¼Œæˆ‘ä»¬é€‰æ‹©å’Œå’Œè‡ªå·±å†…æ ¸ç‰ˆæœ¬ç›¸åŒçš„linuxæºç ï¼Œé€‰æ‹©tagä»¥åä¸‹è½½</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602153140796.png" alt="image-20230602153140796" /></p><p>æˆ‘ä»¬å…ˆå®‰è£…ä¸€äº›ä¼šç”¨åˆ°çš„åŒ…ï¼ˆå¤§æ¦‚ç‡æ˜¯ä¸å¤Ÿçš„ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev \</span></span><br><span class="line"><span class="language-bash">                 gawk build-essential bison flex texinfo gperf libtool patchutils bc \</span></span><br><span class="line"><span class="language-bash">                 zlib1g-dev libexpat-dev git \</span></span><br><span class="line"><span class="language-bash">                 libglib2.0-dev libfdt-dev libpixman-1-dev \</span></span><br><span class="line"><span class="language-bash">                 libncurses5-dev libncursesw5-dev libelf-dev</span></span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæ€»æ–‡ä»¶å¤¹ï¼Œåå­—å¯ä»¥éšæ„ï¼Œæˆ‘è¿™é‡Œå°±å«<code>hdu-os-lab</code>äº†ï¼Œæˆ‘ä»¬å°†linuxæºç è§£å‹åˆ°æ€»æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åè¿›å…¥linuxæ–‡ä»¶å¤¹ï¼Œå¼€å§‹ç¼–è¯‘ã€‚</p><p>ç¬¬ä¸€æ­¥åˆ›å»ºx64é»˜è®¤çš„é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make ARCH=x86_64 x86_64_defconfig</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602153618577.png" alt="image-20230602153618577" /></p><p>ç¬¬äºŒæ­¥è¿›è¡Œè¿›ä¸€æ­¥é…ç½®ï¼Œé»˜è®¤å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make ARCH=x86_64 menuconfig</span></span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ°è¿™ä¸ªé¡µé¢å<code>Save</code>ç„¶å<code>Exit</code>å³å¯ï¼Œå¦‚æœå‡ºç°æŠ¥é”™å¤§æ¦‚ç‡æ˜¯ä½ çš„ç»ˆç«¯å¤ªå°äº†ï¼ˆç‰©ç†ï¼‰ï¼Œä¸è¶³ä»¥å®¹çº³é…ç½®é¡µé¢ï¼Œå°†ä½ çš„ç»ˆç«¯æ‹‰å¤§ä¸€ç‚¹å°±è¡Œäº†ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602153843373.png" alt="image-20230602153843373" /></p><p>ç¬¬ä¸‰éƒ¨æ­£å¼å¼€å§‹ç¼–è¯‘ï¼Œè¿™ä¸€éƒ¨æ—¶é—´ç•¥ä¹…ï¼Œ5-10åˆ†é’Ÿå·¦å³ï¼ˆä½œè€…æœºå­ä¸Šï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make bzImage -j$(nproc) # -j è¡¨ç¤ºå¼€å¯å¤šçº¿ç¨‹ç¼–è¯‘ï¼Œnprocæ˜¯cpuçš„æ•°é‡</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602163737358.png" alt="image-20230602163737358" /></p><p>æ˜¾ç¤º<code>ready</code>å†…æ ¸å°±ç¼–è¯‘å¥½äº†</p><h1 id="qemu"><a class="markdownIt-Anchor" href="#qemu"></a> qemu</h1><p>qemuçš„éƒ¨åˆ†æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç”¨åŒ…ç®¡ç†å·¥å…·ç›´æ¥å®‰è£…ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯è‡ªå·±ç¼–è¯‘ï¼Œåœ¨æœ¬æ–‡é‡‡ç”¨äº†åè€…ï¼Œè¿™é‡Œè¿˜æ˜¯æ¨èå¤§å®¶ä½¿ç”¨å‰è€…ã€‚</p><h2 id="ç›´æ¥å®‰è£…"><a class="markdownIt-Anchor" href="#ç›´æ¥å®‰è£…"></a> ç›´æ¥å®‰è£…</h2><ul><li><strong>Arch:</strong> <code>pacman -S qemu</code></li><li><strong>Debian/Ubuntu:</strong> <code>apt-get install qemu</code></li><li><strong>Fedora:</strong> <code>dnf install @virtualization</code></li><li><strong>Gentoo:</strong> <code>emerge --ask app-emulation/qemu</code></li><li><strong>RHEL/CentOS:</strong> <code>yum install qemu-kvm</code></li><li><strong>SUSE:</strong> <code>zypper install qemu</code></li></ul><h2 id="è‡ªå·±ç¼–è¯‘"><a class="markdownIt-Anchor" href="#è‡ªå·±ç¼–è¯‘"></a> è‡ªå·±ç¼–è¯‘</h2><p>ä¸‹è½½æºç ï¼Œåœ¨æœ¬æ–‡ä¸­ä½¿ç”¨äº†<code>8.0.0</code>ç‰ˆæœ¬</p><p><a href="https://www.qemu.org/download/#source">https://www.qemu.org/download/#source</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> qemu-x64</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ../qemu-8.0.0</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./configure --target-list=x86_64-softmmu --prefix=<span class="variable">$&#123;qemu-x64æ‰€åœ¨ç›®å½•&#125;</span> <span class="comment"># å¯æ‰§è¡Œæ–‡ä»¶æœ€åä¼šè¢«æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹é¢</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make install</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯æ¯ä¸ªæ­¥éª¤æˆåŠŸçš„æˆªå›¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./configure --target-list=x86_64-softmmu --prefix=<span class="variable">$&#123;qemu-x64æ‰€åœ¨ç›®å½•&#125;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602185718930.png" alt="image-20230602185718930" /></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602190638011.png" alt="image-20230602190638011" /></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make install</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602190805645.png" alt="image-20230602190805645" /></p><p>ç„¶åæŠŠ<code>qemu-x64ä¸‹çš„binç›®å½•</code>å¯¼å‡ºï¼ˆexportå¯¼å‡ºçš„ç¯å¢ƒå˜é‡åªåœ¨å½“å‰shellæœ‰æ•ˆï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠç¯å¢ƒå˜é‡å†™åˆ°<code>.bashrc</code>æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;$PATH:&#123;qemu-x64çš„binç›®å½•&#125;&quot;</span><br></pre></td></tr></table></figure><h1 id="busybox"><a class="markdownIt-Anchor" href="#busybox"></a> busybox</h1><p>åˆ°äº†ç°åœ¨ä¸çŸ¥é“ä½ æ˜¯ä¸æ˜¯å·²ç»ç»å†äº†å¾ˆå¤šæŠ˜ç£¨ğŸ˜‡ï¼Œå†åšæŒåšæŒï¼Œè¿™é‡Œæ˜¯æœ€åä¸€ä¸ªéƒ¨åˆ†äº†ã€‚</p><p>æºç ï¼š</p><p><a href="https://github.com/mirror/busybox">https://github.com/mirror/busybox</a></p><p>ä¸‹è½½å®Œåè¿›å…¥ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make menuconfig</span></span><br></pre></td></tr></table></figure><p><code>Settings -&gt; Build Options -&gt; Build static binary (no shared libs)</code></p><p>ï¼ˆæŒ‰ç©ºæ ¼é€‰æ‹©ï¼ŒæŒ‰å›è½¦è¿›å…¥ï¼‰</p><p>é€‰å®Œ<code>Exit</code>ç„¶åä¿å­˜å³å¯</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602192335841.png" alt="image-20230602192335841" /></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make install</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602192540669.png" alt="image-20230602192540669" /></p><p>å¥½äº†ï¼Œåˆ°ç›®å‰ä¸‰ä¸ªéƒ¨åˆ†çš„ç¼–è¯‘å°±å¤§åŠŸå‘Šæˆäº†!</p><h1 id="åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿ"></a> åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿ</h1><p>æŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœæƒ³è¦åœ¨ç³»ç»Ÿä¸­åŒ…å«åŠ¨æ€åº“ï¼Œè¿™é‡Œè¦éœ€è¦æ”¹ä¸º2g</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">qemu-img create rootfs.img  1g</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mkfs.ext4 rootfs.img</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> rootfs</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> mount -o loop rootfs.img  rootfs</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> rootfs</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">cp</span> -r ../busybox/_install/* .</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> proc sys dev etc etc/init.d</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> etc/init.d/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">touch</span> rcS</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> vi rcS</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rcS çš„å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line">---------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">mount -t proc none /proc</span><br><span class="line">mount -t sysfs none /sys</span><br><span class="line">/sbin/mdev -s</span><br><span class="line">---------------------</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x rcS</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ../../../</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> umount rootfs</span></span><br></pre></td></tr></table></figure><h1 id="å¯åŠ¨x86_64-qemuæ¨¡æ‹Ÿå™¨"><a class="markdownIt-Anchor" href="#å¯åŠ¨x86_64-qemuæ¨¡æ‹Ÿå™¨"></a> å¯åŠ¨x86_64 qemuæ¨¡æ‹Ÿå™¨</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">qemu-system-x86_64 -kernel linux-5.19/arch/x86/boot/bzImage -boot c -m 2048M -hda rootfs.img -append <span class="string">&quot;root=/dev/sda rw console=ttyS0,115200 acpi=off nokaslr&quot;</span> -serial stdio -display none</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602194750613.png" alt="image-20230602194750613" /></p><p>å¦‚æœåˆ°äº†è¿™é‡Œï¼Œæˆ‘ç»ˆäºå¯ä»¥æ­å–œä½ æˆåŠŸè¾£ğŸ˜</p><h1 id="ä½“éªŒx86_64ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#ä½“éªŒx86_64ç¯å¢ƒ"></a> ä½“éªŒx86_64ç¯å¢ƒ</h1><p>ï¼ˆå…¶å®æ²¡ä»€ä¹ˆå¯ä½“éªŒçš„ï¼Œå› ä¸ºæœ¬æœºå°±æ˜¯x64ğŸ˜•ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> mount rootfs.img rootfs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥åˆ°rootfsç¼–å†™hello.c</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> vim hello.c</span></span><br><span class="line">---</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    printf(&quot;Hello World!&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">---</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨é™æ€ç¼–è¯‘ï¼Œå› ä¸ºæˆ‘ä»¬åˆ›å»ºçš„ç³»ç»Ÿä¸­æ²¡æœ‰å¤åˆ¶åŠ¨æ€åº“</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> gcc -static hello.c -o static-hello</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ‘ä»¬å¯åŠ¨æˆ‘ä»¬çš„qemuæ¨¡æ‹Ÿå™¨</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./static-hello</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602203056031.png" alt="image-20230602203056031" /></p><p>å¦‚æœä½ æƒ³è¦è¿è¡ŒåŠ¨æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆéœ€è¦ä½ å¤åˆ¶å¿…é¡»çš„åŠ¨æ€åº“ï¼Œå¦‚æœä½ å‰é¢åˆ›å»ºçš„æ˜¯2gçš„æ˜ åƒï¼Œç›´æ¥å¤åˆ¶åŠ¨æ€åº“å³å¯ï¼Œä¸‹é¢æˆ‘å‡è®¾ä½ åˆ›å»ºçš„æ˜¯1gçš„æ˜ åƒï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„æ˜ åƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">qemu-img create rootfs-lib.img 2g</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mkfs.ext4 rootfs-lib.img</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> rootfs-lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> mount rootfs-lib.img rootfs-lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> mount rootfs.img rootfs</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">cp</span> -r rootfs/* rootfs-lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> rootfs-lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> lib lib64</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">cp</span> -r /lib/x86_64-linux-gnu lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">cp</span> /lib64/ld-linux-x86-64.so.2 lib64/ld-linux-x86-64.so.2</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> gcc hello.c -o hello</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> umount rootfs-lib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> umount rootfs</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">qemu-system-x86_64 -kernel linux-5.19/arch/x86/boot/bzImage -boot c -m 2048M -hda rootfs-lib.img -append <span class="string">&quot;root=/dev/sda rw console=ttyS0,115200 acpi=off nokaslr&quot;</span> -serial stdio -display none</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/linux/image-20230602210005168.png" alt="image-20230602210005168" /></p><p>å®Œç»“æ’’èŠ±ğŸŒ¸</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> qemu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨uç›˜ä¸­å®‰è£…ubuntu</title>
      <link href="/2023/06/01/%E5%9C%A8u%E7%9B%98%E4%B8%AD%E5%AE%89%E8%A3%85ubuntu/"/>
      <url>/2023/06/01/%E5%9C%A8u%E7%9B%98%E4%B8%AD%E5%AE%89%E8%A3%85ubuntu/</url>
      
        <content type="html"><![CDATA[<p>ä½ æ˜¯å¦å› ä¸ºç»å¸¸ä½¿ç”¨ä¸åŒçš„ç”µè„‘ï¼Œä½†æ˜¯ç¼–ç¨‹ç¯å¢ƒä¸åŒè€Œè‹¦æ¼å‘¢ï¼Œä»Šå¤©çš„æ–‡ç« ä¼šæ•™ä½ æŠŠubuntuè£…å…¥ç§»åŠ¨å›ºæ€ä¸­ï¼Œç°åœ¨SSDçš„ä»·æ ¼å·²ç»å¾ˆä¾¿å®œäº†ï¼Œè¿™é‡Œæˆ‘ä¼šç”¨1Tçš„ç§»åŠ¨å›ºæ€ä¸ºä¾‹ï¼Œæ•™ä¼šä½ å¦‚ä½•å°†ubuntuè£…å…¥ç§»åŠ¨å…¶ä¸­ï¼ˆåŒæ—¶æ”¯æŒUEFIå’ŒBIOSï¼‰ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæœ‰å‡ ç‚¹éœ€è¦æé†’ï¼š</p><ol><li>æ“ä½œä¸å½“å¯èƒ½ä¼šå¯¼è‡´æ•°æ®æŸå¤±ï¼Œä¸¥é‡çš„æ“ä½œå¤±è¯¯ç”šè‡³å¯èƒ½ç ´åä½ çš„ç”µè„‘ï¼Œæ‰€ä»¥è¦æ…é‡æ“ä½œã€‚</li><li>æ¯ä¸€æ­¥éƒ½è¦ç»å¯èƒ½è°¨æ…çš„æ“ä½œï¼Œä¸€ä¸ªç²—å¿ƒå¯èƒ½å°±ä¼šå¯¼è‡´å‰åŠŸå°½å¼ƒã€‚</li><li>å»ºè®®æœ‰ä¸€å®šåŸºç¡€çš„äººæ¥å®Œæˆã€‚</li></ol><h1 id="ä½¿ç”¨vmware"><a class="markdownIt-Anchor" href="#ä½¿ç”¨vmware"></a> ä½¿ç”¨Vmware</h1><p>é¦–å…ˆå®‰è£…vmwareï¼Œ<a href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html</a></p><p>è™½ç„¶æ˜¯æ”¶è´¹çš„ï¼Œä½†æ˜¯ç½‘ä¸Šæ¿€æ´»ç ç®€ç›´ä¸è¦å¤ªå¤šï¼Œè¿™é‡Œè‡ªå·±æœç´¢è§£å†³ã€‚</p><p>ï¼ˆå¦‚æœä¹‹å‰æ²¡æœ‰ä½¿ç”¨è™šæ‹Ÿæœºæˆ–è€…å®‰è£…ç³»ç»Ÿçš„ç»éªŒæ¥ä¸‹æ¥æ“ä½œè¦æ›´åŠ å°å¿ƒï¼‰</p><p>åœ¨å®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€vmwareï¼ˆåœ¨å·¦ä¸‹è§’çš„æœç´¢æ ä¸­æ‰¾åˆ°vmwareï¼Œå³é”®ç‚¹å‡»åç”¨ç®¡ç†å‘˜æ‰“å¼€ï¼‰ï¼Œåˆ›å»ºè™šæ‹Ÿæœºï¼Œé™¤äº†ä¸‹é¢å‡ºç°çš„å†…å®¹ï¼Œå…¶ä»–çš„éƒ½é€‰æ‹©é»˜è®¤å³å¯ã€‚</p><ol><li>é€‰æ‹©ç¨åå®‰è£…æ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦åé¢è‡ªå®šä¹‰çš„é…ç½®</li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531205214087.png" alt="image-20230531205214087" /></p><ol start="2"><li>ä½¿ç”¨ç‰©ç†ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯uç›˜ï¼Œè¿™é‡Œä¸€å®šè¦æœ‰ç®¡ç†å‘˜æƒé™</li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531205235908.png" alt="" /></p><ol start="3"><li><p>é€‰æ‹©ç‰©ç†ç£ç›˜ï¼Œé€‰æ‹©ä½ uç›˜çš„ç›˜ç¬¦ï¼Œæ³¨æ„ï¼Œè¿™é‡Œä¸€å®šä¸è¦é€‰é”™ï¼Œä¸€èˆ¬æ˜¯æœ€åä¸€ä¸ªã€‚</p><p>å®åœ¨ä¸ç¡®å®šé€šè¿‡è¿™é‡Œçš„æ•™ç¨‹æŸ¥çœ‹<a href="https://jingyan.baidu.com/article/0f5fb09923fde06d8334ea35.html">https://jingyan.baidu.com/article/0f5fb09923fde06d8334ea35.html</a></p></li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531205330556.png" alt="image-20230531205235908" /></p><ol start="4"><li>åœ¨è™šæ‹Ÿæœºè®¾ç½®ä¸­é€‰æ‹©UEFI</li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531205417235.png" alt="" /></p><ol start="5"><li><p>é€‰æ‹©æå‰ä¸‹å¥½ç£ç›˜å°è±¡æ–‡ä»¶</p><p>ä¸‹è½½urlï¼š<a href="https://cn.ubuntu.com/">https://cn.ubuntu.com/</a></p></li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531210821564.png" alt="image-20230531210821564" /></p><ol start="6"><li>é…ç½®å¥½ä¹‹åå¯åŠ¨è™šæ‹Ÿæœºï¼Œé™é™çš„ç­‰å¾…ï¼Œé»˜è®¤æ–¹å¼å¯åŠ¨ä¹‹åé€‰æ‹©try ubuntuï¼Œæˆ‘ä»¬å…ˆä¸è¦ä¸‹è½½</li></ol><p>â€‹è¿›å…¥ubuntuä¹‹åä¸‹è½½gpartedåˆ†åŒºå·¥å…·</p><p>â€‹ï¼ˆå¦‚æœå¯åŠ¨å¤±è´¥æŠ¥é”™uç›˜è¢«å ç”¨ï¼Œå°è¯•å…³é—­å„ç±»åº”ç”¨ï¼Œé‡å¯ï¼Œæ ¼å¼åŒ–uç›˜ç­‰æ“ä½œï¼‰</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531211732495.png" alt="image-20230531211732495" /></p><ol start="7"><li>æ¥ä¸‹æ¥çš„æ“ä½œæ“ä½œä¼šæ ¼å¼åŒ–uç›˜ï¼Œè¯·ç¡®ä¿ä½ çš„uç›˜çš„é‡è¦æ–‡ä»¶éƒ½è¢«å¤‡ä»½ï¼Œåˆ›å»ºgptè¡¨</li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531212108850.png" alt="image-20230531212108850" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531212125193.png" alt="image-20230531212125193" /></p><ol start="8"><li><p>åˆ†åŒºï¼Œä¸‹é¢æ˜¯åˆ†åŒºçš„ç»“æœï¼Œæˆ‘çš„ç©ºé—´æ¯”è¾ƒå¤§ï¼Œåˆ†çš„å¥¢ä¾ˆäº†ä¸€ç‚¹ï¼Œæˆ‘è¯´æ˜ä¸€ä¸‹ä¸‹é¢çš„åˆ†åŒº</p><ul><li>/dev/sda1: ä¾ç„¶ä½œä¸ºuç›˜çš„ç©ºé—´ï¼Œä¸æƒ³è¦å½“ä½œuç›˜ä½¿ç”¨å¯ä»¥ä¸è¦</li><li>/dev/sda2: linuxä¸»è¦ç©ºé—´ï¼Œå†³å®šäº†ä½ çš„linuxæ“ä½œç³»ç»Ÿå ç”¨çš„ç©ºé—´</li><li>/dev/sda3:  efiåˆ†åŒºï¼Œ100MBä»¥ä¸Šå³å¯</li><li>/dev/sda4: äº¤æ¢ç©ºé—´ï¼Œè¿™å—åŒºåŸŸåœ¨å†…å­˜ä¸è¶³æ—¶ä¼šè¢«ç”¨ä½œè™šæ‹Ÿå†…å­˜ï¼Œå¦‚æœuç›˜ç©ºé—´å°å¯ä»¥ä¸è¦</li><li>æœ€åçš„ç©ºé—´å®‰è£…grubï¼Œé¢„ç•™1Mä»¥ä¸Šå³å¯ï¼ˆæ‰€ä»¥è¯´æˆ‘åˆ†çš„æ¯”è¾ƒéšæ„ï¼Œç©ºé—´å°çš„å°½é‡ä¸è¦æµªè´¹ï¼‰</li></ul><p>åˆ†é…å¥½ä¹‹åç¡®è®¤å³å¯</p></li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531212901951.png" alt="image-20230531212901951" /></p><ol start="9"><li><p>å®‰è£…grubï¼ŒæŒ‰é¡ºåºè¾“å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo gdisk /dev/sdb</span><br><span class="line">n</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é»˜è®¤ç¼–å·ï¼Œå›è½¦å°±è¡Œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é»˜è®¤å¼€å§‹ä½ç½®ï¼Œå›è½¦</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é»˜è®¤ç»“æŸä½ç½®ï¼Œå›è½¦</span></span><br><span class="line">EF02 # EF02 å°±æ˜¯ bios_grub</span><br><span class="line">p # çœ‹åˆ° Name æœ‰ BIOS boot partition å°±å¯ä»¥äº†</span><br><span class="line">w</span><br><span class="line">y</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531213039722.png" alt="image-20230531213039722" /></p><p>å®‰è£…ä¹‹åç»“æœå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531213104971.png" alt="image-20230531213104971" /></p><h1 id="å®‰è£…ubuntu"><a class="markdownIt-Anchor" href="#å®‰è£…ubuntu"></a> å®‰è£…ubuntu</h1><p>æ¥ä¸‹æ¥ç‚¹å‡»æ¡Œé¢ä¸Šçš„ubuntu installï¼Œåœ¨å®‰è£…ç±»å‹è¿™ä¸€æ­¥é€‰æ‹©å…¶å®ƒé€‰é¡¹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531213250935.png" alt="image-20230531213250935" /></p><p>åœ¨è¿›å…¥åˆ°å®‰è£…ç±»å‹ä¹‹åï¼Œè¦åšä¸‰ä»¶äº‹ï¼š</p><ol><li>å°†/dev/sda2æŒ‚è½½åˆ°<code>/</code>ï¼Œé€‰æ‹©æ ¼å¼åŒ–è¿™ä¸ªåˆ†åŒº</li><li>å°†/dev/sda3æ”¹ä¸ºefi</li><li>ç¡®è®¤<code>å®‰è£…å¯åŠ¨å¼•å¯¼å™¨çš„è®¾å¤‡ä¸ºä½ çš„uç›˜</code></li></ol><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/img/image-20230531213429677.png" alt="image-20230531213429677" /></p><p>å®Œæˆåç­‰å¾…ç»§ç»­å®‰è£…é»˜è®¤é…ç½®ç»§ç»­ï¼Œç­‰å¾…ubuntuå®‰è£…å³å¯ã€‚</p><p>åœ¨å®‰è£…å®Œæˆä¹‹åï¼Œä½ çš„ubuntuå°±å¯ä»¥é€šè¿‡UEFIå¯åŠ¨äº†ï¼ˆç°åœ¨çš„è®¡ç®—æœºåŸºæœ¬ä¸Šæ˜¯UEFIï¼Œæ‰€ä»¥å¦‚æœä½ ä¸æƒ³å†æŠ˜è…¾åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¿˜æ˜¯æ”¯æŒä¸€ä¸‹BIOSå¯åŠ¨ã€‚</p><h1 id="bioså¯åŠ¨"><a class="markdownIt-Anchor" href="#bioså¯åŠ¨"></a> BIOSå¯åŠ¨</h1><p>æˆ‘ä»¬å°†è™šæ‹Ÿæœºå…³é—­ï¼Œå°†å¯åŠ¨æ–¹å¼æ”¹ä¸ºBIOSï¼ˆä¸ä¸Šé¢ç›¸åŒï¼‰ï¼Œå¯åŠ¨ä¹‹åè¿˜æ˜¯é€‰æ‹©try ubuntu</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ä½ å®‰è£…linuxçš„åˆ†åŒºæŒ‚è½½ï¼ˆåœ¨æœ¬åšå®¢ä¸­æ˜¯sda2ï¼‰</span></span><br><span class="line">sudo mount /dev/sdaX /mnt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œæ˜¯ä½ uç›˜çš„åˆ†åŒº</span></span><br><span class="line">sudo grub-install --target=i386-pc --recheck --boot-directory=/mnt/boot /dev/sda</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰é”™è¯¯æŠ¥å‡ºï¼Œé‚£ä¹ˆåº”è¯¥å°±æˆåŠŸäº†ï¼Œç”¨è™šæ‹Ÿæœºå°è¯•BIOSå’ŒUEFIå¯åŠ¨çœ‹çœ‹æ˜¯ä¸æ˜¯éƒ½å¯ä»¥æ­£å¸¸å¯åŠ¨ã€‚</p><p>å¦‚æœéƒ½æ­£å¸¸å¯åŠ¨äº†ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ï¼</p><p>é‡å¯ä½ çš„è®¡ç®—æœºï¼Œé€‰æ‹©Uç›˜å¯åŠ¨å°±å¯ä»¥è¿›å…¥ä½ å®‰è£…çš„ubuntuäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> è£…æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•é˜…è¯»ä¸€æœ¬ä¹¦</title>
      <link href="/2023/01/25/%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E4%B8%80%E6%9C%AC%E4%B9%A6/"/>
      <url>/2023/01/25/%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E4%B8%80%E6%9C%AC%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<p>é˜…è¯»çš„å››ä¸ªé˜¶æ®µ</p><ol><li>åŸºç¡€é˜…è¯»</li><li>æ£€è§†é˜…è¯»</li><li>åˆ†æé˜…è¯»</li><li>ä¸»é¢˜é˜…è¯»</li></ol><p>é˜…è¯»ä¸­æˆ‘ä»¬åº”è¯¥å¯¹ä¸‹é¢å››ä¸ªé—®é¢˜æœ‰è‡ªå·±çš„ç­”æ¡ˆ</p><ol><li>æ•´ä½“æ¥è¯´ï¼Œè¿™æœ¬ä¹¦åœ¨è°ˆä»€ä¹ˆ</li><li>ä½œè€…è¯´äº†ä»€ä¹ˆï¼Œæ˜¯æ€ä¹ˆè¯´çš„</li><li>è¿™æœ¬ä¹¦è¯´çš„æœ‰é“ç†å—ï¼Œæ˜¯éƒ¨åˆ†æœ‰é“ç†è¿˜æ˜¯å…¨éƒ¨æœ‰é“ç†</li><li>è¿™æœ¬ä¹¦å’Œä½ æœ‰ä»€ä¹ˆå…³ç³»å—</li></ol><h1 id="åŸºç¡€é˜…è¯»"><a class="markdownIt-Anchor" href="#åŸºç¡€é˜…è¯»"></a> åŸºç¡€é˜…è¯»</h1><p>åŸºç¡€é˜…è¯»å°±æ˜¯æœ‰ç€é˜…è¯»çš„åŸºæœ¬èƒ½åŠ›</p><h1 id="æ£€è§†é˜…è¯»"><a class="markdownIt-Anchor" href="#æ£€è§†é˜…è¯»"></a> æ£€è§†é˜…è¯»</h1><p>ç”¨äºåˆ¤æ–­ä¸€æœ¬ä¹¦æ˜¯å¦åº”è¯¥ç²¾è¯»ï¼Œå¦‚æœåˆ¤æ–­ä¸€æœ¬ä¹¦æœ‰ç²¾è¯»çš„ä»·å€¼ï¼Œå°±ç»§ç»­é‡‡ç”¨ä¸‹é¢çš„é˜…è¯»æ–¹æ³•ã€‚</p><p>é¦–å…ˆæ•´æœ¬ä¹¦é‡‡ç”¨ç²—è¯»çš„æ–¹æ³•ï¼Œå¯¹æ•´æœ¬ä¹¦æœ‰ä¸€ä¸ªæ•´ä½“çš„äº†è§£ï¼Œç„¶åéµå¾ªä¸‹é¢6ä¸ªæ­¥éª¤</p><ol><li>äº†è§£ä¹¦ç±çš„ä¸»é¢˜</li><li>äº†è§£ä¹¦ç±æ¶æ„</li><li>äº†è§£å…³é”®è¯ç›®</li><li>äº†è§£ä½œè€…ä»‹ç»</li><li>äº†è§£ç« èŠ‚é‡ç‚¹</li><li>äº†è§£é€»è¾‘çº¿ç´¢</li></ol><p>åœ¨åˆ¤æ–­ä¸€æœ¬ä¹¦å€¼å¾—ç²¾è¯»ä»¥åï¼Œæˆ‘ä»¬æ‰§è¡Œåˆ†æé˜…è¯»</p><h1 id="åˆ†æé˜…è¯»"><a class="markdownIt-Anchor" href="#åˆ†æé˜…è¯»"></a> åˆ†æé˜…è¯»</h1><h2 id="ä¸€é˜¶æ®µ"><a class="markdownIt-Anchor" href="#ä¸€é˜¶æ®µ"></a> ä¸€é˜¶æ®µ</h2><ul><li>ç»™ä¹¦åˆ†ç±»</li><li>æ‰¾åˆ°ä¹¦çš„éª¨æ¶</li><li>ä¸ºä¹¦æ‹Ÿå¤§çº²</li><li>å‘ç°ä½œè€…æ„å›¾</li><li>ä¸€é˜¶æ®µæ€»ç»“å›ç­”é—®é¢˜1â€”â€”æ•´ä½“æ¥è¯´ï¼Œè¿™æœ¬ä¹¦åœ¨è°ˆä»€ä¹ˆ</li></ul><h2 id="äºŒé˜¶æ®µ"><a class="markdownIt-Anchor" href="#äºŒé˜¶æ®µ"></a> äºŒé˜¶æ®µ</h2><p>åˆ¤æ–­ä½œè€…ä¸»æ—¨</p><ol><li>ä¹¦ä¸­çš„å„ç§å®šä¹‰</li><li>ç†è§£ä½œè€…æƒ³è®©ä½ å…³æ³¨çš„</li><li>æœ¬ä¹¦å¦‚ä½•æ¨å¯¼</li><li>ä½œè€…è‡ªå·±çš„è§‚ç‚¹æ˜¯æ€ä¹ˆæ ·çš„</li></ol><p>æ€»ç»“å›ç­”â€”â€”ä½œè€…æ˜¯å¦‚ä½•è®¨è®ºæ¸…æ¥šä¸€ä¸ªé—®é¢˜çš„</p><h2 id="ä¸‰é˜¶æ®µ"><a class="markdownIt-Anchor" href="#ä¸‰é˜¶æ®µ"></a> ä¸‰é˜¶æ®µ</h2><p>å…¬æ­£çš„è¯„ä»·ä¸€æœ¬ä¹¦</p><h1 id="ä¸»é¢˜é˜…è¯»"><a class="markdownIt-Anchor" href="#ä¸»é¢˜é˜…è¯»"></a> ä¸»é¢˜é˜…è¯»</h1><p>é€šè¿‡å¤šæœ¬ä¹¦ç›¸åŒä¸»é¢˜çš„æ¨ªå‘æ¯”è¾ƒæ¥åŠ æ·±ç†è§£ã€‚</p><h1 id="è‡ªå·±çš„ç†è§£"><a class="markdownIt-Anchor" href="#è‡ªå·±çš„ç†è§£"></a> è‡ªå·±çš„ç†è§£</h1><p>é˜…è¯»ä¸€ç« æˆ–è€…ä¸€æ®µä¹‹åè¦æ€»ç»“ï¼Œåˆšå¼€å§‹é˜…è¯»å¯ä»¥ç²—è¯»æˆ–è€…è¯´èµ°é©¬è§‚èŠ±ï¼Œä½†æ˜¯ä¸€å®šè‡³å°‘è¦æœ‰ä¸€éæ˜¯å¸¦ç€æ€»ä½“çš„è§†è§’å»é˜…è¯»çš„ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€å£°æ˜</title>
      <link href="/2023/01/04/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%A3%B0%E6%98%8E/"/>
      <url>/2023/01/04/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%A3%B0%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<p>Cè¯­è¨€çš„å£°æ˜å¯ä»¥åµŒå¥—ï¼Œæ‰€ä»¥å¯ä»¥æ„æˆä¸€äº›ç›¸å½“å¤æ‚çš„åµŒå¥—ï¼Œè¿™ç§è¿‡äºå¤æ‚çš„å£°æ˜å¹¶ä¸æ¨èï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥å­¦ä¼šå¦‚ä½•å»é˜…è¯»è¿™äº›å£°æ˜ã€‚å¹¶åœ¨åé¢çš„éƒ¨åˆ†ä¼šè®²è¿°å¦‚ä½•åˆ©ç”¨typedefå»ç®€åŒ–è¿™äº›å£°æ˜</p><h1 id="left-right-rule"><a class="markdownIt-Anchor" href="#left-right-rule"></a> left-right rule</h1><p><code>&quot;left-right&quot; rule</code>æ˜¯è§£è¯»Cè¯­è¨€å£°æ˜çš„å¼ºåŠ›è§„åˆ™ï¼ŒæŒæ¡è¿™ä¸ªè§„åˆ™è¶³å¤Ÿè®©æˆ‘ä»¬è§£å†³å‡ ä¹æ‰€æœ‰çš„Cå£°æ˜ï¼Œè€Œä¸”è§„åˆ™å¹¶ä¸å¤æ‚ï¼Œåˆ†ä¸ºä¸‹é¢å‡ æ­¥</p><blockquote><ol><li>ä»å˜é‡åå¼€å§‹é˜…è¯»</li><li>ä»åŒ…å«å˜é‡åçš„æœ€å†…éƒ¨çš„æ‹¬å·ç”±å†…è€Œå¤–è§£é‡Šï¼Œå¯¹äºæ¯ä¸ªæ‹¬å·çš„å†…éƒ¨ï¼Œå…ˆå¾€å³è¾¹è§£é‡Šï¼Œå†å¾€å·¦è¾¹è§£é‡Šï¼Œå±‚å±‚è§£é‡Š&gt; ç›´è‡³ç»“æŸã€‚</li></ol></blockquote><p>ç¬¬ä¸€æ¡è§„åˆ™å‘Šè¯‰ä½ å¦‚ä½•å¼€å§‹ï¼Œç¬¬äºŒæ¡è§„åˆ™å‘Šè¯‰ä½ å¦‚ä½•è§£é‡Šï¼Œç„¶åï¼Œæˆ‘ä»¬è¦è®°ä½ä¸€äº›è§„åˆ™ï¼Œä½ å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯è§„å®šçš„å†…å®¹ï¼Œæ˜¯æ­»çš„ã€‚</p><ul><li><code>*</code>  è¯»ä½œ â€œæŒ‡å‘â€¦çš„æŒ‡é’ˆâ€ ï¼Œæ¥ä¸‹é‡Œçš„æ ‡è¯†ç¬¦ä¿®é¥°æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹</li><li><code>[]</code>   è¯»ä½œ â€œâ€¦çš„æ•°ç»„â€ ï¼Œæ¥ä¸‹æ¥çš„æ ‡è¯†ç¬¦ä¿®é¥°æ•°ç»„çš„å…ƒç´ </li><li><code>()</code>  è¯»ä½œ â€œè¿”å›â€¦çš„å‡½æ•°â€ï¼Œæ¥ä¸‹æ¥çš„æ ‡è¯†ç¬¦ä¿®é¥°å‡½æ•°è¿”å›å€¼</li></ul><p><code>è¯»ä½œ...</code>æ˜¯ç”¨è¯­è¨€çš„æ–¹å¼å»å°†å£°æ˜ä¸€å±‚å±‚å®šä¹‰å‡ºæ¥ï¼Œå°±æ˜¯åæ˜ äº†æ¥ä¸‹æ¥ä¿®é¥°çš„å†…å®¹ï¼Œç†è§£åé¢çš„éƒ¨åˆ†æˆ‘è®¤ä¸ºä¼šæ›´åŠ ç›´æ¥ã€‚</p><p>å¥½çš„ï¼Œçœ‹äº†ä¸Šé¢çš„å†…å®¹ä½ å¤§æ¦‚äº†è¿˜æ˜¯ç›¸å½“æ¨¡ç³Šçš„ï¼Œä¸è¦æ€¥ï¼Œä¸Šé¢çš„å†…å®¹æš‚æ—¶ä¸å¿…å…³ç³»ï¼Œä¸‹é¢æˆ‘ä¼šå¼€å§‹åˆ—ä¸¾ä¸€äº›ä¾‹å­ï¼Œå¯ä»¥ä¸€è¾¹çœ‹ä¾‹å­ä¸€è¾¹çœ‹è§£é‡Šè§„åˆ™ï¼Œå¦‚æœä½ æƒ³è‡ªå·±å°è¯•ä¸€ä¸‹ä¹Ÿå¯ä»¥å…ˆè‡ªå·±è§£è¯»ã€‚</p><hr /><p>å…ˆæ¥çœ‹ä¸€ç‚¹æˆ‘ä»¬ä»¥å‰å¯èƒ½é‡åˆ°çš„å¤´ç–¼å£°æ˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="type">const</span> <span class="type">int</span> * a;</span><br><span class="line"><span class="number">2.</span> <span class="type">int</span> <span class="type">const</span> * a;</span><br><span class="line"><span class="number">3.</span> <span class="type">int</span> * <span class="type">const</span> a;</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä½ æ˜¯å¦è¿˜è®°å¾—ç»“æœï¼Œåœ¨è¿™ä¸‰ä¸ªå£°æ˜ä¸­ï¼Œåªæœ‰<code>3çš„æŒ‡é’ˆæ˜¯åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆå¸¸é‡</code>ï¼Œå…¶å®ƒä¸¤ä¸ªéƒ½æ˜¯<code>æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡æ˜¯åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æŒ‡é’ˆ</code>ã€‚æˆ‘ä»¬æ¥ä¸€ä¸ªä¸ªè§£è¯»ã€‚</p><p><code>const int * a</code>ï¼š</p><ol><li><p>å…ˆæ‰¾åˆ°å˜é‡åa</p></li><li><p>æ— æ‹¬å·ï¼Œæ€»å…±å°±ä¸€å±‚ï¼Œå…ˆå¾€å³çœ‹ï¼Œæ²¡æœ‰ä»»ä½•æ ‡è¯†ç¬¦</p></li><li><p>å¾€å·¦çœ‹ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€ä¸ª<code>*</code>ï¼ŒOKï¼Œé‚£ä¹ˆæ­¤æ—¶<code>a</code>å·²ç»æ˜¯ä¸€ä¸ª<code>æŒ‡é’ˆ</code>äº†ï¼Œ<code>æ¥ä¸‹æ¥çš„æ ‡è¯†ç¬¦åªä¼šä¿®é¥°æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œè¿™ä¸€ç‚¹å¾ˆå…³é”®</code></p></li><li><p>ç»§ç»­å¾€å·¦çœ‹ï¼Œçœ‹åˆ°<code>int</code>ï¼Œè¯´æ˜æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª<code>int</code>ç±»å‹çš„å˜é‡</p></li><li><p>å†çœ‹åˆ°<code>const</code>ï¼Œè¡¨æ˜è¯¥<code>int</code>ç±»å‹çš„å˜é‡æ˜¯ä¸€ä¸ªå¸¸é‡</p></li></ol><p>é‚£ä¹ˆè¿™ä¸ªå£°æ˜çš„ç»“æœå°±æ˜¯<code>å˜é‡aæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹æ˜¯ä¸€ä¸ªintç±»å‹çš„å¸¸é‡</code></p><p><code>int const * a</code>ï¼š</p><ol><li>æ‰¾åˆ°å˜é‡åa</li><li>å¾€å³çœ‹ï¼Œæ— æ ‡è¯†ç¬¦</li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œaæ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li><li>å¾€å·¦çœ‹ï¼Œ<code>const</code>ï¼ŒæŒ‡å‘çš„å˜é‡æ˜¯ä¸€ä¸ªå¸¸é‡</li><li>å¾€å·¦çœ‹ï¼Œ<code>int</code>ï¼Œè¯¥å¸¸é‡æ˜¯intç±»å‹çš„</li></ol><p>é‚£ä¹ˆè¿™ä¸ªå£°æ˜çš„ç»“æœå°±æ˜¯<code>å˜é‡aæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹æ˜¯ä¸€ä¸ªintç±»å‹çš„å¸¸é‡</code></p><p><code>int * const a</code>ï¼š</p><ol><li>æ‰¾åˆ°å˜é‡åa</li><li>å¾€å³çœ‹ï¼Œæ— æ ‡è¯†ç¬¦</li><li>å¾€å·¦çœ‹ï¼Œ<code>const</code>ï¼Œaæ˜¯å¸¸é‡</li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œaæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯aç°åœ¨æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼Œæ¥ä¸‹æ¥çš„æ ‡è¯†ç¬¦ä¼šå¼€å§‹ä¿®é¥°æŒ‡é’ˆæŒ‡å‘çš„å˜é‡</li><li>å¾€å·¦çœ‹ï¼Œ<code>int</code>ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å˜é‡æ˜¯intç±»å‹çš„</li></ol><p>é‚£ä¹ˆè¿™ä¸ªå£°æ˜çš„ç»“æœå°±æ˜¯<code>å˜é‡aæ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹æ˜¯ä¸€ä¸ªintç±»å‹çš„å˜é‡</code></p><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæœ‰ä¸¤ç‚¹å¾ˆé‡è¦</p><ol><li>æŒ‰ç…§é¡ºåºè¯»å–</li><li>ä¸€å®šè¦ç†è§£æ ‡è¯†ç¬¦ä»€ä¹ˆæ—¶å€™ä¿®é¥°å˜é‡aï¼Œä»€ä¹ˆæ—¶å€™ä¿®é¥°aæŒ‡å‘çš„å†…å®¹ï¼Œå½“aè¢«å®šä¹‰ä¸ºæŒ‡é’ˆä»¥åï¼Œæ ‡è¯†ç¬¦å°±åªä¼šä¿®é¥°æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œè¿™æ˜¯ä¸€ä¸ªå›ºå®šçš„è§„åˆ™</li></ol><hr /><p>å†æ¥çœ‹ä¸€ä¸ªå®¹æ˜“æ··æ·†çš„ä¾‹å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="type">int</span> *p[<span class="number">10</span>];</span><br><span class="line"><span class="number">2.</span> <span class="type">int</span> (*p)[<span class="number">10</span>];</span><br></pre></td></tr></table></figure><p><code>1æ˜¯æŒ‡é’ˆæ•°ç»„ï¼Œ2æ˜¯æ•°ç»„æŒ‡é’ˆ</code></p><p><code>int *p[10]</code>ï¼š</p><ol><li>æ‰¾åˆ°å˜é‡åp</li><li>å¾€å³çœ‹ï¼Œ<code>[10]</code>ï¼Œpæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¥ä¸‹æ¥æ ‡è¯†ç¬¦åªèƒ½ä¿®é¥°æ•°ç»„å…ƒç´ </li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œæ•°ç»„å…ƒç´ æ˜¯æŒ‡é’ˆ</li><li>å¾€å·¦çœ‹ï¼Œ<code>int</code>ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å˜é‡æ˜¯intç±»å‹</li></ol><p><code>int (*p)[10]</code>ï¼š</p><ol><li>æ‰¾åˆ°å˜é‡åp</li><li>å› ä¸ºæœ‰æ‹¬å·ï¼Œæ‰€ä»¥è¦å…ˆå¤„ç†<code>(*p)</code></li><li>å¾€å³çœ‹ï¼Œæ— æ ‡è¯†ç¬¦</li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œpæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ¥ä¸‹æ¥çš„æ ‡è¯†ç¬¦åªä¼šä¿®é¥°æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹</li><li>è§£é‡Šå®Œæ‹¬å·å†…éƒ¨çš„ï¼Œç°åœ¨è§£é‡Šå¤–éƒ¨çš„ï¼Œ<code>int ()[10]</code></li><li>å¾€å³çœ‹ï¼Œ<code>[10]</code>ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å˜é‡æ˜¯æ•°ç»„ç±»å‹çš„</li><li>å¾€å·¦çœ‹ï¼Œ<code>int</code>ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯intç±»å‹</li></ol><hr /><p>æˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¸€ç‚¹å¤æ‚ä¸€äº›çš„ä¾‹å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> * <span class="type">const</span> *(*b)(<span class="type">int</span> a);</span><br></pre></td></tr></table></figure><ol><li>æ‰¾åˆ°å˜é‡åb</li><li>æœ‰æ‹¬å·ï¼Œæˆ‘ä»¬è¦å…ˆè§£é‡Š<code>(*b)</code></li><li><code>*b</code>å¾€å³çœ‹ï¼Œæ— æ ‡è¯†ç¬¦</li><li>å¾€å·¦çœ‹ï¼Œbæ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li><li>ç„¶åå†è§£é‡Š<code>char * const *  (int a)</code></li><li>å¾€å³çœ‹<code>(int a)</code>ï¼ŒbæŒ‡å‘çš„å˜é‡æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œæ¥ä¸‹æ¥å·¦è¾¹çš„æ ‡è¯†ç¬¦éƒ½åªä¼šä¿®é¥°å‡½æ•°è¿”å›å€¼</li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li><li>å¾€å·¦çœ‹<code>const</code>ï¼Œè¿”å›å€¼çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå¸¸é‡</li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œè¿™ä¸ªå¸¸é‡æ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li><li>å¾€å·¦çœ‹ï¼Œ<code>char</code>ï¼ŒæŒ‡é’ˆå¸¸é‡æŒ‡å‘ä¸€ä¸ªcharç±»å‹å˜é‡</li></ol><p>é‚£ä¹ˆè¿™ä¸ªå£°æ˜çš„ç»“æœå°±æ˜¯<code>å˜é‡aæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡ï¼ŒæŒ‡é’ˆå¸¸é‡æŒ‡å‘ä¸€ä¸ªå­—ç¬¦å‹å˜é‡</code></p><p>è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼Œå‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯è¦ç»è¿‡è§£é‡Šçš„ï¼Œåªä¸è¿‡è¿™ä¸ªä¾‹å­å’Œä¸‹é¢è¿™ä¸ªä¾‹å­çš„å‡½æ•°å‚æ•°éƒ½å¤æ‚æˆ‘å°±ç›´æ¥è·³è¿‡äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *(* a[<span class="number">10</span>])(<span class="type">int</span> **p);</span><br></pre></td></tr></table></figure><ol><li>æ‰¾åˆ°å˜é‡åa</li><li>å…ˆå¤„ç†<code>(* a[10])</code></li><li>å¾€å³çœ‹ï¼Œ<code>[10]</code>ï¼Œaæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¥ä¸‹æ¥çš„æ ‡è¯†ç¬¦åªä¼šä¿®é¥°æ•°ç»„å…ƒç´ </li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œæ•°ç»„å…ƒç´ æ˜¯æŒ‡é’ˆç±»å‹</li><li>æ¥ä¸‹æ¥è§£é‡Š<code>char *()(int **p)</code></li><li>å¾€å³çœ‹ï¼Œ<code>(int **p)</code>ï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°æ˜¯äºŒçº§æŒ‡é’ˆ</li><li>å¾€å·¦çœ‹ï¼Œ<code>*</code>ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li><li>å¾€å·¦çœ‹ï¼Œ<code>char</code>ï¼Œcharç±»å‹æŒ‡é’ˆ</li></ol><p>é‚£ä¹ˆè¿™ä¸ªå£°æ˜çš„ç»“æœå°±æ˜¯<code>å˜é‡aæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œå‡½æ•°å‚æ•°æ˜¯äºŒçº§æŒ‡é’ˆï¼Œè¿”å›å€¼ä¸€ä¸ªæŒ‡å‘å­—ç¬¦å‹å˜é‡çš„æŒ‡é’ˆ</code></p><p>OKï¼Œå¦‚æœä½ çœ‹å®Œå¹¶ç†è§£äº†ä¸Šé¢çš„å†…å®¹ï¼Œä½ ä¼šå‘ç°è§£é‡ŠCçš„å£°æ˜å®é™…ä¸Šä¹Ÿä¸æ˜¯å¤ªå¤æ‚ï¼Œæˆ‘é‡æ–°æ€»ç»“ä¸€ä¸‹è¦ç‚¹ï¼Œæˆ‘ç›¸ä¿¡ç°åœ¨çš„ä½ çœ‹è¿™äº›è¦ç‚¹ä¼šæœ‰æ–°çš„æ„Ÿæ‚Ÿ</p><ol><li>æŒ‰ç…§é¡ºåºè§£é‡Š</li><li>è®°ä½ç°åœ¨è§£é‡Šçš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚å˜é‡å·²ç»å£°æ˜ä¸ºæŒ‡é’ˆåï¼Œè¦æ¸…æ¥šæ¥ä¸‹æ¥çš„æ ‡è¯†ç¬¦åªä¼šä¿®é¥°æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œè€Œä¸ä¼šå†æ¥ä¿®é¥°è¿™ä¸ªæŒ‡é’ˆæœ¬èº«ã€‚</li></ol><p>è™½ç„¶ç°åœ¨æˆ‘ä»¬ä¼šè§£é‡ŠCè¯­è¨€çš„å£°æ˜ï¼Œä½†æ˜¯å¤æ‚çš„å£°æ˜åœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¸æ˜¯å¥½çš„é€‰æ‹©ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬ä»‹ç»ç”¨typedefæ¥ç®€åŒ–å£°æ˜</p><h1 id="ç”¨typedefæ¥ç®€åŒ–å£°æ˜"><a class="markdownIt-Anchor" href="#ç”¨typedefæ¥ç®€åŒ–å£°æ˜"></a> ç”¨typedefæ¥ç®€åŒ–å£°æ˜</h1><p>typedefåœ¨æˆ‘ä»¬åˆå­¦Cæ—¶å…¶å®å¹¶ä¸å¤ªå¸¸ç”¨ï¼Œå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ç”¨æ¥ç®€åŒ–ç»“æ„ä½“çš„å£°æ˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> <span class="title">Node</span>;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ç”¨<code>Node</code>è€Œä¸æ˜¯<code>struct Node</code>æ¥å®šä¹‰å˜é‡ï¼Œè¿™ç§åšæ³•æ˜¯å¦æ˜æ™ºä¸æ˜¯æˆ‘ä»¬è¦è®¨è®ºçš„å†…å®¹ï¼Œä½†æ˜¯ä»…ä»…æ˜¯è¿™æ ·çš„ä½¿ç”¨è¿œè¿œæ²¡æœ‰å±•ç°å‡ºtypedefçš„åŠ›é‡ã€‚</p><h2 id="typedefå’Œdefineçš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#typedefå’Œdefineçš„åŒºåˆ«"></a> typedefå’Œ#defineçš„åŒºåˆ«</h2><p>å¦‚æœæˆ‘ä»¬ä»…ä»…åªæ˜¯åƒä¸Šé¢ä¸€æ ·ç”¨è¿‡typedefï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¯¹typedefçš„çœŸå®ä½œç”¨äº§ç”Ÿè¯¯åŒºã€‚</p><p>#defineæ˜¯å®Œå…¨çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œä»…æ­¤è€Œå·²ï¼Œä½†æ˜¯typedefä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒçœŸå®çš„é‡å‘½åäº†ä¸€ä¸ªç±»å‹ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> A int*</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span>* B;</span><br><span class="line">A a,b;</span><br><span class="line">B c,d;</span><br></pre></td></tr></table></figure><p>å˜é‡<code>aæ˜¯æŒ‡é’ˆ</code>ï¼Œè€Œå˜é‡<code>båªæ˜¯ä¸€ä¸ªæ™®é€šçš„æ•´å‹å˜é‡</code>ï¼Œå› ä¸ºå®é™…çš„å®šä¹‰æ˜¯è¿™æ ·çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *a,b;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯<code>cå’Œdéƒ½æ˜¯æŒ‡é’ˆ</code>ï¼Œå› ä¸ºBæ˜¯ç±»å‹<code>int *</code>çš„åˆ«åï¼Œæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œå¯ä»¥è¯´Bæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ–°çš„ç±»å‹ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­å·²ç»å±•ç°äº†typedefä¸å­—ç¬¦ä¸²æ›¿æ¢å¤§ä¸ç›¸åŒï¼Œä½†typedefä¸ä»…äºæ­¤ï¼Œå¦‚æœä½ æ²¡æœ‰çœŸæ­£çš„æ˜ç™½typedefçš„ä½œç”¨ï¼Œé‚£ä¹ˆä¸‹é¢è¿™ä¸ªä¾‹å­ä½ ä¸€å®šæ— æ³•ç†è§£</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> Array[<span class="number">20</span>];</span><br><span class="line">Array a;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„aæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º20çš„æ•´å‹æ•°ç»„ã€‚Arrayæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹æ˜¯é•¿åº¦ä¸º20çš„æ•´å‹æ•°ç»„ã€‚</p><p>ç°åœ¨ä½ åº”è¯¥å¯ä»¥æ˜ç™½typedefçš„ç”¨æ³•äº†ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹typedefæ€ä¹ˆç®€åŒ–å£°æ˜ã€‚</p><h2 id="typedefç®€åŒ–å£°æ˜"><a class="markdownIt-Anchor" href="#typedefç®€åŒ–å£°æ˜"></a> typedefç®€åŒ–å£°æ˜</h2><p>æˆ‘ä»¬æ¥ç®€åŒ–ä¸Šé¢çš„ä¾‹å­</p><p><code>char *(* a[10])(int **p);</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> *(*Func)(<span class="type">int</span> **p);</span><br><span class="line"><span class="comment">// é‚£ä¹ˆaå¯ä»¥å®šä¹‰å¦‚ä¸‹</span></span><br><span class="line">Func a[<span class="number">10</span>];</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨typedefæŠŠå‡½æ•°éƒ¨åˆ†å’Œæ•°ç»„éƒ¨åˆ†æ‹†åˆ†äº†å¼€æ¥ï¼Œè¿™äº›ç®€åŒ–æ•ˆæœä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾ï¼Œæˆ‘ä»¬æ¥çœ‹æ›´å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *(* (*a[<span class="number">10</span>])[<span class="number">10</span>][<span class="number">10</span>])(<span class="type">int</span> **p,<span class="type">char</span> *(*f)(<span class="type">int</span> *p[<span class="number">10</span>]));</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å·²ç»æ¯«æ— å¯è¯»æ€§äº†ï¼Œä¹Ÿä¸éœ€è¦è€—è´¹å¿ƒç¥å»è§£é‡Šï¼Œæˆ‘ä»¬æ¥ç®€åŒ–è¿™ä¸ªå£°æ˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆç®€åŒ–ä½œä¸ºå‚æ•°çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> *(*ParamFunc)(<span class="type">int</span> *p[<span class="number">10</span>]);</span><br><span class="line"><span class="comment">// å†æŠŠæ•´ä¸ªå‡½æ•°éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> *(*Func)(<span class="type">int</span> **p,ParamFunc f);</span><br><span class="line"><span class="comment">// æœ€åå†æŠŠæ•°ç»„éƒ¨åˆ†åŠ ä¸Š</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">Func</span> <span class="params">(*ComplexPointer[<span class="number">10</span>])</span>[10][10];</span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥å®šä¹‰äº†</span></span><br><span class="line">ComplexPointer a;</span><br><span class="line"><span class="comment">// ä¸‹é¢æ˜¯ä¸ä½¿ç”¨typedefçš„ï¼Œå¯¹æ¯”ä¸€ä¸‹</span></span><br><span class="line"><span class="type">char</span> *(* (*a[<span class="number">10</span>])[<span class="number">10</span>][<span class="number">10</span>])(<span class="type">int</span> **p,<span class="type">char</span> *(*f)(<span class="type">int</span> *p[<span class="number">10</span>]));</span><br></pre></td></tr></table></figure><p>å¯è§typedefåœ¨å¤æ‚å£°æ˜ä¸­çš„åŠ›é‡ï¼Œå½“ç„¶ï¼Œç®€åŒ–çš„æ–¹æ³•å¯ä»¥æŒ‰ç…§ä½ è‡ªå·±çš„æƒ³æ³•ä»»æ„çš„ç»„ç»‡ã€‚</p><p>å¥½äº†ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯è®²è¿°äº†Cè¯­è¨€çš„å£°æ˜ç›¸å…³å†…å®¹ï¼Œå¸Œæœ›èƒ½è®©ä½ æœ‰æ‰€æ”¶è·ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€çš„æ•°æ®å­˜å‚¨</title>
      <link href="/2023/01/02/C%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
      <url>/2023/01/02/C%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/</url>
      
        <content type="html"><![CDATA[<p>Cè¯­è¨€å…è®¸ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼ŒåŒ…æ‹¬éšå¼çš„è½¬æ¢å’Œå¼ºåˆ¶è½¬æ¢ï¼Œä¸ºäº†æˆ‘ä»¬èƒ½æ›´å¥½çš„ç†è§£è¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£Cè¯­è¨€çš„æ•°æ®åœ¨è®¡ç®—æœºä¸­åˆ°åº•æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚</p><h1 id="æ•´å‹æ•°æ®"><a class="markdownIt-Anchor" href="#æ•´å‹æ•°æ®"></a> æ•´å‹æ•°æ®</h1><p>æˆ‘ä»¬å…ˆä»ç®€å•çš„æ•´å‹æ•°æ®å¼€å§‹ã€‚</p><p>æ— ç¬¦å·æ•´æ•°çš„å‚¨å­˜æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä»¥äºŒè¿›åˆ¶å½¢å¼å‚¨å­˜ï¼Œ64ä½æœºçš„signed intå­˜å‚¨å½¢å¼å¦‚ä¸‹</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bd8ab550f004ad89049744791989583~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" /></p><p>è€Œæœ‰ç¬¦å·æ•´æ•°çš„è¡¨ç¤ºç¨å¤æ‚ï¼Œæœ‰ç¬¦å·æ•´æ•°çš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ0ä»£è¡¨æ•´æ•°ï¼Œ1ä»£è¡¨è´Ÿæ•°ã€‚</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf597aafb658413b9570799c9be45672~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" /></p><p>åœ¨è®¡ç®—æœºä¸­ï¼Œæœ‰ç¬¦å·æ•´æ•°ä»¥è¡¥ç çš„å½¢å¼å‚¨å­˜ã€‚å…³äºè¡¥ç ï¼Œæˆ‘ä»¬åªéœ€è¦ç†è§£å®ƒçš„è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–æœ‰ç¬¦å·æ•´æ•°çš„è®¡ç®—ï¼Œé€šè¿‡è‡ªç„¶æº¢å‡ºå®ç°æ­£ç¡®çš„è¿ç®—çš„ç»“æœã€‚</p><p>å¯ä»¥ç®€å•çš„è®°å¿†å¦‚ä¸‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mtext>è¡¥ç </mtext></msub><mo>+</mo><mo stretchy="false">(</mo><mo>âˆ’</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mtext>è¡¥ç </mtext></msub><mo>=</mo><mn>0</mn><mspace linebreak="newline"></mspace><mo stretchy="false">(</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mtext>è¡¥ç </mtext></msub><mo>+</mo><mo stretchy="false">(</mo><mo>âˆ’</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mtext>è¡¥ç </mtext></msub><mo>=</mo><msup><mn>2</mn><mi>w</mi></msup><mo stretchy="false">(</mo><mi>w</mi><mtext>æ˜¯å­˜å‚¨çš„ä½æ•°</mtext><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mo>âˆ’</mo><mi>x</mi><mtext>çš„è¡¥ç å¯ä»¥ç”¨</mtext><msup><mn>2</mn><mi>w</mi></msup><mo>âˆ’</mo><mi>x</mi><mtext>è®¡ç®—å¾—å‡º</mtext><mspace linebreak="newline"></mspace><mo stretchy="false">(</mo><mo>âˆ’</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mtext>è¡¥ç </mtext></msub><mo>=</mo><msup><mn>2</mn><mi>w</mi></msup><mo>âˆ’</mo><mo stretchy="false">(</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mtext>è¡¥ç </mtext></msub></mrow><annotation encoding="application/x-tex">(x)_{è¡¥ç }+(-x)_{è¡¥ç }=0 \\(x)_{è¡¥ç }+(-x)_{è¡¥ç }=2^w(wæ˜¯å­˜å‚¨çš„ä½æ•°) \\-xçš„è¡¥ç å¯ä»¥ç”¨2^w-xè®¡ç®—å¾—å‡º \\(-x)_{è¡¥ç }=2^w-(x)_{è¡¥ç }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">è¡¥</span><span class="mord cjk_fallback mtight">ç </span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">è¡¥</span><span class="mord cjk_fallback mtight">ç </span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">è¡¥</span><span class="mord cjk_fallback mtight">ç </span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">è¡¥</span><span class="mord cjk_fallback mtight">ç </span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord cjk_fallback">æ˜¯</span><span class="mord cjk_fallback">å­˜</span><span class="mord cjk_fallback">å‚¨</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">ä½</span><span class="mord cjk_fallback">æ•°</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7977219999999999em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">è¡¥</span><span class="mord cjk_fallback">ç </span><span class="mord cjk_fallback">å¯</span><span class="mord cjk_fallback">ä»¥</span><span class="mord cjk_fallback">ç”¨</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">è®¡</span><span class="mord cjk_fallback">ç®—</span><span class="mord cjk_fallback">å¾—</span><span class="mord cjk_fallback">å‡º</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">è¡¥</span><span class="mord cjk_fallback mtight">ç </span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7977219999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">è¡¥</span><span class="mord cjk_fallback mtight">ç </span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><h1 id="æµ®ç‚¹å‹æ•°æ®"><a class="markdownIt-Anchor" href="#æµ®ç‚¹å‹æ•°æ®"></a> æµ®ç‚¹å‹æ•°æ®</h1><p>æµ®ç‚¹å‹æ•°æ®é‡‡ç”¨ä¸‹é¢è¿™ç§æ–¹å¼å­˜å‚¨ï¼Œé¦–å…ˆæ˜¯32ä½çš„float</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89f6aaa3f03249b08fcf48ac6b92d2b5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" /></p><p>ä¸‹é¢æ˜¯64ä½çš„double</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7f23c82ff2c4a70bf8d8bd145f8eb04~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" /></p><p>æµ®ç‚¹æ•°çš„ç¬¦å·ä½å’Œæ•´å‹ç±»ä¼¼ï¼Œä½†æµ®ç‚¹æ•°åªæ˜¯çº¯ç²¹çš„ä¸ºäº†è¡¨ç¤ºç¬¦å·ï¼Œ0è¡¨ç¤ºæ­£æ•°ï¼Œ1è¡¨ç¤ºè´Ÿæ•°ã€‚</p><p>æµ®ç‚¹æ•°çš„æŒ‡æ•°å’Œå°¾æ•°æœ‰äº›ç»†èŠ‚ï¼Œæˆ‘ä»¬ä»¥floatä¸ºä¾‹ï¼Œdoubleç±»ä¼¼ã€‚</p><p>é¦–å…ˆï¼Œ<code>æŒ‡æ•°ä½ä¸­çš„2è¿›åˆ¶æ•°ä¸èƒ½å¤Ÿç›´æ¥è½¬æ¢ä¸ºçœŸå®çš„æŒ‡æ•°</code>ï¼Œå› ä¸º<code>æŒ‡æ•°å®é™…ä¸Šæœ‰æ•´æ•°å’Œè´Ÿæ•°</code>ï¼ŒæŒ‡æ•°ä½ä¸ºäº†èƒ½å¤Ÿè¡¨ç¤ºæ­£æ•°å’Œè´Ÿæ•°ï¼Œä¼šæœ‰ä¸€ä¸ªåç§»é‡ï¼Œè¿™ä¸ªåç§»é‡æ˜¯æŒ‡æ•°ä½çš„ä¸­é—´å€¼ï¼Œå¯¹äº<code>floatæ¥è¯´æ˜¯127</code>ï¼Œ<code>doubleæ˜¯1023</code>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŒ‡æ•°ä¸º2æ—¶ï¼Œé‚£ä¹ˆæŒ‡æ•°ä½ä¸­å­˜ä¸‹çš„çœŸå®æ•°æ®æ˜¯<code>129</code>ã€‚</p><p>å…¶æ¬¡ï¼Œfloatçš„å°¾æ•°è™½ç„¶åªæœ‰23ä½ï¼Œä½†æ˜¯floatçš„æœ‰æ•ˆä½æ•°æ˜¯24ä½ï¼Œå› ä¸º<code>åœ¨å°¾æ•°éƒ¨åˆ†ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªå›ºå®šçš„éšå«ä½ï¼Œè¿™ä¸ªéšå«ä½çš„å€¼æ˜¯1</code>ã€‚å…¶å®å°±æ˜¯ä¸ºå°¾æ•°åŠ ä¸Šäº†ä¸€ä¸ªå›ºå®šçš„1ä½œä¸ºå¼€å¤´ã€‚</p><p>è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºä¸€ä¸ªé0çš„äºŒè¿›åˆ¶æ•°ï¼Œè‡³å°‘æœ‰ä¸€ä¸ª1ï¼ˆæ¢åšå¹³æ—¶è¿™å¯èƒ½æ˜¯åºŸè¯ï¼‰ï¼Œæ¯”å¦‚6æ˜¯<code>0110</code>ï¼Œ5æ˜¯<code>0101</code>ï¼Œè¿™äº›æ•°å­—çš„ç¬¬ä¸€ä¸ª<code>1</code>æˆ‘ä»¬ä¸éœ€è¦å‚¨å­˜ï¼Œ6å°±å­˜<code>10</code>ï¼Œ5å­˜<code>01</code>å°±å¯ä»¥äº†ï¼ˆå½“ç„¶å‰é¢è¿˜æœ‰è‹¥å¹²ä¸ª0å¡«å……ï¼‰ï¼Œè¿™æ ·å¯ä»¥æé«˜æµ®ç‚¹çš„æœ‰æ•ˆå°¾æ•°ã€‚</p><p>é‚£ä¹ˆæµ®ç‚¹æ•°æ€ä¹ˆå­˜0å‘¢ï¼Œå½“æµ®ç‚¹æ•°ä¸º0æ—¶ï¼Œæµ®ç‚¹æ•°çš„æŒ‡æ•°ä½å’Œå°¾æ•°éƒ¨åˆ†å…¨éƒ¨éƒ½ä¸º0ï¼Œè™½ç„¶è¿™ä¸ªæ—¶å€™å°¾æ•°çœ‹èµ·æ¥å¾ˆå¤§ï¼Œä½†æ˜¯æŒ‡æ•°ä½å…¨ä¸º0é‚£å°±æ˜¯-127æ¬¡æ–¹ï¼Œè¿™è¶³å¤Ÿé€¼è¿‘ä¸€ä¸ª0äº†ã€‚</p><p>å¥½äº†ï¼Œå…¶å®ƒç±»å‹çš„å­˜å‚¨ä¹Ÿæ— éæ•´å‹å’Œæµ®ç‚¹å‹ï¼Œæ‰€ä»¥ä¸å¤šèµ˜è¿°ï¼Œå¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿè®©ä½ æœ‰æ‰€æ”¶è·ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€çš„å¼±ç±»å‹æ€§</title>
      <link href="/2023/01/01/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%80%A7/"/>
      <url>/2023/01/01/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>Cè¯­è¨€æ˜¯ä¸€ä¸ªå¼ºç±»å‹çš„è¯­è¨€ï¼Œå˜é‡å¿…é¡»å…ˆå®šä¹‰å†ä½¿ç”¨ï¼Œè€Œä¸”å˜é‡å¦‚æœä¸ç»è¿‡è½¬æ¢ï¼Œé‚£ä¹ˆå°†æ°¸è¿œä¿æŒåŸæ¥çš„ç±»å‹ã€‚ä½†å¼ºå’Œå¼±æ˜¯ç›¸å¯¹çš„ï¼Œå¦‚æœæˆ‘ä»¬æŠŠCè¯­è¨€å’Œå…¶å®ƒçš„ä¸€äº›å¼ºç±»å‹è¯­è¨€ç›¸æ¯”è¾ƒï¼Œæˆ‘ä»¬ä¼šå‘ç°Cè¯­è¨€çš„ä¸€äº›å¼±ç±»å‹ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§ä¼šåœ¨æŸäº›æ—¶å€™å‘å®³æˆ‘ä»¬ã€‚å½“ç„¶ï¼Œè®¨è®ºå¼ºç±»å‹è¿˜æ˜¯å¼±ç±»å‹æ˜¯æ²¡æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œé‡è¦çš„æ˜¯ä»è¿™äº›å¯¹æ¯”ä¸­å­¦åˆ°ä¸€äº›ä¸œè¥¿ï¼Œé¿å…å› æ­¤è€ŒçŠ¯ä¸‹é”™è¯¯ã€‚</p><h1 id="éšå¼ç±»å‹è½¬æ¢æ¢¦å¼€å§‹çš„åœ°æ–¹"><a class="markdownIt-Anchor" href="#éšå¼ç±»å‹è½¬æ¢æ¢¦å¼€å§‹çš„åœ°æ–¹"></a> éšå¼ç±»å‹è½¬æ¢â€”â€”æ¢¦å¼€å§‹çš„åœ°æ–¹</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå¯¹ä¸¤ä¸ªç±»å‹ä¸åŒç±»å‹çš„æ•°æ®æ“ä½œæ—¶ï¼Œå¦‚æœè¿™ä¸¤ä¸ªæ•°æ®åœ¨ä¸€å®šçš„å…¼å®¹èŒƒå›´å†…ï¼ŒCè¯­è¨€ä¼šå¯¹å…¶ä¸­ä¸€ä¸ªæ•°æ®è¿›è¡Œéšå¼çš„ç±»å‹è½¬æ¢ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%80%A7%E5%92%8C%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A81.png" alt="" /></p><p>æˆ‘ä»¬æ‹¿ç»å…¸çš„JAVAè¯­è¨€ä¸¾ä¾‹ï¼ŒJAVAç¦æ­¢äº†<code>boolean</code>ä¸<code>æ•´å‹</code>æ•°æ®ä¹‹é—´çš„ç±»å‹è½¬æ¢ï¼Œä¹Ÿç¦æ­¢äº†<code>æ•´å‹</code>ä¸<code>æµ®ç‚¹å‹</code>æ•°æ®çš„è½¬æ¢ï¼Œä¸ºè¯­è¨€æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ã€‚å¦‚æ­¤ä¸°å¯Œçš„ç±»å‹è½¬æ¢ï¼Œåæ˜ äº†Cè¯­è¨€çš„&quot;å¼±ç±»å‹&quot;ç‰¹æ€§ï¼Œä¸€æ–¹é¢æ˜¯Cè¯­è¨€ä¸ºæˆ‘ä»¬çš„ç¼–ç¨‹æä¾›äº†æ›´é«˜çš„è‡ªç”±åº¦ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¢å¤§äº†éšæ‚£ã€‚</p><p>æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">-1</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(a &gt; b) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a &gt; b&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a &lt; b&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &gt; b</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªéå¸¸æµ…æ˜¾æ˜“æ‡‚çš„ä¾‹å­ï¼Œé€šè¿‡ä¸Šé¢éšå¼ç±»å‹è½¬æ¢çš„ä¼˜å…ˆçº§æˆ‘ä»¬çŸ¥é“æœ‰ç¬¦å·æ•´æ•°è¢«è½¬æ¢æˆäº†æ— ç¬¦å·æ•´æ•°ï¼Œè€Œåœ¨æœ‰ç¬¦å·æ•´æ•°ä¸­æœ€é«˜ä½ç”¨<code>1æ¥ä»£è¡¨è´Ÿæ•°</code>ï¼Œå¯¼è‡´çš„ç»“æœå°±æ˜¯è½¬æ¢åçš„aç›¸å½“çš„å¤§ï¼Œé€ æˆäº†æ„æ–™ä¹‹å¤–çš„é”™è¯¯ã€‚</p><p>å¯¹äºCè¯­è¨€çš„åˆå­¦è€…è€Œè¨€ï¼Œå¯¹äºæ— ç¬¦å·æ•´æ•°çš„åº”ç”¨é¢‘ç‡æ¯”è¾ƒä½ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿä¸ä¼šé€ æˆè¿™æ ·çš„é”™è¯¯ã€‚ä½†æ˜¯ä¸‹é¢çš„ä¾‹å­å°±ä¸ä¸€å®šäº†ã€‚</p><h1 id="å°å¿ƒåº“å‡½æ•°çš„è¿”å›å€¼"><a class="markdownIt-Anchor" href="#å°å¿ƒåº“å‡½æ•°çš„è¿”å›å€¼"></a> å°å¿ƒåº“å‡½æ•°çš„è¿”å›å€¼</h1><p>å¤„ç†å­—ç¬¦ä¸²çš„æ ‡å‡†åº“ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„æ–¹æ³•ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çœŸæ­£å…³æ³¨è¿‡å®ƒä»¬çš„è¿”å›å€¼ç±»å‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå› ä¸ºç±»å‹è½¬æ¢é€ æˆçš„é”™è¯¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="number">-1</span> &gt; <span class="built_in">strlen</span>(<span class="string">&quot;A&quot;</span>))&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YES</span><br></pre></td></tr></table></figure><p>ä»æˆ‘ä»¬ä¸Šé¢çš„é”™è¯¯ä¸­æˆ‘ä»¬ä¸éš¾çŒœå‡º<code>strlenå‡½æ•°è¿”å›å€¼æ˜¯æ— ç¬¦å·æ•´æ•°ç±»å‹</code>ï¼Œæˆ‘ä»¬å†æ¥ç»†çœ‹strlenï¼Œå‘ç°è¿”å›å€¼ç±»å‹æ˜¯<code>size_t</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå…·ä½“å¤§å°ä¸å¹³å°æœ‰å…³ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬è¦å°å¿ƒéšå¼è½¬æ¢ç»™æˆ‘ä»¬å¸¦æ¥çš„é”™è¯¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GDBå¿«é€Ÿå…¥é—¨</title>
      <link href="/2023/01/01/gdb%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
      <url>/2023/01/01/gdb%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>GDBå…¨ç§°GNU symbolic debuggerï¼Œè¯ç”ŸäºGNUè®¡åˆ’ï¼Œæ˜¯ä¸€æ¬¾ç¨‹åºè°ƒè¯•å™¨ï¼Œå¦‚æœè„±ç¦»IDEç¯å¢ƒï¼ŒGDBå°†ä¼šæ˜¯ä½ å¼ºå¤§çš„å¸®æ‰‹ã€‚</p><h1 id="gdbä¸‹è½½å’Œä½¿ç”¨"><a class="markdownIt-Anchor" href="#gdbä¸‹è½½å’Œä½¿ç”¨"></a> GDBä¸‹è½½å’Œä½¿ç”¨</h1><p>åœ¨windowsç¯å¢ƒä¸­åªè¦ä¸‹è½½è¿‡Cè¯­è¨€åº”è¯¥å°±ä¼šæœ‰GDBï¼Œè¿™é‡Œä¸»è¦ä»‹ç»linuxç¯å¢ƒï¼Œä¹Ÿå¾ˆç®€å•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">centos</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum install gdb</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ubuntu</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install gdb</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…¶å®ƒç³»ç»Ÿç±»ä¼¼</span></span><br></pre></td></tr></table></figure><p>è°ƒè¯•ä¸€ä¸ªç¨‹åºï¼Œä¾‹å¦‚æˆ‘ä»¬ç°åœ¨è¦è°ƒè¯•å¯æ‰§è¡Œç¨‹åº<code>a.out</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gdb a.out</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒè¯•ä¸€ä¸ªCè¯­è¨€çš„ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦åœ¨gccç¼–è¯‘æ—¶å¢åŠ <code>-g</code>é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹å‘Šè¯‰ç¼–è¯‘å™¨æ·»åŠ è°ƒè¯•ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc -g main.c</span></span><br></pre></td></tr></table></figure><h1 id="gdbè°ƒè¯•å¸¸ç”¨å‘½ä»¤"><a class="markdownIt-Anchor" href="#gdbè°ƒè¯•å¸¸ç”¨å‘½ä»¤"></a> GDBè°ƒè¯•å¸¸ç”¨å‘½ä»¤</h1><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œæ‹¬å·é‡Œé¢æ˜¯å‘½ä»¤çš„ç¼©å†™ï¼Œä½¿ç”¨ä¸¤è€…éƒ½å¯ä»¥</p><h2 id="runr"><a class="markdownIt-Anchor" href="#runr"></a> runï¼ˆrï¼‰</h2><p>å¯åŠ¨ç¨‹åºï¼Œå¦‚æœæœ‰æ–­ç‚¹åˆ™è¿è¡Œè‡³ç¬¬ä¸€æ–­ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿è¡Œåˆ°ç»“æŸ</p><h2 id="nextn"><a class="markdownIt-Anchor" href="#nextn"></a> nextï¼ˆnï¼‰</h2><p>è®©ç¨‹åºå¾€ä¸‹æ‰§è¡Œä¸€æ­¥</p><h2 id="listl"><a class="markdownIt-Anchor" href="#listl"></a> listï¼ˆlï¼‰</h2><p>åˆ—å‡ºç¨‹åºæºä»£ç åŠå…¶è¡Œå·</p><h2 id="breakb"><a class="markdownIt-Anchor" href="#breakb"></a> breakï¼ˆbï¼‰</h2><p>ç»™ç¨‹åºæ‰“æ–­ç‚¹ï¼Œå¯ä»¥ç»™æŸä¸€è¡Œæ‰“æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥ç»™ä¸€ä¸ªå‡½æ•°æ‰“æ–­ç‚¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">b è¡Œå·</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">b å‡½æ•°å</span></span><br></pre></td></tr></table></figure><h2 id="infoi"><a class="markdownIt-Anchor" href="#infoi"></a> infoï¼ˆiï¼‰</h2><p>æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹æ–­ç‚¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">i b</span></span><br></pre></td></tr></table></figure><h2 id="continuec"><a class="markdownIt-Anchor" href="#continuec"></a> continueï¼ˆcï¼‰</h2><p>å‘ä¸‹æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</p><h2 id="printp"><a class="markdownIt-Anchor" href="#printp"></a> printï¼ˆpï¼‰</h2><p>æ‰“å°å˜é‡ä¿¡æ¯</p><h1 id="è°ƒè¯•coreæ–‡ä»¶"><a class="markdownIt-Anchor" href="#è°ƒè¯•coreæ–‡ä»¶"></a> è°ƒè¯•coreæ–‡ä»¶</h1><p>coreæ–‡ä»¶æ˜¯å†…å­˜çš„æ˜ è±¡ï¼Œå½“ç¨‹åºå´©æºƒçš„æ—¶å€™ï¼Œcoreæ–‡ä»¶ä¿å­˜äº†å†…å­˜çš„çŠ¶æ€ï¼Œç”¨äºè°ƒè¯•ã€‚ç”±äºcoreæ–‡ä»¶ç•¥å¤§ï¼Œé»˜è®¤è¢«é™åˆ¶ç”Ÿæˆã€‚</p><p>æˆ‘ä»¬å¯ä»¥è§£é™¤è¿™ä¸ªé™åˆ¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ulimit</span> -c unlimited</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å†™ä¸€æ®µä¼šå¯¼è‡´å´©æºƒçš„ç¨‹åº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> *a = <span class="literal">NULL</span>;</span><br><span class="line">    *a = <span class="number">1</span>; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å´©æºƒåäº§ç”Ÿcoreæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>core.2197</code>ï¼Œç”¨GDBè°ƒè¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gdb a.out core.2197</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹åˆ°å´©æºƒçš„åœ°æ–¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Program terminated with signal 11, Segmentation fault.</span><br><span class="line">#0  0x00000000004004dd in main () at a.c:4</span><br><span class="line">4           *a = 1;</span><br></pre></td></tr></table></figure><p>okï¼Œè¿™å°±æ˜¯GDBçš„ç®€å•ä½¿ç”¨äº†</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æŒ‡é’ˆå’Œæ•°ç»„å¹¶ä¸ç›¸åŒâ€”â€”Cè¯­è¨€</title>
      <link href="/2022/12/27/%E6%8C%87%E9%92%88%E5%92%8C%E6%95%B0%E7%BB%84%E5%B9%B6%E4%B8%8D%E7%9B%B8%E5%90%8C%E2%80%94%E2%80%94C%E8%AF%AD%E8%A8%80/"/>
      <url>/2022/12/27/%E6%8C%87%E9%92%88%E5%92%8C%E6%95%B0%E7%BB%84%E5%B9%B6%E4%B8%8D%E7%9B%B8%E5%90%8C%E2%80%94%E2%80%94C%E8%AF%AD%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æˆ‘ä»¬åˆå­¦Cè¯­è¨€æ—¶ï¼Œæˆ‘ä»¬ä¼šæœ‰è¿™æ ·ä¸€ä¸ªè®¤çŸ¥æˆ–è€…æ„Ÿè§‰ï¼šæŒ‡é’ˆå’Œæ•°ç»„æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬ä¹Ÿç»å¸¸å¹²ç€è¿™æ ·çš„äº‹æƒ…ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ä»£ç ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> a[<span class="number">3</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    <span class="type">int</span> *p = a;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, p[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,*(a+<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çœ‹èµ·æ¥ä¸¤è€…ä¼¼ä¹ç¡®å®æ²¡æœ‰å·®åˆ«ï¼ŒæŒ‡é’ˆå¯ä»¥åƒæ•°ç»„ä¸€æ ·ä½¿ç”¨<code>[]</code>ï¼Œè€Œæ•°ç»„åä¹Ÿå¯ä»¥<code>è§£å¼•ç”¨</code>ï¼Œè€Œä¸”å®ƒä»¬çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p><p>æˆ–è€…åœ¨æˆ‘ä»¬å®šä¹‰å‡½æ•°æ—¶ï¼Œä¹Ÿå¯èƒ½ä¼šæŠŠä¸¤è€…å½“æˆä¸€ç§å¤„ç†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">foo</span><span class="params">(<span class="type">int</span> *p)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;foo: %d&quot;</span>, p[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> a[<span class="number">3</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    foo(a);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ˜¯é‚£ä¹ˆè‡ªç„¶ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦è‚¯å®šï¼Œä¸¤è€…ä¹‹å‰ç¡®å®æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥æŠŠä¸¤è€…åˆ’ä¸Šä¸€ä¸ªç­‰å·ï¼Œé‚£å°±å¤§é”™ç‰¹é”™äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ä¸¤è€…ä¹‹é—´åˆ°åº•æœ‰å“ªäº›åŒºåˆ«ã€‚</p><h1 id="æ•°ç»„ä¸­åˆ°åº•å­˜äº†ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#æ•°ç»„ä¸­åˆ°åº•å­˜äº†ä»€ä¹ˆ"></a> æ•°ç»„ä¸­åˆ°åº•å­˜äº†ä»€ä¹ˆ</h1><p>è¿™ä¸ªé—®é¢˜ä¼¼ä¹å¾ˆç®€å•</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ•°ç»„ï¼Œåªè¦å­¦è¿‡Cè¯­è¨€çš„æ•°ç»„ï¼Œä½ å‡ ä¹å¯ä»¥ä¸å‡æ€ç´¢çš„å›ç­”å‡ºæ¥ï¼Œå­˜äº†<code>1,2å’Œ3</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[<span class="number">3</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure><p>okï¼Œé‚£ä¹ˆç»§ç»­æ¥å›ç­”ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼Œä¸‹é¢è¿™ä¸ªæŒ‡é’ˆpä¸­å­˜äº†ä»€ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œå‚¨å­˜äº†<code>açš„åœ°å€</code>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p = a;</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯¹ä¸Šé¢çš„é—®é¢˜æ²¡æœ‰å¼‚è®®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”»å‡ºè¿™æ ·çš„å†…å­˜å›¾</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/NGW.png" alt="NGW" /></p><p>okï¼Œæˆ‘ä»¬å†å›æ¥çœ‹å‰é¢çš„èµ‹å€¼ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠ<code>a</code>çš„å€¼èµ‹ç»™äº†<code>p</code>ï¼Œé‚£ä¹ˆ<code>a</code>çš„å€¼æ˜¯å­˜æ”¾åœ¨å“ªé‡Œçš„å‘¢ï¼Œä¹Ÿå°±æ˜¯<code>0x10000</code>è¿™ä¸ªå€¼åŸæ¥æ˜¯å­˜æ”¾åœ¨äº†ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p = a;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼¼ä¹æ‰¾ä¸åˆ°<code>0x10000</code>çš„æ‰€åœ¨ä½ç½®ï¼Œè€Œåœ¨<code>a</code>è¿™ä¸ªä½ç½®ä¸Šå‚¨å­˜çš„æ˜¯<code>1</code>ï¼Œæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªèµ‹å€¼è¯­å¥ï¼Œæ˜¯ä¸æ˜¯çªç„¶åˆå›°æƒ‘èµ·æ¥äº†ï¼Œå¥½åƒ<code>=</code>è¿™ä¸ªæ“ä½œç¬¦ä¹Ÿä¸æ˜¯é‚£ä¹ˆè‡ªç„¶äº†ï¼ŒæŒ‰ç…§æˆ‘ä»¬å¯¹äº<code>=</code>çš„ç†è§£ï¼Œåº”è¯¥æ˜¯æŠŠ<code>1</code>èµ‹å€¼ç»™<code>p</code>ã€‚</p><p>é‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Œæˆ‘è®°å¾—æˆ‘ä»¬åˆå­¦Cè¯­è¨€æ—¶ï¼Œæ•™ç§‘ä¹¦ä¸Šå¯¹äºæ•°ç»„åçš„è¯´æ˜æ˜¯ï¼š<code>æ•°ç»„åä»£è¡¨çš„æ˜¯è¯¥æ•°ç»„é¦–å…ƒç´ çš„åœ°å€</code>ï¼Œæˆ‘ä»¬è¦æ³¨æ„è¿™ä¸ª<code>ä»£è¡¨</code>ï¼Œä¹Ÿå°±è¯´è¿™ä¸ª<code>a</code>æ‰€å‚¨å­˜çš„åœ°å€åœ¨å†…å­˜ä¸­å¹¶æ²¡æœ‰åˆ†é…ç©ºé—´ï¼Œ<code>aä¹Ÿä»…ä»…åªæ˜¯ä»£è¡¨äº†ä¸€ä¸ªåœ°å€</code>ã€‚å…·ä½“ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œè¿™æ˜¯Cè¯­è¨€å†…éƒ¨è¦åšçš„ï¼Œå°±ä¸ç”¨æˆ‘ä»¬æ“å¿ƒäº†ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ•°ç»„åä»£è¡¨äº†æ•°ç»„é¦–å…ƒç´ çš„åœ°å€ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç»™è¿™ä¸ªåœ°å€çš„å­˜å‚¨åˆ†é…ä¸€ä¸ªç©ºé—´ã€‚</p><p>ä»ä¸€ç‚¹ä¸Šæ¥çœ‹ï¼Œæ•°ç»„å’ŒæŒ‡é’ˆå·²ç»æœ‰äº†æ˜æ˜¾çš„ä¸åŒäº†ï¼Œè€Œæ•°ç»„åå®é™…ä¸Šæ²¡æœ‰ç”¨ç©ºé—´æ¥å­˜ä¸‹åœ°å€ï¼Œæ‰€ä»¥æ•°ç»„åä¹Ÿæ˜¯ä¸èƒ½å¤Ÿä½œä¸ºå·¦å€¼çš„ï¼Œæ¯”å¦‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[<span class="number">3</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// 1.</span></span><br><span class="line"><span class="type">int</span> b[<span class="number">3</span>] = &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line">a = b;</span><br><span class="line"><span class="comment">// 2.</span></span><br><span class="line"><span class="type">int</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> *p = &amp;b;</span><br><span class="line">a = p;</span><br><span class="line"><span class="comment">// æ•°ç»„åä¸å¯è¢«èµ‹å€¼</span></span><br></pre></td></tr></table></figure><h1 id="æ•°ç»„å’ŒæŒ‡é’ˆåˆ†åˆ«æ˜¯å¦‚ä½•å·¥ä½œçš„"><a class="markdownIt-Anchor" href="#æ•°ç»„å’ŒæŒ‡é’ˆåˆ†åˆ«æ˜¯å¦‚ä½•å·¥ä½œçš„"></a> æ•°ç»„å’ŒæŒ‡é’ˆåˆ†åˆ«æ˜¯å¦‚ä½•å·¥ä½œçš„</h1><p>æˆ‘ä»¬å†ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚æœæŠŠæ•°ç»„åå’ŒæŒ‡é’ˆç­‰åŒä¼šé—¹å‡ºæ€ä¹ˆæ ·çš„ç¬‘è¯ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸‹ï¼ŒæŒ‡é’ˆæ˜¯å¦‚ä½•å·¥ä½œçš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,*p);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½å¾ˆå¥½ç†è§£</p><ol><li><p>å–å‡ºåœ°å€<code>0x10000</code></p></li><li><p>å†æ ¹æ®åœ°å€<code>0x10000</code>å–å‡ºåœ°å€ä¸­çš„å€¼</p></li></ol><p>è¿™ä¸ªæˆ‘ç›¸ä¿¡å¯¹äºå­¦è¿‡Cè¯­è¨€æŒ‡é’ˆçš„å¤§å®¶éƒ½å¾ˆå¥½ç†è§£ï¼Œå¦‚æœæˆ‘ä»¬æ¢æˆæ•°ç»„åå‘¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,*a);</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æŒ‰ç…§æŒ‡é’ˆçš„å·¥ä½œæ–¹å¼å»ç†è§£å®ƒï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥åº”è¯¥æ˜¯å–å‡ºåœ°å€ï¼Œé‚£ä¹ˆåœ°å€æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬ä¼šæƒŠäººçš„å‘ç°è¿™ä¸ª<code>åœ°å€ç«Ÿç„¶æ˜¯1</code>ï¼Œè¿™æ¯«æ— ç–‘é—®æ˜¯ä¸€ä¸ªæ— æ•ˆåœ°å€ï¼Œæ­¤æ—¶å¦‚æœç¨‹åºå´©æºƒæˆ‘ä»¬åº”è¯¥åº†å¹¸ï¼Œå¦åˆ™å°†ä¼šäº§ç”Ÿæ— æ³•é¢„æ–™çš„åæœã€‚</p><p>ä½†äº‹å®ä¸Šï¼Œä¸Šé¢<code>*a</code>çš„æ–¹å¼ä¹Ÿå¯ä»¥æ­£ç¡®çš„å–å‡ºå€¼ï¼Œè¿™æˆ‘ä»¬åˆæ˜¯ä¸€ä¸ªæ··æ·†æŒ‡é’ˆå’Œæ•°ç»„åçš„åŸå› ã€‚</p><p>ç”±ä¸Šæˆ‘ä»¬ä¸éš¾å‘ç°ï¼ŒCè¯­è¨€åœ¨è§£å¼•ç”¨æ—¶ï¼Œå¯¹å¾…æ•°ç»„åå’ŒæŒ‡é’ˆçš„ç­–ç•¥æ˜¯ä¸ä¸€æ ·çš„ã€‚é‚£æˆ‘ä»¬ä¸å¦¨å†ç»†åˆ†ä¸€ä¸‹å®ƒä»¬çš„å·¥ä½œæµç¨‹ï¼Œä»”ç»†çœ‹çœ‹å®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221228102700430.png" alt="" /></p><p>æˆ‘ä»¬å‡è®¾<code>æŒ‡é’ˆP</code>çš„åœ°å€æ˜¯<code>0x20000</code>ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>*p</code>çš„å·¥ä½œæµç¨‹ï¼š</p><ol><li>æ‰¾åˆ°æŒ‡é’ˆPæ‰€åœ¨çš„åœ°å€<code>0x20000</code></li><li>å–å‡ºè¿™ä¸ªåœ°å€çš„å€¼<code>0x10000</code></li><li>æœ€åå†æ ¹æ®åœ°å€<code>0x10000</code>å–å‡ºå€¼<code>1</code></li></ol><p>å†æ¥çœ‹çœ‹<code>*a</code>çš„å·¥ä½œæµç¨‹ï¼š</p><ol><li>æ‰¾åˆ°<code>a</code>æ‰€åœ¨çš„åœ°å€<code>0x10000</code></li><li>å–å‡º<code>0x10000</code>çš„å€¼<code>1</code></li></ol><p>æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯å‘ç°ä¸¤è€…å¤§ä¸ç›¸åŒï¼Œè‡³äºæ˜¯å¦‚ä½•æ‰¾åˆ°æŒ‡é’ˆåœ°å€<code>0x20000</code>çš„ï¼Œè¿™ä¸ªå°±è¦äº¤ç»™Cè¯­è¨€æœ¬èº«äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒã€‚</p><p>å¥½äº†ï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘å¹¶ä¸æ˜¯è¦è¯´ä»¥å‰çš„ç”¨æ³•éƒ½æ˜¯é”™è¯¯çš„ï¼Œäº‹å®ä¸Šï¼ŒCè¯­è¨€å…è®¸æˆ‘ä»¬è¿™æ ·å»å¤„ç†ï¼Œè¿™æ ·å¤„ç†èµ·æ¥æ›´æ–¹ä¾¿ï¼Œå…¶å®å°±å¤Ÿäº†ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ç”¨ä»¥å‰çš„æ–¹æ³•å»åšã€‚ä¸»è¦ç›®çš„è¿˜æ˜¯å¸Œæœ›å¤§å®¶åœ¨ä½¿ç”¨ä¸¤è€…çš„åŒæ—¶æ›´è¦æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œè¿™æ ·ä¸€æ˜¯å¯ä»¥æ›´å¥½çš„ä½¿ç”¨å®ƒä»¬ï¼ŒäºŒæ˜¯ä¹Ÿå‡å°äº†æˆ‘ä»¬å†™å‡ºé”™è¯¯ä»£ç çš„å¯èƒ½æ€§ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Dosboxå’Œmasmæ­å»ºæ±‡ç¼–ç¯å¢ƒ</title>
      <link href="/2022/12/26/Dosbox%E5%92%8Cmasm%E6%90%AD%E5%BB%BA%E6%B1%87%E7%BC%96%E7%8E%AF%E5%A2%83/"/>
      <url>/2022/12/26/Dosbox%E5%92%8Cmasm%E6%90%AD%E5%BB%BA%E6%B1%87%E7%BC%96%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>å­¦ä¹ æ±‡ç¼–è¯­è¨€ä¹‹å‰ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç¯å¢ƒæ¥è¿è¡Œæ±‡ç¼–ä»£ç ï¼Œæ‰€ä»¥æ­¤æ–‡è®°å½•ä¸‹è‡ªå·±çš„ç¯å¢ƒæ­å»ºè¿‡ç¨‹</p><h1 id="ä¸‹è½½dosboxå’Œmasm"><a class="markdownIt-Anchor" href="#ä¸‹è½½dosboxå’Œmasm"></a> ä¸‹è½½Dosboxå’Œmasm</h1><p>Dosboxæä¾›32ä½æœºç¯å¢ƒï¼Œmasmè´Ÿè´£ç¼–è¯‘æ±‡ç¼–ä»£ç </p><p>Doxboxä¸‹è½½åœ°å€</p><p><a href="https://www.dosbox.com/download.php?main=1">Doså®˜ç½‘</a></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221226105031616.png" alt="image-20221226105031616" /></p><p>ç‚¹å‡»Downloadä¸‹è½½å³å¯</p><p>æ¥ä¸‹æ¥å®‰è£…masm</p><p><a href="https://github.com/xDarkLemon/DOSBox_MASM/tree/master">https://github.com/xDarkLemon/DOSBox_MASM/tree/master</a></p><p>ä¸‹è½½è§£å‹ä»¥åæˆ‘ä»¬åªéœ€è¦è¿™ä¸ªmasmæ–‡ä»¶å¤¹</p><h1 id="é…ç½®dosbox"><a class="markdownIt-Anchor" href="#é…ç½®dosbox"></a> é…ç½®Dosbox</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æŠŠmasmé…ç½®åˆ°Dosboxä¸­ï¼Œæˆ‘ä»¬æ‰“å¼€<code>DOSBox 0.74-3 Options.bat</code>æ–‡ä»¶</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221226105813360.png" alt="image-20221226105813360" /></p><p>åœ¨æ–‡ä»¶çš„åº•éƒ¨åŠ å…¥å¦‚ä¸‹å†…å®¹ï¼ŒæŠŠ<code>D:\1Packages\Debug</code>æ¢æˆ<code>ä½ è‡ªå·±masmæ–‡ä»¶å¤¹æ‰€åœ¨ä½ç½®</code>ï¼Œæ­¤å¤–æˆ‘ä»¬åœ¨ç›¸åŒç›®å½•ä¸‹å¯ä»¥æ–°å»ºä¸€ä¸ªasmç›®å½•ä½œä¸ºå·¥ä½œç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MOUNT F  D:\1Packages\Debug</span><br><span class="line">set PATH=%PATH%;F:\masm;</span><br><span class="line">F:</span><br><span class="line">cd F:\ASM</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221226110006515.png" alt="image-20221226110006515" /></p><p>æ„æ€æ˜¯æŠŠæœ¬æœºçš„<code>D:\1Packages\Debug</code>ç›®å½•æŒ‚è½½åˆ°<code>Dosboxçš„Fç›˜</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨Dosboxä¸‹çš„Fç›˜ç›´æ¥ä½¿ç”¨masmå‘½ä»¤äº†</p><p>è¿™æ ·å°±é…ç½®å®Œæˆäº†ï¼Œå¦‚æœè§‰å¾—çª—å£å¤ªå°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>alt+enter</code>æ¥ä½¿å¾—çª—å£å…¨å±ï¼Œå†æ¬¡æŒ‰ä¸‹é€€å‡ºå…¨å±ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(äºŒ)dockerçš„åŸºæœ¬ä½¿ç”¨</title>
      <link href="/2022/12/17/docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/12/17/docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç¬¬ä¸€èŠ‚çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†dockerçš„ä½œç”¨ï¼Œä»¥åŠå®Œæˆäº†dockerçš„å®‰è£…å’Œdockerçš„hello worldï¼Œåˆæ­¥è¿›å…¥äº†dockerçš„æ—¶é—´ï¼Œè¿™ä¸€èŠ‚å†…å®¹ä¼šä»dockerçš„åŸºæœ¬æ¶æ„å‡ºå‘ï¼Œè®²è§£ç»„æˆæ¶æ„ä¸­ç»„æˆéƒ¨åˆ†çš„å…³ç³»ä»¥åŠå¦‚ä½•æ“ä½œå®ƒä»¬ã€‚</p><h1 id="dockerçš„æ¶æ„"><a class="markdownIt-Anchor" href="#dockerçš„æ¶æ„"></a> Dockerçš„æ¶æ„</h1><p>æ¥ä¸‹æ¥æˆ‘ä¼šè®²è§£dockerçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼Œåœ¨å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹dockerçš„æ•´ä½“æ¶æ„ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/c8116066bdbf295a7c9fc25b87755dfe.png" alt="c8116066bdbf295a7c9fc25b87755dfe" /></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹dockerçš„ç»„æˆéƒ¨åˆ†ï¼Œé¦–å…ˆdockeræ˜¯æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯çš„ï¼Œæ˜¯ä¸€ä¸ªC/Sæ¶æ„ã€‚</p><p>ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹dockeræœ€æ ¸å¿ƒçš„éƒ¨åˆ†â€”â€”<code>å®¹å™¨</code>ï¼Œ<code>é•œåƒ</code>ï¼Œ<code>ä»“åº“</code>ã€‚æˆ‘ä»¬ä¹‹å‰è¯´äº†dockeræŠŠè½¯ä»¶å’Œç¯å¢ƒæ‰“åŒ…åˆ°ä¸€èµ·ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‰“åŒ…çš„ç»“æœå°±æ˜¯ä¸€ä¸ª<code>é•œåƒ</code>ï¼Œè¿™ä¸ª<code>é•œåƒæ˜¯ä¸€ä¸ªæ¨¡æ¿</code>ï¼Œå¦‚æœæˆ‘ä»¬è¦è¿è¡Œè¿™ä¸ªåº”ç”¨ï¼Œdockerä¼šæŒ‰ç…§è¿™ä¸ªæ¨¡æ¿ï¼Œç”Ÿæˆä¸€ä¸ª<code>å®¹å™¨å»è¿è¡Œè¿™ä¸ªåº”ç”¨</code>ã€‚</p><p>ä¸åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºç›¸å¯¹æ¯”ï¼Œ<code>é•œåƒ</code>å°±ç±»ä¼¼äº<code>iso</code>æ–‡ä»¶ï¼Œè€Œ<code>å®¹å™¨</code>å°±ç±»ä¼¼äº<code>è™šæ‹Ÿæœº</code>ï¼Œé•œåƒåªæ˜¯å……å½“äº†ä¸€ä¸ªä¸å˜çš„æ¨¡æ¿ï¼Œè€Œæ ¹æ®è¿™ä¸ªæ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä»»æ„æ•°é‡çš„â€œå®¹å™¨â€ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221217101801776.png" alt="image-20221217101801776" /></p><p>é‚£ä¹ˆ<code>ä»“åº“</code>è¿™ä¸ªæ¦‚å¿µä¹Ÿå°±å¥½ç†è§£äº†ï¼Œ<code>ä»“åº“</code>å°±æ˜¯ç”¨äºå­˜æ”¾<code>é•œåƒ</code>çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»“åº“å»ä¸‹è½½æˆ‘ä»¬éœ€è¦çš„é•œåƒï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±å…ˆä»<code>å®¹å™¨</code>,<code>é•œåƒ</code>è¿™ä¸¤ä¸ªæ–¹é¢æ¥è®²è¿°dockerçš„æ“ä½œã€‚</p><h1 id="é•œåƒçš„åŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#é•œåƒçš„åŸºæœ¬æ“ä½œ"></a> é•œåƒçš„åŸºæœ¬æ“ä½œ</h1><p>åŸºæœ¬æ“ä½œæ— éæ˜¯å¦‚ä½•ä¸‹è½½ï¼Œå¦‚ä½•æŸ¥çœ‹ï¼Œå¦‚ä½•åˆ é™¤ï¼Œå…ˆæ¥çœ‹çœ‹é•œåƒçš„æŸ¥çœ‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹‹å‰è¿è¡Œè¿‡hello-worldå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªé•œåƒï¼Œhello-worldï¼Œä¸€ä¸ªé•œåƒçš„ä¿¡æ¯åŒ…æ‹¬å®ƒçš„<code>åå­—</code>ï¼Œ<code>æ ‡ç­¾</code>ï¼Œ<code>ID</code>ï¼Œ<code>åˆ›å»ºæ—¶é—´</code>ä»¥åŠ<code>é•œåƒçš„å¤§å°</code>ï¼Œé•œåƒçš„IDç”¨äºå”¯ä¸€çš„æ ‡è¯†æ¯ä¸ªé•œåƒï¼Œåœ¨æ‰§è¡Œç›¸å…³çš„æ“ä½œå¯ä»¥ç”¨<code>é•œåƒçš„IDæ¥ä»£æ›¿é•œåƒçš„åå­—</code>ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°hello-worldè¿™ä¸ªé•œåƒçš„å¤§å°ååˆ†è½»é‡ï¼Œåªæœ‰åå‡ KBã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    feb5d9fea6a5   14 months ago   13.3kB</span><br></pre></td></tr></table></figure><p>åœ¨ç”¨é•œåƒçš„IDä»£æ›¿é•œåƒåå­—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åªä½¿ç”¨<code>é•œåƒIDçš„å‰ç¼€</code>ï¼Œ<code>åªè¦è¿™ä¸ªå‰ç¼€ä¸å­˜åœ¨äºå…¶å®ƒé•œåƒä¸­</code>ï¼Œä¸ä¼šé€ æˆæ­§ä¹‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥<code>å°½å¯èƒ½çŸ­</code>çš„ä½¿ç”¨IDå‰ç¼€ã€‚</p><p>åŠ å…¥æˆ‘ä»¬è¿™ä¸ªæ—¶å€™åªæœ‰è¿™ä¸€ä¸ªé•œåƒï¼Œé‚£ä¹ˆç°åœ¨æœ‰ä¸¤ç§åˆ é™¤é•œåƒçš„æ–¹å¼ï¼Œç”¨<code>åå­—æŒ‡å®š</code>å’Œç”¨<code>IDæŒ‡å®š</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker rmi hello-world</span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker rmi f <span class="comment"># åªæœ‰è¿™ä¸€ä¸ªé•œåƒï¼Œé‡‡ç”¨IDçš„ç¬¬ä¸€ä½ä¹Ÿä¸ä¼šé€ æˆæ­§ä¹‰,ä¹Ÿå°±æ˜¯feb5d9fea6a5çš„ç¬¬ä¸€ä½ï¼Œf</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é•œåƒï¼Œå‘ç°hello-worldå·²ç»è¢«åˆ é™¤äº†</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images</span></span><br></pre></td></tr></table></figure><p>å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬ç”¨IDçš„å‰ä¸¤åˆ°ä¸‰ä½å°±è¶³ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒäº†ï¼Œåé¢çš„é•œåƒä¹Ÿå­˜åœ¨ç±»ä¼¼çš„æ“ä½œï¼Œäº‹å®ä¸Š<code>docker images</code>è¿™ä¸ªå‘½ä»¤å±•ç¤ºç»™æˆ‘ä»¬çš„IDä¹Ÿåªæ˜¯ä¸€ä¸ªå‰ç¼€ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»åˆ é™¤äº†hello-worldè¿™ä¸ªé•œåƒï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æŠŠå®ƒé‡æ–°ä¸‹è½½å›æ¥ã€‚</p><p>ä¸‹è½½é•œåƒé‡‡ç”¨çš„æ˜¯<code>docker pull</code>è¿™ä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªé•œåƒåŒ…æ‹¬<code>é•œåƒçš„åå­—</code>å’Œ<code>é•œåƒçš„æ ‡ç­¾</code>ï¼Œå¦‚æœä¸å¸¦æ ‡ç­¾é»˜è®¤å°±æ˜¯<code>lastest</code>è¿™ä¸ªæ ‡ç­¾ã€‚ç°åœ¨æˆ‘ä»¬æ¥ä¸‹è½½<code>hello-world</code>ï¼Œä¹Ÿå°±æ˜¯<code>hello-world:lastest</code>è¿™ä¸ªé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker pull hello-world</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°hello-worldå·²ç»ä¸‹è½½å®Œæˆ</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•æŸ¥æ‰¾æˆ‘ä»¬éœ€è¦çš„é•œåƒå‘¢ï¼Œåé¢æˆ‘åœ¨å°†ä»“åº“çš„æ—¶å€™ä¼šè¿›è¡Œæ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œç°åœ¨å…ˆä»‹ç»ä½¿ç”¨dockerå‘½ä»¤çš„æ–¹å¼æŸ¥æ‰¾ã€‚</p><p>ä½¿ç”¨<code>docker search</code>æ¥æŸ¥çœ‹å¯ä»¥ä¸‹è½½çš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker search nginx</span></span><br></pre></td></tr></table></figure><p>åœ¨æ‰¾åˆ°é•œåƒä»¥åï¼Œå°±å¯ä»¥æ ¹æ®é•œåƒçš„åå­—æ¥ä¸‹è½½æˆ‘ä»¬éœ€è¦çš„é•œåƒäº†ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221217111216995.png" alt="image-20221217111216995" /></p><h1 id="å®¹å™¨çš„åŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#å®¹å™¨çš„åŸºæœ¬æ“ä½œ"></a> å®¹å™¨çš„åŸºæœ¬æ“ä½œ</h1><p>é•œåƒæ˜¯çœŸæ­£è¿è¡Œçš„è½¯ä»¶ï¼Œæ“ä½œç›¸å¯¹æ¥è¯´æ¯”é•œåƒå¤æ‚äº›ã€‚</p><p>å®¹å™¨æ˜¯çœŸæ­£æ‰æ˜¯çœŸæ­£è¿è¡Œçš„ç¨‹åºï¼Œæ‰€ä»¥å¦‚ä½•è¿è¡Œä¸€ä¸ªå®¹å™¨æ˜¾ç„¶æ˜¯ç›¸å½“é‡è¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥å­¦ç€æ€ä¹ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿå¾ˆç®€å•ï¼Œä»¥è¿è¡Œhello-worldä¸ºä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run hello-world</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å½“ç„¶ï¼Œç”¨é•œåƒIDä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run f</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æŠŠhello-worldè¿™ä¸ªé•œåƒè¿è¡Œèµ·æ¥äº†ï¼Œè¿™ä¸ªé•œåƒå®Œæˆçš„ä»»åŠ¡å°±æ˜¯æ‰“å°å‡ºä¸€äº›æç¤ºä¿¡æ¯ã€‚</p><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰§è¡Œçš„docker run hello-worldå—ï¼Œé‚£æ—¶æˆ‘ä»¬å¹¶<code>æ²¡æœ‰æå‰æ‹‰å–é•œåƒ</code>ï¼Œä½†æ˜¯ä¾ç„¶<code>æˆåŠŸè¿è¡Œäº†å®¹å™¨</code>ï¼Œæˆ‘ä»¬ä¸å¦¨å›é¡¾ä¸€ä¸‹dockerçš„æ¶æ„å›¾ï¼Œrunè¿™ä¸ªå‘½ä»¤åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆæŸ¥çœ‹<code>æœ¬åœ°æ˜¯å¦æœ‰è¿™ä¸ªé•œåƒ</code>ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªé•œåƒï¼Œä¼šå…ˆä»<code>ä»“åº“æ‹‰å–é•œåƒç„¶åå†è¿è¡Œ</code>ã€‚</p><p>è¿è¡ŒæˆåŠŸå®¹å™¨ä»¥åï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ‰€æœ‰çš„å®¹å™¨ã€‚è¿™é‡Œåº”è¯¥ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå½“å®¹å™¨æ²¡æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œdockerä¼šåœæ­¢è¿™ä¸ªå®¹å™¨ï¼Œhello-worldè¿™ä¸ªé•œåƒå› ä¸ºåªæœ‰æ‰“å°ä¿¡æ¯è¿™ä¸ªä»»åŠ¡ï¼Œæ‰€ä»¥å®Œæˆä»¥åå®¹å™¨å°±ä¼šè¢«åœæ­¢ã€‚<code>docker ps</code>åªèƒ½æŸ¥çœ‹<code>æ­£åœ¨è¿è¡Œçš„å®¹å™¨</code>ï¼Œå¦‚æœè¦æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼Œéœ€è¦æ·»åŠ <code>-a</code>å‚æ•°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps -a</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¹å™¨çš„ä¸€äº›ä¿¡æ¯,åŒ…æ‹¬<code>ID</code>ï¼Œ<code>åå­—</code>ç­‰ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¹å™¨çš„åå­—æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID   IMAGE       COMMAND  CREATED          STATUS             PORTS  NAMES</span><br><span class="line">2eeaafa5c921   hello-world &quot;/hello&quot; 3 seconds ago    Exited (0) 2 seconds ago        competent_poitras</span><br></pre></td></tr></table></figure><p>å› ä¸ºhello-worldè¿™ä¸ªé•œåƒä¸å…·å¤‡æŒç»­è¿è¡Œçš„èƒ½åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥ç”¨<code>nginx</code>è¿™ä¸ªé•œåƒä½œä¸ºæ¡ˆä¾‹ç»§ç»­æ•™å­¦ï¼Œ<code>-d</code>å‚æ•°è¡¨ç¤ºè®©è¿™ä¸ªå®¹å™¨åœ¨åå°è¿è¡Œï¼Œ<code>--name</code>å¯ä»¥æŒ‡å®šè¿™ä¸ªå®¹å™¨çš„åå­—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker pull nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d --name nginx nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹æˆ‘ä»¬è¿è¡Œçš„nginxï¼Œnginxä¼š<code>ç›‘å¬80ç«¯å£</code>ï¼Œæ‰€æœ‰æˆ‘ä»¬å»æµè§ˆå™¨è®¿é—®ä¸€ä¸‹80ç«¯å£</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221217122353083.png" alt="image-20221217122353083" /></p><p>æˆ‘ä»¬ä¼šå‘ç°è®¿é—®å¤±è´¥äº†ï¼Œè¿™å¹¶ä¸æ˜¯è¿è¡Œå¤±è´¥äº†ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªç½‘ç»œçš„é—®é¢˜ï¼Œæš‚ä¸”ã€‚ä¹‹å‰è¯´è¿‡ï¼Œdockerä¼šæŠŠåº”ç”¨å’Œå®ƒçš„ç¯å¢ƒæ‰“åŒ…åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªæ‰“åŒ…åçš„è¿è¡Œçš„å®¹å™¨å°±ç±»ä¼¼äºè™šæ‹Ÿæœºï¼Œè¦çŸ¥é“ï¼Œè™šæ‹Ÿæœºä¸æˆ‘ä»¬æœ¬æœº<code>å¹¶ä¸ä¼šå…±äº«ä¸€ä¸ªç½‘ç»œ</code>ï¼Œä¹Ÿå°±æ˜¯è¯´è™½ç„¶nginxç›‘å¬äº†80ç«¯å£ï¼Œä½†æ˜¯å®ƒç›‘å¬çš„å®é™…ä¸Šæ˜¯<code>nginxè¿™ä¸ªå®¹å™¨å†…éƒ¨çš„80ç«¯å£</code>ï¼Œä¸ºäº†éªŒè¯è¿™ä¸ªè¯´æ³•ï¼Œæˆ‘ä»¬è¿›å…¥åˆ°nginxè¿™ä¸ªå®¹å™¨å†…éƒ¨å»ä¸€æ¢ç©¶ç«Ÿã€‚</p><p>execå¯ä»¥åœ¨å®¹å™¨å†…æ‰§è¡Œå¦å¤–çš„ç¨‹åºï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›å…¥åˆ°å®¹å™¨ä¸­ï¼Œ<code>-it</code>è¿™ä¸ªå‚æ•°æ˜¯ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªå¯ä»¥äº¤äº’çš„shellï¼Œ<code>/bin/bash</code>æ˜¯åœ¨å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰§è¡Œä¸‹é¢è¿™ä¸ªå‘½ä»¤ä»¥åæˆ‘ä»¬å°±è¿›å…¥åˆ°äº†å®¹å™¨ä¸­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">exec</span> -it nginx /bin/bash</span></span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ°å®¹å™¨ä»¥åï¼Œæˆ‘ä»¬å°è¯•åœ¨å®¹å™¨ä¸­å»è®¿é—®80ç«¯å£ï¼Œçœ‹çœ‹nginxæ˜¯å¦ç›‘å¬äº†80ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl localhost</span></span><br></pre></td></tr></table></figure><p>å“åº”å¦‚ä¸‹ï¼Œè¯´æ˜ç¡®å®ç›‘å¬äº†å®¹å™¨å†…éƒ¨çš„80ç«¯å£ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å…³äºå®¹å™¨ç½‘ç»œï¼Œæˆ‘ä»¬æ”¾åœ¨ä¹‹åçš„ç« èŠ‚å†è¯¦ç»†ä»‹ç»ã€‚</p><p>ç„¶åæˆ‘ä»¬æ¥ç€å°è¯•å»å…³é—­ï¼Œæ‰“å¼€ï¼Œåˆ é™¤è¿™ä¸ªå®¹å™¨ï¼Œå®¹å™¨å’Œé•œåƒä¸€æ ·ï¼Œéƒ½å¯ä»¥ç”¨<code>IDæ¥ä»£æ›¿åå­—</code>ï¼Œè¿™é‡Œå°±ä¸å°è¯•äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stop nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker start nginx</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤ä¹‹å‰è¦å…ˆå…³é—­</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker stop nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">rm</span> nginx</span></span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå¦‚æœæˆ‘ä»¬ä¸€å®šè¦åœ¨è‡ªå·±çš„ä¸»æœºä¸Šè®¿é—®nginxçš„æœåŠ¡æ€ä¹ˆåŠå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®¹å™¨å†…éƒ¨çš„ç«¯å£æ˜ å°„åˆ°ä¸»æœºï¼Œé‡‡ç”¨<code>-p</code>å‚æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°ï¼Œåé¢çš„<code>80:80</code>è¡¨ç¤º<code>ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨ç«¯å£</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…ˆåˆ é™¤åŸæ¥çš„å®¹å™¨</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker <span class="built_in">rm</span> nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d -p 80:80 --name nginx</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼Œå¤§åŠŸå‘Šæˆ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221217123851938.png" alt="image-20221217123851938" /></p><p>æœ€åæˆ‘æ¥æ€»ç»“ä¸€ä¸‹å®¹å™¨çš„å¸¸ç”¨æ“ä½œ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221217124243311.png" alt="image-20221217124243311" /></p><p>è¿™ä¸€èŠ‚ä»‹ç»äº†å®¹å™¨å’Œé•œåƒçš„åŸºæœ¬ç”¨æ³•ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡æ­¤æ—¶ä½ ä»¬è¿˜å¯¹å®¹å™¨å’Œé•œåƒæœ‰ç€è¯¸å¤šçš„ç–‘æƒ‘ï¼Œä¾‹å¦‚é•œåƒä»ä½•æ‹‰å–ï¼Œå®¹å™¨çš„ç½‘ç»œæ˜¯æ€ä¹ˆå›äº‹ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬ç»§ç»­æ·±å…¥ä»‹ç»dockerçš„ä½¿ç”¨ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(ä¸€)å¼€å¯dockerçš„æ—…ç¨‹</title>
      <link href="/2022/12/16/%E4%BB%8Edocker%E5%BC%80%E5%90%AF%E7%9A%84%E6%97%85%E7%A8%8B/"/>
      <url>/2022/12/16/%E4%BB%8Edocker%E5%BC%80%E5%90%AF%E7%9A%84%E6%97%85%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤©ä¸‹è‹¦ç¯å¢ƒä¹…çŸ£"><a class="markdownIt-Anchor" href="#å¤©ä¸‹è‹¦ç¯å¢ƒä¹…çŸ£"></a> å¤©ä¸‹è‹¦ç¯å¢ƒä¹…çŸ£</h1><p><code>printf(&quot;Hello World!&quot;)</code>ï¼Œè¿™ä¹Ÿè®¸æ˜¯ä½ å­¦ä¹ Cè¯­è¨€æ—¶æ‰“å°çš„ç¬¬ä¸€è¡Œè¯­å¥ï¼ŒCè¯­è¨€ä½œä¸ºå¤§å¤šæ•°äººçš„å…¥é—¨è¯­è¨€ï¼ŒHello Worldå¼€å§‹äº†æˆ‘ä»¬çš„ä»£ç ç”Ÿæ¶¯ã€‚å¯¹äºè¿‡å»åˆå­¦çš„æˆ‘ä»¬è€Œè¨€ï¼Œè¦æ‰“å°å‡ºè¿™ä¸€è¡Œä»£ç å¹¶ä¸è½»æ¾ï¼Œæˆ‘ä»¬è¦å®‰è£…ä¸€ä¸ªé›†æˆå¼€å‘ç¯å¢ƒï¼Œå¯èƒ½æ˜¯CodeBlocksï¼Œå¯èƒ½æ˜¯visual studioç­‰ç­‰ï¼Œæœ‰äº›å¯èƒ½ä¼šç»™æˆ‘ä»¬å®‰è£…å¥½Cè¯­è¨€çš„ç¯å¢ƒï¼Œæœ‰äº›åˆ™è¦è‡ªå·±å®‰è£…æˆ–è€…æ˜¯é…ç½®ç¯å¢ƒå˜é‡ã€‚å¯èƒ½æˆ‘ä»¬åƒè¾›ä¸‡è‹¦å®‰è£…å¥½äº†è¿è¡Œç¯å¢ƒï¼Œç»“æœè¦è¿è¡Œä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦ä¸‹è½½è¿™ä¸ªé¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–ã€‚ä¸ç®¡å…·ä½“çš„æƒ…å†µå¦‚ä½•ï¼Œ<code>é…ç½®ç¯å¢ƒ</code>ï¼Œè¿™çŸ­çŸ­çš„å››ä¸ªå­—å¯èƒ½å°†ä¼šåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´æ—¶é—´é‡Œä¸€ç›´æŠ˜ç£¨æˆ‘ä»¬ã€‚</p><p>ç¯å¢ƒç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤§çš„ç—›è‹¦ï¼Œä½†æˆ‘ä»¬æ˜¾ç„¶ä¸ä¼šå°±æ­¤è®¤å‘½ï¼Œæœ‰äº†ç–¼ç‚¹ï¼Œå°±ä¼šæœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬æ‰‹é‡Œå¯æ˜¯æ¡ç€ä»£ç çš„ç¨‹åºå‘˜ã€‚é‚£ä¹ˆåˆ°åº•åº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ã€‚åœ¨èµ·åˆï¼Œæˆ‘ä»¬é¦–å…ˆè§£å†³çš„æ˜¯ä¾èµ–é—®é¢˜ï¼Œå¯¹äºå„ç§è¯­è¨€ï¼Œéƒ½æœ‰äº†è‡ªå·±å¯¹åº”çš„åŒ…ï¼ˆä¾èµ–ï¼‰ç®¡ç†æœºåˆ¶ï¼Œä¾‹å¦‚<code>Java</code>çš„<code>Maven</code>ï¼Œ<code>javascript</code>çš„<code>npm</code>ç­‰ï¼Œè¿™äº›åŒ…ç®¡ç†å·¥å…·è®°å½•äº†æˆ‘ä»¬é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–ï¼Œå€ŸåŠ©äºè¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬åœ¨ä¸‹æ¬¡è¿è¡Œè¿™äº›ç¨‹åºæ—¶å¯ä»¥å¿«é€Ÿä¸‹è½½å¥½æ‰€éœ€è¦çš„ä¾èµ–ã€‚ä¾èµ–çš„é—®é¢˜çœ‹èµ·æ¥å°±è§£å†³äº†ï¼Œä½†ï¼ŒçœŸçš„å¦‚æ­¤å—ï¼Ÿ</p><p>é—®é¢˜å¾ˆå¿«å‡ºç°ï¼Œæˆ‘ä»¬åœ¨ä¸‹è½½ä¾èµ–æ—¶ï¼Œå¯èƒ½é‡åˆ°åŒ…ç®¡ç†å·¥å…·ç‰ˆæœ¬é”™è¯¯çš„é—®é¢˜ï¼Œè¿™äº›åŒ…ç®¡ç†å·¥å…·æœ¬èº«å°±æ˜¯ä¸€ä¸ªä¸ªè½¯ä»¶ï¼Œä¸ºäº†é…ç½®å®‰è£…è¿™äº›è½¯ä»¶ï¼Œæˆ‘ä»¬ä¼¼ä¹åˆå›åˆ°äº†èµ·ç‚¹ã€‚é€€ä¸€æ­¥è¯´ï¼ŒåŒ…ç®¡ç†å·¥å…·åªèƒ½è§£å†³ä¾èµ–çš„é—®é¢˜ï¼Œä¸€ä¸ªè¯­è¨€æ‰€éœ€è¦çš„è¿è¡Œç¯å¢ƒè¿˜æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±å»ä¸‹è½½ï¼ŒåŒ…ç®¡ç†å·¥å…·ç¡®å®ä¸ºæˆ‘ä»¬çš„å¼€å‘èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ï¼Œä½†æ˜¯å®ƒä¾ç„¶æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¿…é¡»è¿›ä¸€æ­¥æ·±å…¥è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸å¦¨é‡æ–°æ€è€ƒä¾èµ–ï¼Œä»è½¯ä»¶çš„è§’åº¦æ¥è¯´ï¼Œä¾èµ–ç¡®å®æ˜¯ä¸€ä¸ªä¸ªåŒ…ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æ¢ä¸€ä¸ªè§’åº¦ï¼Œå…¶å®ä¸€ä¸ªç¨‹åºä¸Šæœ€æœ¬è´¨ä¸Šçš„ä¾èµ–ï¼Œæ˜¯å¯¹å½“å‰<code>æ“ä½œç³»ç»Ÿçš„ä¾èµ–</code>ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠ<code>è½¯ä»¶è¿åŒæ“ä½œç³»ç»Ÿ</code>ä¸€èµ·å¸¦è¿‡å»å‘¢ã€‚</p><p>æ€ä¹ˆæŠŠæ“ä½œç³»ç»Ÿå’Œè½¯ä»¶æ‰“åŒ…åœ¨ä¸€èµ·å‘¢ï¼Œæˆ‘ä»¬æ­¤æ—¶å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ä¸ªæŠ€æœ¯â€”â€”<code>è™šæ‹ŸåŒ–æŠ€æœ¯</code>ï¼Œå³ä½¿ç”¨è™šæ‹Ÿæœºæ¥æ‰“åŒ…æˆ‘ä»¬çš„è½¯ä»¶ã€‚ä½†æ˜¯é—®é¢˜å°±åœ¨äºè™šæ‹Ÿæœºå¤ªå¤§äº†ï¼Œä¸€ä¸ªlinuxç³»ç»Ÿå¯èƒ½ç›¸å¯¹å°ä¸€äº›ï¼Œåªæœ‰å‡ ä¸ªGï¼Œä½†æ˜¯å¦‚æœæ˜¯windowsç³»ç»Ÿï¼Œæ•°é‡å¾ˆå¿«ä¼šå¢é•¿åˆ°å‡ åä¸ªGï¼Œæˆ‘ä»¬ä¸ºäº†æ¬è¿ä¸€ä¸ªè½¯ä»¶çš„ç¯å¢ƒï¼ŒèŠ±è´¹å¦‚æ­¤å¤§çš„ä»£ä»·ï¼Œä¼¼ä¹æ˜¯æœ‰äº›è¿‡äº†ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªé—®é¢˜åˆ°åº•è¯¥å¦‚ä½•è§£å†³ï¼Œæˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’â€”â€”dockerï¼Œç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹æ¡ˆã€‚ä»è™šæ‹ŸåŒ–ç¯å¢ƒçš„è§’åº¦æ¥è¯´ï¼Œdockeræä¾›äº†ä¸è™šæ‹Ÿæœºç±»ä¼¼çš„æ•ˆæœï¼Œä½†æ˜¯dockeråˆ›é€ çš„è™šæ‹Ÿç¯å¢ƒå¤§å°åªæœ‰<code>å‡ ç™¾MB</code>ç”šè‡³åªæœ‰<code>å‡ åMB</code>ï¼ååˆ†è½»é‡ï¼</p><p>dockerï¼Œç»™äº†è‹¦ç¯å¢ƒä¹…çŸ£çš„æˆ‘ä»¬ä¸€æŠ¹å¸Œæœ›ã€‚é‚£ä¹ˆdockeråˆ°åº•æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Œåˆæ˜¯æ€æ ·ä½¿ç”¨çš„å‘¢ï¼Œä¸”å¬æˆ‘å¨“å¨“é“æ¥ã€‚</p><h1 id="dockeræŠŠç¯å¢ƒéƒ½è£…åˆ°ç®±å­é‡Œ"><a class="markdownIt-Anchor" href="#dockeræŠŠç¯å¢ƒéƒ½è£…åˆ°ç®±å­é‡Œ"></a> Dockerâ€”â€”æŠŠç¯å¢ƒéƒ½è£…åˆ°ç®±å­é‡Œ</h1><p>Dockerï¼Œæ˜¯ä¸€ä¸ªå®¹å™¨åŒ–å¼•æ“ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å®šä¹‰ï¼Œä¸éš¾å‘ç°ä¸¤ä¸ªå…³é”®è¯ï¼Œ<code>å®¹å™¨</code>å’Œ<code>å¼•æ“</code>ã€‚é‚£ä¹ˆå¼•æ“æ˜¯ä»€ä¹ˆå‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸è¯´çš„æ±½è½¦å¼•æ“ï¼Œå°±æ˜¯ç”¨äºå‘åŠ¨æ±½è½¦çš„ï¼Œé‚£ä¹ˆå®¹å™¨åŒ–å¼•æ“ï¼Œå°±æ˜¯ç”¨äºå®¹å™¨åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œdockerå°±æ˜¯ä¸€ä¸ªè´Ÿè´£å®¹å™¨åŒ–çš„è½¯ä»¶ã€‚</p><p>é‚£ä¹ˆå®¹å™¨åŒ–æ˜¯ä»€ä¹ˆå‘¢ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæš‚ä¸”ä¸æå®¹å™¨çš„æœ¬è´¨ï¼Œæˆ‘ä»¬å…ˆç®€å•çš„ç†è§£ä¸ºå®¹å™¨å°±æ˜¯ä¸€ä¸ª<code>è½»é‡çš„&quot;è™šæ‹Ÿæœº&quot;</code>ï¼Œè€Œdockerï¼Œå°±æ˜¯è´Ÿè´£æŠŠè½¯ä»¶å’Œå®ƒå¯¹åº”çš„ç¯å¢ƒæ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨é‡Œï¼Œä¹Ÿå°±æ˜¯å®¹å™¨åŒ–ã€‚è€Œæ‰“åŒ…å¥½çš„ç¯å¢ƒï¼Œå…·æœ‰è½»é‡ä¸”çµæ´»çš„ç‰¹ç‚¹ï¼Œå°±å¥½åƒæµ·ä¸Šè¿é€è´§ç‰©çš„é›†è£…ç®±ä¸€æ ·ï¼Œéº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ï¼ŒdockeræŠŠç¯å¢ƒå’Œè½¯ä»¶éƒ½æ‰“åŒ…åˆ°äº†ä¸€æ ·çš„ä¸€ä¸ªç®±å­é‡Œã€‚</p><p>Dockerä¸ºä»€ä¹ˆå¯ä»¥å®ç°å¦‚æ­¤è½»é‡åŒ–ï¼Œæˆ‘ä»¬æ¯”å¯¹è™šæ‹Ÿæœºå’Œdockerä¹‹é—´çš„å·¥ä½œåŸç†ï¼Œä¸éš¾å‘ç°dockerå®¹å™¨åŒ–å‡ºçš„åº”ç”¨éƒ½å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œè€Œè™šæ‹Ÿæœºåˆ™æ˜¯ä¸ºæ¯ä¸€ä¸ªåº”ç”¨éƒ½è™šæ‹ŸåŒ–å‡ºäº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œä¸¤è€…çš„å¼€é”€æ˜¾ç„¶ä¸åœ¨åŒä¸€çº§åˆ«ä¸Šã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/b734f7d91bda055236b3467bc16f6302.png" alt="b734f7d91bda055236b3467bc16f6302" /></p><h1 id="å¯èˆªå°é²¸é±¼"><a class="markdownIt-Anchor" href="#å¯èˆªå°é²¸é±¼"></a> å¯èˆªï¼Œå°é²¸é±¼ï¼</h1><p>ä»‹ç»äº†è¿™ä¹ˆå¤šï¼Œä¸çŸ¥é“æ˜¯å¦ä½ å¯¹dockerå·²ç»å……æ»¡äº†å¥½å¥‡ï¼Œæ˜¯å¦å·²ç»æ‘©æ‹³æ“¦æŒå‡†å¤‡å¥½ä½¿ç”¨dockeräº†å‘¢ï¼Œä¸‹é¢æˆ‘å°±æ¥ç®€å•ä»‹ç»dockerçš„ä½¿ç”¨ã€‚</p><p>Dockeråœ¨å„ä¸ªå¹³å°éƒ½æœ‰å®‰è£…çš„æ–¹å¼ï¼Œå¦‚æœæœ‰æ¡ä»¶ï¼Œæœ€å¥½ä½¿ç”¨linuxç³»ç»Ÿï¼Œå› ä¸ºDockerçš„å®ç°äº‹å®ä¸Šæ˜¯<code>ä¾èµ–äºlinuxç³»ç»Ÿ</code>çš„ï¼Œç›´æ¥ä½¿ç”¨linuxä¼šæœ‰æ›´åŠ åŸç”Ÿçš„ä½“éªŒï¼Œå½“ç„¶ï¼Œå¦‚æœæ‰‹è¾¹æš‚æ—¶æ²¡æœ‰linuxçš„ç¯å¢ƒå¯ä»¥ä½¿ç”¨æˆ–è€…å¯¹linuxçš„æ“ä½œè¿˜æ²¡æœ‰å¾ˆç†Ÿæ‚‰ï¼Œåœ¨å…¶å®ƒæ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨å›¾å½¢åŒ–çš„ç•Œé¢ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„å…¥é—¨æ–¹å¼ã€‚ä¸‹é¢æˆ‘ä¼šä»‹ç»centosï¼Œubuntuå’Œwindowsçš„dockerå®‰è£…æ–¹å¼ã€‚</p><h2 id="centos-ä¸­çš„å®‰è£…"><a class="markdownIt-Anchor" href="#centos-ä¸­çš„å®‰è£…"></a> CentOS ä¸­çš„å®‰è£…</h2><p>CentOSçš„å®‰è£…æ¯”è¾ƒç®€å•ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤ä¾æ¬¡æ‰§è¡Œå‘½ä»¤å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum install -y yum-utils</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"> <span class="built_in">sudo</span> yum-config-manager \</span></span><br><span class="line"><span class="language-bash">    --add-repo \</span></span><br><span class="line"><span class="language-bash">    https://download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span></span><br></pre></td></tr></table></figure><h2 id="ubuntuä¸­çš„å®‰è£…"><a class="markdownIt-Anchor" href="#ubuntuä¸­çš„å®‰è£…"></a> Ubuntuä¸­çš„å®‰è£…</h2><p>Ubuntuçš„å®‰è£…ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt-get update</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt-get install \</span></span><br><span class="line"><span class="language-bash">    ca-certificates \</span></span><br><span class="line"><span class="language-bash">    curl \</span></span><br><span class="line"><span class="language-bash">    gnupg \</span></span><br><span class="line"><span class="language-bash">    lsb-release</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/apt/keyrings</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> \</span></span><br><span class="line"><span class="language-bash">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">  <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt-get update</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span></span><br></pre></td></tr></table></figure><h2 id="å…¶å®ƒlinuxç³»ç»Ÿä¸­çš„å®‰è£…"><a class="markdownIt-Anchor" href="#å…¶å®ƒlinuxç³»ç»Ÿä¸­çš„å®‰è£…"></a> å…¶å®ƒlinuxç³»ç»Ÿä¸­çš„å®‰è£…</h2><p>å¦‚æœæ˜¯å…¶å®ƒlinuxç³»ç»Ÿï¼Œdockerå®˜ç½‘éƒ½æä¾›äº†è¾ƒä¸ºè¯¦å°½çš„å®‰è£…æ–¹å¼ï¼Œé“¾æ¥æ”¾åœ¨ä¸‹é¢ï¼ŒæŒ‰ç…§è‡ªå·±çš„éœ€æ±‚å¯»æ‰¾å³å¯ã€‚</p><p><a href="https://docs.docker.com/engine/install/">Dockeråœ¨linuxæ“ä½œç³»ç»Ÿä¸­çš„å®‰è£…æ–¹å¼</a></p><h2 id="windowsä¸­çš„å®‰è£…"><a class="markdownIt-Anchor" href="#windowsä¸­çš„å®‰è£…"></a> Windowsä¸­çš„å®‰è£…</h2><p>ç›¸è¾ƒäºlinuxï¼ŒWindowsçš„å®‰è£…åˆ™ç¨æ˜¾éº»çƒ¦ï¼Œå› ä¸ºdockeræ˜¯çš„è¿è¡Œä¾èµ–äºlinuxï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å…ˆä¸‹è½½<code>wsl</code>ï¼Œå³<code>Windows Subsystem for Linux</code>ï¼ŒWindowsä¸­çš„linuxå­ç³»ç»Ÿã€‚</p><p>ç”¨ç®¡ç†å‘˜æ‰“å¼€powershellï¼Œä¸‹è½½wslï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå¸®ä½ ä¸‹å¥½wslï¼ŒåŒæ—¶ä¸‹è½½ä¸€ä¸ªubuntuï¼Œå®‰è£…çš„å†…å®¹æ¯”è¾ƒå¤§ï¼Œè¿™é‡Œå¯èƒ½è¦èŠ±è´¹å‡ ååˆ†é’Ÿçš„æ—¶é—´ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wsl --install</span></span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä»¥åï¼Œä½ å¯ä»¥åœ¨å®ƒç»™ä½ å®‰è£…çš„ubuntuç³»ç»Ÿä¸­æŒ‰ç…§ä¸Šé¢æåˆ°çš„æ–¹æ³•å®‰è£…docker ï¼ˆç¬”è€…æ²¡æœ‰è¯•è¿‡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½<code>docker desktop</code>ï¼Œè¿™è¾¹ä»‹ç»ä¸‹è½½<code>docker desktopçš„æ–¹æ³•</code></p><p>è¿›å…¥dockerçš„å®˜ç½‘ï¼Œä¸‹è½½å®‰è£…åŒ…ï¼Œç„¶åå®‰è£…å³å¯ã€‚</p><p><a href="https://www.docker.com/">https://www.docker.com/</a></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221216181845610.png" alt="image-20221216181845610" /></p><h1 id="å°é²¸é±¼è¯¥å¹²æ´»äº†"><a class="markdownIt-Anchor" href="#å°é²¸é±¼è¯¥å¹²æ´»äº†"></a> å°é²¸é±¼ï¼Œè¯¥å¹²æ´»äº†</h1><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†æˆ‘ä»¬è‡ªå·±çš„å°é²¸é±¼ï¼Œä¸‹é¢æˆ‘ä¼šç®€å•çš„å‘Šè¯‰ä½ å¦‚ä½•è®©å°é²¸é±¼å·¥ä½œèµ·æ¥ã€‚</p><p>æˆ‘ä»¬éœ€è¦å…ˆå¯åŠ¨æˆ‘ä»¬çš„å°é²¸é±¼ï¼ŒWindowsåªéœ€è¦åŒå‡»å¯åŠ¨ç¨‹åºå°±å¯ä»¥äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> systemctl start docker</span></span><br></pre></td></tr></table></figure><p>å’Œå­¦ä¹ åˆ«çš„è¯­è¨€ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆæ¥è¿è¡Œdockerä¸­çš„hello world</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run hello-world</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çœ‹åˆ°æ‰“å°äº†ä¸‹é¢è¿™ä¸€æ®µæ–‡å­—ï¼Œé‚£ä¹ˆå°±ä»£è¡¨dockerå®‰è£…æˆåŠŸäº†ï¼Œä¹Ÿæ­å–œä½ æˆåŠŸè¿è¡Œäº†ä¸€ä¸ªå®¹å™¨ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®‰è£…å¥½äº†dockerå¹¶ä¸”è¿è¡Œäº†ç¬¬ä¸€ä¸ªå®¹å™¨ï¼ŒæˆåŠŸè¿ˆå‡ºäº†dockerä¹‹æ—…çš„ç¬¬ä¸€æ­¥ï¼Œåœ¨ä¸‹ä¸€ä¸ªç« èŠ‚ï¼Œæˆ‘ä¼šè¯¦ç»†ä»‹ç»dockerçš„ä½¿ç”¨æ–¹å¼ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlç´¢å¼•ä½¿ç”¨æŒ‡å—</title>
      <link href="/2022/12/06/mysql%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2022/12/06/mysql%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="mysqlç´¢å¼•æ¦‚è¿°"><a class="markdownIt-Anchor" href="#mysqlç´¢å¼•æ¦‚è¿°"></a> mysqlç´¢å¼•æ¦‚è¿°</h1><p>åœ¨æˆ‘ä»¬æ­£å¼å¼€å§‹è®²ç´¢å¼•ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸å¦¨å›æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å­—å…¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç›´æ¥å»æ•´æœ¬ä¹¦å»æ£€ç´¢å†…å®¹ï¼Œè€Œæ˜¯å…ˆå»æŸ¥æ‰¾ç›®å½•ï¼Œæ ¹æ®ç›®å½•ç»™æˆ‘ä»¬æä¾›çš„é¡µç ï¼Œåœ¨ä»å­—å…¸ä¸­æŸ¥è¯¢ä¿¡æ¯ï¼Œç´¢å¼•å°±ç±»ä¼¼äºå­—å…¸ä¸­çš„ç›®å½•ï¼Œå¯ä»¥å¤§å¤§æé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ã€‚</p><p>mysqlçš„ç´¢å¼•æœºåˆ¶æ˜¯mysqlæä¾›ç»™æˆ‘ä»¬çš„ä¸€ä¸ªè¶…å¼ºçš„åŠŸèƒ½ï¼Œæ­£ç¡®çš„ç´¢å¼•å¯ä»¥å¤§å¤§æé«˜mysqlæ£€ç´¢çš„é€Ÿåº¦å’Œæ•ˆç‡ã€‚</p><h1 id="ç´¢å¼•æœ¬è´¨"><a class="markdownIt-Anchor" href="#ç´¢å¼•æœ¬è´¨"></a> ç´¢å¼•æœ¬è´¨</h1><p>å¦‚æœäº†è§£è¿‡æ•°æ®ç»“æ„æˆ–è€…æ•°æ®åº“çš„åº•å±‚ï¼Œé‚£ä¹ˆä¸€å®šçŸ¥é“mysqlç´¢å¼•çš„åº•å±‚æ˜¯åŸºäºB+æ ‘çš„ï¼Œé‚£å°±æ˜¯è¯´æ‰€è°“ç´¢å¼•å…¶å®å°±æ˜¯B+æ ‘ï¼Œå¯¹æŸä¸€ä¸ªå­—æ®µå»ºç«‹ç´¢å¼•å°±æ˜¯ä»¥è¿™ä¸ªå­—æ®µä¸ºå…³é”®å­—å»ºç«‹B+æ ‘ï¼Œè¿™æ£µB+æ ‘ä¼šè¢«ä¿å­˜åœ¨mysqlçš„æ–‡ä»¶ä¸­ï¼Œå…·ä½“çš„æ–‡ä»¶ä¼šæ ¹æ®å¼•æ“çš„ä¸åŒè€Œä¸åŒï¼Œä»¥æœ€å¸¸ç”¨çš„innodbå’Œmyiasmä¸ºä¾‹ï¼š</p><p>myisamï¼š</p><ul><li><code>tablename_myisam_index.frm</code>ï¼šè¯¥æ–‡ä»¶ä¸­å­˜å‚¨è¡¨çš„ç»“æ„ä¿¡æ¯ã€‚</li><li><code>tablename_myisam_index.MYD</code>ï¼šè¯¥æ–‡ä»¶ä¸­å­˜å‚¨è¡¨çš„è¡Œæ•°æ®ã€‚</li><li><code>tablename_myisam_index.MYI</code>ï¼šè¯¥æ–‡ä»¶ä¸­å­˜å‚¨è¡¨çš„ç´¢å¼•æ•°æ®ã€‚</li></ul><p>innodbï¼š</p><ul><li><code>tablename_innodb_index.frm</code>ï¼šè¯¥æ–‡ä»¶ä¸­å­˜å‚¨è¡¨çš„ç»“æ„ä¿¡æ¯ã€‚</li><li><code>tablename_innodb_index.ibd</code>ï¼šè¯¥æ–‡ä»¶ä¸­å­˜å‚¨è¡¨çš„è¡Œæ•°æ®å’Œç´¢å¼•æ•°æ®ã€‚</li></ul><blockquote><p>ä¸åŒçš„å¼•æ“å¯¹æ•°æ®çš„å¤„ç†æ–¹å¼ä¸åŒï¼Œä¿å­˜æ•°æ®çš„æ–¹å¼ä¹Ÿä¸åŒï¼Œå¯¹äºmyisamæ¥è¯´ï¼Œå¾ˆæ˜æ˜¾å¯ä»¥å‘ç°å®ƒçš„ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯ä¸å­˜æ”¾åœ¨ä¸€èµ·çš„ï¼Œè€ŒinnodbæŠŠæ•°æ®å’Œç´¢å¼•æ”¾åœ¨ä¸€èµ·ï¼Œè¿™é‡Œæ˜¯æ¶‰åŠåˆ°çš„æ˜¯ä¸¤è€…ä¹‹é—´ç´¢å¼•ç±»å‹çš„åŒºåˆ«ï¼Œinnodbä½¿ç”¨çš„æ˜¯èšç°‡ç´¢å¼•ï¼Œmyisamä½¿ç”¨çš„éèšç°‡ç´¢å¼•ï¼Œè¿™é‡Œä¸äºˆè¯¦ç»†ä»‹ç»ã€‚</p></blockquote><p>è¯´çš„ç®€å•ç²—æš´ä¸€ç‚¹ï¼Œä¸€ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªB+æ ‘ã€‚</p><h1 id="ç´¢å¼•çš„åˆ†ç±»å’Œåˆ›å»º"><a class="markdownIt-Anchor" href="#ç´¢å¼•çš„åˆ†ç±»å’Œåˆ›å»º"></a> ç´¢å¼•çš„åˆ†ç±»å’Œåˆ›å»º</h1><p>ç´¢å¼•çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œä»ä¸åŒçš„ç»´åº¦æˆ‘ä»¬å¯ä»¥æœ‰å¾ˆå¤šåˆ†ç±»ï¼Œä¸‹é¢è®²åˆ†åˆ«ä»‹ç»ä»–ä»¬å¹¶ä»‹ç»å®ƒä»¬çš„åŸºæœ¬ç”¨æ³•ã€‚</p><h2 id="ä»ä½¿ç”¨çš„æ•°æ®ç»“æ„åŒºåˆ†"><a class="markdownIt-Anchor" href="#ä»ä½¿ç”¨çš„æ•°æ®ç»“æ„åŒºåˆ†"></a> ä»ä½¿ç”¨çš„æ•°æ®ç»“æ„åŒºåˆ†</h2><p>æœ€å¸¸ç”¨çš„æœ‰ä¸¤ç§ç´¢å¼•ï¼š</p><ul><li><code>B+Tree</code>ç±»å‹ï¼š<code>MySQL</code>ä¸­æœ€å¸¸ç”¨çš„ç´¢å¼•ç»“æ„ï¼Œå¤§éƒ¨åˆ†å¼•æ“æ”¯æŒï¼Œæœ‰åºã€‚</li><li><code>Hash</code>ç±»å‹ï¼šå¤§éƒ¨åˆ†å­˜å‚¨å¼•æ“éƒ½æ”¯æŒï¼Œå­—æ®µå€¼ä¸é‡å¤çš„æƒ…å†µä¸‹æŸ¥è¯¢æœ€å¿«ï¼Œæ— åºã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create index index_name on tablename(column);</span><br><span class="line">create index hash_index_name using hash on tablename(column);</span><br></pre></td></tr></table></figure><h2 id="å»ºç«‹ç´¢å¼•ä½¿ç”¨çš„å­—æ®µæ•°é‡"><a class="markdownIt-Anchor" href="#å»ºç«‹ç´¢å¼•ä½¿ç”¨çš„å­—æ®µæ•°é‡"></a> å»ºç«‹ç´¢å¼•ä½¿ç”¨çš„å­—æ®µæ•°é‡</h2><p>æ ¹æ®å»ºç«‹ç´¢å¼•æ—¶ä½¿ç”¨çš„å­—æ®µæ•°é‡ï¼Œå¯ä»¥åˆ†ä¸º<code>å•åˆ—ç´¢å¼•</code>å’Œ<code>å¤šåˆ—ç´¢å¼•</code>ã€‚</p><p><code>å•åˆ—ç´¢å¼•</code>å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§:</p><ul><li><code>å”¯ä¸€ç´¢å¼•</code>ï¼šå”¯ä¸€ç´¢å¼•çš„ç´¢å¼•å€¼ä¸å…è®¸é‡å¤</li><li><code>ä¸»é”®ç´¢å¼•</code>ï¼šä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼ŒåŒæ—¶ä¸å…è®¸ç©ºå€¼</li><li><code>æ™®é€šç´¢å¼•</code></li><li>â€¦</li></ul><p>ç”±å¤šä¸ªå­—æ®µç»„åˆåˆ›å»ºçš„ç´¢å¼•å°±æ˜¯ç»„åˆç´¢å¼•ã€‚</p><h2 id="æŒ‰ç…§åŠŸèƒ½é€»è¾‘åˆ†ç±»"><a class="markdownIt-Anchor" href="#æŒ‰ç…§åŠŸèƒ½é€»è¾‘åˆ†ç±»"></a> æŒ‰ç…§åŠŸèƒ½é€»è¾‘åˆ†ç±»</h2><ul><li><code>æ™®é€šç´¢å¼•</code></li><li><code>ä¸»é”®ç´¢å¼•</code></li><li><code>å”¯ä¸€ç´¢å¼•</code></li><li><code>å…¨æ–‡ç´¢å¼•</code></li></ul><p><code>å…¨æ–‡ç´¢å¼•</code>çš„åŸç†æœ‰äº›ç±»ä¼¼äº<code>ESç­‰æœç´¢å¼•æ“</code>ï¼Œå»ºç«‹çš„è¿‡ç¨‹ä¸­ä¼šå¯¹æ–‡æœ¬å­—æ®µè¿›è¡Œ<code>åˆ†è¯</code>ã€‚ï¼Œåœ¨mysqlä¸­ï¼Œæˆ‘ä»¬å¯¹æ–‡æœ¬è¿›è¡Œæœç´¢æ—¶ä¼šä½¿ç”¨<code>like</code>å­—æ®µæ¥è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œå½“æ—¶å½“é€šé…ç¬¦<code>%</code>ç½®äºå¾…åŒ¹é…å­—ç¬¦ä¸²å‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆï¼Œä¾‹å¦‚<code>%test</code>ã€‚æ­¤æ—¶æœç´¢çš„æ•ˆç‡ä¼šå¤§å¤§è¾ƒä½ï¼Œå…¨æ–‡ç´¢å¼•åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šèµ·åˆ°è¾ƒå¤§çš„ä½œç”¨ã€‚</p><h2 id="æŒ‰ç…§å‚¨å­˜å±‚æ¬¡"><a class="markdownIt-Anchor" href="#æŒ‰ç…§å‚¨å­˜å±‚æ¬¡"></a> æŒ‰ç…§å‚¨å­˜å±‚æ¬¡</h2><p>ä¸»è¦åˆ†ä¸ºèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ä¸¤ç§ï¼Œä¸¤è€…çš„åŒºåˆ«ä¸»è¦æ˜¯æ•°æ®æ˜¯å¦å­˜æ”¾åœ¨ç´¢å¼•èŠ‚ç‚¹ä¸­ã€‚</p><ul><li><code>èšç°‡ç´¢å¼•</code>ï¼šé€»è¾‘ä¸Šè¿ç»­ä¸”ç‰©ç†ç©ºé—´ä¸Šçš„è¿ç»­ã€‚</li><li><code>éèšç°‡ç´¢å¼•</code>ï¼šé€»è¾‘ä¸Šçš„è¿ç»­ï¼Œç‰©ç†ç©ºé—´ä¸Šä¸è¿ç»­ã€‚</li></ul><p>ä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªç´¢å¼•å°±æ˜¯ä¸€é¢—B+æ ‘ï¼Œå¦‚æœçœŸå®æ•°æ®å‚¨å­˜åœ¨è¿™ä¸ªB+çš„èŠ‚ç‚¹ä¸­ï¼Œå°±æ˜¯èšç°‡ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯ç‰©ç†ç©ºé—´ä¸Šçš„è¿ç»­ã€‚</p><p>è€Œéèšç°‡ç´¢å¼•ä¸ä¹‹ç›¸å¯¹ï¼Œå¹¶ä¸ä¼šå‚¨å­˜çœŸæ­£çš„æ•°æ®ï¼Œè€Œæ˜¯å‚¨å­˜æŒ‡å‘<code>æ•°æ®çš„æŒ‡é’ˆ</code>ã€‚</p><p>æˆ‘ä»¬ä»¥innodbå’Œmyisamä¸ºä¾‹ï¼Œ<code>innodbçš„çš„ä¸»é”®ç´¢å¼•</code>ä½¿ç”¨äº†<code>èšç°‡ç´¢å¼•</code>ï¼Œ<code>myisam</code>ä½¿ç”¨äº†<code>éèšç°‡ç´¢å¼•</code>ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨å®ƒä»¬çš„æ–‡ä»¶ç»„ç»‡å½¢å¼ä¸Šå°±å¯ä»¥çœ‹å‡ºæ¥ä»–ä»¬çš„åŒºåˆ«ã€‚</p><h2 id="ç´¢å¼•çš„ä½¿ç”¨æ–¹å¼"><a class="markdownIt-Anchor" href="#ç´¢å¼•çš„ä½¿ç”¨æ–¹å¼"></a> ç´¢å¼•çš„ä½¿ç”¨æ–¹å¼</h2><p>æœªå®Œå¾…ç»­â€¦</p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxåŸºæœ¬ä½¿ç”¨æŒ‡å—</title>
      <link href="/2022/11/24/nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2022/11/24/nginx%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="nginxæ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#nginxæ˜¯ä»€ä¹ˆ"></a> nginxæ˜¯ä»€ä¹ˆ</h1><p>nginxæ˜¯ä¸€ä¸ªç”±Cè¯­è¨€ç¼–å†™çš„è½»é‡çº§<code>webæœåŠ¡å™¨</code>ï¼Œ<code>å ç”¨å†…å­˜å°</code>ï¼Œ<code>å¹¶å‘èƒ½åŠ›å¼º</code>ï¼Œæ€§èƒ½éå¸¸ä¼˜è¶Šï¼Œæ˜¯å½“ä¸‹éå¸¸æµè¡Œçš„webæœåŠ¡å™¨ã€‚é™¤æ­¤ä»¥å¤–ï¼Œnginxè¿˜æ”¯æŒç›¸å½“å¤šçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº</p><ol><li>åå‘ä»£ç†</li><li>è´Ÿè½½å‡è¡¡</li><li>åŠ¨é™åˆ†ç¦»</li></ol><p>è¿™äº›ä¹Ÿæ˜¯nginxå¸¸è§çš„åº”ç”¨åœºæ™¯ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥å…¨é¢çš„ä»‹ç»ä¸€ä¸‹nginxçš„åº”ç”¨</p><h1 id="ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå‡†å¤‡"></a> ç¯å¢ƒå‡†å¤‡</h1><p>æ“ä½œç³»ç»Ÿé‡‡ç”¨<code>centos7</code></p><p>nginxçš„å®‰è£…ç›¸å½“ç®€å•ï¼Œåœ¨centosä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨yumå®‰è£…</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">yum install nginx</span></span><br></pre></td></tr></table></figure><p>åœ¨å®‰è£…çš„ä¼—å¤šæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ–‡ä»¶æ˜¯è¦æ³¨æ„çš„</p><ul><li><code>/etc/nginx</code>ï¼šå­˜æ”¾nginxçš„é…ç½®æ–‡ä»¶</li><li><code>/usr/share/nginx/html</code>ï¼šnginxé»˜è®¤çš„webæ ¹</li></ul><p>æ¥ä¸‹æ¥å¯åŠ¨nginxè¯•è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl start nginx</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å†æ¥æµ‹è¯•çœ‹çœ‹ï¼Œèƒ½æ­£ç¡®è¿”å›å†…å®¹å³å¯</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl localhost</span></span><br></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®æœåŠ¡å™¨ipï¼Œå‡ºç°ä¸‹å›¾é¡µé¢å³æˆåŠŸ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221124193645099.png" alt="image-20221124193645099" /></p><p>è¿™é‡Œåˆ—å‡ºä¸€ä¸‹å¸¸ç”¨å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload  # å‘ä¸»è¿›ç¨‹å‘é€ä¿¡å·ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œçƒ­é‡å¯</span><br><span class="line">nginx -s reopen # é‡å¯ Nginx</span><br><span class="line">nginx -s stop    # å¿«é€Ÿå…³é—­</span><br><span class="line">nginx -s quit    # ç­‰å¾…å·¥ä½œè¿›ç¨‹å¤„ç†å®Œæˆåå…³é—­</span><br><span class="line">nginx -T         # æŸ¥çœ‹å½“å‰ Nginx æœ€ç»ˆçš„é…ç½®</span><br><span class="line">nginx -t -c &lt;é…ç½®è·¯å¾„&gt;    # æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰é—®é¢˜ï¼Œå¦‚æœå·²ç»åœ¨é…ç½®ç›®å½•ï¼Œåˆ™ä¸éœ€è¦-c</span><br><span class="line">systemctl start nginx    # å¯åŠ¨ Nginx</span><br><span class="line">systemctl stop nginx     # åœæ­¢ Nginx</span><br><span class="line">systemctl restart nginx  # é‡å¯ Nginx</span><br><span class="line">systemctl reload nginx   # é‡æ–°åŠ è½½ Nginxï¼Œç”¨äºä¿®æ”¹é…ç½®å</span><br><span class="line">systemctl enable nginx   # è®¾ç½®å¼€æœºå¯åŠ¨ Nginx</span><br><span class="line">systemctl disable nginx  # å…³é—­å¼€æœºå¯åŠ¨ Nginx</span><br><span class="line">systemctl status nginx   # æŸ¥çœ‹ Nginx è¿è¡ŒçŠ¶æ€</span><br></pre></td></tr></table></figure><h1 id="nginxé…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#nginxé…ç½®æ–‡ä»¶"></a> nginxé…ç½®æ–‡ä»¶</h1><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹nginxçš„ä¸»é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /etc/nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span></span> </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"># For more information on configuration, see:</span><br><span class="line">#   * Official English Documentation: http://nginx.org/en/docs/</span><br><span class="line">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span><br><span class="line"></span><br><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       [::]:80;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># Settings for a TLS enabled server.</span><br><span class="line">#</span><br><span class="line">#    server &#123;</span><br><span class="line">#        listen       443 ssl http2;</span><br><span class="line">#        listen       [::]:443 ssl http2;</span><br><span class="line">#        server_name  _;</span><br><span class="line">#        root         /usr/share/nginx/html;</span><br><span class="line">#</span><br><span class="line">#        ssl_certificate &quot;/etc/pki/nginx/server.crt&quot;;</span><br><span class="line">#        ssl_certificate_key &quot;/etc/pki/nginx/private/server.key&quot;;</span><br><span class="line">#        ssl_session_cache shared:SSL:1m;</span><br><span class="line">#        ssl_session_timeout  10m;</span><br><span class="line">#        ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">#        ssl_prefer_server_ciphers on;</span><br><span class="line">#</span><br><span class="line">#        # Load configuration files for the default server block.</span><br><span class="line">#        include /etc/nginx/default.d/*.conf;</span><br><span class="line">#</span><br><span class="line">#        error_page 404 /404.html;</span><br><span class="line">#            location = /40x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#</span><br><span class="line">#        error_page 500 502 503 504 /50x.html;</span><br><span class="line">#            location = /50x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æ„è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼ŒåŸºæœ¬è¯­æ³•å¦‚ä¸‹</p><ul><li>æ¯æ¡æŒ‡ä»¤ç”±<code>;</code>ç»“å°¾</li><li>æ¯ä¸ªæŒ‡ä»¤å—ç”±<code>&#123;&#125;</code>åŒºåˆ†</li><li><code>#</code>æ³¨é‡Š</li></ul><p>ä»ä¸Šé¢çš„é…ç½®æ–‡ä»¶æˆ‘ç›¸ä¿¡ä½ å¤šå°‘å¯ä»¥çœ‹å‡ºä¸€äº›nginxçš„é…ç½®å†…å®¹ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶è¿˜æ˜¯è¿‡äºå¤æ‚äº†ï¼Œæˆ‘ä»¬å…ˆä»ç®€å•å¼€å§‹ç¼–å†™é…ç½®æ–‡ä»¶ã€‚</p><p>è¿™é‡Œåªä»‹ç»ä¸€æ¡æŒ‡ä»¤</p><p><code>include</code> :å¯ä»¥å¼•å…¥å…¶å®ƒçš„nginxé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°nginxä¸»é…ç½®æ–‡ä»¶å·²ç»å¼•å…¥äº†<code>/etc/nginx/conf.d/*.conf</code>æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸‹é¢å°†ä¼šåœ¨<code>conf.d</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»ºé…ç½®æ–‡ä»¶ï¼Œè¿™æ ·æ—¢å¯ä»¥ä¿æŒä¸»é…ç½®æ–‡ä»¶çš„æ•´æ´æ€§ï¼Œä¹Ÿæœ‰åˆ©äºåˆ’åˆ†æ¨¡å—ã€‚</p><h1 id="nginxä½œä¸ºwebæœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#nginxä½œä¸ºwebæœåŠ¡å™¨"></a> nginxä½œä¸ºwebæœåŠ¡å™¨</h1><p>å…ˆå…è®¸ä¸€ä¸‹å…¶å®ƒç”¨æˆ·ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /etc/nginx</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">chmod</span> o+x conf.d</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>conf.d</code>æ–‡ä»¶å¤¹ä¸‹æˆ‘ä»¬æ–°å»º<code>static.conf</code>æ–‡ä»¶</p><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8000</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> /home/admin/www;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="listen"><a class="markdownIt-Anchor" href="#listen"></a> listen</h2><p>è¯¥æŒ‡ä»¤ç”¨æˆ·å£°æ˜ç›‘å¬çš„ä½ç½®ï¼Œæ ¼å¼ä¸ºæœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li><code>127.0.0.1</code>â€”â€”åªå£°æ˜ipï¼Œé»˜è®¤ç›‘å¬80</li><li><code>80</code>â€”â€”å£°æ˜ç«¯å£</li><li><code>127.0.0.1:80</code>â€”â€”å£°æ˜å…·ä½“çš„ipå’Œç«¯å£</li></ul><h2 id="server-name"><a class="markdownIt-Anchor" href="#server-name"></a> server name</h2><p>ç”¨äºåŒºåˆ†è¯·æ±‚çš„è™šæ‹Ÿä¸»æœºï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚ä¸­çš„<code>Host</code>å­—æ®µï¼Œä¾‹å¦‚ï¼š</p><ul><li><p><code>localhost:8000</code>çš„Hostæ˜¯<code>localhost</code></p></li><li><p><code>nginx:8000</code>çš„Hostæ˜¯<code>nginx</code></p></li></ul><p>å½“nginxæœ‰å¤šä¸ªserverç›‘å¬ä¸€ä¸ªç«¯å£çš„æ—¶å€™å¯ä»¥ç”¨ä¸»æœºååŒºåˆ†ï¼Œå½“ä¸»æœºååœ¨<code>server_name</code>ä¸­æ²¡æœ‰åŒ¹é…æ—¶ï¼Œnginxä¼šé»˜è®¤åŒ¹é…ç¬¬ä¸€ä¸ª<code>server</code>ï¼Œæ‰€ä»¥åœ¨åªæœ‰ä¸€ä¸ªserverçš„ä½¿ç”¨server_nameå¯ä»¥ä»»æ„å–</p><h2 id="location"><a class="markdownIt-Anchor" href="#location"></a> location</h2><p>locationç”¨äºåŒ¹é…uriï¼Œå£°æ˜åŒ¹é…çš„è·¯å¾„å’Œæ¨¡å¼</p><h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2><p>ä¸æ­¤åŒæ—¶æˆ‘ä»¬åˆ›å»ºå¥½<code>/home/admin/www</code>ç›®å½•ï¼Œå¹¶ä¸”åœ¨ç›®å½•ä¸‹æ–°å»º<code>index.html</code>ï¼Œæ–‡ä»¶å†…å®¹æ„æ€ä¸€ä¸‹å³å¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Static Server Success!</span><br></pre></td></tr></table></figure><p>æœ€åé‡å¯nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥é…ç½®æ–‡ä»¶æ­£ç¡®æ€§</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> nginx -t</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> nginx -s reload</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æµ‹è¯•ä¸€ä¸‹èƒ½å¦çœ‹åˆ° Static Server Success!</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl localhost:8000</span></span><br></pre></td></tr></table></figure><blockquote><p>è¦æ³¨æ„ï¼Œwebæ ¹ç›®å½•<code>/home/admin/www</code>ä¸­çš„æ‰€æœ‰æ–‡ä»¶å¤¹éƒ½åº”è¯¥å¯¹å…¶å®ƒç”¨æˆ·æœ‰æ‰§è¡Œæƒé™ï¼Œå¦åˆ™nginxå°†äº§ç”Ÿ403é”™è¯¯</p><p>å¯ä»¥ä½¿ç”¨<code>chmod o+x -R admin</code>æ¥è§£å†³</p></blockquote><h1 id="åå‘ä»£ç†"><a class="markdownIt-Anchor" href="#åå‘ä»£ç†"></a> åå‘ä»£ç†</h1><h2 id="äº†è§£æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"><a class="markdownIt-Anchor" href="#äº†è§£æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"></a> äº†è§£æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</h2><p>å…ˆäº†è§£ä¸€ä¸‹æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</p><ul><li>æ­£å‘ä»£ç†</li></ul><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/forward-proxy-flow.svg" alt="" /></p><p>ç»™å®¢æˆ·ç«¯åšä»£ç†å°±æ˜¯æ­£å‘ä»£ç†</p><ul><li>åå‘ä»£ç†</li></ul><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/reverse-proxy-flow.svg" alt="" /></p><p>åä¹‹ï¼Œç»™æœåŠ¡å™¨åšä»£ç†å°±æ˜¯åå‘ä»£ç†</p><h2 id="å¼€å§‹ä¸€ä¸ªç®€å•çš„æœåŠ¡"><a class="markdownIt-Anchor" href="#å¼€å§‹ä¸€ä¸ªç®€å•çš„æœåŠ¡"></a> å¼€å§‹ä¸€ä¸ªç®€å•çš„æœåŠ¡</h2><p>æ—¢ç„¶æ˜¯åå‘ä»£ç†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç®€å•çš„httpæœåŠ¡ï¼Œè¿™é‡Œç”¨Goå†™ä¸€ä¸ª</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">w.Write([]<span class="type">byte</span>(<span class="string">&quot;hello&quot;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">w.Write([]<span class="type">byte</span>(req.RequestURI))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">http.ListenAndServe(<span class="string">&quot;:3000&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹ä¸æ‡‚ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œè¿™ä¸ªæœåŠ¡å°±æ˜¯ç›‘å¬äº†<code>3000</code>ç«¯å£ï¼Œè®¿é—®<code>localhost:3000/hello</code>æ—¶è¿”å›<code>hello</code>ï¼Œå…¶ä½™æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«åŒ¹é…åˆ°ç¬¬äºŒä¸ªå¤„ç†å™¨ï¼Œä¼šæ‰“å°å‡ºè¯·æ±‚çš„<code>URI</code></p><p>è¿™é‡Œå°±ä½¿ç”¨nginxåå‘ä»£ç†ï¼Œè®©æˆ‘ä»¬åœ¨<code>8001</code>ç«¯å£å‘é€çš„è¯·æ±‚å¯ä»¥è½¬å‘ç»™<code>3000</code>ç«¯å£</p><p>æ–°å»ºæ–‡ä»¶<code>reverse_proxy.conf</code>ï¼Œé…ç½®å¦‚ä¸‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">listen</span> <span class="number">8001</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">server_name</span> localhost;</span><br><span class="line">  </span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:3000;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="proxy_pass"><a class="markdownIt-Anchor" href="#proxy_pass"></a> proxy_pass</h2><p>å°†æ¥å—çš„è¯·æ±‚è½¬å‘åˆ°æŒ‡å®šçš„æœåŠ¡ä¸Š</p><p>è¿™é‡Œè¦æ³¨æ„ä»¥ä¸‹ä¸¤ç§<code>location</code></p><ul><li>è½¬å‘çš„åœ°å€ç»“å°¾<code>æ²¡æœ‰è·¯å¾„</code></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /api &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:3000;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å½“é…ç½®å¦‚ä¸Šæ—¶ï¼Œè¯·æ±‚çš„<code>URI</code>ä¼šè¢«<code>å…¨éƒ¨è¿½åŠ åˆ°è½¬å‘åœ°å€åé¢</code>ï¼Œä¾‹å¦‚<code>localhost:8001/api/hello</code>ï¼Œåé¢çš„<code>/api/hello</code>è¢«è¿½åŠ åˆ°<code>localhost:3000</code>çš„åé¢ï¼Œæœ€åçš„è½¬å‘åœ°å€æ˜¯<code>localhost:3000/api/hello</code></p><ul><li>è½¬å‘çš„åœ°å€ç»“å°¾<code>æœ‰è·¯å¾„</code></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /api &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:3000/v1;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å½“é…ç½®å¦‚ä¸Šæ—¶ï¼Œ<code>URIä¼šåœ¨å»æ‰å‰ç¼€ä»¥åè¿½åŠ åˆ°è½¬å‘åœ°å€åé¢</code></p><p>ä¾‹å¦‚è¯·æ±‚ï¼š<code>localhost:8001/api/hello</code>ï¼Œè½¬å‘åœ°å€ä¸º<code>localhost:8001/v1/hello</code></p><hr /><p>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> nginx -t <span class="comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> nginx -s reload</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl localhost:8001/hello <span class="comment"># è¿”å›helloå³ä¸ºæˆåŠŸ</span></span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¯•ç€æ”¹å˜<code>proxy_pass</code>å¦‚ä¸‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /api &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:3000/v1;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> nginx -t <span class="comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> nginx -s reload</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl localhost:8001/api/hello <span class="comment"># è¿”å›ç»“æœæ˜¯/v1/hello</span></span></span><br></pre></td></tr></table></figure><h1 id="åŠ¨é™åˆ†ç¦»"><a class="markdownIt-Anchor" href="#åŠ¨é™åˆ†ç¦»"></a> åŠ¨é™åˆ†ç¦»</h1><p>åŠ¨é™åˆ†ç¦»å¯ä»¥ç†è§£ä¸ºæŠŠä¸Šé¢çš„ä¸¤ä¸ªåŠŸèƒ½ç»“åˆï¼Œå°†é™æ€æ–‡ä»¶çš„å¤„ç†äº¤ç»™nginxï¼Œè¿™æ ·å¯ä»¥å‡å°åç«¯æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæé«˜æ€§èƒ½ã€‚</p><p>åœ¨ä½¿ç”¨åŠ¨é™åˆ†ç¦»ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä»¥ä¸‹locationçš„åŒ¹é…è§„åˆ™å’Œä¿®é¥°ç¬¦</p><h2 id="locationåŒ¹é…è§„åˆ™å’Œä¿®é¥°ç¬¦"><a class="markdownIt-Anchor" href="#locationåŒ¹é…è§„åˆ™å’Œä¿®é¥°ç¬¦"></a> locationåŒ¹é…è§„åˆ™å’Œä¿®é¥°ç¬¦</h2><p>locationé»˜è®¤æ˜¯æœ€é•¿å‰ç¼€åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æ®å‰ç¼€å»åŒ¹é…è·¯å¾„ï¼Œå½“æœ‰å¤šä¸ªlocationç¬¦åˆæ—¶ï¼Œé€‰æ‹©æœ€é•¿çš„ã€‚</p><p>æ­¤å¤–ï¼Œlocationè¿˜æœ‰ä¸‹é¢å››ç§æœ€å¸¸ç”¨çš„ä¿®é¥°ç¬¦ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½åˆ—å‡º</p><ul><li><p><code>=</code>     ç­‰äºï¼Œä¸¥æ ¼åŒ¹é… ï¼ŒåŒ¹é…ä¼˜å…ˆçº§æœ€é«˜ã€‚</p></li><li><p><code>^~</code>  è¡¨ç¤ºæ™®é€šå­—ç¬¦åŒ¹é…ã€‚ä½¿ç”¨å‰ç¼€åŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†åŒ¹é…å…¶å®ƒ locationã€‚ä¼˜å…ˆçº§ç¬¬äºŒé«˜ã€‚</p></li><li><p><code>~ </code>    åŒºåˆ†å¤§å°å†™</p></li><li><p><code>~* </code> ä¸åŒºåˆ†å¤§å°å†™</p></li><li><p>æ— ä¿®é¥°ç¬¦</p></li></ul><p>å¯ä»¥å‘ç°<code>^~</code>å’Œæ— ä¿®é¥°ç¬¦åŒ¹é…è§„åˆ™ç›¸åŒï¼Œä½†æ˜¯ä¼˜å…ˆçº§ä¸åŒ</p><hr /><p>è¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥æ¥çœ‹ä¸¤ä¸ªå¤„ç†é™æ€èµ„æºçš„ä¾‹å­</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /images/ &#123;</span><br><span class="line">    <span class="attribute">root</span>   /usr/share/nginx/html; <span class="comment"># é™æ€èµ„æºç›®å½•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> <span class="regexp">~ \.jpg</span> &#123;</span><br><span class="line">    <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªæ˜¯æ™®é€šåŒ¹é…ï¼ŒåŒ¹é…<code>imags</code>å¼€å¤´çš„è¯·æ±‚</p><p>ç¬¬äºŒä¸ªæ˜¯åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…ï¼ŒåŒ¹é…å«æœ‰<code>.jpg</code>çš„è¯·æ±‚</p><h1 id="ç¼“å†²å’Œç¼“å­˜"><a class="markdownIt-Anchor" href="#ç¼“å†²å’Œç¼“å­˜"></a> ç¼“å†²å’Œç¼“å­˜</h1><p>é¦–å…ˆæˆ‘ä»¬è¦åŒºåˆ«å¼€ç¼“å†²ä¸ç¼“å­˜ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/nginx%E7%BC%93%E5%86%B2%E4%B8%8E%E7%BC%93%E5%AD%98.png" alt="" /></p><p>ç¼“å†²å®é™…ä¸Šå¹¶æ²¡æœ‰å‡å°‘å‘é€åˆ°æœåŠ¡ç«¯çš„è¯·æ±‚æ•°é‡ã€‚</p><h2 id="ç¼“å†²"><a class="markdownIt-Anchor" href="#ç¼“å†²"></a> ç¼“å†²</h2><p>å½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç½‘ç»œçŠ¶å†µä¸ä½³æ—¶ï¼Œnginxå¯èƒ½è¦èŠ±è´¹è¾ƒé•¿çš„æ—¶é—´æŠŠå“åº”å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´nginxä¸serverç«¯çš„è¿æ¥è¢«å ç”¨ï¼Œå¯¼è‡´èµ„æºçš„æµªè´¹ï¼Œæ‰€æœ‰æˆ‘ä»¬å¯ä»¥æŠŠå“åº”å…ˆç¼“å†²åˆ°nginxæœåŠ¡å™¨ï¼Œé‡Šæ”¾è¿æ¥èµ„æºã€‚</p><h3 id="proxy_buffering"><a class="markdownIt-Anchor" href="#proxy_buffering"></a> proxy_buffering</h3><p>æ§åˆ¶ç¼“å†²æ˜¯å¦å¼€å¯ï¼Œæ‰“å¼€ä¸º<code>on</code>ï¼Œå…³é—­ä¸º<code>off</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy_buffer_size"><a class="markdownIt-Anchor" href="#proxy_buffer_size"></a> proxy_buffer_size</h3><p>ç”¨äºè®¾ç½®è¯»å–serverç«¯çš„åˆå§‹å“åº”éƒ¨åˆ†çš„å¤§å°ï¼Œè¿™ä¸ªåˆå§‹å“åº”éƒ¨åˆ†ä¸€èˆ¬æ˜¯<code>response header</code>ï¼Œå¤§å°ä¸€èˆ¬é…ç½®ä¸º<code>4K</code>æˆ–è€…<code>8K</code>ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ï¼Œåœ¨linuxä¸ŠæŸ¥çœ‹æ–¹å¼å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">getconf PAGE_SIZE</span></span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_buffer_size</span> <span class="number">4k</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy_buffers"><a class="markdownIt-Anchor" href="#proxy_buffers"></a> proxy_buffers</h3><p>é…ç½®è¯»å–serverç«¯å“åº”çš„ç¼“å†²åŒºä¸ªæ•°å’Œå¤§å°ï¼Œå¤§å°ä¸€èˆ¬ä¸ºå†…å­˜é¡µï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ä¸ªæ•°å’Œå¤§å°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿æ¥çš„</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_buffers</span> <span class="number">16</span> <span class="number">4K</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy_busy_buffers_size"><a class="markdownIt-Anchor" href="#proxy_busy_buffers_size"></a> proxy_busy_buffers_size</h3><p>é…ç½®å½“serverç«¯æœªè¯»å–å®Œæˆæ—¶ï¼Œå…è®¸å¼€å§‹ç»™å®¢æˆ·ç«¯å‘é€å“åº”çš„ç¼“å†²åŒºå¤§å°ï¼Œé€šå¸¸è®¾ç½®æˆä¸¤ä¸ªå†…å­˜é¡µçš„å¤§å°</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_busy_buffers_size</span> <span class="number">8K</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy_max_temp_file_size"><a class="markdownIt-Anchor" href="#proxy_max_temp_file_size"></a> proxy_max_temp_file_size</h3><p>å½“ç¼“å†²çš„å¤§å°è¶…è¿‡ç¼“å†²åŒºå…è®¸çš„å†…å­˜å¤§å°ä¹‹åï¼Œä¼šæŠŠå“åº”å†…å®¹å†™å…¥ç£ç›˜ä¸´æ—¶æ–‡ä»¶ï¼Œè¯¥å‚æ•°ç”¨äºé…ç½®ç£ç›˜ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§ç©ºé—´</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_max_temp_file_size</span> <span class="number">1024m</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy_temp_file_write_size"><a class="markdownIt-Anchor" href="#proxy_temp_file_write_size"></a> proxy_temp_file_write_size</h3><p>é…ç½®æ¯ä¸ªè¿æ¥å…è®¸å†™å…¥ç£ç›˜ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§ç©ºé—´</p> <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_temp_file_write_size</span> <span class="number">8k</span>;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹ä¸€ä¸ªä¾‹å­</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="section">location</span> /cache  &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://192.168.1.135:8080;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#é»˜è®¤å¼€å¯ï¼Œå¼€å¯ä»£ç†ç¼“å†²åŒºï¼ˆå†…å­˜ï¼‰</span></span><br><span class="line">            <span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span><br><span class="line">            <span class="comment">#è®¾ç½®å“åº”å¤´çš„ç¼“å†²åŒºè®¾ä¸º8k</span></span><br><span class="line">            <span class="attribute">proxy_buffer_size</span> <span class="number">8k</span>;</span><br><span class="line">            <span class="comment">#è®¾ç½®ç½‘é¡µå†…å®¹ç¼“å†²åŒºä¸ªæ•°ä¸º8ï¼Œå•ä¸ªå¤§å°ä¸º8k</span></span><br><span class="line">            <span class="attribute">proxy_buffers</span> <span class="number">8</span> <span class="number">8k</span>;</span><br><span class="line">            <span class="comment">#è®¾ç½®å½“nginxè¿˜åœ¨è¯»å–è¢«ä»£ç†æœåŠ¡å™¨çš„æ•°æ®å“åº”çš„åŒæ—¶é—´ä¸€æ¬¡æ€§å‘å®¢æˆ·ç«¯å“åº”çš„æ•°æ®çš„æœ€å¤§ä¸º16k</span></span><br><span class="line">            <span class="attribute">proxy_busy_buffers_size</span> <span class="number">16k</span>;</span><br><span class="line">            <span class="comment">#ä¸´æ—¶æ–‡ä»¶æœ€å¤§ä¸º1024m</span></span><br><span class="line">            <span class="attribute">proxy_max_temp_file_size</span> <span class="number">1024m</span>;</span><br><span class="line">            <span class="comment">#è®¾ç½®ä¸€æ¬¡å¾€ä¸´æ—¶æ–‡ä»¶çš„å¤§å°æœ€å¤§ä¸º16k</span></span><br><span class="line">            <span class="attribute">proxy_temp_file_write_size</span> <span class="number">16k</span>;</span><br><span class="line">            <span class="comment">#è®¾ç½®ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç›®å½•</span></span><br><span class="line">            <span class="attribute">proxy_temp_path</span> /tmp/proxy_temp;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜"><a class="markdownIt-Anchor" href="#ç¼“å­˜"></a> ç¼“å­˜</h2><h3 id="proxy_cache_path"><a class="markdownIt-Anchor" href="#proxy_cache_path"></a> proxy_cache_path</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache_path</span>  /tmp/nginx/cache levels=<span class="number">1</span>:<span class="number">2</span>  keys_zone=mycache:<span class="number">10m</span> max_size=<span class="number">10g</span>;</span><br></pre></td></tr></table></figure><p>é…ç½®nginxç¼“å­˜ï¼Œæœ‰å¦‚ä¸‹é€‰é¡¹</p><ul><li><p><code>/tmp/nginx/cache</code>ï¼šç¼“å­˜è·¯å¾„</p></li><li><p><code>levels=1:2</code>ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹nginxç¼“å­˜æ–‡ä»¶ä¼šæ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œä½†æ˜¯è¿™æ ·ä¼šé™ä½ç¼“å­˜æ€§èƒ½ï¼Œé‡‡ç”¨<code>1:2</code>çš„æ–¹å¼æ¥è®¾ç½®å¤šçº§ç›®å½•ï¼Œ</p><p>æ•°å­—çš„å«ä¹‰æ˜¯æ–‡ä»¶å¤¹å‘½åé‡‡ç”¨å‡ ä½16è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€çº§ç›®å½•æ˜¯1ï¼Œé‡‡ç”¨1ä½16è¿›åˆ¶ï¼Œæœ‰16ä¸ªç›®å½•ï¼ŒäºŒçº§ç›®å½•æœ‰256ä¸ªæ–‡ä»¶å¤¹ï¼Œæ€»å…±æœ‰16*256ä¸ªç¼“å­˜æ–‡ä»¶</p></li><li><p><code>key_zone</code>ï¼šé…ç½®å…±äº«å†…å­˜ä¸­æ”¾ç½®ç¼“å­˜keyå­—ç¬¦ä¸²çš„ç©ºé—´å¤§å°ï¼Œé€šè¿‡keyå¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªrequestæ˜¯å¦å‘½ä¸­ç¼“å­˜ï¼Œ<code>1m</code>çš„ç©ºé—´å¯ä»¥æ”¾ç½®å¤§çº¦<code>8000</code>ä¸ªkey</p></li><li><p><code>max_size</code>ï¼šç¼“å­˜æœ€å¤§ç©ºé—´</p></li><li><p><code>inactive</code>ï¼šè®¾ç½®æœªè®¿é—®æ–‡ä»¶è¢«åˆ é™¤çš„æ—¶é—´ï¼Œå³ä¾¿è¿™ä¸ªæ–‡ä»¶æ²¡æœ‰è¿‡æœŸ</p></li></ul><h3 id="proxy_cache_bypass"><a class="markdownIt-Anchor" href="#proxy_cache_bypass"></a> proxy_cache_bypass</h3><p>é…ç½®ä½•æ—¶ä¸é€‚ç”¨ç¼“å­˜ï¼Œé€šå¸¸æ˜¯åœ¨å®¢æˆ·ç«¯è¯·æ±‚å¸¦æœ‰<code>no-cache</code>å‚æ•°æ—¶</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache_bypass</span> <span class="variable">$arg_nocache</span> <span class="variable">$arg_comment</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy_cache_key"><a class="markdownIt-Anchor" href="#proxy_cache_key"></a> proxy_cache_key</h3><p>ç¼“å­˜çš„keyå€¼ï¼Œè¯¥keyå€¼ç”¨äºåœ¨å†…å­˜ä¸­å»ºç«‹ç´¢å¼•ï¼Œå…¶md5å€¼æ˜¯ç¼“å­˜æ–‡ä»¶åï¼Œæ ¼å¼ä¸€èˆ¬è®¾ç½®å¦‚ä¸‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache_key</span> <span class="variable">$scheme</span><span class="variable">$proxy_host</span><span class="variable">$uri</span><span class="variable">$is_args</span><span class="variable">$args</span>;</span><br></pre></td></tr></table></figure><h3 id="proxy_cache_methods"><a class="markdownIt-Anchor" href="#proxy_cache_methods"></a> proxy_cache_methods</h3><p>ç¼“å­˜çš„è¯·æ±‚æ–¹æ³•</p><h3 id="proxy_cache_valid"><a class="markdownIt-Anchor" href="#proxy_cache_valid"></a> proxy_cache_valid</h3><p>è®¾ç½®å¼€å¯ç¼“å­˜çš„çŠ¶æ€ç å’Œç¼“å­˜çš„æ—¶é—´</p><h3 id="proxy_cache_min_uses"><a class="markdownIt-Anchor" href="#proxy_cache_min_uses"></a> proxy_cache_min_uses</h3><p>è®¾ç½®å¼€å¯ç¼“å­˜çš„æœ€å°è¯·æ±‚æ¬¡æ•°ï¼Œå¯ä»¥é¿å…å¯¹ä½é¢‘ç‡è¯·æ±‚ç¼“å­˜</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment">#è®¾ç½®ç¼“å­˜è·¯å¾„å’Œç›¸å…³å‚æ•°ï¼ˆå¿…é€‰ï¼‰</span></span><br><span class="line">    <span class="attribute">proxy_cache_path</span>  /tmp/nginx/cache levels=<span class="number">1</span>:<span class="number">2</span>  keys_zone=mycache:<span class="number">10m</span> max_size=<span class="number">10g</span>;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="section">location</span> /cache  &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://192.168.1.135:8080;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#å¼•ç”¨ç¼“å­˜é…ç½®ï¼ˆå¿…é€‰ï¼‰</span></span><br><span class="line">            <span class="attribute">proxy_cache</span> mycache;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#å¯¹å“åº”çŠ¶æ€ç ä¸º200 302çš„å“åº”ç¼“å­˜100s</span></span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">302</span> <span class="number">100s</span>;</span><br><span class="line">            <span class="comment">#å¯¹å“åº”çŠ¶æ€ç ä¸º404çš„å“åº”ç¼“å­˜200</span></span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">404</span> <span class="number">200s</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#è¯·æ±‚å‚æ•°å¸¦æœ‰nocacheæˆ–è€…commentæ—¶ä¸ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">            <span class="attribute">proxy_cache_bypass</span> <span class="variable">$arg_nocache</span> <span class="variable">$arg_comment</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#å¿½ç•¥è¢«ä»£ç†æœåŠ¡å™¨è®¾ç½®çš„&quot;Cache-Control&quot;å¤´ä¿¡æ¯</span></span><br><span class="line">            <span class="attribute">proxy_ignore_headers</span> <span class="string">&quot;Cache-Control&quot;</span>; </span><br><span class="line"></span><br><span class="line">            <span class="comment">#å¯¹GET HEAD POSTæ–¹æ³•è¿›è¡Œç¼“å­˜ </span></span><br><span class="line">            <span class="attribute">proxy_cache_methods</span> GET HEAD POST;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#å½“ç¼“å­˜è¿‡æœŸæ—¶ï¼Œå½“æ„é€ ä¸Šæ¸¸è¯·æ±‚æ—¶ï¼Œæ·»åŠ If-Modified-Sinceå’ŒIf-None-Matchå¤´éƒ¨ï¼Œå€¼ä¸ºè¿‡æœŸç¼“å­˜ä¸­çš„Last-Modifiedå€¼å’ŒEtagå€¼ã€‚</span></span><br><span class="line">            <span class="attribute">proxy_cache_revalidate</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#å½“è¢«ä»£ç†æœåŠ¡å™¨è¿”å›403æ—¶ï¼Œnginxå¯ä»¥ä½¿ç”¨å†å²ç¼“å­˜æ¥å“åº”å®¢æˆ·ç«¯ï¼Œè¯¥åŠŸèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½èƒ½å¤Ÿä¸ºå®¢æˆ·ç«¯æä¾›ä¸é—´æ–­è®¿é—®</span></span><br><span class="line">            <span class="attribute">proxy_cache_use_stale</span> http_403;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœªå®Œå¾…ç»­â€¦</p>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨git hooksè‡ªåŠ¨åŒ–éƒ¨ç½²hexo</title>
      <link href="/2022/11/23/%E7%94%A8git-hooks%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2hexo/"/>
      <url>/2022/11/23/%E7%94%A8git-hooks%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2hexo/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h1><p>hexoæ˜¯çŸ¥åçš„<code>åšå®¢éƒ¨ç½²æ¡†æ¶</code>ï¼Œé‡‡ç”¨<code>SSGï¼ˆStatic Site Generationï¼‰</code>çš„æ–¹å¼ç”Ÿæˆé™æ€é¡µé¢ï¼Œç»“åˆä½¿ç”¨githubç­‰æ‰˜ç®¡å¹³å°å¯ä»¥å¿«é€Ÿéƒ¨ç½²æˆ‘ä»¬çš„ç«™ç‚¹ã€‚hexoä¹Ÿç»™æˆ‘ä»¬æä¾›äº†æ”¯æŒéƒ¨ç½²çš„æ’ä»¶ï¼Œå®‰è£…å®Œæˆä»¥åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>hexo deploy</code>æ¨é€å†…å®¹åˆ°æ‰˜ç®¡å¹³å°ã€‚</p><p>è™½ç„¶hexoå·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸€å¥—æ–¹ä¾¿çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œä½†æ˜¯ä½¿ç”¨hexoæœ€å¤§çš„ç—›ç‚¹ä¹‹ä¸€å°±æ˜¯å½“æˆ‘ä»¬è¦æ¢è®¾å¤‡æ—¶æ— æ³•æ–¹ä¾¿çš„è¿ç§»ã€‚å› ä¸º<code>hexo deploy</code>åªè´Ÿè´£æŠŠhexoç”Ÿæˆçš„é™æ€é¡µé¢ï¼Œä¹Ÿå°±æ˜¯<code>public</code>ç›®å½•ä¸‹çš„å†…å®¹æ¨é€åˆ°æ‰˜ç®¡å¹³å°ï¼Œæˆ‘ä»¬å¦‚æœè¦è¿ç§»æˆ‘ä»¬çš„æ–‡ç« åˆ°å¦ä¸€å°æœºå™¨ï¼Œåªèƒ½æŠŠæ–‡ä»¶å¤¹æ‹·è´è¿‡å»ï¼Œéå¸¸çš„ä¸æ–¹ä¾¿ï¼Œå¦‚æœæˆ‘ä»¬æ„å¤–ä¸¢å¤±è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŸæ¥çš„<code>markdown</code>æ–‡ç« éƒ½ä¼šä¸¢å¤±ã€‚</p><p>ä»Šå¤©è¦ä»‹ç»çš„<code>git hooks</code>å°±æ˜¯è§£å†³é—®é¢˜çš„ä¸€å¥—æ–¹æ¡ˆï¼Œæˆ‘ä»¬ç”¨<code>git</code>ç»´æŠ¤æˆ‘ä»¬çš„hexoæ–‡ä»¶ï¼Œä¸ä»…æ–¹ä¾¿è¿ç§»ï¼Œè€Œä¸”å¢åŠ äº†ç»´æŠ¤å†å²ç‰ˆæœ¬çš„åŠŸèƒ½ã€‚</p><h1 id="git-hooks"><a class="markdownIt-Anchor" href="#git-hooks"></a> git hooks</h1><p>å¼€å§‹ä¹‹å‰è¿˜æ˜¯å…ˆç®€å•çš„ä»‹ç»ä¸€ä¸‹git hooks</p><h2 id="é’©å­"><a class="markdownIt-Anchor" href="#é’©å­"></a> é’©å­</h2><p>å¯ä»¥ç®€å•çš„ç†è§£ä¸ºåœ¨ç‰¹å®šæ—¶æœºè§¦å‘çš„ç¨‹åºã€‚æˆ‘ä»¬ç”¨git hooksæ¥ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git init git-hooks-test</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> git-hooks-test/.git/hooks</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„æ–‡ä»¶</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221124113801527.png" alt="image-20221124113801527" /></p><p>æˆ‘ä»¬ä»¥<code>pre-commit</code>ä¸ºä¾‹ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­çš„è„šæœ¬ä¼šåœ¨æ¯æ¬¡commitä¹‹å‰æ‰§è¡Œï¼Œæˆ‘ä»¬æ¥ç®€å•çš„æµ‹è¯•ä¸€ä¸‹ï¼ŒæŠŠ<code>pre-commit</code>çš„å†…å®¹å¤åˆ¶ä¸ºä¸‹æ–‡ã€‚</p><p>åœ¨å¤åˆ¶å†…å®¹ä¹‹å‰è®°å¾—æŠŠsampleåˆ é™¤ï¼Œå¸¦è¿™ä¸ªåç¼€çš„é’©å­æ–‡ä»¶ä¼šè¢«å¿½ç•¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &quot;Hello World&quot;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&#x27;test hooks&#x27;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221124115136586.png" alt="image-20221124115136586" /></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„hello worldè¢«æ‰“å°å‡ºæ¥ï¼Œé‚£ä¹ˆå…¶å®ƒé’©å­ä¹Ÿæ˜¯åŒç†çš„ï¼Œä¸å†è¯´æ˜</p><h1 id="æ­å»ºç¯å¢ƒ"><a class="markdownIt-Anchor" href="#æ­å»ºç¯å¢ƒ"></a> æ­å»ºç¯å¢ƒ</h1><p>æˆ‘ä»¬æ¥ä¸‹æ¥åˆ†åˆ«æ­å»ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ç¯å¢ƒ</p><h2 id="æœåŠ¡ç«¯"><a class="markdownIt-Anchor" href="#æœåŠ¡ç«¯"></a> æœåŠ¡ç«¯</h2><h3 id="nodeå’Œgit"><a class="markdownIt-Anchor" href="#nodeå’Œgit"></a> nodeå’Œgit</h3><p>æ“ä½œç³»ç»Ÿä¸º<code>ubuntu</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> useradd hexo -m <span class="comment"># åˆ›å»ºç”¨æˆ·åŠå…¶homeç›®å½•</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> passwd hexo <span class="comment"># é…ç½®ä¸€ä¸ªå¯†ç </span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt update</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install git</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”±äºubuntuå®‰è£…nodejsæ—¶å‘ç°ç‰ˆæœ¬è¿‡ä½ï¼Œè¿™é‡Œä¸ç”¨é»˜è®¤çš„è½¯ä»¶æº</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> curl -sL https://deb.nodesource.com/setup_14.x | <span class="built_in">sudo</span> -E bash -</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œçš„nodejsåŒæ—¶åŒ…å«nodejså’Œnpm</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install nodejs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…hexo</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">node install -g hexo-cli</span></span><br></pre></td></tr></table></figure><h3 id="git-hooksé…ç½®"><a class="markdownIt-Anchor" href="#git-hooksé…ç½®"></a> git hooksé…ç½®</h3><p>æ¥ä¸‹æ¥é…ç½®gitä»“åº“å’Œgit hooks</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /home/hexo</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> å»ºç«‹è£¸ä»“åº“</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git init --bare blog.git</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­˜æ”¾hexoæ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p www/blog</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¾‘post-receiveé’©å­ï¼Œä¼šåœ¨æ”¶åˆ°æ–‡ä»¶ä»¥åæ‰§è¡Œ</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim blog.git/hooks/post-receive</span></span><br></pre></td></tr></table></figure><p>é…ç½®å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">git --work-tree=/home/hexo/www/blog --git-dir=/home/hexo/blog.git checkout -f master</span><br><span class="line">cd /home/hexo/www/blog</span><br><span class="line">npm install</span><br><span class="line">hexo g</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®°å¾—ç»™æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">chmod</span> +x blog.git/hooks/post-receive</span></span><br></pre></td></tr></table></figure><p>æš‚æ—¶è¿™æ ·é…ç½®å°±å¥½äº†</p><h3 id="nginxé…ç½®"><a class="markdownIt-Anchor" href="#nginxé…ç½®"></a> nginxé…ç½®</h3><p>æ¥ä¸‹æ¥ä¸‹è½½nginx</p><p>(è¿™é‡Œä¸‹çš„nginxç‰ˆæœ¬æ„Ÿè§‰è¿‡äºè½åï¼Œåé¢å¦‚æœä½ çš„nginxæ²¡æœ‰ç›¸å…³æ–‡ä»¶é‚£ä¹ˆåªéœ€è¦ä¿®æ”¹<code>/etc/nginx/nginx.conf</code>é‡Œçš„<code>root</code>ä½ç½®å°±å¯ä»¥äº†)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install nginx</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥nginxé…ç½®æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /etc/nginx</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨conf.då­æ–‡ä»¶å¤¹ä¸­æ·»åŠ é…ç½®æ–‡ä»¶æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œè¿™é‡Œç›´æ¥ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> o+w sites-available/default</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim sites-available/default</span></span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­<code>root</code>çš„é…ç½®ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯èƒ½æ˜¯nginxç‰ˆæœ¬ä¸åŒï¼Œå¯ä»¥å°è¯•ç›´æ¥ä¿®æ”¹<code>nginx.conf</code>æ–‡ä»¶ä¸­çš„å¯¹åº”éƒ¨åˆ†</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸åŒçš„ç‰ˆæœ¬å¯èƒ½é»˜è®¤çš„rootä½ç½®ä¸åŒï¼Œæ€»ä¹‹ç°åœ¨ä¿®æ”¹ä¸ºæˆ‘ä»¬éœ€è¦çš„root</span></span><br><span class="line"><span class="attribute">root</span> /var/share/nginx/html</span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸º</span></span><br><span class="line">root /home/hexo/www/blog/public</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> nginx -s reload</span></span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯"><a class="markdownIt-Anchor" href="#å®¢æˆ·ç«¯"></a> å®¢æˆ·ç«¯</h2><p>hexoç¯å¢ƒåˆ›å»ºè¿‡ç¨‹ä¸å†é‡å¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">hexo init myblog</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> myblog</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm install</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sshç›¸å…³å‘½ä»¤æœ€å¥½ä½¿ç”¨git bashæ‰§è¡Œ</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh-keygen</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh-copy-id -i ~/.ssh/id_rsa.pub hexo@ip</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git init</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®sshå…å¯†ç™»å½•</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote add origin ssh://hexo@ip:/home/hexo/blog.git</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add -A</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&#x27;first commit&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push -u origin master</span></span><br></pre></td></tr></table></figure><p>è‡ªå·±å¯ä»¥çœ‹åˆ°æ­£ç¡®çš„æç¤ºä¿¡æ¯å°±æ˜¯é…ç½®å¥½äº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221124181651635.png" alt="image-20221124181651635" /></p><p>ç„¶åè¯•ç€è®¿é—®æœåŠ¡å™¨ipï¼ŒæŸ¥çœ‹éƒ¨ç½²æƒ…å†µ</p>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»github pageåˆ°github action</title>
      <link href="/2022/11/22/%E4%BB%8Egithub-page%E5%88%B0github-action/"/>
      <url>/2022/11/22/%E4%BB%8Egithub-page%E5%88%B0github-action/</url>
      
        <content type="html"><![CDATA[<h1 id="github-pageså’Œgithub-actions"><a class="markdownIt-Anchor" href="#github-pageså’Œgithub-actions"></a> Github Pageså’ŒGithub Actions</h1><p>github pagesæ˜¯githubç»™æˆ‘ä»¬æä¾›äº†æ‰˜ç®¡é™æ€ç½‘ç«™çš„å¼ºå¤§åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¿«é€Ÿéƒ¨ç½²è‡ªå·±çš„ä¸€äº›åº”ç”¨ã€‚</p><p>github actionsæ˜¯githubçš„ä¸€ä¸ªCI/CDå¹³å°ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ„å»ºå’Œéƒ¨ç½²é¡¹ç›®ï¼Œä¹Ÿæ‹¥æœ‰ç€ååˆ†å¼ºå¤§çš„åŠŸèƒ½ã€‚</p><p>çœ‹ä¼¼ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„è”ç³»ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ¯”æˆ‘ä»¬æƒ³çš„äº²å¯†å¤šäº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä»github pageså¼€å§‹ä¸€æ­¥ä¸€æ­¥è®²è¿°å®ƒä»¬ä¹‹é—´çš„è”ç³»ã€‚</p><p>å¦‚æœå¯¹<code>Github Actions</code>è¿˜æ²¡æœ‰åŸºæœ¬çš„è®¤è¯†ï¼Œå»ºè®®å¯ä»¥å…ˆå»äº†è§£ç›¸å…³å†…å®¹æˆ–è€…é˜…è¯»æˆ‘çš„åšå®¢</p><p>ä¼ é€é—¨ï¼š<a href="/2022/11/08/github-action%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/" title="github-actionç®€æ˜æ•™ç¨‹">github-actionç®€æ˜æ•™ç¨‹</a></p><h1 id="å†è®¤è¯†github-pages"><a class="markdownIt-Anchor" href="#å†è®¤è¯†github-pages"></a> å†è®¤è¯†Github Pages</h1><p>æˆ‘ä»¬å…ˆå›åˆ°ä¸€ä¸ªç†Ÿæ‚‰çš„ç•Œé¢ï¼Œä¸‹é¢æ˜¯github pagesçš„é…ç½®ç•Œé¢</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122201939789.png" alt="" /></p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹é…ç½®github pagesçš„æ–¹å¼</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122202036990.png" alt="image-20221122202036990" /></p><p>å‘ç°æ˜¯æœ‰ä¸¤ç§çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å‘ç°äº†ä¸€ä¸ªé€‰é¡¹â€”â€”<code>Github Actions</code>ï¼Œä»è¿™é‡Œå°±çœ‹å‡ºäº†ä¸€äº›ç«¯å€ªï¼Œæˆ‘ä»¬ç”±ä¸¤ç§æ–¹å¼å»éƒ¨ç½²github pagesï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯å€Ÿç”±<code>Github Actions</code>ï¼Œä¸‹é¢å¼€å§‹é€ä¸ªä»‹ç»è¿™ä¸¤ç§æ–¹æ³•ã€‚</p><p><code>Deploy from a branch</code>æ˜¯ä¸€ä¸ªæ›´åŠ å¸¸ç”¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆä»è¿™ä¸ªæ–¹æ³•ä»‹ç»ã€‚</p><h2 id="deploy-from-a-branch"><a class="markdownIt-Anchor" href="#deploy-from-a-branch"></a> Deploy from a branch</h2><p>è¿™ç§æ–¹æ³•çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå…ˆå¾€<code>github</code>çš„ä»“åº“ä¸Šæ¨é€ä¸€ä¸ªç®€å•çš„<code>index.html</code>æ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    Hello World</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122204820985.png" alt="image-20221122204820985" /></p><p>è¿™æ ·å°±å¯ä»¥äº†(è¯·å…ˆå¿½ç•¥å¦ä¸€ä¸ªæ–‡ä»¶å¤¹)ï¼Œç„¶ååœ¨<code>github pages</code>çš„é…ç½®é¡µæŒ‰ä¸‹<code>Save</code>ï¼ˆ<code>å¦‚æœä½ ä¹‹å‰å·²ç»é…ç½®è¿‡github pagesï¼Œé‚£ä¹ˆå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥</code>ï¼‰</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122203701291.png" alt="image-20221122203701291" /></p><p>ç„¶åæˆ‘ä»¬æŸ¥çœ‹<code>github actions</code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°ç«Ÿç„¶æœ‰ä»»åŠ¡æ­£åœ¨è¿è¡Œï¼</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122204016665.png" alt="image-20221122204016665" /></p><p>æ‰€ä»¥æˆ‘ä»¬ä¼šå‘ç°<code>github pages</code>éƒ¨ç½²çš„è¿‡ç¨‹ä¹Ÿæ˜¯èµ°äº†ä¸€ä¸ªå·¥ä½œæµï¼Œé‚£ä¹ˆå…·ä½“å†…å®¹å°±ä¸ä»‹ç»äº†ï¼Œæ¥ç€æˆ‘ä»¬è®¿é—®<code>https://&lt;github id&gt;.github.io/&lt;repository name&gt;/</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122204717686.png" alt="image-20221122204717686" /></p><h2 id="github-actions"><a class="markdownIt-Anchor" href="#github-actions"></a> Github Actions</h2><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ç”¨è‡ªå·±çš„å·¥ä½œæµå»éƒ¨ç½²ï¼Œæˆ‘ä»¬é€‰æ‹©<code>Github Actions</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122205018718.png" alt="image-20221122205018718" /></p><p><code>Github Actions</code>å·²ç»ç»™å‡ºäº†ä¸¤ä¸ªæˆ‘ä»¬å¯èƒ½éœ€è¦çš„<code>workflows</code>æ¨¡æ¿ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>Static HTML</code>ï¼Œç‚¹å‡»<code>Configure</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122205147452.png" alt="image-20221122205147452" /></p><p>è¿™é‡Œæˆ‘ä»¬èƒ½çœ‹åˆ°æˆ‘ä»¬å°†è¦åˆ›å»ºçš„å·¥ä½œæµæ–‡ä»¶ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ä»”ç»†é˜…è¯»ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦ä¿®æ”¹å®ƒçš„é…ç½®ï¼Œç›´æ¥ç‚¹å‡»å³ä¸Šè§’ç»¿è‰²çš„<code>Start commit</code>æäº¤æ”¹å˜å°±å¯ä»¥äº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122205302916.png" alt="image-20221122205302916" /></p><p>å†æ¥çœ‹<code>Github Actions</code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°è‡ªå·±åˆ›å»ºå·¥ä½œæµå·²ç»è¿è¡Œèµ·æ¥äº†ï¼Œè¿™é‡Œæä¸€ä¸‹ï¼Œå·¥ä½œæµè¿è¡Œçš„åå­—å¦‚æœæ²¡æœ‰é…ç½®ï¼Œé»˜è®¤æ˜¯è¿™ä¸€æ¬¡<code>commit</code>çš„ä¿¡æ¯ä½œä¸ºåå­—ï¼Œç­‰å¾…éƒ¨ç½²æˆåŠŸå°±å¯ä»¥äº†ï¼Œæ•ˆæœè¿™é‡Œå°±ä¸æŸ¥çœ‹äº†ï¼Œç°åœ¨å°±é…ç½®å¥½äº†ä¸€ä¸ª<code>Github Actions</code>çš„å·¥ä½œæµï¼Œä¹‹åæˆ‘ä»¬çš„æ¯ä¸€æ¬¡æäº¤éƒ½ä¼šè§¦å‘è¿™ä¸ªå·¥ä½œæµï¼Œè®©å®ƒå¸®åŠ©æˆ‘ä»¬æ„å»º<code>github pages</code></p><h1 id="å·§ç”¨github-actionså¸‚åœº"><a class="markdownIt-Anchor" href="#å·§ç”¨github-actionså¸‚åœº"></a> å·§ç”¨Github Actionså¸‚åœº</h1><p>åˆ°äº†ç°åœ¨è¿™ä¸€æ­¥ï¼Œä½ å¯èƒ½ä¼šæƒŠå¹äºGithub Actionså¼ºå¤§çš„åŠŸèƒ½ï¼ˆå…¶å®ç›®å‰è¿˜æ²¡æ€ä¹ˆè¡¨ç°å‡ºæ¥ï¼Œä¹ğŸ˜…ï¼‰ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯èƒ½æ„Ÿåˆ°å®³æ€•ï¼ŒåŸå› æ˜¯<code>Github Actions</code>çš„é…ç½®æ–‡ä»¶å®åœ¨æ˜¯å¤ªé•¿äº†ï¼Œæˆ‘èƒ½å†™å‡ºè¿™ä¹ˆå¤æ‚çš„å·¥ä½œæµæ–‡ä»¶å—ã€‚</p><p>å¤§å®¶å…¶å®å¤§å¯ä¸å¿…æ‹…å¿ƒï¼Œä¸€æ–¹é¢ï¼Œgithubç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šåœºæ™¯ä¸‹çš„<code>å·¥ä½œæµæ–‡ä»¶æ¨¡æ¿</code>ï¼Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä¹‹å‰æè¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å†æ­¥éª¤ä¸­ä½¿ç”¨åˆ«äººå·²ç»å†™å¥½çš„<code>actions</code>ï¼Œå¤§å¤§ç®€åŒ–æˆ‘ä»¬ç¼–å†™çš„éš¾åº¦ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•æŸ¥çœ‹è‡ªå·±æƒ³è¦çš„å·¥ä½œæµæ–‡ä»¶ã€‚</p><h2 id="å·¥ä½œæµæ–‡ä»¶æ¨¡æ¿"><a class="markdownIt-Anchor" href="#å·¥ä½œæµæ–‡ä»¶æ¨¡æ¿"></a> å·¥ä½œæµæ–‡ä»¶æ¨¡æ¿</h2><p>æˆ‘ä»¬ç‚¹å¼€Actionsï¼Œå¦‚æœæˆ‘ä»¬ä¹‹å‰æ²¡æœ‰åˆ›å»ºè¿‡å·¥ä½œæµï¼Œé‚£ä¹ˆä½ å·²ç»å¯ä»¥å‘ç°ä¸‹é¢æœ‰å¾ˆå¤šçš„å·¥ä½œæµæ–‡ä»¶å¯ä»¥ä¾›ä½ é€‰æ‹©ï¼Œå¦‚æœä½ å·²ç»åˆ›å»ºäº†å·¥ä½œæµï¼Œæˆ‘ä»¬ç‚¹å‡»å·¦ä¾§çš„<code>New workflow</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122210259207.png" alt="image-20221122210259207" /></p><p>è¿™é‡Œæœ‰å¤§é‡çš„æ¨¡æ¿å¯ä»¥é€‰æ‹©ï¼Œ<code>Suggested for this repository</code>æ˜¯githubæ ¹æ®ä½ ä»“åº“ä¸­è¯­è¨€çš„ç§ç±»å æ¯”ç»™ä½ æ¨èæœ€å¯èƒ½ç”¨åˆ°çš„å·¥ä½œæµæ–‡ä»¶ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122210502053.png" alt="image-20221122210502053" /></p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä»ä¸­é€‰æ‹©ï¼Œè¿™ä¼šå¤§å¤§é™ä½æˆ‘ä»¬ç¼–å†™çš„éš¾åº¦</p><h2 id="actionså¸‚åœº"><a class="markdownIt-Anchor" href="#actionså¸‚åœº"></a> actionså¸‚åœº</h2><p>æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹æ€ä¹ˆç»™è‡ªå·±çš„<code>æ­¥éª¤ï¼ˆstepï¼‰</code>æ‰¾åˆ°åˆé€‚çš„actionsï¼Œè®©æˆ‘ä»¬é¿å…ä¹¦å†™é‡å¤çš„è„šæœ¬ï¼Œæˆ‘ä»¬ç‚¹å‡»githubå¯¼èˆªæ ä¸­çš„<code>Marketplace</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122210729497.png" alt="image-20221122210729497" /></p><p>æ¥ä¸‹æ¥ç‚¹å‡»<code>Actions</code>ï¼Œæˆ‘ä»¬çœ‹åˆ°å¾ˆå¤šå·²ç»è¢«ç¼–å†™å¥½çš„<code>actions</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122210826365.png" alt="image-20221122210826365" /></p><p>æˆ‘ä»¬éšä¾¿ç‚¹å¼€ä¸€ä¸ªï¼Œå¤§å¤šæ•°çš„<code>actions</code>éƒ½ä¼šç»™å‡ºç”¨æ³•ï¼Œç¤ºä¾‹å’Œå‚æ•°çš„è¯´æ˜ç­‰ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œä½ å¯ä»¥å¿«é€Ÿä¸Šæ‰‹åˆ«äººçš„è„šæœ¬</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122211029409.png" alt="image-20221122211029409" /></p><h1 id="github-actionsé›†æˆgoé¡¹ç›®çš„ä¸€ä¸ªç®€å•æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#github-actionsé›†æˆgoé¡¹ç›®çš„ä¸€ä¸ªç®€å•æ¡ˆä¾‹"></a> Github Actionsé›†æˆGoé¡¹ç›®çš„ä¸€ä¸ªç®€å•æ¡ˆä¾‹</h1><p>æˆ‘ä»¬å…ˆæ¥ç®€å•çš„å†™ä¸€ä¸ªGoçš„WebæœåŠ¡å’Œä¸€ä¸ªå¯¹åº”çš„æµ‹è¯•æ–‡ä»¶ï¼Œè¿™ä¸ªæœåŠ¡å°†ç›‘å¬8080ç«¯å£ï¼Œè®¿é—®<code>/hello</code>è·¯ç”±å°†è¿”å›<code>hello world</code>ï¼Œæµ‹è¯•æ–‡ä»¶å°†æµ‹è¯•è¿™ä¸ªWebæœåŠ¡å’Œè·¯ç”±æ˜¯å¦æ­£å¸¸ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HelloWorld</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(http.StatusOK, <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">&quot;/hello&quot;</span>, HelloWorld)</span><br><span class="line"></span><br><span class="line">r.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class="line">   <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http&quot;</span></span><br><span class="line">   <span class="string">&quot;testing&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMain</span><span class="params">(m *testing.M)</span></span> &#123;</span><br><span class="line">   <span class="keyword">go</span> main()</span><br><span class="line">   time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">   m.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdd</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">   assertion := assert.New(t)</span><br><span class="line">   resp, err := http.Get(<span class="string">&quot;http://localhost:8080/hello&quot;</span>)</span><br><span class="line">   assertion.Nil(err)</span><br><span class="line">   assertion.Equal(http.StatusOK, resp.StatusCode)</span><br><span class="line">   data, _ := ioutil.ReadAll(resp.Body)</span><br><span class="line">   assertion.Equal(<span class="string">&quot;hello world&quot;</span>, <span class="type">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ç›®å½•å¦‚å›¾ç¤º</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108230538412.png" alt="image-20221108230538412" /></p><p>å…ˆæŠŠä»£ç ä¸Šä¼ åˆ°github</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122211754888.png" alt="image-20221122211754888" /></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å»åˆ›å»ºå·¥ä½œæµï¼Œæˆ‘ä»¬å‘ç°githubå·²ç»ç»™æˆ‘ä»¬æ¨èäº†ä¸¤ä¸ªå·¥ä½œæµæ¨¡æ¿ï¼Œæˆ‘ä»¬ç›´æ¥é€‰ç¬¬äºŒä¸ªï¼ˆå¦‚æœä½ æ²¡æœ‰å‘å…ˆä½ æƒ³è¦çš„å·¥ä½œæµæ¨¡æ¿ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨æœç´¢ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ çš„éœ€æ±‚éƒ½å¯ä»¥è¢«æ»¡è¶³ï¼‰</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122211849893.png" alt="image-20221122211849893" /></p><p>é˜…è¯»å·¥ä½œæµæ–‡ä»¶ï¼Œå‘ç°æˆ‘ä»¬çš„è¿™ä¸ªå·¥ä½œæµæ–‡ä»¶å·²ç»å·®ä¸å¤šæ»¡è¶³äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬æ ¹æ®è‡ªå·±çš„éœ€æ±‚åšå‡ºå°å°çš„ä¿®æ”¹ï¼Œä¸»è¦æ˜¯æ·»åŠ ä¸‹è½½ä¾èµ–çš„æ­¥éª¤</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122212141857.png" alt="image-20221122212141857" /></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å·¥ä½œæµåç§°</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Go</span> <span class="string">package</span></span><br><span class="line"><span class="comment"># ä»»åŠ¡åç§°</span></span><br><span class="line"><span class="attr">run-name:</span> <span class="string">Go</span> <span class="string">Build</span> <span class="string">&amp;&amp;</span> <span class="string">Test</span></span><br><span class="line"><span class="comment"># è§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¥ä½œ</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="comment"># å·¥ä½œçš„åå­—å«åšbuild</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="comment"># è¿è¡Œåœ¨ubuntuä¸Š</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># ä½¿ç”¨actionsï¼Œå°†æ–‡ä»¶ä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œuseå£°æ˜ä½¿ç”¨çš„actions</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">      <span class="comment"># é…ç½®goè¯­è¨€ç¯å¢ƒ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Go</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-go@v3</span></span><br><span class="line">        <span class="comment"># é…ç½®actionsçš„å‚æ•°ï¼Œè¿™é‡Œæ˜¯goçš„ç‰ˆæœ¬</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">go-version:</span> <span class="number">1.18</span></span><br><span class="line">      <span class="comment"># ä¸‹è½½ä¾èµ–</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">go</span> <span class="string">mod</span> <span class="string">download</span></span><br><span class="line">      <span class="comment"># ç¼–è¯‘é¡¹ç›®</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">go</span> <span class="string">build</span> <span class="string">-v</span> <span class="string">.</span></span><br><span class="line">     <span class="comment"># è¿è¡Œæµ‹è¯• </span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Test</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">go</span> <span class="string">test</span> <span class="string">-v</span> <span class="string">.</span></span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬ä¸Šä¼ æˆ‘ä»¬çš„æœ¬åœ°ä»“åº“ï¼ŒæŸ¥çœ‹Actionï¼Œç­‰å¾…ç‰‡åˆ»ï¼Œæ‰§è¡Œå®Œçš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·¥ä½œæµéƒ½è¢«æ‰§è¡Œäº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221122212941261.png" alt="image-20221122212941261" /></p><p>å…³äºGoè¯­è¨€å·¥ä½œæµçš„ç»†èŠ‚å°±ä¸ä»‹ç»äº†ï¼Œä¸‹é¢æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹æµ‹è¯•å‡ºé”™çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¿®æ”¹<code>main.go</code>ï¼Œå°†è¿”å›çš„å†…å®¹ç”±<code>hello world</code>æ”¹ä¸º<code>Hello World</code>ï¼Œæˆ‘ä»¬å†æ¬¡æäº¤è‡³Github</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HelloWorld</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">   c.String(http.StatusOK, <span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„å·¥ä½œæµæ‰§è¡Œå¤±è´¥äº†ï¼Œè¿™æ˜¾ç„¶æ˜¯ç”±äºæˆ‘ä»¬çš„Testæ­¥éª¤æ²¡æœ‰é€šè¿‡å¯¼è‡´çš„</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108231224859.png" alt="image-20221108231224859" /></p><p>æˆ‘ä»¬ç‚¹å¼€æˆ‘ä»¬çš„å·¥ä½œæµæŸ¥çœ‹ç»†èŠ‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108231406042.png" alt="image-20221108231406042" /></p><p>å‘ç°ç¡®å®æ˜¯æˆ‘ä»¬ä¿®æ”¹äº†è¿”å›å€¼ä¸º<code>Hello World</code>å¯¼è‡´çš„é”™è¯¯ï¼Œè¿™æ˜¯ä¸€ç§é”™è¯¯ï¼Œæ­¤å¤–æˆ‘ä»¬å¯ä»¥ä¿®æ”¹Goä»£ç åˆ¶é€ è¯­æ³•é”™è¯¯ï¼Œä½¿ä»£ç æ— æ³•ç¼–è¯‘ï¼Œè¿™é‡Œå°±ä¸å†æµ‹è¯•äº†ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æˆåŠŸä½¿ç”¨äº†Github Actionså®ŒæˆGoé¡¹ç›®çš„æŒç»­é›†æˆï¼Œå¦‚æœæƒ³è¦è¿›ä¸€æ­¥äº†è§£ç›¸å…³å†…å®¹å¯ä»¥é˜…è¯»å®˜æ–¹æ–‡æ¡£</p><p>ä¼ é€é—¨ï¼š<a href="https://docs.github.com/cn/actions">GitHub Actionsæ–‡æ¡£ - GitHub Docs</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> github action </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>casè®¤è¯æµç¨‹ç®€ä»‹</title>
      <link href="/2022/11/18/cas%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E7%AE%80%E4%BB%8B/"/>
      <url>/2022/11/18/cas%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="casæ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#casæ˜¯ä»€ä¹ˆ"></a> CASæ˜¯ä»€ä¹ˆ</h1><p>åœ¨è®¤è¯†CASä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®¤è¯†ä¸€ä¸‹SSOã€‚</p><p>SSOæ˜¯<code>Single Sign On</code>çš„ç¼©å†™ï¼Œæ„ä¸ºå•ç‚¹ç™»å½•ï¼Œæ˜¯ä¸€ç§åº”ç”¨æ¶æ„ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ã€‚</p><p>SSOåªæ˜¯ä¸€ç§æ¶æ„ï¼Œè€ŒCASå°±æ˜¯å®ç°SSOçš„ä¸€å¥—æ–¹æ¡ˆï¼ŒCASæ˜¯<code>Central Authentication Service</code>çš„ç®€ç§°ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/c967cd85751e4e739cd8455286c86302_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.png" alt="c967cd85751e4e739cd8455286c86302_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0" /></p><h1 id="äº†è§£cas"><a class="markdownIt-Anchor" href="#äº†è§£cas"></a> äº†è§£CAS</h1><p>æˆ‘ä»¬å…ˆæ¥ç”¨ä¸€ä¸ªå¥‡æ€ªçš„æ¸¸ä¹åœºæ¨¡æ‹Ÿä¸€ä¸‹CASæ•´ä¸ªè¿ä½œçš„æµç¨‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221118183917114.png" alt="image-20221118183917114" /></p><p>åœ¨è¿™ä¸ªæ¸¸ä¹åœºä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å»<code>æˆæƒä¸­å¿ƒ</code>ä¹°ä¸€æ¬¡ç¥¨å°±å¯ä»¥åœ¨å…¨åœºç•…ç©ã€‚æ¯ä¸ªæ¸¸ä¹è®¾æ–½éƒ½éœ€è¦è‡ªå·±å®ƒä»¬è‡ªå·±<code>å•ç‹¬çš„ç¥¨æ®</code>ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸ªåœ°ç‚¹è´­ä¹°ç¥¨æ®ï¼Œåªè¦æœ‰æ¸¸ä¹åœºçš„é€šç¥¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªé€šç¥¨è®©æ¸¸ä¹è®¾æ–½çš„å”®ç¥¨å¤„æ‰¾æ¸¸ä¹åœºæˆæƒä¸­å¿ƒéªŒè¯ï¼ˆé˜²æ­¢é€šç¥¨ä¼ªé€ ï¼‰ï¼ŒéªŒè¯é€šè¿‡ä»¥åå”®ç¥¨å¤„ä¼šç»™æˆ‘ä»¬ç¥¨æ®ï¼Œæ‹¿ç€å¯¹åº”çš„ç¥¨æ®æˆ‘ä»¬å°±å¯ä»¥åœ¨å¯¹åº”çš„æ¸¸ä¹è®¾æ–½å¿«ä¹çš„ç©è€äº†ã€‚</p><p>åœ¨å®é™…CASå®ç°ä¸­ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹</p><ul><li>æ¸¸å®¢â€”â€”æµè§ˆå™¨</li><li>æ¸¸ä¹åœºæˆæƒä¸­å¿ƒâ€”â€”cas serveræˆæƒè®¤è¯ä¸­å¿ƒ</li><li>æ¸¸ä¹è®¾æ–½â€”â€”å¤šä¸ªAPP</li><li>é€šç¥¨â€”â€”TGCï¼ˆTicket Grangting Ticketï¼‰</li><li>æ¸¸ä¹è®¾æ–½ä¸“é—¨çš„ç¥¨æ®â€”â€”appå¯¹åº”cookie</li></ul><p>å…³ç³»å›¾å¦‚ä¸‹ï¼ˆé™äºCASçš„æµç¨‹å®åœ¨æ¯”è¾ƒç¹çï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªå›¾çœç•¥äº†éƒ¨åˆ†å†…å®¹ï¼Œä¸»è¦çœç•¥åœ¨<code>éªŒè¯é€šè¿‡</code>è¿™é‡Œï¼‰</p><p>ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬è„±ç¦»casæœ¬èº«å¤æ‚çš„æµç¨‹æ¥æ€è€ƒï¼Œcasåªæ˜¯æŠŠå¤šä¸ªåº”ç”¨çš„ç™»å½•åŠŸèƒ½æŠ½ç¦»å‡ºæ¥åšäº†ä¸€ä¸ªé›†æˆè€Œå·²ã€‚è¿™é‡Œå…ˆè¯´æ˜ä¸€ä¸‹ï¼Œåœ¨è¢«çœç•¥çš„éªŒè¯é€šè¿‡æµç¨‹ä¸­ï¼Œæ¶‰åŠ<code>TGC</code>ï¼Œ<code>TGT</code>å’Œ<code>ST</code>ä¸‰ç§ç¥¨æ®ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„å…·ä½“æµç¨‹ä¸­ä»‹ç»ï¼ˆä¸€æ–¹é¢ä¸å¸Œæœ›è¿‡æ—©çš„æŠŠé—®é¢˜å¤æ‚åŒ–ï¼Œä¸€æ–¹é¢ä¸å¸Œæœ›è¯¯å¯¼è¯»è€…ï¼ŒçœŸæ˜¯çº ç»“å•Šï¼Œå¤§å®¶è°…è§£ä¸€ä¸‹ï¼‰</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221118184737951.png" alt="image-20221118184737951" /></p><h1 id="casçš„å…·ä½“æµç¨‹"><a class="markdownIt-Anchor" href="#casçš„å…·ä½“æµç¨‹"></a> CASçš„å…·ä½“æµç¨‹</h1><p>æˆ‘ä¼šåˆ†åˆ«ä»‹ç»å››ä¸ªæ–¹é¢å†…å®¹</p><ul><li>ä»æµè§ˆå™¨å‘å‡ºTGCåˆ°æµè§ˆå™¨æ‹¿åˆ°appçš„cookieçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆä¹Ÿå°±æ˜¯çœç•¥å†…å®¹ï¼‰</li><li>æ²¡æœ‰æ‹¿åˆ°TGCï¼ˆæ²¡æœ‰åœ¨casç™»é™†è¿‡ï¼‰çš„æ•´ä¸ªç™»å½•æµç¨‹</li><li>æ‹¿åˆ°TGCçš„æ•´ä¸ªæµç¨‹</li><li>é€€å‡ºç™»é™†çš„æµç¨‹</li></ul><p>å¦‚æœçœ‹å®Œå‰é¢æ‹†åˆ†çš„æµç¨‹å›¾å’Œç¬¬ä¸€éƒ¨åˆ†ä»ç„¶æ„Ÿåˆ°ç–‘æƒ‘ï¼Œé‚£ä¹ˆå¯ä»¥ä»”ç»†çœ‹çœ‹ç¬¬2éƒ¨åˆ†ï¼Œé‚£é‡Œæœ‰å®Œæ•´çš„æµç¨‹ï¼Œå½“ç„¶ï¼Œä½ è¦æœ‰è€å¿ƒï¼ˆæ”¾å¤§äº†å›¾æ…¢æ…¢çœ‹ï¼Œçœ‹çš„æ—¶å€™è¦ä¿è¯è„‘å­é‡Œæœ‰userï¼Œbrowerï¼Œcas serverï¼Œappå››ä¸ªå¯¹è±¡ï¼Œè¦çŸ¥é“ï¼Œä»…å‡­æ–‡å­—è¿™äº›æµç¨‹ä¼šå¾ˆæŠ½è±¡ï¼Œè¦è®©æµç¨‹åŠ¨èµ·æ¥ï¼‰</p><h2 id="ä»tgcåˆ°app-cookie"><a class="markdownIt-Anchor" href="#ä»tgcåˆ°app-cookie"></a> ä»TGCåˆ°app cookie</h2><ul><li><p>TGTï¼šTicket Grangting Ticket</p></li><li><p>TGCï¼šTicket Granting Cookie</p></li><li><p>STï¼šService Ticket</p></li></ul><p>TGCå’ŒTGCæ˜¯cas serverçš„ä¸€å¯¹cookieå’Œsessionï¼Œè¿™æ ·ç†è§£å°±å¯ä»¥äº†ï¼ŒTGCæ˜¯ç”¨æˆ·åœ¨cas serverç™»å½•è¿‡çš„å‡­è¯</p><p>STæ˜¯å…è®¸ç”¨æˆ·è®¿é—®æŸä¸€APPçš„å‡­æ®ï¼Œè¿™ä¸ªè®²èµ·æ¥æ¯”è¾ƒæŠ½è±¡ï¼Œä¸‹é¢çœ‹å›¾ï¼Œè¿™ä¸ªå›¾å‡è®¾ç”¨æˆ·å·²ç»è·å–äº†TGCï¼ˆè¦æ³¨æ„ï¼Œä¸Šé¢çš„æµç¨‹å›¾å·²ç»å’Œè¿™é‡Œä¸åŒäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„å›¾ä¸ºäº†ç®€åŒ–æµç¨‹æœ¬èº«å°±æœ‰é”™è¯¯çš„å†…å®¹ï¼‰</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221118190222832.png" alt="image-20221118190222832" /></p><p><code>æ˜¯ä¸æ˜¯çœ‹å®Œè¿™äº›æ›´åŠ å¤´æ™•äº†ï¼Œç”±äºæ‹†åˆ†äº†æµç¨‹ï¼Œå±€éƒ¨çš„è®¤çŸ¥å¯èƒ½è¿˜æ˜¯ä¼šè®©ä½ æ„Ÿåˆ°ä¸æ˜ç™½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä¸ªæµç¨‹</code></p><h2 id="æœªç™»å½•çŠ¶æ€ä¸‹æ— tgcçš„å®Œæ•´æµç¨‹"><a class="markdownIt-Anchor" href="#æœªç™»å½•çŠ¶æ€ä¸‹æ— tgcçš„å®Œæ•´æµç¨‹"></a> æœªç™»å½•çŠ¶æ€ä¸‹ï¼ˆæ— TGCï¼‰çš„å®Œæ•´æµç¨‹</h2><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/5e8d855819894c3fa1f8ba85ead37cb2_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.png" alt="" /></p><p>è¿™é‡Œæˆ‘èƒ½è¯´çš„å°±æ˜¯å¤§å®¶è®¤çœŸçœ‹å›¾ï¼Œä¸€å®šè¦æŠŠå››ä¸ªè§’è‰²åœ¨æµç¨‹ä¸­åšä»€ä¹ˆææ¸…æ¥š</p><h2 id="æœ‰tgcçŠ¶æ€ä¸‹ç™»å½•app"><a class="markdownIt-Anchor" href="#æœ‰tgcçŠ¶æ€ä¸‹ç™»å½•app"></a> æœ‰TGCçŠ¶æ€ä¸‹ç™»å½•APP</h2><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/d3264e5b6f18444cb700616d6904fcf8_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.png" alt="" /></p><p>æµç¨‹å’Œä¸Šé¢åŒºåˆ«ä¸å¤§ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å…å»äº†ç”¨æˆ·äº†ç™»å½•ï¼Œè¿™ä¹Ÿæ˜¯casæœ€é‡è¦çš„åœ°æ–¹</p><h2 id="é€€å‡ºç™»å½•"><a class="markdownIt-Anchor" href="#é€€å‡ºç™»å½•"></a> é€€å‡ºç™»å½•</h2><p>éœ€è¦äº†è§£çš„æ˜¯ï¼Œä½¿ç”¨cas serverçš„Appåœ¨ä¸€ä¸ªé€€å‡ºç™»é™†åä¼šå…¨éƒ¨é€€å‡ºç™»å½•</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/a616807e5bd34deb985c72a201826695_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.png" alt="" /></p><p>æµç¨‹æœ‰ç‚¹å¤šï¼Œé™ä¸‹å¿ƒæ¥ä¹Ÿè®¸æ‰æ˜¯æœ€å¥½çš„æ–¹æ³•</p>]]></content>
      
      
      
        <tags>
            
            <tag> sso </tag>
            
            <tag> cas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>swaggoçš„ä½¿ç”¨</title>
      <link href="/2022/11/17/swaggo%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/11/17/swaggo%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>swagæ˜¯ä¸€ä¸ªä¸ºGoè¯­è¨€ç”Ÿæˆæ–‡æ¡£çš„æ¡†æ¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ</p><ul><li>swagå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæŠŠGoæ³¨é‡Šç”Ÿæˆä¸ºå¯¹åº”çš„Swagger2.0æ–‡æ¡£</li><li>ä¸ºå¤šç§æµè¡Œæ¡†æ¶å‡†å¤‡çš„æ’ä»¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€ŸåµŒå…¥Swag</li></ul><h1 id="å¿«é€Ÿå¼€å§‹ä»¥ginä¸ºä¾‹"><a class="markdownIt-Anchor" href="#å¿«é€Ÿå¼€å§‹ä»¥ginä¸ºä¾‹"></a> å¿«é€Ÿå¼€å§‹(ä»¥ginä¸ºä¾‹)</h1><h2 id="ä¸‹è½½å’Œä½¿ç”¨swagå‘½ä»¤è¡Œå·¥å…·"><a class="markdownIt-Anchor" href="#ä¸‹è½½å’Œä½¿ç”¨swagå‘½ä»¤è¡Œå·¥å…·"></a> ä¸‹è½½å’Œä½¿ç”¨swagå‘½ä»¤è¡Œå·¥å…·</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go install github.com/swaggo/swag/cmd/swag@latest</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸èƒ½ä½¿ç”¨è®°å¾—æ£€æŸ¥ä¸€ä¸‹ä½ çš„<code>$&#123;GOPATH&#125;/bin</code>ç›®å½•æ˜¯å¦åŠ å…¥äº†ç¯å¢ƒå˜é‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åŠ ä¸ŠGoæ³¨é‡Šï¼Œmain()å‡½æ•°ä¸­çš„å†…å®¹æˆ‘ä»¬æš‚ä¸”ä¸éœ€è¦ç®¡ï¼Œåœ¨ä½ çš„main.goä¸­åŠ å…¥ä¸Šé¢çš„æ³¨é‡Šéƒ¨åˆ†å°±å¯ä»¥äº†ï¼Œå¦‚æœä½ ä¸æƒ³æŠŠæ³¨é‡Šæ”¾åœ¨main.goçš„ä½ç½®ï¼Œåé¢ä½¿ç”¨swagå‘½ä»¤è¡Œå·¥å…·çš„è¿‡ç¨‹ä¸­éœ€è¦å¸¦ä¸Šç›¸å…³çš„å‚æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @title           Swagger Example API</span></span><br><span class="line"><span class="comment">// @version         1.0</span></span><br><span class="line"><span class="comment">// @description     This is a sample server celler server.</span></span><br><span class="line"><span class="comment">// @termsOfService  http://swagger.io/terms/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @contact.name   API Support</span></span><br><span class="line"><span class="comment">// @contact.url    http://www.swagger.io/support</span></span><br><span class="line"><span class="comment">// @contact.email  support@swagger.io</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @license.name  Apache 2.0</span></span><br><span class="line"><span class="comment">// @license.url   http://www.apache.org/licenses/LICENSE-2.0.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @host      localhost:8080</span></span><br><span class="line"><span class="comment">// @BasePath  /api/v1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @securityDefinitions.basic  BasicAuth</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    c := controller.NewController()</span><br><span class="line"></span><br><span class="line">    v1 := r.Group(<span class="string">&quot;/api/v1&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        accounts := v1.Group(<span class="string">&quot;/accounts&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            accounts.GET(<span class="string">&quot;:id&quot;</span>, c.ShowAccount)</span><br><span class="line">            accounts.GET(<span class="string">&quot;&quot;</span>, c.ListAccounts)</span><br><span class="line">            accounts.POST(<span class="string">&quot;&quot;</span>, c.AddAccount)</span><br><span class="line">            accounts.DELETE(<span class="string">&quot;:id&quot;</span>, c.DeleteAccount)</span><br><span class="line">            accounts.PATCH(<span class="string">&quot;:id&quot;</span>, c.UpdateAccount)</span><br><span class="line">            accounts.POST(<span class="string">&quot;:id/images&quot;</span>, c.UploadAccountImage)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    r.GET(<span class="string">&quot;/swagger/*any&quot;</span>, ginSwagger.WrapHandler(swaggerFiles.Handler))</span><br><span class="line">    r.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆswagçš„docsç›®å½•ï¼Œç›®å½•ä¸­åŒ…å«äº†swagæ–‡æ¡£ä¸­çš„æ‰€æœ‰ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">swag init</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221117204850694.png" alt="image-20221117204850694" /></p><p>å¦‚æœä½ çš„æ³¨é‡Šåœ¨å…¶å®ƒåœ°æ–¹ï¼ŒåŠ ä¸Š-gå‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">swag init -g &lt;filepath&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨swagçš„fmtå‘½ä»¤æ¥æ ¼å¼åŒ–æˆ‘ä»¬çš„æ³¨é‡Šï¼Œå½“ç„¶ï¼Œè¿™ä¸æ˜¯å¿…é¡»çš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">swag <span class="built_in">fmt</span></span></span><br></pre></td></tr></table></figure><h2 id="æ•´åˆgin"><a class="markdownIt-Anchor" href="#æ•´åˆgin"></a> æ•´åˆgin</h2><p>ä¸‹è½½ç›¸å…³åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get -u github.com/swaggo/swag/cmd/swag</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨ç»™swaggeråˆ†é…è·¯ç”±çš„æ–‡ä»¶ä¸­åŠ ä¸Šå¯¹åº”çš„åŒ…ï¼Œåˆ†é…è·¯ç”±çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/swagger/*any&quot;</span>, ginSwagger.WrapHandler(swaggerFiles.Handler))</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä½ æƒ³æŠŠè¿™è¡Œä»£ç æ”¾åœ¨ä»€ä¹ˆä½ç½®ï¼Œå°±æŠŠå¯¹åº”çš„åŒ…å¼•å…¥ã€‚è¿™é‡Œåˆ‡è®°ï¼Œä¸€å®šè¦å¯¼å…¥çš„docsæ–‡ä»¶ï¼Œå¦åˆ™swaggerå°†ä¼šæ‰¾ä¸åˆ°æ•°æ®ï¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/swaggo/gin-swagger&quot;</span> <span class="comment">// gin-swagger middleware</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/swaggo/files&quot;</span> <span class="comment">// swagger embed files</span></span><br><span class="line"><span class="keyword">import</span> _<span class="string">&quot;project-name/docs&quot;</span> <span class="comment">// å¯¼å…¥ä½ çš„docsæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ä¸‹é¢è¿™ä¸ªæ–¹å¼ç»™swaggeræ–‡æ¡£åˆ†é…è·¯ç”±</span></span><br><span class="line"><span class="comment">// è®¿é—®/swagger/index.html</span></span><br><span class="line">r.GET(<span class="string">&quot;/swagger/*any&quot;</span>, ginSwagger.WrapHandler(swaggerFiles.Handler))</span><br></pre></td></tr></table></figure><p>æœ€åè®¿é—®<code>/swagger/index.html</code>å°±å¯ä»¥ç”Ÿæ•ˆäº†</p><h2 id="ç»™apiæ·»åŠ æ³¨é‡Š"><a class="markdownIt-Anchor" href="#ç»™apiæ·»åŠ æ³¨é‡Š"></a> ç»™APIæ·»åŠ æ³¨é‡Š</h2><p>æˆ‘ä»¬ç®€å•çœ‹ä¸ªä¾‹å­</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ListAccounts godoc</span></span><br><span class="line"><span class="comment">// @Summary      List accounts</span></span><br><span class="line"><span class="comment">// @Description  get accounts</span></span><br><span class="line"><span class="comment">// @Tags         accounts</span></span><br><span class="line"><span class="comment">// @Accept       json</span></span><br><span class="line"><span class="comment">// @Produce      json</span></span><br><span class="line"><span class="comment">// @Param        q    query     string  false  &quot;name search by q&quot;  Format(email)</span></span><br><span class="line"><span class="comment">// @Success      200  &#123;array&#125;   model.Account</span></span><br><span class="line"><span class="comment">// @Failure      400  &#123;object&#125;  httputil.HTTPError</span></span><br><span class="line"><span class="comment">// @Failure      404  &#123;object&#125;  httputil.HTTPError</span></span><br><span class="line"><span class="comment">// @Failure      500  &#123;object&#125;  httputil.HTTPError</span></span><br><span class="line"><span class="comment">// @Router       /accounts [get]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Controller)</span></span> ListAccounts(ctx *gin.Context) &#123;</span><br><span class="line">  q := ctx.Request.URL.Query().Get(<span class="string">&quot;q&quot;</span>)</span><br><span class="line">  accounts, err := model.AccountsAll(q)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    httputil.NewError(ctx, http.StatusNotFound, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  ctx.JSON(http.StatusOK, accounts)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´å¤šçš„ä¾‹å­å¤§å®¶è‡ªå·±å»è¯»å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘å°±ä¸å…·ä½“ä»‹ç»äº†ï¼Œè¿™é‡Œè¦æä¸€å¥ï¼Œæ³¨é‡Šå’Œå¯¹åº”çš„å‡½æ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºè¡Œï¼Œå¦åˆ™ä¸ä¼šç»™è¿™ä¸ªå‡½æ•°ç”Ÿæˆæ–‡æ¡£</p><p><a href="https://github.com/swaggo/swag">swaggo/swag</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> swaggo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoéƒ¨ç½²åˆ°è‡ªå·±çš„äº‘æœåŠ¡å™¨</title>
      <link href="/2022/11/09/hexo%E9%83%A8%E7%BD%B2%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2022/11/09/hexo%E9%83%A8%E7%BD%B2%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹ä¹‹å‰"><a class="markdownIt-Anchor" href="#å¼€å§‹ä¹‹å‰"></a> å¼€å§‹ä¹‹å‰</h1><p>æœ¬æ–‡ä¸ä¼šæ¶‰åŠhexoçš„ä½¿ç”¨ï¼Œè¯·å…ˆå»äº†è§£hexoçš„åŸºæœ¬ä½¿ç”¨å’Œéƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥å‚è€ƒæˆ‘çš„æ–‡ç« <a href="/2022/11/05/hexo%E5%BB%BA%E7%AB%99%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/" title="hexoå»ºç«™ç®€æ˜æ•™ç¨‹">hexoå»ºç«™ç®€æ˜æ•™ç¨‹</a>ã€‚</p><p>æœ¬æ•™ç¨‹åŸºäºCentos7.6ï¼Œå¦‚æœæ˜¯å…¶å®ƒlinuxå‘è¡Œç‰ˆè¯·è‡ªè¡Œä¿®æ”¹ç›¸åº”å‘½ä»¤ã€‚</p><h1 id="æ„å»ºæœåŠ¡å™¨ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#æ„å»ºæœåŠ¡å™¨ç¯å¢ƒ"></a> æ„å»ºæœåŠ¡å™¨ç¯å¢ƒ</h1><h2 id="å®‰è£…gitå’Œnginx"><a class="markdownIt-Anchor" href="#å®‰è£…gitå’Œnginx"></a> å®‰è£…gitå’Œnginx</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install git</span><br><span class="line">yum install nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ubuntu</span></span><br><span class="line">apt install git</span><br><span class="line">apt install nginx</span><br></pre></td></tr></table></figure><h2 id="é…ç½®gitä»“åº“"><a class="markdownIt-Anchor" href="#é…ç½®gitä»“åº“"></a> é…ç½®gitä»“åº“</h2><p>ä¸‹é¢çš„ç”¨æˆ·å’Œç›®å½•éƒ½å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œä½†æ³¨æ„è¦ä¿æŒä¸Šä¸‹æ–‡ç»Ÿä¸€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">useradd hexo # æ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œå…¶å®ä¹Ÿä¸æ˜¯å¿…é¡»çš„</span><br><span class="line">chown -R hexo:hexo /home/hexo # æŠŠç›®å½•çš„å½’å±æƒäº¤ç»™hexoç”¨æˆ·</span><br><span class="line">cd home</span><br><span class="line">chmod o+x hexo # é»˜è®¤åˆ›å»ºçš„hexoæ–‡ä»¶å¤¹åªæœ‰hexoæœ‰æ‰§è¡Œæƒé™ï¼Œnginxç”¨æˆ·æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œå°†ä¼šå¯¼è‡´403</span><br><span class="line">cd hexo</span><br><span class="line">mkdir -p /home/hexo/www/blog # åˆ›å»ºåšå®¢éƒ¨ç½²ç›®å½•</span><br><span class="line">git init --bare blog.git # è£¸ä»“åº“ï¼Œæ²¡æœ‰å·¥ä½œç©ºé—´</span><br><span class="line">cd /home/hexo/blog.git/hooks</span><br><span class="line">vim post-receive # åˆ›å»ºé’©å­æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">git --work-tree=/home/hexo/www/blog --git-dir=/home/hexo/blog.git checkout -f</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>#!/bin/sh</code>ä¸è¦æ¼äº†ï¼Œè¿™é‡Œå£°æ˜äº†ä¸‹é¢è„šæœ¬æ‰§è¡Œå™¨çš„ä½ç½®ã€‚</p><p><code>work-tree</code>ï¼šå·¥ä½œç›®å½•</p><p><code>git-dir</code>ï¼šgitä»“åº“ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-receive # ç»™ä¸æ‰§è¡Œæƒé™</span><br></pre></td></tr></table></figure><p>è¿œç¨‹çš„gitä»“åº“å¤§è‡´é…ç½®å°±æ˜¯å¦‚æ­¤</p><h2 id="é…ç½®ssh"><a class="markdownIt-Anchor" href="#é…ç½®ssh"></a> é…ç½®ssh</h2><p>åœ¨ä½ çš„windowsç”µè„‘ä¸Šç”Ÿæˆsshå…¬é’¥å¯†é’¥ï¼ˆéœ€è¦å®‰è£…gitï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä¼šè®©ä½ è¾“å…¥å…¬é’¥å’Œå¯†é’¥çš„ä¿å­˜ä½ç½®å’Œå¯†ç ç­‰ï¼Œå¦‚æœä¸æƒ³è¾“å…¥å¯ä»¥æŒ‰å›è½¦ï¼Œè¿™å°†ä½¿ç”¨é»˜è®¤çš„å­˜æ”¾ä½ç½®å’Œç©ºçš„å¯†ç ã€‚</p><p>é»˜è®¤å­˜åœ¨åœ¨ä½ çš„<code>C:\Users\ç”¨æˆ·å\.ssh</code>ç›®å½•ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221109162309901.png" alt="image-20221109162309901" /></p><p>è¿™é‡Œå»ºè®®ç”¨æ”¯æŒftpçš„ç¬¬ä¸‰æ–¹å·¥å…·ç›´æ¥æ“ä½œã€‚</p><p>æŠŠ<code>id_rsa.pub</code>æ”¾åˆ°æœåŠ¡å™¨çš„<code>/home/hexo/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­ï¼ˆå¦‚æœæ–‡ä»¶ä¸­å·²ç»å­˜åœ¨å…¬é’¥ï¼Œè¿½åŠ åœ¨æ–‡ä»¶ä¸‹é¢å³å¯ï¼‰ã€‚</p><p>å¦‚æœä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œä½¿ç”¨powershellç”¨rootç™»å½•åˆ°æœåŠ¡å™¨ä¸Šï¼ˆhexoç”¨æˆ·ç›®å‰æ²¡æœ‰è®¾ç½®å¯†ç ï¼‰ï¼Œç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@ip # è¿™é‡Œçš„ipè¦æ¢æˆä½ çš„æœåŠ¡å™¨ip</span><br><span class="line">scp æœ¬åœ°æ–‡ä»¶ä½ç½® root@ip:/home/hexo/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œå¯ä»¥æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh hexo@ip</span><br></pre></td></tr></table></figure><p>é…ç½®æˆåŠŸåº”è¯¥å¯ä»¥ç›´æ¥ç™»å½•</p><h2 id="å°†æœ¬åœ°hexoåšå®¢ä¸Šä¼ åˆ°æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å°†æœ¬åœ°hexoåšå®¢ä¸Šä¼ åˆ°æœåŠ¡å™¨"></a> å°†æœ¬åœ°hexoåšå®¢ä¸Šä¼ åˆ°æœåŠ¡å™¨</h2><p>ä¿®æ”¹åšå®¢ç›®å½•ä¸‹çš„<code>_config.yaml</code>æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">hexo@ip:/home/hexo/blog.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>å°†deployéƒ¨åˆ†ä¿®æ”¹å¦‚ä¸Šï¼Œç„¶åä½¿ç”¨éƒ¨ç½²å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨<code>/home/hexo/www/blog</code>ç›®å½•ä¸‹çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶</p><h2 id="é…ç½®nginx"><a class="markdownIt-Anchor" href="#é…ç½®nginx"></a> é…ç½®nginx</h2><p>æœ€åä½¿ç”¨nginxåå‘ä»£ç†å°±å¯ä»¥å®ç°è®¿é—®äº†ã€‚</p><p>ä½¿ç”¨http</p><p><code>/etc/nginx/nginx.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For more information on configuration, see:</span></span><br><span class="line"><span class="comment">#   * Official English Documentation: http://nginx.org/en/docs/</span></span><br><span class="line"><span class="comment">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">user</span> nginx;</span><br><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"><span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log;</span><br><span class="line"><span class="attribute">pid</span> /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span>  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>            <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span>          <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nodelay</span>         <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>   <span class="number">65</span>;</span><br><span class="line">    <span class="attribute">types_hash_max_size</span> <span class="number">4096</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span>             /etc/nginx/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>        application/octet-stream;</span><br><span class="line">    <span class="comment"># Load modular configuration files from the /etc/nginx/conf.d directory.</span></span><br><span class="line">    <span class="comment"># See http://nginx.org/en/docs/ngx_core_module.html#include</span></span><br><span class="line">    <span class="comment"># for more information.</span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">listen</span>       [::]:<span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  _;</span><br><span class="line">        <span class="attribute">root</span>         /home/hexo/www/blog;</span><br><span class="line">        <span class="attribute">charset</span> utf8;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">        <span class="section">location</span> = /<span class="number">404</span>.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦é…ç½®https</p><p><code>/etc/nginx/nginx.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For more information on configuration, see:</span></span><br><span class="line"><span class="comment">#   * Official English Documentation: http://nginx.org/en/docs/</span></span><br><span class="line"><span class="comment">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">user</span> nginx;</span><br><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"><span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log;</span><br><span class="line"><span class="attribute">pid</span> /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span>  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>            <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span>          <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nodelay</span>         <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>   <span class="number">65</span>;</span><br><span class="line">    <span class="attribute">types_hash_max_size</span> <span class="number">4096</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span>             /etc/nginx/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>        application/octet-stream;</span><br><span class="line">    <span class="comment"># Load modular configuration files from the /etc/nginx/conf.d directory.</span></span><br><span class="line">    <span class="comment"># See http://nginx.org/en/docs/ngx_core_module.html#include</span></span><br><span class="line">    <span class="comment"># for more information.</span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">443</span> ssl http2;</span><br><span class="line">        <span class="attribute">listen</span>       [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">        <span class="attribute">server_name</span>  _;</span><br><span class="line">        <span class="attribute">root</span>         /home/hexo/www/blog;</span><br><span class="line">        <span class="attribute">charset</span> utf8;</span><br><span class="line">        <span class="attribute">ssl_certificate</span>     è¯ä¹¦æ‰€åœ¨ä½ç½®;</span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> è¯ä¹¦çš„å¯†é’¥æ‰€åœ¨ä½ç½®;</span><br><span class="line">        <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">1m</span>;</span><br><span class="line">        <span class="attribute">ssl_session_timeout</span>  <span class="number">10m</span>;</span><br><span class="line">        <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">        <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">        <span class="section">location</span> = /<span class="number">404</span>.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½åæˆ‘ä»¬é‡æ–°åŠ è½½ä¸€ä¸‹nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -t # æ£€æŸ¥nginxé…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®</span><br><span class="line">systemctl start nginx # å¦‚æœæ²¡æœ‰å¯åŠ¨nginx</span><br><span class="line">systemctl reload nginx # é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æœ€åæµ‹è¯•ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http</span></span><br><span class="line">curl localhost</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https</span></span><br><span class="line">curl https://åŸŸå</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github-actionç®€æ˜æ•™ç¨‹</title>
      <link href="/2022/11/08/github-action%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/"/>
      <url>/2022/11/08/github-action%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="github-actionsæ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#github-actionsæ˜¯ä»€ä¹ˆ"></a> Github Actionsæ˜¯ä»€ä¹ˆ</h1><p>GitHub Actions æ˜¯ä¸€ç§æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ (CI/CD) å¹³å°ï¼Œå¯ç”¨äºè‡ªåŠ¨æ‰§è¡Œç”Ÿæˆã€æµ‹è¯•å’Œéƒ¨ç½²ç®¡é“ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯é€šè¿‡ç¼–å†™ç¬¦åˆGithub Actionsè¦æ±‚çš„<code>&quot;è„šæœ¬&quot;</code>ï¼Œè®©Githubæ¥æ‰§è¡Œè¿™ä¸€çš„<code>&quot;è„šæœ¬&quot;</code>ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¿˜æ˜¯æœ‰å¿…è¦ç®€å•çš„ä»‹ç»ä¸€ä¸‹æŒç»­é›†æˆã€‚</p><p><strong>æŒç»­é›†æˆæŒ‡çš„æ˜¯ï¼Œé¢‘ç¹åœ°ï¼ˆä¸€å¤©å¤šæ¬¡ï¼‰å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ã€‚</strong></p><p>å®ƒçš„å¥½å¤„ä¸»è¦æœ‰ä¸¤ä¸ªã€‚</p><blockquote><p>**ï¼ˆ1ï¼‰å¿«é€Ÿå‘ç°é”™è¯¯ã€‚**æ¯å®Œæˆä¸€ç‚¹æ›´æ–°ï¼Œå°±é›†æˆåˆ°ä¸»å¹²ï¼Œå¯ä»¥å¿«é€Ÿå‘ç°é”™è¯¯ï¼Œå®šä½é”™è¯¯ä¹Ÿæ¯”è¾ƒå®¹æ˜“ã€‚</p><p>**ï¼ˆ2ï¼‰é˜²æ­¢åˆ†æ”¯å¤§å¹…åç¦»ä¸»å¹²ã€‚**å¦‚æœä¸æ˜¯ç»å¸¸é›†æˆï¼Œä¸»å¹²åˆåœ¨ä¸æ–­æ›´æ–°ï¼Œä¼šå¯¼è‡´ä»¥åé›†æˆçš„éš¾åº¦å˜å¤§ï¼Œç”šè‡³éš¾ä»¥é›†æˆã€‚</p></blockquote><p>**æŒç»­é›†æˆçš„ç›®çš„ï¼Œå°±æ˜¯è®©äº§å“å¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒé«˜è´¨é‡ã€‚**å®ƒçš„æ ¸å¿ƒæªæ–½æ˜¯ï¼Œä»£ç é›†æˆåˆ°ä¸»å¹²ä¹‹å‰ï¼Œå¿…é¡»é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚åªè¦æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼Œå°±ä¸èƒ½é›†æˆã€‚</p><h1 id="ç†è§£github-actionså·¥ä½œæµ"><a class="markdownIt-Anchor" href="#ç†è§£github-actionså·¥ä½œæµ"></a> ç†è§£Github Actionså·¥ä½œæµ</h1><p>ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°çš„è„šæœ¬åœ¨å…·ä½“çš„å®ç°ä¸­å°±æ˜¯ä¸€ä¸ªå·¥ä½œæµæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é‡‡ç”¨yamlç¼–å†™ï¼Œæ–‡ä»¶çš„å‘½åæ²¡æœ‰è¦æ±‚ï¼Œæ”¾ç½®åœ¨ä»£ç ä»“åº“çš„<code>.github/workflows</code>æ–‡ä»¶å¤¹ä¸‹ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæœ€ç®€å•çš„å·¥ä½œæµæ–‡ä»¶æ¥ç†è§£å·¥ä½œæµçš„ç»„æˆï¼Œç„¶åæˆ‘ä»¬å°è¯•è®©Githubå¸®åŠ©æˆ‘ä»¬å®Œæˆä¸‹é¢çš„å·¥ä½œã€‚</p><p><code>example.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">GitHub</span> <span class="string">Actions</span> <span class="string">Demo</span></span><br><span class="line"><span class="attr">run-name:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.actor</span> <span class="string">&#125;&#125;</span> <span class="string">is</span> <span class="string">testing</span> <span class="string">out</span> <span class="string">GitHub</span> <span class="string">Actions</span> <span class="string">ğŸš€</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="comment"># å·¥ä½œåå­—ï¼Œæ²¡æœ‰è¦æ±‚  </span></span><br><span class="line">  <span class="attr">Explore-GitHub-Actions:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;ğŸ‰ The job was automatically triggered by a $<span class="template-variable">&#123;&#123; github.event_name &#125;&#125;</span> event.&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;ğŸ§ This job is now running on a $<span class="template-variable">&#123;&#123; runner.os &#125;&#125;</span> server hosted by GitHub!&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;ğŸ” The name of your branch is $<span class="template-variable">&#123;&#123; github.ref &#125;&#125;</span> and your repository is $<span class="template-variable">&#123;&#123; github.repository &#125;&#125;</span>.&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Check</span> <span class="string">out</span> <span class="string">repository</span> <span class="string">code</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;ğŸ’¡ The $<span class="template-variable">&#123;&#123; github.repository &#125;&#125;</span> repository has been cloned to the runner.&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;ğŸ–¥ï¸ The workflow is now ready to test your code on the runner.&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">List</span> <span class="string">files</span> <span class="string">in</span> <span class="string">the</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          ls $&#123;&#123; github.workspace &#125;&#125;</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;ğŸ This job&#x27;s status is $<span class="template-variable">&#123;&#123; job.status &#125;&#125;</span>.&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108214958201.png" alt="image-20221108214958201" /></p><h2 id="github-actionsç»„æˆ"><a class="markdownIt-Anchor" href="#github-actionsç»„æˆ"></a> Github Actionsç»„æˆ</h2><h3 id="workflowså·¥ä½œæµ"><a class="markdownIt-Anchor" href="#workflowså·¥ä½œæµ"></a> Workflowsâ€”â€”å·¥ä½œæµ</h3><p>å·¥ä½œæµæ˜¯ä¸€ä¸ªå¯é…ç½®çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ï¼Œå®ƒå°†è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä½œä¸šã€‚è¯´å¾—å…·ä½“ä¸€ç‚¹ï¼Œå·¥ä½œæµæ˜¯å¯¹å·¥ä½œæµç¨‹åŠå…¶å„æ“ä½œæ­¥éª¤ä¹‹é—´ä¸šåŠ¡è§„åˆ™çš„æŠ½è±¡å’Œæ¦‚æ‹¬æè¿°ã€‚æ¯”å¦‚è¯´ä½ è¦åšä¸€ä»¶äº‹ï¼Œå®Œæˆè¿™ä»¶äº‹è¦æœ‰å¾ˆå¤šçš„æ­¥éª¤ï¼Œè€Œè¿™äº›æ­¥éª¤ä¹‹é—´ç›¸äº’çš„å…³ç³»å’Œé€»è¾‘å°±æ˜¯ä¸€ä¸ªå·¥ä½œæµã€‚</p><p>åœ¨Github Actionsä¸­ï¼Œå·¥ä½œæµç”±ç­¾å…¥åˆ°å­˜å‚¨åº“çš„ YAML æ–‡ä»¶å®šä¹‰ï¼Œå¹¶åœ¨å­˜å‚¨åº“ä¸­çš„äº‹ä»¶è§¦å‘æ—¶è¿è¡Œï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼Œæˆ–æŒ‰å®šä¹‰çš„æ—¶é—´è¡¨è§¦å‘ï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±<code>on</code>æ ‡ç­¾å®šä¹‰è§¦å‘äº‹ä»¶ï¼Œè¡¨ç¤ºå½“ä½ æŠŠä»£ç pushåˆ°ä»“åº“æ—¶è§¦å‘è¿™ä¸ªå·¥ä½œæµã€‚</p><p>ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªyamlæ–‡ä»¶å°±ä»£è¡¨äº†ä¸€ä¸ªå·¥ä½œæµã€‚ä¸€ä¸ªä»“åº“å¯ä»¥é…ç½®å¤šä¸ªå·¥ä½œæµæ–‡ä»¶ï¼Œå®ƒä»¬å°†ç‹¬ç«‹æ‰§è¡Œã€‚</p><p><code>name: GitHub Actions Demo</code>ï¼šå®šä¹‰äº†è¿™ä¸ªå·¥ä½œæµçš„åå­—</p><p><code>run-name</code>ï¼šå½“å‰æ­£åœ¨è¿è¡Œçš„å·¥ä½œæµåç§°</p><h3 id="eventsäº‹ä»¶"><a class="markdownIt-Anchor" href="#eventsäº‹ä»¶"></a> Eventsâ€”â€”äº‹ä»¶</h3><p>ä¸€ä¸ªå…·ä½“çš„æ´»åŠ¨ï¼Œç”¨äºè§¦å‘å·¥ä½œæµæ‰§è¡Œã€‚</p><p><code>on</code>ï¼šè§¦å‘å·¥ä½œæµçš„äº‹ä»¶ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­è¡¨ç¤ºå‘è¿™ä¸ªä»“åº“ä¸­pushå°±ä¼šæ‰§è¡Œè¿™ä¸ªå·¥ä½œæµ</p><h3 id="jobså·¥ä½œå’Œstepsæ­¥éª¤"><a class="markdownIt-Anchor" href="#jobså·¥ä½œå’Œstepsæ­¥éª¤"></a> Jobsâ€”â€”å·¥ä½œå’ŒStepsâ€”â€”æ­¥éª¤</h3><p>ä¸€ä¸ªå·¥ä½œæ˜¯ä¸€ç³»åˆ—æ‰§è¡Œåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„æ­¥éª¤çš„é›†åˆã€‚æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ä¸€ä¸ªShellè„šæœ¬æˆ–è€…ä¸€ä¸ªactionsï¼ˆä¸€ç³»åˆ—ç”±ä»–äººå·²ç»å®Œæˆçš„è„šæœ¬ï¼‰ã€‚è¿™äº›æ­¥éª¤ä¼šåœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œï¼Œå®ƒä»¬å…±äº«ä¸Šä¸‹æ–‡å’Œä¾èµ–ï¼Œæ­¥éª¤ä¹‹é—´æŒ‰ç…§é¡ºåºæ‰§è¡Œã€‚</p><p><code>name</code>ï¼šå®šä¹‰äº†æ­¥éª¤çš„åå­—</p><p><code>run</code>ï¼šä¸€ä¸ªæ­¥éª¤å…·ä½“è¦æ‰§è¡Œçš„å†…å®¹</p><h3 id="actions"><a class="markdownIt-Anchor" href="#actions"></a> Actions</h3><p>ä¸€ç³»åˆ—ç”±ä»–äººå†™å¥½çš„è„šæœ¬ï¼Œè¿™äº›è„šæœ¬åœ¨Githubçš„<code>Marketplace</code>ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œä½¿ç”¨Actionså¯ä»¥å¤§å¤§å‡å°‘æˆ‘ä»¬éœ€è¦ç¼–å†™çš„ä»£ç é‡ï¼Œé¿å…æ‰§è¡Œé‡å¤çš„æ“ä½œï¼Œæ¯”å¦‚ç€è¿™ä¸ªç¤ºä¾‹æ–‡ä»¶ä¸­ä½¿ç”¨çš„<code>actions/checkout@v3</code>å°±æ˜¯ä¸€ä¸ªactionsï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠå½“å‰ä»“åº“çš„æ–‡ä»¶è½¬ç§»åˆ°æœåŠ¡å™¨ä¸­ï¼Œå¦‚æœå·¥ä½œæµä¸­éœ€è¦æ‰§è¡Œè„šæœ¬å°±å¿…é¡»åŒ…å«è¿™ä¸ªactionsï¼Œæ‰€ä»¥å‡ ä¹å¤§éƒ¨åˆ†çš„å·¥ä½œæµéƒ½ä¼šåŒ…å«è¿™ä¸ªactionsã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108230338604.png" alt="image-20221108230338604" /></p><p><code>use</code>ï¼šå£°æ˜è¦ä½¿ç”¨çš„actions</p><p><code>with</code>ï¼šé…ç½®actionså‚æ•°</p><h3 id="runners"><a class="markdownIt-Anchor" href="#runners"></a> Runners</h3><p>è¿è¡Œå·¥ä½œæµçš„æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨å¯ä»¥ç”±Githubå…è´¹æä¾›ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨ä½ è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œç›®å‰Githubæä¾›ä¸‰ç§æ“ä½œç³»ç»Ÿ</p><ul><li>Microsoft Windows</li><li>Ubuntu Linux</li><li>macOS</li></ul><p>ç”±Githubæä¾›çš„æœåŠ¡å™¨æ¯æ¬¡è¿è¡Œéƒ½æ˜¯ä¸€ä¸ªå…¨æ–°çš„ï¼Œæœªé…ç½®è¿‡çš„æ–°æœåŠ¡å™¨ã€‚</p><p><code>runs-on</code>ï¼šå®šä¹‰äº†è¯¥å·¥ä½œä½¿ç”¨çš„æœåŠ¡å™¨</p><h3 id="ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡"></a> ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡</h3><p>å³ä¾¿æ²¡æœ‰å­¦è¿‡ï¼Œå¾ˆæ˜æ˜¾<code>$&#123;&#123;&#125;&#125;</code>è¯­æ³•æ˜¯ä¸€ç§å–å‡ºå˜é‡çš„ç”¨æ³•ï¼Œè¿™é‡Œä¸å…·ä½“ä»‹ç»ã€‚</p><h3 id="github-actionsåˆæ­¥ä½¿ç”¨"><a class="markdownIt-Anchor" href="#github-actionsåˆæ­¥ä½¿ç”¨"></a> Github Actionsåˆæ­¥ä½¿ç”¨</h3><p>ä»‹ç»å®Œäº†åŸºç¡€æ¦‚å¿µï¼Œä¸‹é¢æˆ‘ä»¬æ¥ç”¨ä¸Šé¢çš„å·¥ä½œæµæ–‡ä»¶æ¥ç¬¬ä¸€æ¬¡ä½¿ç”¨Github Actions</p><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†<code>example.yaml</code>æ”¾åœ¨<code>.github/workflows</code>æ–‡ä»¶å¤¹ä¸‹ã€‚ç„¶åæˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶å¤¹è¿æ¥ä¸€ä¸ªGithubä»“åº“ï¼ŒæŠŠè¿™ä¸ªä»“åº“æ¨é€åˆ°Githubä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°ä»“åº“ä¸­çš„<code>Actions</code>é€‰é¡¹ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç¼–å†™çš„Github Actionså·¥ä½œæµè¢«æ‰§è¡Œäº†ï¼ˆæ­£å¸¸æ¥è¯´åªæœ‰ä¸€ä¸ªï¼Œæˆ‘çš„ä»“åº“ä¹‹å‰å·²ç»æ‰§è¡Œè¿‡ä¸€äº›åˆ«çš„å·¥ä½œæµäº†ï¼‰ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108222144851.png" alt="image-20221108222144851" /></p><p>ç‚¹å¼€æŸ¥çœ‹è¿™ä¸ªå·¥ä½œæµï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°å·¥ä½œæµçš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108222553490.png" alt="image-20221108222553490" /></p><p>è¿™é‡Œçš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€ä¸ªæ­¥éª¤ï¼Œç‚¹å¼€è¿™äº›æ­¥éª¤ä½ å¯ä»¥çœ‹åˆ°è¿è¡Œè¿™äº›æ­¥éª¤äº§ç”Ÿçš„æ—¥å¿—ç»“æœã€‚æ¯”å¦‚æˆ‘ä»¬è®¾ç½®çš„ç¬¬ä¸€ä¸ªæ­¥éª¤<code>ğŸ‰ The job was automatically triggered by a $&#123;&#123; github.event_name &#125;&#125; event.</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœ<code>ğŸ‰ The job was automatically triggered by a push event.</code>ï¼Œå¾ˆæ˜æ˜¾è§¦å‘è¿™ä¸ªå·¥ä½œæµçš„äº‹ä»¶åæ˜¯<code>push</code>ï¼Œå…¶å®ƒçš„ç±»ä¼¼ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªæ­¥éª¤</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">List</span> <span class="string">files</span> <span class="string">in</span> <span class="string">the</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">ls</span> <span class="string">$&#123;&#123;</span> <span class="string">github.workspace</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ­¥éª¤è¦æ±‚åˆ—å‡ºå·¥ä½œç©ºé—´ä¸­çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬ç‚¹å¼€è¿™ä¸ªæ­¥éª¤å¯ä»¥çœ‹åˆ°è¿è¡Œçš„ç»“æœ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221108223659524.png" alt="image-20221108223659524" /></p><p>ç°åœ¨æˆ‘ä»¬å®Œæˆäº†Github Actionsçš„ä¸€ä¸ªç®€å•ä½¿ç”¨ï¼Œå¦‚æœæƒ³è¦æ›´åŠ æ·±å…¥çš„ç†è§£ï¼Œå¯ä»¥è‡ªå·±åŠ¨æ‰‹å»å®è·µä¸€ä¸‹æˆ–è€…é˜…è¯»æˆ‘çš„åšå®¢</p><p>ä¼ é€é—¨ï¼š<a href="/2022/11/22/%E4%BB%8Egithub-page%E5%88%B0github-action/" title="ä»github pageåˆ°github action">ä»github pageåˆ°github action</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> github action </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§å­¦ç‰©ç†å…‰å­¦ç¬”è®°</title>
      <link href="/2022/11/07/%E5%A4%A7%E5%AD%A6%E7%89%A9%E7%90%86%E5%85%89%E5%AD%A6%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/11/07/%E5%A4%A7%E5%AD%A6%E7%89%A9%E7%90%86%E5%85%89%E5%AD%A6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€è°æŒ¯åŠ¨"><a class="markdownIt-Anchor" href="#ç®€è°æŒ¯åŠ¨"></a> ç®€è°æŒ¯åŠ¨</h1><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>ç®€è°æŒ¯åŠ¨çš„å¾®åˆ†æ–¹ç¨‹</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>x</mi></mrow><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><msup><mi>w</mi><mn>2</mn></msup><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">ç®€è°æŒ¯åŠ¨çš„å¾®åˆ†æ–¹ç¨‹:\\\frac{d^2x}{dt^2}+w^2x=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">ç®€</span><span class="mord cjk_fallback">è°</span><span class="mord cjk_fallback">æŒ¯</span><span class="mord cjk_fallback">åŠ¨</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">å¾®</span><span class="mord cjk_fallback">åˆ†</span><span class="mord cjk_fallback">æ–¹</span><span class="mord cjk_fallback">ç¨‹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>ç®€è°æŒ¯åŠ¨æ–¹ç¨‹</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mi>x</mi><mo>=</mo><mi>A</mi><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>w</mi><mi>t</mi><mo>+</mo><mi>Ï†</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ç®€è°æŒ¯åŠ¨æ–¹ç¨‹:\\x=Acos(wt+\varphi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">ç®€</span><span class="mord cjk_fallback">è°</span><span class="mord cjk_fallback">æŒ¯</span><span class="mord cjk_fallback">åŠ¨</span><span class="mord cjk_fallback">æ–¹</span><span class="mord cjk_fallback">ç¨‹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mclose">)</span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>è´¨ç‚¹è¿åŠ¨çš„é€Ÿåº¦</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mi>v</mi><mo>=</mo><mfrac><mrow><mi>d</mi><mi>x</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>âˆ’</mo><mi>A</mi><mi>w</mi><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mi>t</mi><mo>+</mo><mi>Ï†</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">è´¨ç‚¹è¿åŠ¨çš„é€Ÿåº¦:\\v=\frac{dx}{dt}=-Awsin(wt+\varphi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">è´¨</span><span class="mord cjk_fallback">ç‚¹</span><span class="mord cjk_fallback">è¿</span><span class="mord cjk_fallback">åŠ¨</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">é€Ÿ</span><span class="mord cjk_fallback">åº¦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mclose">)</span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>å¦‚æœå·²çŸ¥åˆå§‹æ¡ä»¶</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mi>t</mi><mo>=</mo><mn>0</mn><mspace width="1em"/><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mspace width="1em"/><mi>v</mi><mo>=</mo><msub><mi>v</mi><mn>0</mn></msub><mspace linebreak="newline"></mspace><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><mi>A</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>Ï†</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>v</mi><mn>0</mn></msub><mo>=</mo><mo>âˆ’</mo><mi>w</mi><mi>A</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>Ï†</mi></mrow></mstyle></mtd></mtr></mtable></mrow><mo>âŸ¹</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>A</mi><mo>=</mo><msqrt><mrow><msubsup><mi>x</mi><mn>0</mn><mn>2</mn></msubsup><mo>+</mo><mfrac><msubsup><mi>v</mi><mn>0</mn><mn>2</mn></msubsup><msup><mi>w</mi><mn>2</mn></msup></mfrac></mrow></msqrt></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>a</mi><mi>n</mi><mi>Ï†</mi><mo>=</mo><mfrac><mrow><mo>âˆ’</mo><msub><mi>v</mi><mn>0</mn></msub></mrow><mrow><mi>w</mi><msub><mi>x</mi><mn>0</mn></msub></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">å¦‚æœå·²çŸ¥åˆå§‹æ¡ä»¶:\\t = 0\quad x = x_0\quad v=v_0\\\begin{cases}x_0=Acos\varphi\\v_0=-wAsin\varphi\end{cases}\Longrightarrow\begin{cases}A=\sqrt{x_0^2+\frac{v_0^2}{w^2}}\\tan\varphi=\frac{-v_0}{wx_0}\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">å¦‚</span><span class="mord cjk_fallback">æœ</span><span class="mord cjk_fallback">å·²</span><span class="mord cjk_fallback">çŸ¥</span><span class="mord cjk_fallback">åˆ</span><span class="mord cjk_fallback">å§‹</span><span class="mord cjk_fallback">æ¡</span><span class="mord cjk_fallback">ä»¶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal">Ï†</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal">Ï†</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âŸ¹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2931em;vertical-align:-1.39655em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.89655em;"><span style="top:-3.8965499999999995em;"><span class="pstrut" style="height:3.35832em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.35832em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959080000000001em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.09164em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.52806em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051142857142857em;"><span style="top:-2.188485714285714em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.31832em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4816800000000001em;"><span></span></span></span></span></span></span></span><span style="top:-2.40687em;"><span class="pstrut" style="height:3.35832em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">Ï†</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8184309999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.39655em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h1 id="ç”±å·²çŸ¥æ¡ä»¶æ±‚ç®€è°æŒ¯åŠ¨æ–¹ç¨‹"><a class="markdownIt-Anchor" href="#ç”±å·²çŸ¥æ¡ä»¶æ±‚ç®€è°æŒ¯åŠ¨æ–¹ç¨‹"></a> ç”±å·²çŸ¥æ¡ä»¶æ±‚ç®€è°æŒ¯åŠ¨æ–¹ç¨‹</h1><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>ç®€è°æŒ¯åŠ¨æ–¹ç¨‹</mtext><mo>:</mo><mi>x</mi><mo>=</mo><mi>A</mi><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>w</mi><mi>t</mi><mo>+</mo><mi>Ï†</mi><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mtext>é€Ÿåº¦</mtext><mo>:</mo><mi>v</mi><mo>=</mo><mfrac><mrow><mi>d</mi><mi>x</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>âˆ’</mo><mi>A</mi><mi>w</mi><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>w</mi><mi>t</mi><mo>+</mo><mi>Ï†</mi><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mtext>åŠ é€Ÿåº¦</mtext><mo>:</mo><mi>a</mi><mo>=</mo><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>x</mi></mrow><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>=</mo><mo>âˆ’</mo><mi>A</mi><msup><mi>w</mi><mn>2</mn></msup><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>w</mi><mi>t</mi><mo>+</mo><mi>Ï†</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ç®€è°æŒ¯åŠ¨æ–¹ç¨‹:x=Acos(wt+\varphi)\\é€Ÿåº¦:v=\frac{dx}{dt}=-Awsin(wt+\varphi)\\åŠ é€Ÿåº¦:a=\frac{d^2x}{dt^2}=-Aw^2cos(wt+\varphi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">ç®€</span><span class="mord cjk_fallback">è°</span><span class="mord cjk_fallback">æŒ¯</span><span class="mord cjk_fallback">åŠ¨</span><span class="mord cjk_fallback">æ–¹</span><span class="mord cjk_fallback">ç¨‹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">é€Ÿ</span><span class="mord cjk_fallback">åº¦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">åŠ </span><span class="mord cjk_fallback">é€Ÿ</span><span class="mord cjk_fallback">åº¦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mclose">)</span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>ç®€è°æŒ¯åŠ¨çš„èƒ½é‡</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mi>E</mi><mo>=</mo><msub><mi>E</mi><mi>k</mi></msub><mo>+</mo><msub><mi>E</mi><mi>p</mi></msub><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>k</mi><msup><mi>A</mi><mn>2</mn></msup><mo>âˆ</mo><msup><mi>A</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">ç®€è°æŒ¯åŠ¨çš„èƒ½é‡:\\E=E_k+E_p=\frac{1}{2}kA^2\propto A^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">ç®€</span><span class="mord cjk_fallback">è°</span><span class="mord cjk_fallback">æŒ¯</span><span class="mord cjk_fallback">åŠ¨</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">èƒ½</span><span class="mord cjk_fallback">é‡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>å…¶å®ƒå…¬å¼</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mi>w</mi><mo>=</mo><msqrt><mfrac><mi>k</mi><mi>m</mi></mfrac></msqrt></mrow><annotation encoding="application/x-tex">å…¶å®ƒå…¬å¼:\\w=\sqrt \frac{k}{m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">å…¶</span><span class="mord cjk_fallback">å®ƒ</span><span class="mord cjk_fallback">å…¬</span><span class="mord cjk_fallback">å¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.44em;vertical-align:-0.7634050000000001em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6765949999999998em;"><span class="svg-align" style="top:-4.4em;"><span class="pstrut" style="height:4.4em;"></span><span class="mord" style="padding-left:1em;"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span style="top:-3.6365950000000002em;"><span class="pstrut" style="height:4.4em;"></span><span class="hide-tail" style="min-width:1.02em;height:2.48em;"><svg width='400em' height='2.48em' viewBox='0 0 400000 2592' preserveAspectRatio='xMinYMin slice'><path d='M424,2478c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1014.6s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185c-2,6,-10,9,-24,9c-8,0,-12,-0.7,-12,-2z M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7634050000000001em;"><span></span></span></span></span></span></span></span></span></span></p><h1 id="ç®€è°æŒ¯åŠ¨çš„åˆ¤å®š"><a class="markdownIt-Anchor" href="#ç®€è°æŒ¯åŠ¨çš„åˆ¤å®š"></a> ç®€è°æŒ¯åŠ¨çš„åˆ¤å®š</h1><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>ç®€è°è¿åŠ¨çš„åˆ¤æ–­å¼</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mtext>å¹³åŠ¨</mtext><mo>:</mo><mspace linebreak="newline"></mspace><msub><mi>F</mi><mtext>åˆ</mtext></msub><mo>=</mo><mi>m</mi><mi>a</mi><mo>=</mo><mi>m</mi><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>x</mi></mrow><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mspace linebreak="newline"></mspace><mfrac><msup><mi>d</mi><mn>2</mn></msup><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><msup><mi>w</mi><mn>2</mn></msup><mi>x</mi><mo>=</mo><mn>0</mn><mspace linebreak="newline"></mspace><mtext>å¼¹ç°§æŒ¯å­</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mi>F</mi><mo>=</mo><mo>âˆ’</mo><mi>k</mi><mi>x</mi><mspace linebreak="newline"></mspace><mo>â‡“</mo><mspace linebreak="newline"></mspace><mi>m</mi><mi>a</mi><mo>=</mo><mo>âˆ’</mo><mi>k</mi><mi>x</mi><mspace linebreak="newline"></mspace><mo>â‡“</mo><mspace linebreak="newline"></mspace><mi>a</mi><mo>+</mo><mfrac><mi>k</mi><mi>m</mi></mfrac><mi>x</mi><mo>=</mo><mn>0</mn><mspace linebreak="newline"></mspace><mtext>ä»¤</mtext><msup><mi>w</mi><mn>2</mn></msup><mo>=</mo><mfrac><mi>k</mi><mi>m</mi></mfrac><mspace linebreak="newline"></mspace><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>x</mi></mrow><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><msup><mi>w</mi><mn>2</mn></msup><mi>x</mi><mo>=</mo><mn>0</mn><mspace linebreak="newline"></mspace><mspace linebreak="newline"></mspace><mtext>è½¬åŠ¨</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mi>M</mi><mo>=</mo><mi>J</mi><mi>Î±</mi><mo>=</mo><mi>J</mi><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>Î¸</mi></mrow><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mspace linebreak="newline"></mspace><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>Î¸</mi></mrow><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><msup><mi>w</mi><mn>2</mn></msup><mi>Î¸</mi><mo>=</mo><mn>0</mn><mspace linebreak="newline"></mspace><mtext>å•æ‘†</mtext><mo>:</mo><mspace linebreak="newline"></mspace><msup><mi>w</mi><mn>2</mn></msup><mo>=</mo><mfrac><mrow><mi>m</mi><mi>g</mi><mi>l</mi></mrow><mi>J</mi></mfrac><mspace linebreak="newline"></mspace><mi>Î¸</mi><mo>=</mo><msub><mi>Î¸</mi><mn>0</mn></msub><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>w</mi><mi>t</mi><mo>+</mo><mi>Ï•</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ç®€è°è¿åŠ¨çš„åˆ¤æ–­å¼:\\å¹³åŠ¨:\\F_åˆ=ma=m\frac{d^2x}{dt^2}\\\frac{d^2}{dt^2}+w^2x=0\\å¼¹ç°§æŒ¯å­:\\F=-kx\\\Downarrow\\ma=-kx\\\Downarrow\\a+\frac{k}{m}x=0\\ä»¤w^2=\frac{k}{m}\\\frac{d^2x}{dt^2}+w^2x=0\\\\è½¬åŠ¨:\\M=J\alpha=J\frac{d^2\theta}{dt^2}\\\frac{d^2\theta}{dt^2}+w^2\theta=0\\å•æ‘†:\\w^2=\frac{mgl}{J}\\\theta=\theta_0cos(wt+\phi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">ç®€</span><span class="mord cjk_fallback">è°</span><span class="mord cjk_fallback">è¿</span><span class="mord cjk_fallback">åŠ¨</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">åˆ¤</span><span class="mord cjk_fallback">æ–­</span><span class="mord cjk_fallback">å¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">å¹³</span><span class="mord cjk_fallback">åŠ¨</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">åˆ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord mathnormal">m</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">å¼¹</span><span class="mord cjk_fallback">ç°§</span><span class="mord cjk_fallback">æŒ¯</span><span class="mord cjk_fallback">å­</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">x</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mrel">â‡“</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">x</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mrel">â‡“</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord cjk_fallback">ä»¤</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">è½¬</span><span class="mord cjk_fallback">åŠ¨</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">å•</span><span class="mord cjk_fallback">æ‘†</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï•</span><span class="mclose">)</span></span></span></span></span></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç‰©ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoå»ºç«™ç®€æ˜æ•™ç¨‹</title>
      <link href="/2022/11/05/hexo%E5%BB%BA%E7%AB%99%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/"/>
      <url>/2022/11/05/hexo%E5%BB%BA%E7%AB%99%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…nodejs"><a class="markdownIt-Anchor" href="#å®‰è£…nodejs"></a> å®‰è£…node.js</h1><p>å‰å¾€å®˜ç½‘ä¸‹è½½é•¿æœŸç¨³å®šç‰ˆçš„node.js</p><p><a href="https://nodejs.org/zh-cn/">Node.js </a></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105082507512.png" alt="image-20221105082507512" /></p><p>ä¸‹è½½å®Œæˆä»¥åæ£€æŸ¥ä¸€ä¸‹èƒ½å¦æ‰“å°å‡ºç‰ˆæœ¬ï¼Œæ­£å¸¸æ‰“å°å°±è¡¨ç¤ºä¸‹è½½æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm -v</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…hexo"><a class="markdownIt-Anchor" href="#å®‰è£…hexo"></a> å®‰è£…hexo</h1><p>æˆ‘ä»¬ç”¨npmåœ¨å…¨å±€å®‰è£…hexo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦ä¸‹è½½æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo -v</span><br></pre></td></tr></table></figure><h1 id="åˆå§‹åŒ–åšå®¢"><a class="markdownIt-Anchor" href="#åˆå§‹åŒ–åšå®¢"></a> åˆå§‹åŒ–åšå®¢</h1><p>æ‰¾åˆ°ä½ æƒ³è¦æ”¾ç½®åšå®¢çš„ç›®å½•ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ï¼Œåé¢è·Ÿç€ä½ æƒ³ç»™åšå®¢ç›®å½•å–çš„åå­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init &lt;dir-name&gt;</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105083029837.png" alt="image-20221105083029837" /></p><p>ç°åœ¨ä½ å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•ä¸‹å¤šå‡ºäº†<code>my-blog</code>ç›®å½•ï¼Œæˆ‘ä»¬è¿›å…¥åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd myblog</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105083256875.png" alt="image-20221105083256875" /></p><p>ä½ çœ‹åˆ°ç›®å½•ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä»¬ä¸éœ€è¦äº†è§£æ¯ä¸ªç›®å½•çš„ä½œç”¨ï¼Œæˆ‘ä»¬ç€é‡éœ€è¦å…³æ³¨çš„æ˜¯ä¸‹é¢è¿™äº›æ–‡ä»¶</p><ul><li>sourceâ€”â€”<code>ä¿å­˜ä½ çš„åšå®¢æ–‡ç« çš„æºæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ä»¥åä½ å†™çš„æ–‡ç« éƒ½ä¼šåœ¨è¿™ä¸ªç›®å½•é‡Œé¢</code><ul><li>ç‚¹å¼€sourceï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ª<code>_post</code>ç›®å½•ï¼Œè¿™æ˜¯å­˜åœ¨å·²å‘å¸ƒæ–‡ç« çš„ç›®å½•ï¼Œä½ å¯ä»¥çœ‹è§è¿™é‡Œé¢å·²ç»æœ‰ä¸€ç¯‡<code>helloworld</code>äº†</li></ul></li><li>_config.ymlâ€”â€”<code>åšå®¢çš„é…ç½®æ–‡ä»¶</code></li></ul><h1 id="è¿è¡Œä½ çš„åšå®¢"><a class="markdownIt-Anchor" href="#è¿è¡Œä½ çš„åšå®¢"></a> è¿è¡Œä½ çš„åšå®¢</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿è¡Œä½ çš„åšå®¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105083902252.png" alt="image-20221105083902252" /></p><p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>localhost:4000</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°ä½ éƒ¨ç½²çš„åšå®¢</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105084002617.png" alt="image-20221105084002617" /></p><p>åœ¨æ§åˆ¶å°ä¸­è¾“å…¥<code>Ctrl+C</code>å¯ä»¥åœæ­¢è¿è¡Œåšå®¢</p><h1 id="hexoåˆæ­¥ä½¿ç”¨"><a class="markdownIt-Anchor" href="#hexoåˆæ­¥ä½¿ç”¨"></a> hexoåˆæ­¥ä½¿ç”¨</h1><p>æˆ‘ä»¬ç°åœ¨å·²ç»å®‰è£…å¥½äº†æˆ‘ä»¬çš„hexoåšå®¢ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ç®€å•çš„ä½¿ç”¨ä¸€ä¸‹å®ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºæ–‡ç« </span></span><br><span class="line">hexo new &quot;my-first-post&quot;</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105084328948.png" alt="image-20221105084328948" /></p><p>ç„¶åè¿›å…¥åˆ°<code>source/_post</code>ç›®å½•ä¸­æŸ¥çœ‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105084355396.png" alt="image-20221105084355396" /></p><p>å¯ä»¥çœ‹åˆ°ä¹‹å‰åˆ›å»ºçš„æ–‡ç« ï¼Œç„¶åæˆ‘ä»¬æ‰“å¼€å®ƒï¼Œéšä¾¿è¾“å…¥ä¸€ç‚¹æµ‹è¯•å†…å®¹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105084502155.png" alt="image-20221105084502155" /></p><p>æˆ‘ä»¬å·²ç»å†™å¥½äº†æˆ‘ä»¬çš„æ–‡ç« ï¼Œç°åœ¨æˆ‘ä»¬è¦æŠŠè¿™ç¯‡æ–‡ç« å‘å¸ƒåˆ°åšå®¢ä¸Šï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦hexoæ¡†æ¶å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆå¯¹åº”çš„å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105084749897.png" alt="image-20221105084749897" /></p><p>è¿™æ ·å°±ç”Ÿæˆå¥½äº†ï¼Œæœ€åï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„åšå®¢æŸ¥çœ‹éƒ¨ç½²çš„æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>åˆ·æ–°æµè§ˆå™¨ï¼Œç‚¹å‡»<code>Archives</code> ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ–‡ç« </p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105084936293.png" alt="image-20221105084936293" /></p><p>è¿™æ ·æˆ‘ä»¬å°±åˆæ­¥æŒæ¡äº†hexoçš„ä½¿ç”¨ï¼Œç°åœ¨æˆ‘æ¥æ€»ç»“ä¸€äº›hexoå¸¸ç”¨å‘½ä»¤</p><ul><li><code>hexo clean </code>:æ¸…é™¤ç”±<code>hexo g</code>ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è¯´æ²¡ä»€ä¹ˆç”¨ï¼Œå½“éƒ¨ç½²å‡ºç°é—®é¢˜çš„æ—¶å€™å¯ä»¥å°è¯•æ¸…é™¤ç„¶åé‡æ–°ç”Ÿæˆ</li><li><code>hexo g</code>:æŠŠæˆ‘ä»¬å†™å¥½çš„æ–‡ç« ç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶(å…¶å®æ˜¯html)</li><li><code>hexo s</code>ï¼šè¿è¡Œåšå®¢</li><li><code>hexo new &lt;post-name&gt;</code>ï¼šç”Ÿæˆæ–‡ç« æ¨¡æ¿</li></ul><p>æ¥ä¸‹æ¥çš„æ­¥éª¤éƒ½è¦ä½¿ç”¨gitï¼Œæ²¡æœ‰gitçš„å°ä¼™ä¼´å¯ä»¥å…ˆæš‚åœå»ä¸‹è½½git</p><h1 id="ç¾åŒ–å’Œå®šåˆ¶åŒ–åšå®¢"><a class="markdownIt-Anchor" href="#ç¾åŒ–å’Œå®šåˆ¶åŒ–åšå®¢"></a> ç¾åŒ–å’Œå®šåˆ¶åŒ–åšå®¢</h1><p>æˆ‘ä»¬ç°åœ¨ä½¿ç”¨äº†åšå®¢é»˜è®¤çš„ä¸»é¢˜ï¼Œæœ‰äº›äººå¯èƒ½å¯¹è¿™ä¸ªä¸»é¢˜å¹¶ä¸æ»¡æ„ï¼Œæ²¡æœ‰å…³ç³»ï¼Œhexoä¸­æœ‰å¤§é‡çš„ä¸»é¢˜å¯ä»¥ä¾›ä½ é€‰æ‹©ï¼Œç°åœ¨æˆ‘ä»¬æ¥å°è¯•ä½¿ç”¨hexoæœ€å¸¸ç”¨çš„åšå®¢ä¸»é¢˜ä¹‹ä¸€â€”â€”<code>butterfly</code></p><p>ä¸‹è½½å®‰è£…<code>butterfly</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…ˆä¸è¦æ€¥ç€è¾“å…¥å‘½ä»¤ï¼Œæ£€æŸ¥ä¸€ä¸‹ä½ æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•ï¼Œæ³¨æ„å‘½ä»¤åœ¨æœ‰_config.ymlçš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</span></span><br><span class="line">git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡ºç°äº†è¿™ä¸ªæ–‡ä»¶å¤¹<code>themes/butterfly</code></p><p>æˆ‘ä»¬è¿›å…¥åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå¤åˆ¶ä¸€ä»½<code>_config.yml</code>ï¼Œå°†å®ƒæ”¹åä¸º<code>_config.butterfly.yml</code>ï¼Œç„¶åæŠŠè¿™ä¸ªæ”¹ååçš„æ–‡ä»¶ç§»åŠ¨åˆ°ä½ çš„åšå®¢ç›®å½•ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105090235722.png" alt="image-20221105090235722" /></p><p>å‰ªåˆ‡åˆ°åšå®¢ç›®å½•ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105090301838.png" alt="image-20221105090301838" /></p><p>æ‰“å¼€åšå®¢ç›®å½•ä¸‹çš„<code>_config.yml</code>ï¼Œä¿®æ”¹ä¸»é¢˜ä¸º<code>butterfly</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105090705931.png" alt="image-20221105090705931" /></p><p>æœ€åé‡æ–°ç”Ÿæˆæ–‡ä»¶ç„¶åè¿è¡Œåšå®¢ï¼Œå¤§åŠŸå‘Šæˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105090745946.png" alt="image-20221105090745946" /></p><p>æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯æ¯”åŸæ¥çš„å¥½çœ‹ä¸€ç‚¹äº†ï¼Œå…³äºç«™ç‚¹ä¿¡æ¯çš„é…ç½®å’Œæ›´åŠ è¯¦ç»†çš„å®šåˆ¶åŒ–éœ€æ±‚ï¼Œå¯ä»¥è‡ªè¡Œé˜…è¯»<code>butterfly</code>çš„å®˜æ–¹æ–‡æ¡£å’Œ<code>hexo</code>çš„æ–‡æ¡£</p><p><a href="https://butterfly.js.org/">Butterfly - A Simple and Card UI Design theme for Hexo</a></p><p><a href="https://hexo.io/zh-cn/docs/configuration.html">é…ç½® | Hexo</a></p><p>å¦‚æœæƒ³è¦é…ç½®å…¶å®ƒçš„ä¸»é¢˜ï¼Œå¯ä»¥è‡ªå·±ä¸Šç½‘æœç´¢é…ç½®ï¼Œä¸»é¢˜çš„é…ç½®æš‚æ—¶å°±åˆ°è¿™é‡Œäº†</p><h1 id="éƒ¨ç½²åšå®¢åˆ°github"><a class="markdownIt-Anchor" href="#éƒ¨ç½²åšå®¢åˆ°github"></a> éƒ¨ç½²åšå®¢åˆ°github</h1><p>ä¸‹é¢çš„æ•™ç¨‹éƒ½å‡è®¾ä½ å·²ç»å®Œæˆäº†gitçš„é…ç½®å¹¶ä¸”å·²ç»æ³¨å†Œå¥½äº†githubè´¦å·</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“åå«åš<code>&lt;githubç”¨æˆ·å&gt;.github.io</code></p><p>æ¯”å¦‚æˆ‘çš„çš„githubç”¨æˆ·åå«åš<code>jking412</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªä»“åº“åå°±æ˜¯<code>jking412.github.io</code></p><p>ç„¶åå¤åˆ¶ä¸‹ä½ ä»“åº“çš„åœ°å€ï¼ˆæˆ‘çš„ä»“åº“ä¹‹å‰å·²ç»åˆ›å»ºè¿‡äº†ï¼Œæ–°åˆ›å»ºçš„ä»“åº“æ˜¯ç©ºçš„ï¼‰<img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221105091649357.png" alt="image-20221105091649357" /></p><p>åœ¨åšå®¢ç›®å½•çš„<code>_config.yml</code>æ–‡ä»¶ä¸‹çš„<code>deploy</code>ä¸­é…ç½®å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">https://github.com/jking412/jking412.github.io.git</span> <span class="comment"># è¿™é‡Œæ˜¯ä½ çš„ä»“åº“é“¾æ¥</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å®‰è£…å¥½ä¾èµ–ï¼Œå°±å¯ä»¥æŠŠæˆ‘ä»¬æœ¬åœ°çš„å†…å®¹æ¨é€åˆ°githubä¸Šäº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>åœ¨éƒ¨ç½²å®Œæˆä»¥åï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®<code>http://&lt;githubç”¨æˆ·å&gt;.github.io</code>è®¿é—®åˆ°ä½ çš„åšå®¢</p><p>æ¯”å¦‚æˆ‘çš„åšå®¢ç½‘å€å°±æ˜¯<code>jking412.github.io</code></p><p>éƒ¨ç½²å¯èƒ½ä¼šèŠ±è´¹1~2åˆ†é’Ÿï¼Œæˆ‘ä»¬è€å¿ƒç­‰å¾…ä»¥åå°±å¯ä»¥çœ‹åˆ°å•¦</p><h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1><p>æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨hexoçš„æµç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºæ–‡ç« </span></span><br><span class="line">hexo new &quot;post&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹æ–‡ç« ä»¥åç”Ÿæˆ</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç°åœ¨æœ¬åœ°çœ‹ä¸€ä¸‹åšå®¢æœ‰æ²¡æœ‰é—®é¢˜</span></span><br><span class="line">hexo s</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ²¡æœ‰é—®é¢˜å°±æ¨é€åˆ°githubï¼Œæ³¨æ„ä¸è¦æ¨é€çš„å¤ªé¢‘ç¹ï¼Œå¯èƒ½ä¼šè¢«githubé™åˆ¶</span></span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>æœ‰äº†åšå®¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®°å½•ä¸‹è‡ªå·±ç”Ÿæ´»ä¸­çš„ç‚¹ç‚¹æ»´æ»´ï¼Œåšå®¢ä¹Ÿæ˜¯å¸®åŠ©è‡ªå·±èµ°å‘ä¼˜ç§€çš„é‡è¦å·¥å…·ï¼Œè¦å¥½å¥½ä½¿ç”¨å®ƒå‘€</p>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€mysqlã€mysqlè¯­æ³•é€Ÿè®°</title>
      <link href="/2022/10/15/mysql%E8%AF%AD%E6%B3%95%E9%80%9F%E8%AE%B0/"/>
      <url>/2022/10/15/mysql%E8%AF%AD%E6%B3%95%E9%80%9F%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€-æ•°æ®å®šä¹‰"><a class="markdownIt-Anchor" href="#ä¸€-æ•°æ®å®šä¹‰"></a> ä¸€ã€æ•°æ®å®šä¹‰</h1><p>ä¸»è¦ä½¿ç”¨DDLï¼Œç”¨äºå®šä¹‰æ•°æ®å¯¹è±¡ï¼ˆæ•°æ®åº“ï¼Œæ•°æ®è¡¨ï¼Œè§†å›¾ï¼Œç´¢å¼•ç­‰ï¼‰</p><h2 id="æ•°æ®åº“database"><a class="markdownIt-Anchor" href="#æ•°æ®åº“database"></a> æ•°æ®åº“ï¼ˆDATABASEï¼‰</h2><blockquote><p>åˆ›å»ºæ•°æ®åº“</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> DATABASE test;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤æ•°æ®åº“</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE test</span><br></pre></td></tr></table></figure><blockquote><p>é€‰æ‹©æ•°æ®åº“</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE test;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®è¡¨table"><a class="markdownIt-Anchor" href="#æ•°æ®è¡¨table"></a> æ•°æ®è¡¨ï¼ˆTABLEï¼‰</h2><h3 id="æ•°æ®è¡¨çš„åˆ›å»ºä¸åˆ é™¤"><a class="markdownIt-Anchor" href="#æ•°æ®è¡¨çš„åˆ›å»ºä¸åˆ é™¤"></a> æ•°æ®è¡¨çš„åˆ›å»ºä¸åˆ é™¤</h3><blockquote><p>åˆ›å»ºæ•°æ®è¡¨</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">  id <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;Id&#x27;</span>,</span><br><span class="line">  username <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;default&#x27;</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line">  password <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;default&#x27;</span> COMMENT <span class="string">&#x27;å¯†ç &#x27;</span>,</span><br><span class="line">  email <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;default&#x27;</span> COMMENT <span class="string">&#x27;é‚®ç®±&#x27;</span></span><br><span class="line">) COMMENT<span class="operator">=</span><span class="string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ®å·²æœ‰è¡¨åˆ›å»º</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> viper_user <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤æ•°æ®è¡¨</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ•°æ®è¡¨"><a class="markdownIt-Anchor" href="#ä¿®æ”¹æ•°æ®è¡¨"></a> ä¿®æ”¹æ•°æ®è¡¨</h3><blockquote><p>æ·»åŠ åˆ—</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">ADD</span> age <span class="type">int</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤åˆ—</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">column</span> age;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹åˆ—</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span></span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> age tinyint;</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ ä¸»é”®</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (id);</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤ä¸»é”®</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br></pre></td></tr></table></figure><h2 id="è§†å›¾view"><a class="markdownIt-Anchor" href="#è§†å›¾view"></a> è§†å›¾ï¼ˆVIEWï¼‰</h2><p>è§†å›¾æ˜¯åŸºäºSQLè¯­å¥çš„ç»“æœé›†çš„å¯è§†åŒ–è¡¨ã€‚è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸å‚¨å­˜æ•°æ®ï¼Œä¹Ÿä¸å¤„ç†æ•°æ®ã€‚ä¸»è¦ç”¨äºç®€åŒ–å’Œæ–¹ä¾¿æˆ‘ä»¬çš„æ“ä½œï¼Œä½†æ˜¯è§†å›¾çš„æ“ä½œå’Œæ™®é€šçš„è¡¨çš„æ“ä½œæ–¹å¼ç±»ä¼¼</p><blockquote><p>è§†å›¾çš„ä½œç”¨</p></blockquote><ul><li>ç®€åŒ–å¤æ‚çš„sqlæ“ä½œ</li></ul><blockquote><p>åˆ›å»ºè§†å›¾</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> top_10_user_view <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> id,username </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&lt;</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤è§†å›¾</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> top_10_user_view;</span><br></pre></td></tr></table></figure><h2 id="ç´¢å¼•index"><a class="markdownIt-Anchor" href="#ç´¢å¼•index"></a> ç´¢å¼•ï¼ˆINDEXï¼‰</h2><p>ç´¢å¼•å¯ä»¥æ›´åŠ é«˜æ•ˆçš„æŸ¥è¯¢æ•°æ®ã€‚ç”¨æˆ·æ— æ³•çœ‹åˆ°ç´¢å¼•ï¼Œä½†æ˜¯å¯ä»¥ç”¨å®ƒæ¥åŠ é€ŸæŸ¥è¯¢ã€‚</p><p>ä½†æ˜¯ç»´æŠ¤ç´¢å¼•éœ€è¦é¢å¤–çš„ç©ºé—´å’Œæ—¶é—´ï¼Œæ‰€ä»¥æ›´æ–°ä¸€ä¸ªå«æœ‰ç´¢å¼•çš„è¡¨èŠ±è´¹çš„ä»£ä»·ä¼šæ¯”ä¸å«æœ‰ç´¢å¼•çš„è¡¨æ›´å¤§ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¨èæ˜¯åªåœ¨è¢«é¢‘ç¹æœç´¢çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•</p><blockquote><p>å”¯ä¸€ç´¢å¼•</p></blockquote><p>è¡¨é¢æ­¤ç´¢å¼•çš„æ¯ä¸€ä¸ªç´¢å¼•å€¼éƒ½å¯ä»¥å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„ä¸€ä¸ªè®°å½•</p><blockquote><p>åˆ›å»ºç´¢å¼•</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX user_index</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">user</span> (id);</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºå”¯ä¸€ç´¢å¼•</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX user_index</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">user</span> (id);</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤ç´¢å¼•</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABlE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX user_index;</span><br></pre></td></tr></table></figure><h2 id="çº¦æŸ"><a class="markdownIt-Anchor" href="#çº¦æŸ"></a> çº¦æŸ</h2><blockquote><p>SQL çº¦æŸç”¨äºè§„å®šè¡¨ä¸­çš„æ•°æ®è§„åˆ™ã€‚</p></blockquote><ul><li>å¦‚æœå­˜åœ¨è¿åçº¦æŸçš„æ•°æ®è¡Œä¸ºï¼Œè¡Œä¸ºä¼šè¢«çº¦æŸç»ˆæ­¢ã€‚</li><li>çº¦æŸå¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶è§„å®šï¼ˆé€šè¿‡ CREATE TABLE è¯­å¥ï¼‰ï¼Œæˆ–è€…åœ¨è¡¨åˆ›å»ºä¹‹åè§„å®šï¼ˆé€šè¿‡ ALTER TABLE è¯­å¥ï¼‰ã€‚</li><li>çº¦æŸç±»å‹<ul><li><code>NOT NULL</code> - æŒ‡ç¤ºæŸåˆ—ä¸èƒ½å­˜å‚¨ NULL å€¼ã€‚</li><li><code>UNIQUE</code> - ä¿è¯æŸåˆ—çš„æ¯è¡Œå¿…é¡»æœ‰å”¯ä¸€çš„å€¼ã€‚</li><li><code>PRIMARY KEY</code> - NOT NULL å’Œ UNIQUE çš„ç»“åˆã€‚ç¡®ä¿æŸåˆ—ï¼ˆæˆ–ä¸¤ä¸ªåˆ—å¤šä¸ªåˆ—çš„ç»“åˆï¼‰æœ‰å”¯ä¸€æ ‡è¯†ï¼Œæœ‰åŠ©äºæ›´å®¹æ˜“æ›´å¿«é€Ÿåœ°æ‰¾åˆ°è¡¨ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„è®°å½•ã€‚</li><li><code>FOREIGN KEY</code> - ä¿è¯ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åŒ¹é…å¦ä¸€ä¸ªè¡¨ä¸­çš„å€¼çš„å‚ç…§å®Œæ•´æ€§ã€‚</li><li><code>CHECK</code> - ä¿è¯åˆ—ä¸­çš„å€¼ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶ã€‚</li><li><code>DEFAULT</code> - è§„å®šæ²¡æœ‰ç»™åˆ—èµ‹å€¼æ—¶çš„é»˜è®¤å€¼ã€‚</li></ul></li></ul><p>åˆ›å»ºè¡¨æ—¶ä½¿ç”¨çº¦æŸæ¡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> Users (</span><br><span class="line">  Id <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;è‡ªå¢Id&#x27;</span>,</span><br><span class="line">  Username <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;default&#x27;</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line">  Password <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;default&#x27;</span> COMMENT <span class="string">&#x27;å¯†ç &#x27;</span>,</span><br><span class="line">  Email <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;default&#x27;</span> COMMENT <span class="string">&#x27;é‚®ç®±åœ°å€&#x27;</span>,</span><br><span class="line">  Enabled TINYINT(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ˜¯å¦æœ‰æ•ˆ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (Id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="äºŒ-å¢åˆ æ”¹æŸ¥"><a class="markdownIt-Anchor" href="#äºŒ-å¢åˆ æ”¹æŸ¥"></a> äºŒã€å¢åˆ æ”¹æŸ¥</h1><p>åˆç§°ä¸ºCRUDï¼Œæ•°æ®åº“åŸºæœ¬æ“ä½œ</p><ul><li><code>create</code>-å¢</li><li><code>delete</code>-åˆ </li><li><code>update</code>-æ”¹</li><li><code>retrieve</code>-æŸ¥</li></ul><h2 id="æ’å…¥æ•°æ®"><a class="markdownIt-Anchor" href="#æ’å…¥æ•°æ®"></a> æ’å…¥æ•°æ®</h2><p>ä½¿ç”¨<code>INSERT INTO</code></p><blockquote><p>æ’å…¥å®Œæ•´çš„è¡Œ</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">10</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;test@test.com&#x27;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>æ’å…¥è¡Œçš„ä¸€éƒ¨åˆ†</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> <span class="keyword">user</span>(username,password,email)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;test@test.com&#x27;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>æ’å…¥æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> <span class="keyword">user</span> (username)</span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> account;</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°æ•°æ®"><a class="markdownIt-Anchor" href="#æ›´æ–°æ•°æ®"></a> æ›´æ–°æ•°æ®</h2><p>ä½¿ç”¨<code>UPDATE</code></p><blockquote><p>æ›´æ–°æ•°æ®</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">SET</span> username<span class="operator">=</span><span class="string">&#x27;Mike&#x27;</span>,password<span class="operator">=</span><span class="string">&#x27;test&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ•°æ®"><a class="markdownIt-Anchor" href="#åˆ é™¤æ•°æ®"></a> åˆ é™¤æ•°æ®</h2><p>ä½¿ç”¨<code>DELETE</code></p><blockquote><p>åˆ é™¤æŒ‡å®šæ•°æ®</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span>  <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ®</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢æ•°æ®"><a class="markdownIt-Anchor" href="#æŸ¥è¯¢æ•°æ®"></a> æŸ¥è¯¢æ•°æ®</h2><ul><li><code>SELECT</code>- æŸ¥è¯¢</li><li><code>DISTINCT</code>-è¿”å›ä¸åŒçš„å€¼</li><li><code>LIMIT</code>-é™åˆ¶è¿”å›çš„è¡Œæ•°ï¼Œå¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¼€å§‹æŸ¥è¯¢çš„è¡Œæ•°ï¼Œç¬¬ä¸€è¡Œæ˜¯0ï¼›ç¬¬äºŒä¸ªæ˜¯è¿”å›çš„æ€»è¡Œæ•°</li></ul><blockquote><p>å•åˆ—æŸ¥è¯¢</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢å¤šåˆ—</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,username <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢æ‰€æœ‰åˆ—</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢ä¸åŒå€¼</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> </span><br><span class="line"><span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><blockquote><p>é™åˆ¶æŸ¥è¯¢ç»“æ„</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># è¿”å›å‰<span class="number">5</span>è¡Œ</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> LIMIT <span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> LIMIT <span class="number">0</span>,<span class="number">5</span></span><br><span class="line"># è¿”å›<span class="number">3</span><span class="operator">~</span><span class="number">5</span>è¡Œ</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> LIMIT <span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰-å­æŸ¥è¯¢"><a class="markdownIt-Anchor" href="#ä¸‰-å­æŸ¥è¯¢"></a> ä¸‰ã€å­æŸ¥è¯¢</h1><p>å­æŸ¥è¯¢æ˜¯åµŒå¥—è¾ƒå¤§çš„æŸ¥è¯¢ä¸­çš„ä¸€ä¸ªå°æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ä¹Ÿè¢«ç§°ä¸º<code>å†…éƒ¨æŸ¥è¯¢</code>æˆ–è€…<code>å†…éƒ¨é€‰æ‹©</code></p><ul><li>å­æŸ¥è¯¢åµŒå¥—åœ¨<code>SELECT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>ã€<code>INSERT</code> æˆ–è€…å¦ä¸€ä¸ªå­æŸ¥è¯¢ä¸­</li><li>å­æŸ¥è¯¢éœ€è¦ç”¨<code>()</code> æ‹¬èµ·æ¥</li><li>å­æŸ¥è¯¢ä¼˜å…ˆäºçˆ¶æŸ¥è¯¢æ‰§è¡Œï¼Œå› ä¸ºéœ€è¦å…ˆè·å¾—å­æŸ¥è¯¢çš„ç»“æœ</li></ul><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/sql-subqueries.gif" alt="sql-subqueries" /></p><blockquote><p>å­æŸ¥è¯¢ä¸­çš„å­æŸ¥è¯¢</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> cust_id</span><br><span class="line">                  <span class="keyword">FROM</span> orders</span><br><span class="line">                  <span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (<span class="keyword">SELECT</span> order_num</span><br><span class="line">                                      <span class="keyword">FROM</span> orderitems</span><br><span class="line">                                      <span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;RGAN01&#x27;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="where"><a class="markdownIt-Anchor" href="#where"></a> WHERE</h2><p><code>WHERE</code>ç”¨äºè¿‡æ»¤è®°å½•ï¼Œ<code>WHERE</code>åè·Ÿç€ä¸€ä¸ª<code>true</code>æˆ–è€…<code>false</code>çš„æ¡ä»¶</p><p>å¯ä»¥åœ¨<code>WHERE</code>ä¸­ä½¿ç”¨çš„æ“ä½œç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>=</td><td>ç­‰äº</td></tr><tr><td>&lt;&gt;</td><td>ä¸ç­‰äºã€‚æ³¨é‡Šï¼šåœ¨ SQL çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œè¯¥æ“ä½œç¬¦å¯è¢«å†™æˆ !=</td></tr><tr><td>&gt;</td><td>å¤§äº</td></tr><tr><td>&lt;</td><td>å°äº</td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº</td></tr><tr><td>BETWEEN</td><td>åœ¨æŸä¸ªèŒƒå›´å†…</td></tr><tr><td>LIKE</td><td>æœç´¢æŸç§æ¨¡å¼</td></tr><tr><td>IN</td><td>æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼</td></tr></tbody></table><blockquote><p>SELECT</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>UPDATE</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">SET</span> username<span class="operator">=</span><span class="string">&#x27;root&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;Mike&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>DELETE</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> uesr</span><br><span class="line"><span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="inå’Œbetween"><a class="markdownIt-Anchor" href="#inå’Œbetween"></a> INå’ŒBETWEEN</h2><p><code>IN</code>åœ¨<code>WHERE</code>å­å¥ä¸­ä½¿ç”¨ï¼Œç”¨äºåœ¨è®°å½•ä¸­æ‰¾åˆ°ç‰¹å®šçš„å€¼ã€‚</p><p><code>BETWEEN</code>åœ¨<code>WHERE</code>å­å¥ä¸­ä½¿ç”¨ï¼Œç”¨äºåœ¨è®°å½•ä¸­æ‰¾åˆ°ç‰¹å®šèŒƒå›´çš„å€¼ã€‚</p><blockquote><p>IN</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> username <span class="keyword">IN</span> (<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;Mike&#x27;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>BETWEEN</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> </span><br><span class="line"><span class="keyword">WHERE</span> age BWTWEEN <span class="number">30</span> <span class="keyword">AND</span> <span class="number">35</span>;</span><br></pre></td></tr></table></figure><h2 id="and-or-not"><a class="markdownIt-Anchor" href="#and-or-not"></a> ANDã€ORã€NOT</h2><p>ä¸‰è€…ç”¨äºå¯¹è¿‡æ»¤æ¡ä»¶çš„é€»è¾‘å¤„ç†</p><blockquote><p>AND</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span> <span class="keyword">AND</span> username <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>OR</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span> <span class="keyword">OR</span> username <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>NOT</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">AND</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure><h2 id="like"><a class="markdownIt-Anchor" href="#like"></a> LIKE</h2><p><code>LIKE</code>åœ¨<code>WHERE</code>å­å¥ä¸­ä½¿ç”¨ï¼Œç”¨äºç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ¨¡å¼ï¼Œæ‰€ä»¥åªæœ‰åœ¨å­—æ®µæ˜¯æ–‡æœ¬å€¼çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨ã€‚</p><p>LIKEæ”¯æŒä¸¤ä¸ªé€šé…ç¬¦,<code>_</code>å’Œ<code>%</code></p><ul><li><code>_</code>è¡¨ç¤ºä»»æ„å­—ç¬¦å‡ºç°ä¸€æ¬¡</li><li><code>%</code>è¡¨ç¤ºä»»æ„å­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°</li></ul><p>ä¸è¦éšæ„çš„ä½¿ç”¨é€šé…ç¬¦ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä½ çš„æŸ¥è¯¢éå¸¸ç¼“æ…¢</p><p>å½“æˆ‘ä»¬è¦åŒ¹é…çš„å­—ç¬¦ä¸²ä¸­çœŸçš„å«æœ‰<code>_</code>å’Œ<code>%</code>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è½¬ä¹‰å­—ç¬¦<code>\%</code>å’Œ<code>\_</code></p><blockquote><p>%</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">USER</span></span><br><span class="line"><span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;%root%&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>_</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">USER</span></span><br><span class="line"><span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;_root_&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="å››-è¿æ¥å’Œç»„åˆ"><a class="markdownIt-Anchor" href="#å››-è¿æ¥å’Œç»„åˆ"></a> å››ã€è¿æ¥å’Œç»„åˆ</h1><h2 id="è¿æ¥join"><a class="markdownIt-Anchor" href="#è¿æ¥join"></a> è¿æ¥ï¼ˆJOINï¼‰</h2><p>è¿æ¥ç”¨äºè¿æ¥å¤šä¸ªè¡¨ï¼Œè€Œä¸”æ¡ä»¶è¯­å¥ä½¿ç”¨<code>ON</code>è€Œä¸æ˜¯<code>WHERE</code>ã€‚</p><p>è¿æ¥å¯ä»¥æ›¿æ¢å­æŸ¥è¯¢ï¼Œè€Œä¸”æ•ˆç‡å¾€å¾€æ¯”å­æŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚</p><p>è¿æ¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p><ul><li>å¤–è¿æ¥<ul><li>å·¦ï¼ˆå¤–ï¼‰è¿æ¥</li><li>å³ï¼ˆå¤–ï¼‰è¿æ¥</li><li>å…¨å¤–è¿æ¥</li></ul></li><li>å†…è¿æ¥<ul><li>è‡ªè¿æ¥</li><li>è‡ªç„¶è¿æ¥</li></ul></li><li>å…¨å¤–è¿æ¥(mysqlä¸æ”¯æŒ)</li></ul><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/sql-join.png" alt="sql-join" /></p><blockquote><p>å†…è¿æ¥(INNER JOIN)</p></blockquote><p>å†…è¿æ¥åˆç§°ç­‰å€¼è¿æ¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿”å›è¡¨ä¹‹é—´çš„å…¬å…±éƒ¨åˆ†ï¼Œæ²¡æœ‰æ¡ä»¶çš„æƒ…å†µä¸‹è¿”å›ç¬›å¡å°”ç§¯ï¼ˆæœ€å¥½ä¸è¦è¿™æ ·åšï¼Œè¿™æ ·ä¼šå¾ˆå®¹æ˜“è¿”å›çˆ†ç‚¸å¤šçš„è¡Œæ•°ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> users <span class="keyword">INNER</span> <span class="keyword">JOIN</span> students</span><br><span class="line"><span class="keyword">ON</span> user.id <span class="operator">=</span> students.id;</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªè¿æ¥(=)</p></blockquote><p>è‡ªè¿æ¥çœ‹çœ‹å‡ºå†…è¿æ¥çš„ä¸€ç§ï¼Œåªæ˜¯è¿æ¥çš„æ˜¯è¡¨çš„è‡ªèº«è€Œå·²ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c1.cust_id, c1.cust_name, c1.cust_contact</span><br><span class="line"><span class="keyword">FROM</span> customers c1, customers c2</span><br><span class="line"><span class="keyword">WHERE</span> c1.cust_name <span class="operator">=</span> c2.cust_name</span><br><span class="line"><span class="keyword">AND</span> c2.cust_contact <span class="operator">=</span> <span class="string">&#x27;Jim Jones&#x27;</span>;</span><br></pre></td></tr></table></figure><p>psï¼šæ²¡æ„Ÿè§‰åˆ°ç”¨å¤„</p><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c1.cust_id, c1.cust_name, c1.cust_contact</span><br><span class="line"><span class="keyword">FROM</span> customers c1</span><br><span class="line"><span class="keyword">WHERE</span> c1.cust_contact <span class="operator">=</span> <span class="string">&#x27;Jim Jones&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªç„¶è¿æ¥(NATURAL JOIN)</p></blockquote><p>å¯ä»¥è‡ªåŠ¨çš„è¿æ¥åŒååˆ—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> students;</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºä¸Šé¢å†…è¿æ¥çš„å†™æ³•ï¼Œä½†æ˜¯å†…è¿æ¥ä¸åŒçš„æ˜¯å†…è¿æ¥å¯ä»¥è‡ªå·±æŒ‡å®šåˆ—ï¼Œè€Œä¸éœ€è¦åˆ—æ˜ç›¸åŒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> users <span class="keyword">INNER</span> <span class="keyword">JOIN</span> students</span><br><span class="line"><span class="keyword">ON</span> user.uid <span class="operator">=</span> students.sid;</span><br></pre></td></tr></table></figure><blockquote><p>å¤–è¿æ¥(OUTER JOIN)</p></blockquote><p>Mysqlä¸æ”¯æŒ</p><blockquote><p>å·¦è¿æ¥(LEFT JOIN)</p></blockquote><p>ä»¥å·¦è¾¹çš„è¡¨ä¸ºä¸»ï¼Œå³ä¾¿å·¦è¾¹çš„è¡¨æ²¡æœ‰ä¸å³è¾¹çš„è¡¨å…³è”ä¹Ÿä¼šè¢«ä¿ç•™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> customers.cust_id, orders.order_num</span><br><span class="line"><span class="keyword">FROM</span> customers <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders</span><br><span class="line"><span class="keyword">ON</span> customers.cust_id <span class="operator">=</span> orders.cust_id;</span><br></pre></td></tr></table></figure><blockquote><p>å³è¿æ¥(RIGHT JOIN)</p></blockquote><p>ä¸å·¦è¿æ¥ç›¸åï¼Œä»¥å³è¾¹çš„è¡¨ä¸ºä¸»</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> customers.cust_id, orders.order_num</span><br><span class="line"><span class="keyword">FROM</span> customers <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> orders</span><br><span class="line"><span class="keyword">ON</span> customers.cust_id <span class="operator">=</span> orders.cust_id;</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆunion"><a class="markdownIt-Anchor" href="#ç»„åˆunion"></a> ç»„åˆï¼ˆUNIONï¼‰</h2><p><code>UNION</code>å°†å¤šä¸ªç»“æœé›†åˆå¹¶æˆä¸€ä¸ªå¹¶è¿”å›</p><p>åŸºæœ¬è§„åˆ™ï¼š</p><ul><li>æ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒ</li><li>åˆ—çš„æ•°æ®ç±»å‹å¿…é¡»å…¼å®¹</li></ul><p>åªèƒ½æœ‰ä¸€ä¸ª<code>ORDER BY</code>è¯­å¥ï¼Œä¸”ä½äºè¯­å¥çš„æœ€åã€‚<br />é»˜è®¤å»é™¤ç›¸åŒè¡Œï¼Œå¦‚éœ€ä¿ç•™ï¼Œä½¿ç”¨<code>UNION ALL</code>ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>ä¸€ä¸ªæŸ¥è¯¢ä»å¤šä¸ªè¡¨ä¸­è¿”å›ç»“æœ</li><li>ä¸€ä¸ªè¡¨æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="keyword">IN</span> (<span class="string">&#x27;IL&#x27;</span>, <span class="string">&#x27;IN&#x27;</span>, <span class="string">&#x27;MI&#x27;</span>)</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_name <span class="operator">=</span> <span class="string">&#x27;Fun4All&#x27;</span>;</span><br></pre></td></tr></table></figure><p>JOIN vs UNION</p><ul><li><code>JOIN</code>ä¸­è¿æ¥çš„åˆ—å¯èƒ½ä¸åŒï¼Œä½†æ˜¯<code>UNION</code>ä¸­ï¼ŒæŸ¥è¯¢çš„åˆ—æ•°å’Œé¡ºåºå¿…é¡»ç›¸åŒ</li><li><code>JOIN</code>æŠŠæŸ¥è¯¢çš„åˆ—æ°´å¹³æ”¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ„æˆç¬›å¡å°”ç§¯ï¼Œ <code>UNION</code>æŠŠæŸ¥è¯¢çš„åˆ—å‚ç›´æ”¾ç½®</li></ul><h1 id="äº”-å‡½æ•°"><a class="markdownIt-Anchor" href="#äº”-å‡½æ•°"></a> äº”ã€å‡½æ•°</h1><p>ä¸åŒæ•°æ®åº“çš„å‡½æ•°å¾€å¾€ä¸åŒï¼Œä¸‹é¢ä»¥Mysqlä¸ºä¾‹</p><h3 id="æ–‡æœ¬å¤„ç†"><a class="markdownIt-Anchor" href="#æ–‡æœ¬å¤„ç†"></a> æ–‡æœ¬å¤„ç†</h3><table><thead><tr><th style="text-align:center">å‡½æ•°</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center"><code>LEFT()</code>ã€<code>RIGHT()</code></td><td style="text-align:center">å·¦è¾¹æˆ–è€…å³è¾¹çš„å­—ç¬¦</td></tr><tr><td style="text-align:center"><code>LOWER()</code>ã€<code>UPPER()</code></td><td style="text-align:center">è½¬æ¢ä¸ºå°å†™æˆ–è€…å¤§å†™</td></tr><tr><td style="text-align:center"><code>LTRIM()</code>ã€<code>RTIM()</code></td><td style="text-align:center">å»é™¤å·¦è¾¹æˆ–è€…å³è¾¹çš„ç©ºæ ¼</td></tr><tr><td style="text-align:center"><code>LENGTH()</code></td><td style="text-align:center">é•¿åº¦</td></tr><tr><td style="text-align:center"><code>SOUNDEX()</code></td><td style="text-align:center">è½¬æ¢ä¸ºè¯­éŸ³å€¼</td></tr></tbody></table><p>å…¶ä¸­ï¼Œ <strong>SOUNDEX()</strong> å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> mytable</span><br><span class="line"><span class="keyword">WHERE</span> SOUNDEX(col1) <span class="operator">=</span> SOUNDEX(<span class="string">&#x27;apple&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="æ—¥æœŸå’Œæ—¶é—´å¤„ç†æ—¥æœŸå’Œæ—¶é—´å¤„ç†"><a class="markdownIt-Anchor" href="#æ—¥æœŸå’Œæ—¶é—´å¤„ç†æ—¥æœŸå’Œæ—¶é—´å¤„ç†"></a> æ—¥æœŸå’Œæ—¶é—´å¤„ç†æ—¥æœŸå’Œæ—¶é—´å¤„ç†</h3><ul><li>æ—¥æœŸæ ¼å¼ï¼š<code>YYYY-MM-DD</code></li><li>æ—¶é—´æ ¼å¼ï¼š<code>HH:MM:SS</code></li></ul><table><thead><tr><th style="text-align:center">å‡½ æ•°</th><th style="text-align:center">è¯´ æ˜</th></tr></thead><tbody><tr><td style="text-align:center"><code>AddDate()</code></td><td style="text-align:center">å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰</td></tr><tr><td style="text-align:center"><code>AddTime()</code></td><td style="text-align:center">å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰</td></tr><tr><td style="text-align:center"><code>CurDate()</code></td><td style="text-align:center">è¿”å›å½“å‰æ—¥æœŸ</td></tr><tr><td style="text-align:center"><code>CurTime()</code></td><td style="text-align:center">è¿”å›å½“å‰æ—¶é—´</td></tr><tr><td style="text-align:center"><code>Date()</code></td><td style="text-align:center">è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ†</td></tr><tr><td style="text-align:center"><code>DateDiff()</code></td><td style="text-align:center">è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·®</td></tr><tr><td style="text-align:center"><code>Date_Add()</code></td><td style="text-align:center">é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•°</td></tr><tr><td style="text-align:center"><code>Date_Format()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸²</td></tr><tr><td style="text-align:center"><code>Day()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ†</td></tr><tr><td style="text-align:center"><code>DayOfWeek()</code></td><td style="text-align:center">å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡ </td></tr><tr><td style="text-align:center"><code>Hour()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ†</td></tr><tr><td style="text-align:center"><code>Minute()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ†</td></tr><tr><td style="text-align:center"><code>Month()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ†</td></tr><tr><td style="text-align:center"><code>Now()</code></td><td style="text-align:center">è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td style="text-align:center"><code>Second()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ†</td></tr><tr><td style="text-align:center"><code>Time()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ†</td></tr><tr><td style="text-align:center"><code>Year()</code></td><td style="text-align:center">è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ†</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> NOW();</span><br><span class="line"><span class="number">2018</span><span class="number">-4</span><span class="number">-14</span> <span class="number">20</span>:<span class="number">25</span>:<span class="number">11</span></span><br></pre></td></tr></table></figure><h3 id="æ•°å€¼å¤„ç†"><a class="markdownIt-Anchor" href="#æ•°å€¼å¤„ç†"></a> æ•°å€¼å¤„ç†</h3><table><thead><tr><th style="text-align:center">å‡½æ•°</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">SIN()</td><td style="text-align:center">æ­£å¼¦</td></tr><tr><td style="text-align:center">COS()</td><td style="text-align:center">ä½™å¼¦</td></tr><tr><td style="text-align:center">TAN()</td><td style="text-align:center">æ­£åˆ‡</td></tr><tr><td style="text-align:center">ABS()</td><td style="text-align:center">ç»å¯¹å€¼</td></tr><tr><td style="text-align:center">SQRT()</td><td style="text-align:center">å¹³æ–¹æ ¹</td></tr><tr><td style="text-align:center">MOD()</td><td style="text-align:center">ä½™æ•°</td></tr><tr><td style="text-align:center">EXP()</td><td style="text-align:center">æŒ‡æ•°</td></tr><tr><td style="text-align:center">PI()</td><td style="text-align:center">åœ†å‘¨ç‡</td></tr><tr><td style="text-align:center">RAND()</td><td style="text-align:center">éšæœºæ•°</td></tr></tbody></table><h3 id="æ±‡æ€»"><a class="markdownIt-Anchor" href="#æ±‡æ€»"></a> æ±‡æ€»</h3><table><thead><tr><th style="text-align:center">å‡½ æ•°</th><th style="text-align:center">è¯´ æ˜</th></tr></thead><tbody><tr><td style="text-align:center"><code>AVG()</code></td><td style="text-align:center">è¿”å›æŸåˆ—çš„å¹³å‡å€¼</td></tr><tr><td style="text-align:center"><code>COUNT()</code></td><td style="text-align:center">è¿”å›æŸåˆ—çš„è¡Œæ•°</td></tr><tr><td style="text-align:center"><code>MAX()</code></td><td style="text-align:center">è¿”å›æŸåˆ—çš„æœ€å¤§å€¼</td></tr><tr><td style="text-align:center"><code>MIN()</code></td><td style="text-align:center">è¿”å›æŸåˆ—çš„æœ€å°å€¼</td></tr><tr><td style="text-align:center"><code>SUM()</code></td><td style="text-align:center">è¿”å›æŸåˆ—å€¼ä¹‹å’Œ</td></tr></tbody></table><p><code>AVG()</code> ä¼šå¿½ç•¥ NULL è¡Œã€‚</p><p>ä½¿ç”¨ DISTINCT å¯ä»¥è®©æ±‡æ€»å‡½æ•°å€¼æ±‡æ€»ä¸åŒçš„å€¼ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(<span class="keyword">DISTINCT</span> col1) <span class="keyword">AS</span> avg_col</span><br><span class="line"><span class="keyword">FROM</span> mytable</span><br></pre></td></tr></table></figure><h1 id="å…­-æ’åºå’Œåˆ†ç»„"><a class="markdownIt-Anchor" href="#å…­-æ’åºå’Œåˆ†ç»„"></a> å…­ã€æ’åºå’Œåˆ†ç»„</h1><blockquote><p>order by</p></blockquote><p>ç”¨äºå¯¹ç»“æœé›†æ’åºï¼Œæœ‰ä¸¤ç§æ’åºæ¨¡å¼</p><ul><li><code>ASC</code>ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰</li><li><code>DESC</code>ï¼šé™åº</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price <span class="keyword">DESC</span>,prod_name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure><blockquote><p>group by</p></blockquote><p>æŠŠè®°å½•åˆ†ç»„åˆ°æ±‡æ€»è¡Œä¸­ï¼Œä¸ºæ¯ä¸ªæ±‡æ€»è¡Œè¿”å›ä¸€ä¸ªè®°å½•</p><p>é€šå¸¸é…åˆæ±‡æ€»å‡½æ•°ä½¿ç”¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, <span class="built_in">COUNT</span>(cust_address) <span class="keyword">AS</span> addr_num</span><br><span class="line"><span class="keyword">FROM</span> Customers <span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_name</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰<code>cust_name</code>ç›¸åŒçš„å­—æ®µä¼šè¢«æ±‡æ€»æˆä¸€ä¸ªå­—æ®µè¿”å›</p><blockquote><p>HAVING</p></blockquote><p>ä¸“é—¨ç”¨äºè¿‡æ»¤æ±‡æ€»çš„ç»„è®°å½•</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name,<span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">GRUOP <span class="keyword">BY</span> cust_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h1 id="ä¸ƒ-äº‹åŠ¡å¤„ç†"><a class="markdownIt-Anchor" href="#ä¸ƒ-äº‹åŠ¡å¤„ç†"></a> ä¸ƒã€äº‹åŠ¡å¤„ç†</h1><p>MYSQLé»˜è®¤é‡‡ç”¨éšå¼æäº¤ç­–ç•¥(autocommit)ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥å°±ä¼šæŠŠè¿™æ¡è¯­å¥å½“æˆä¸€ä¸ªäº‹åŠ¡æäº¤ã€‚</p><p>é€šè¿‡<code>set autocommit=0</code>å¯ä»¥å…³é—­è‡ªåŠ¨æäº¤ï¼Œè¿™æ˜¯å‘½ä»¤é’ˆå¯¹è¿æ¥çš„ã€</p><p>å½“æˆ‘ä»¬æ˜¾å¼çš„å¼€å¯ä¸€ä¸ªäº‹åŠ¡<code>START TRANSACTION</code>æ—¶ï¼Œä¼šå…³é—­éšå¼æäº¤ï¼›å½“<code>COMMIT</code>æˆ–è€…<code>ROLLBACK</code>ä¹‹åä¼šé‡æ–°å¼€å¯éšå¼æäº¤</p><p>äº‹åŠ¡å‘½ä»¤:</p><ul><li><code>START TRANSACTION</code>-å¼€å¯ä¸€ä¸ªäº‹åŠ¡</li><li><code>SAVEPOINT</code>-åœ¨äº‹åŠ¡ä¸­åˆ›å»ºä¿å­˜ç‚¹</li><li><code>ROLLBACK TO</code>-å›æ»šåˆ°æŸä¸ªä¿å­˜ç‚¹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™è¿”å›åˆ°<code>START TRANSACTION</code>çš„ä½ç½®</li><li><code>COMMIT</code>-æäº¤äº‹åŠ¡</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯äº‹åŠ¡</span><br><span class="line"><span class="keyword">START</span> TRANSACTION</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> `<span class="keyword">user</span>`</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># è®¾ç½®ä¿å­˜ç‚¹</span><br><span class="line"><span class="keyword">SAVEPOINT</span> updateA;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> `<span class="keyword">user</span>`</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># å›æ»šåˆ°ä¿å­˜å¸¦ä½ </span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> updateA;</span><br><span class="line"></span><br><span class="line"># æäº¤äº‹åŠ¡ï¼Œæ­¤æ—¶åªæœ‰ç¬¬ä¸€ä¸ª<span class="keyword">insert</span>è¢«æäº¤</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><h1 id="å…«-æƒé™æ§åˆ¶"><a class="markdownIt-Anchor" href="#å…«-æƒé™æ§åˆ¶"></a> å…«ã€æƒé™æ§åˆ¶</h1><p>é‡‡ç”¨<code>GRANT</code>å’Œ<code>REVOKE</code>æ§åˆ¶è®¿é—®æƒé™ã€‚</p><p>è¯¥å‘½ä»¤å¯ä»¥åœ¨ä»¥ä¸‹è¿™äº›å±‚æ¬¡ä¸Šæ§åˆ¶è®¿é—®æƒé™ï¼š</p><ul><li>æ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨<code>GRANT ALL</code> å’Œ<code>REVOKE ALL</code></li><li>æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨<code>ON database.*</code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¼æ•°æ®åº“ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°æ®è¡¨ï¼Œ<code>*</code>ä»£è¡¨å¯¹å…¨éƒ¨è¡¨éƒ½æˆäºˆæƒé™</li><li>ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨<code>ON database.table</code></li><li>ç‰¹å®šçš„åˆ—</li><li>ç‰¹å®šçš„å‚¨å­˜è¿‡ç¨‹</li></ul><blockquote><p>æŸ¥è¯¢mysqlä¸­çš„æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºè´¦æˆ·</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">user</span> myuser INDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;mypassword&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹è´¦æˆ·å</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;newuser&#x27;</span> <span class="keyword">WHERE</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;myeser&#x27;</span>;</span><br><span class="line">FLUSH PREVILEGES;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹æƒé™</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> GTANTS <span class="keyword">FOR</span> myuser;</span><br></pre></td></tr></table></figure><blockquote><p>æˆäºˆæƒé™</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> myuser;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤æƒé™</p></blockquote> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">TO</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">FROM</span> myuser;</span><br></pre></td></tr></table></figure><blockquote><p>æ›´æ”¹å¯†ç </p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> myuser <span class="operator">=</span> <span class="string">&#x27;mypass&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€mysqlã€mysqlå¿«é€Ÿå…¥é—¨</title>
      <link href="/2022/10/15/mysql%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
      <url>/2022/10/15/mysql%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€-åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#ä¸€-åŸºæœ¬æ¦‚å¿µ"></a> ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h1><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/20200115160512.png" alt="" /></p><h2 id="æ•°æ®åº“æœ¯è¯­"><a class="markdownIt-Anchor" href="#æ•°æ®åº“æœ¯è¯­"></a> æ•°æ®åº“æœ¯è¯­</h2><ul><li><code>æ•°æ®åº“ï¼ˆdatabaseï¼‰</code>-ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨</li><li><code>æ•°æ®è¡¨ï¼ˆtableï¼‰</code>-æŸç§ç‰¹å®šæ•°æ®ç±»å‹çš„ç»“æ„åŒ–æ¸…å•</li><li><code>æ¨¡å¼ï¼ˆschemaï¼‰</code>-å…³äºæ•°æ®åº“å’Œæ•°æ®è¡¨çš„ç‰¹æ€§ä¿¡æ¯</li><li><code>åˆ—ï¼ˆcolumnï¼‰</code>ï¼šè¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µ</li><li><code>è¡Œï¼ˆrowï¼‰</code>è¡¨ä¸­çš„ä¸€ä¸ªè®°å½•</li><li><code>ä¸»é”®ï¼ˆprimary keyï¼‰</code>ï¼šä¸€ä¸ªç‰¹æ®Šçš„åˆ—ï¼Œå¯ä»¥å”¯ä¸€çš„æ ‡è¯†æ•°æ®è¡¨ä¸­çš„ä¸€è¡Œæ•°æ®</li></ul><h2 id="sqlè¯­æ³•"><a class="markdownIt-Anchor" href="#sqlè¯­æ³•"></a> SQLè¯­æ³•</h2><p>SQLå³Structed Query Languageï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ¯ä¸ªæ•°æ®åº“éƒ½æœ‰å¯¹è‡ªå·±SQLçš„å®ç°</p><h2 id="sqlè¯­æ³•ç»“æ„"><a class="markdownIt-Anchor" href="#sqlè¯­æ³•ç»“æ„"></a> SQLè¯­æ³•ç»“æ„</h2><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/sql-syntax.png" alt="" /></p><h2 id="sqlè¯­æ³•è¦ç‚¹"><a class="markdownIt-Anchor" href="#sqlè¯­æ³•è¦ç‚¹"></a> SQLè¯­æ³•è¦ç‚¹</h2><ul><li>SQLä¸åŒºåˆ†å¤§å°å†™</li><li>SQLä¹‹é—´å¿…é¡»è¦ä»¥åˆ†å·éš”å¼€</li><li>SQLå¤„ç†æ—¶æ‰€æœ‰ä¸­é—´çš„ç©ºæ ¼éƒ½ä¼šè¢«å¿½ç•¥ï¼ŒSQLå¯ä»¥å†™æˆä¸€è¡Œï¼Œä¹Ÿå¯ä»¥å†™æˆå¤šè¡Œ</li><li>SQLçš„ä¸‰ç§æ³¨é‡Šæ–¹æ³•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æ³¨é‡Š<span class="number">1</span></span><br><span class="line"><span class="comment">-- æ³¨é‡Š2</span></span><br><span class="line"><span class="comment">/* æ³¨é‡Š3 */</span></span><br></pre></td></tr></table></figure><h2 id="sqlåˆ†ç±»"><a class="markdownIt-Anchor" href="#sqlåˆ†ç±»"></a> SQLåˆ†ç±»</h2><h3 id="æ•°æ®å®šä¹‰è¯­è¨€ddl"><a class="markdownIt-Anchor" href="#æ•°æ®å®šä¹‰è¯­è¨€ddl"></a> æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰</h3><blockquote><p>ä»€ä¹ˆæ˜¯DDL</p></blockquote><p>æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆData Definition Languageï¼‰æ˜¯SQLè¯­è¨€é›†ä¸­è´Ÿè´£æ•°æ®ç»“æ„å®šä¹‰å’Œæ•°æ®å¯¹è±¡å®šä¹‰çš„è¯­è¨€ã€‚</p><blockquote><p>æ ¸å¿ƒåŠŸèƒ½</p></blockquote><p>å®šä¹‰æ•°æ®åº“å¯¹è±¡</p><blockquote><p>æ ¸å¿ƒæŒ‡ä»¤</p></blockquote><ul><li><code>CREATE</code></li><li><code>ALTER</code></li><li><code>DROP</code></li></ul><h3 id="æ•°æ®æ“çºµè¯­è¨€dml"><a class="markdownIt-Anchor" href="#æ•°æ®æ“çºµè¯­è¨€dml"></a> æ•°æ®æ“çºµè¯­è¨€ï¼ˆDMLï¼‰</h3><blockquote><p>ä»€ä¹ˆæ˜¯DML</p></blockquote><p>æ•°æ®æ“çºµè¯­è¨€ï¼ˆData Manipulation Languageï¼‰ç”¨äºæ“ä½œæ•°æ®åº“ï¼Œå¯¹æ•°æ®å…¶ä¸­çš„å¯¹è±¡æ“ä½œå’Œè®¿é—®çš„ç¼–ç¨‹è¯­å¥ã€‚</p><blockquote><p>æ ¸å¿ƒåŠŸèƒ½</p></blockquote><p>è®¿é—®æ•°æ®ï¼Œä¸»è¦åŠŸèƒ½åœ¨äºè¯»å†™æ•°æ®åº“</p><blockquote><p>æ ¸å¿ƒæŒ‡ä»¤</p></blockquote><ul><li><code>INSERT</code></li><li><code>UPDATE</code></li><li><code>DELETE</code></li><li><code>SELECT</code></li></ul><h3 id="äº‹åŠ¡æ§åˆ¶è¯­è¨€tcl"><a class="markdownIt-Anchor" href="#äº‹åŠ¡æ§åˆ¶è¯­è¨€tcl"></a> äº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼ˆTCLï¼‰</h3><blockquote><p>ä»€ä¹ˆæ˜¯TCL</p></blockquote><p>äº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼ˆTransaction Control Languageï¼‰æ˜¯ç”¨äºæ§åˆ¶äº‹åŠ¡çš„è¯­è¨€ã€‚</p><blockquote><p>æ ¸å¿ƒåŠŸèƒ½</p></blockquote><p>äº‹åŠ¡æ§åˆ¶</p><blockquote><p>æ ¸å¿ƒæŒ‡ä»¤</p></blockquote><ul><li><code>COMMIT</code>-æäº¤äº‹åŠ¡</li><li><code>ROLLBACK</code>-äº‹åŠ¡å›æ»š</li></ul><h3 id="æ•°æ®æ§åˆ¶è¯­è¨€dcl"><a class="markdownIt-Anchor" href="#æ•°æ®æ§åˆ¶è¯­è¨€dcl"></a> æ•°æ®æ§åˆ¶è¯­è¨€ï¼ˆDCLï¼‰</h3><blockquote><p>ä»€ä¹ˆæ˜¯DCL</p></blockquote><p>æ•°æ®æ§åˆ¶è¯­è¨€ï¼ˆData Control ï¼‰ç”¨äºæ§åˆ¶æ•°æ®è®¿é—®æƒé™</p><blockquote><p>æ ¸å¿ƒåŠŸèƒ½</p></blockquote><p>æ§åˆ¶æ•°æ®è®¿é—®æƒ</p><blockquote><p>æ ¸å¿ƒæŒ‡ä»¤</p></blockquote><ul><li><code>GRANT</code></li><li><code>REVOKE</code></li></ul><p>ä¸åŒæ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¹‹é—´çš„å®‰å…¨å®ä½“æœ‰æ‰€ä¸åŒ</p><h1 id="äºŒ-å¿«é€Ÿå¼€å§‹"><a class="markdownIt-Anchor" href="#äºŒ-å¿«é€Ÿå¼€å§‹"></a> äºŒã€å¿«é€Ÿå¼€å§‹</h1><h2 id="ç™»å½•mysql"><a class="markdownIt-Anchor" href="#ç™»å½•mysql"></a> ç™»å½•mysql</h2><p>é¦–å…ˆç™»å½•æˆ‘ä»¬çš„mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mysql -u root -p</span></span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥å¯†ç </p><h2 id="ä½¿ç”¨mysqlå¢åˆ æ”¹æŸ¥"><a class="markdownIt-Anchor" href="#ä½¿ç”¨mysqlå¢åˆ æ”¹æŸ¥"></a> ä½¿ç”¨mysqlå¢åˆ æ”¹æŸ¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæ•°æ®åº“</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE mysql_practice;</span><br><span class="line">#  ä½¿ç”¨è¿™ä¸ªæ•°æ®åº“</span><br><span class="line">USE mysql_practice;</span><br><span class="line"># åˆ›å»ºæ•°æ®è¡¨</span><br><span class="line"><span class="keyword">CREATE TABLE</span> users(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">    username <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"># æˆ‘ä»¬å…ˆæ’å…¥ä¸€æ¡æ•°æ®</span><br><span class="line"><span class="keyword">INSERT INTO</span> users <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;Mike&#x27;</span>);</span><br><span class="line"># æŸ¥å‡ºæˆ‘ä»¬ä¹‹å‰æ’å…¥çš„æ•°æ®</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> Mike     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+</span></span><br><span class="line"># æ›´æ–°</span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> username<span class="operator">=</span><span class="string">&#x27;john&#x27;</span>;</span><br><span class="line">## å†æ¬¡æŸ¥è¯¢ä¸€ä¸‹</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> john     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+</span></span><br><span class="line"># æœ€åæˆ‘ä»¬å°è¯•æŠŠè¿™ä¸ªæ•°æ®åˆ é™¤</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>; </span><br><span class="line"># å†æŸ¥è¯¢ä¸€ä¸‹ï¼Œå‡ºç°è¿™æ ·å°±æˆåŠŸäº†</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span></span><br></pre></td></tr></table></figure><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»ä¼šmysqlæœ€åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€gitã€gitå’Œgithubå…¥é—¨æ•™ç¨‹</title>
      <link href="/2022/10/15/git%E5%92%8Cgithub%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2022/10/15/git%E5%92%8Cgithub%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="gitç®€ä»‹"><a class="markdownIt-Anchor" href="#gitç®€ä»‹"></a> gitç®€ä»‹</h1><p>gitæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚</p><h1 id="gitå¿«é€Ÿå¼€å§‹"><a class="markdownIt-Anchor" href="#gitå¿«é€Ÿå¼€å§‹"></a> gitå¿«é€Ÿå¼€å§‹</h1><h2 id="å®‰è£…git"><a class="markdownIt-Anchor" href="#å®‰è£…git"></a> å®‰è£…git</h2><p><a href="https://git-scm.com/download/win">Git - Download</a></p><p>è¿™é‡Œä¸è®²è¿°å®‰è£…æ•™ç¨‹</p><h2 id="ä½“éªŒgit"><a class="markdownIt-Anchor" href="#ä½“éªŒgit"></a> ä½“éªŒgit</h2><p>æˆ‘ä»¬å…ˆæ¥å¿«é€Ÿçš„ä½“éªŒä¸€ä¸‹gitï¼Œè¿™ä¸€éƒ¨åˆ†æˆ‘å°†å°½é‡é¿å¼€gitçš„ç»†èŠ‚ï¼Œä¸“æ³¨äºgitçš„ä½¿ç”¨</p><h3 id="gitå’Œgithub"><a class="markdownIt-Anchor" href="#gitå’Œgithub"></a> gitå’Œgithub</h3><p>è¦ä½“éªŒgitçš„å¼ºå¤§åŠŸèƒ½ï¼Œgithubæ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>ä½†æ˜¯è™½ç„¶ä¸¤è€…ä¹‹é—´æœ‰ç€ç±»ä¼¼çš„åå­—ï¼Œä½†ä¸¤è€…ä¹‹é—´çš„å…³ç³»å°±å¥½åƒæ˜¯javaå’ŒJavaScriptä¹‹é—´çš„å…³ç³»ä¸€æ ·â€”â€”ä¸¤è€…ä¹‹é—´å®Œå…¨ä¸ç›¸åŒã€‚</p><p>é‚£ä¹ˆgithubæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿgitæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œgitæ˜¯å¦‚ä½•å®Œæˆç‰ˆæœ¬æ§åˆ¶çš„å‘¢ï¼Œå®ƒä¼šåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œè¿™ä¸ªä»“åº“ä¼šè®°å½•ä¸‹ä»“åº“ä¸­æ–‡ä»¶çš„å„ç§ä¿¡æ¯ã€‚é€šè¿‡äº†gitå’Œä»–åˆ›å»ºçš„ä»“åº“ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æœ¬åœ°å®ç°ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†æ˜¯ä»…ä»…åœ¨æœ¬åœ°çš„ä»“åº“å¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p><p>æˆ‘ä»¬æ›´å¸Œæœ›ä»“åº“ä¿å­˜æœ¬åœ°çš„åŒæ—¶å¯ä»¥ä¿å­˜åœ¨äº‘ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´å¥½çš„ä¿å­˜æˆ‘ä»¬åˆ›å»ºçš„å†…å®¹ï¼›äºæ­¤åŒæ—¶ï¼Œæˆ‘ä»¬æƒ³è¦æŠŠè‡ªå·±åˆ›å»ºçš„ä¸œè¥¿åˆ†äº«ç»™å…¶ä»–äººã€‚é‚£ä¹ˆgithubå°±æ˜¯è¿™æ ·çš„è¿œç¨‹ä»£ç æ‰˜ç®¡å¹³å°ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºgitï¼ŒæŠŠæœ¬åœ°çš„ä»“åº“æ”¾åœ¨githubä¸Šï¼Œè€Œæ”¾åœ¨githubä¸Šçš„å†…å®¹ä¹Ÿå¯ä»¥è¢«æ›´å¤šäººçœ‹åˆ°ï¼Œåˆ†äº«ç»™æ›´å¤šçš„äººï¼Œè¿™å¯¹äºäº’è”ç½‘çš„å‘å±•æ˜¯æå…¶é‡è¦çš„ã€‚æ— æ•°çš„å¼€å‘è€…å¯ä»¥æŠŠè‡ªå·±çš„ä»£ç æ‰˜ç®¡åœ¨githubä¸Šï¼Œå…¨ä¸–ç•ŒèŒƒå›´å†…æ— æ•°ä¼˜ç§€çš„ä»£ç å’Œæ™ºæ…§éƒ½å¼€æºåœ¨githubä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å»å­¦ä¹ è¿™äº›æ€æƒ³å’Œä»£ç ï¼Œè®©è‡ªå·±çš„ä»£ç æ°´å¹³å¾—ä»¥æå‡ã€‚</p><p>è¿™æ ·çš„ä»£ç æ‰˜ç®¡å¹³å°å¹¶ä¸åªæœ‰githubï¼Œåœ¨å›½å†…æˆ‘ä»¬æœ‰è‡ªå·±çš„giteeï¼Œä½†æ˜¯å¯ä»¥é¢„è§çš„æ˜¯ï¼Œgithubçš„ä½“é‡å’Œgiteeçš„ä½“é‡ä¹‹é—´å­˜åœ¨è¾ƒå¤§çš„å·®åˆ«ï¼Œgithubæ˜¯ä¸–ç•Œæ€§çš„ï¼Œgiteeæ˜¯å›½å†…çš„ï¼Œè¿™ä¹Ÿç›´æ¥å¯¼è‡´äº†ä¸¤è€…å¹³å°ä¸Šä»£ç è´¨é‡çš„å·®è·ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æ¥è¯´ä¼šæ›´å¤šçš„ä½¿ç”¨github</p><h3 id="ä½¿ç”¨git"><a class="markdownIt-Anchor" href="#ä½¿ç”¨git"></a> ä½¿ç”¨git</h3><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/bg2015120901.png" alt="img" /></p><blockquote><p>gitä¸­çš„å‡ ä¸ªæ¦‚å¿µ</p></blockquote><p>é€šè¿‡ä¸Šé¢gitå’Œgithubçš„æ¦‚è¿°ï¼Œæˆ‘ä»¬å¯¹gitçš„å·¥ä½œæµç¨‹æœ‰äº†ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£ï¼Œè‡³å°‘å·²çŸ¥çš„æ¦‚å¿µæ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œæœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ã€‚äº‹å®ä¸Šï¼Œgitçš„å·¥ä½œæµç¨‹å¤§æ¦‚ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>gitåœ¨å·¥ä½œä¸­æœ‰4ä¸ªåŒºåŸŸ</p><ul><li>Workspaceï¼šå·¥ä½œåŒº</li><li>Index / Stageï¼šæš‚å­˜åŒº</li><li>Repositoryï¼šä»“åº“åŒºï¼ˆæˆ–æœ¬åœ°ä»“åº“ï¼‰</li><li>Remoteï¼šè¿œç¨‹ä»“åº“</li></ul><p>æœ¬åœ°æ–‡ä»¶æ‰€åœ¨ä½ç½®å°±æ˜¯å·¥ä½œåŒºï¼Œåœ¨æœ¬åœ°æ–‡ä»¶æ‰€åœ¨ä½ç½®ä¼šæœ‰ä¸€ä¸ªæœ¬åœ°ä»“åº“ï¼Œè€Œgithubå°±æ˜¯è¿œç¨‹ä»“åº“ï¼Œæ­¤å¤–ï¼Œåœ¨å·¥ä½œåŒºå’Œæœ¬åœ°ä»“åº“ä¹‹é—´æœ‰ä¸€ä¸ªæš‚å­˜åŒºï¼Œç”¨äºæš‚æ—¶çš„ä¿å­˜æ–‡ä»¶</p><blockquote><p>gitåˆä½“éªŒ</p></blockquote><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œç°åœ¨æˆ‘ä»¬å°±è¦çœŸæ­£çš„å¼€å§‹ä½¿ç”¨gitäº†</p><p>æˆ‘ä»¬æ‰“å¼€å…ˆå°è¯•æŠŠgithubä¸Šçš„å†…å®¹æ‹‰å–åˆ°æœ¬åœ°</p><p><a href="https://github.com/jking412/hello-github">https://github.com/jking412/hello-github</a></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012193257256.png" alt="image-20221012193257256" /></p><p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªä»“åº“ï¼Œç‚¹å‡»å³ä¸Šè§’ç»¿è‰²çš„<code>Code</code>ï¼Œå¤åˆ¶ä¸‹URL</p><p>æ¥ç€ï¼Œæ‰¾åˆ°æˆ‘ä»¬æƒ³è¦æ”¾ç½®ä»“åº“çš„æ–‡ä»¶ä½ç½®ï¼Œåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€git bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/jking412/hello-github</span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012193553880.png" alt="image-20221012193553880" /></p><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°<code>hello-github</code>æ–‡ä»¶å¤¹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012193630137.png" alt="image-20221012193630137" /></p><p>ç‚¹è¿›å»ä¹‹åå°±å¯ä»¥çœ‹åˆ°ä»“åº“é‡Œçš„æ–‡ä»¶äº†</p><h3 id="æ·»åŠ ssh-key"><a class="markdownIt-Anchor" href="#æ·»åŠ ssh-key"></a> æ·»åŠ ssh key</h3><p>åœ¨æˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„ä»“åº“ä¹‹å‰ï¼Œæˆ‘ä»¬è¦é…ç½®ä¸€ä¸‹ssh keyã€‚</p><p>ä¸ºä»€ä¹ˆè¦é…ç½®è¿™ä¸ªå‘¢ï¼ŒåŠ å…¥ä½ è‡ªå·±åˆ›å»ºäº†ä»“åº“ï¼Œå¦‚æœè°éƒ½å¯ä»¥å‘è¿™ä¸ªä»“åº“å»æ¨é€å’Œä¿®æ”¹å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªä»“åº“æ˜¾ç„¶æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æœ¬åœ°çš„gitå¿…é¡»è¦è·å¾—è¿œç¨‹ä»“åº“çš„è®¸å¯ä¹‹åæ‰å¯ä»¥å‘è¿œç¨‹ä»“åº“æ¨é€å†…å®¹ï¼Œè¿™ä¸ªè®¸å¯å°±æ˜¯ssh keyã€‚</p><p>æˆ‘ä»¬æ‰“å¼€git bashï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git config --global user.name <span class="string">&#x27;yourname&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git config --global user.email <span class="string">&#x27;youremail&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh-keygen -t rsa -C <span class="string">&#x27;youremail&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¥ä¸‹æ¥ä¼šå‡ºç°ä¸€äº›ä¿¡æ¯éœ€è¦å¡«å†™ï¼Œæˆ‘ä»¬ä¸å¿…ç®¡å®ƒï¼Œä¸€ç›´æŒ‰ç©ºæ ¼å°±å¯ä»¥äº†</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ssh keyå°±ç”Ÿæˆå¥½äº†ï¼Œæˆ‘ä»¬æ‰“å¼€ssh keyæ‰€åœ¨ä½ç½®ï¼Œåœ¨ä½ çš„Cç›˜ä¸‹çš„Usersç›®å½•ä¸­ï¼Œæ³¨æ„ä½ å¯èƒ½ä¼šæ‰¾ä¸åˆ°.sshç›®å½•ï¼Œè¦æ³¨æ„æ‰“å¼€éšè—æ–‡ä»¶å¤¹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012195206365.png" alt="image-20221012195206365" /></p><p>æˆ‘ä»¬æ‰“å¼€.sshç›®å½•</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012195336400.png" alt="image-20221012195336400" /></p><p>æˆ‘ä»¬æ‰“å¼€<code>id_rsa.pub</code>ï¼Œå¤åˆ¶ä¸‹å…¶ä¸­çš„å†…å®¹ï¼Œç„¶åæ‰“å¼€githubçš„settings</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012195432506.png" alt="image-20221012195432506" /></p><p>å»åˆ›å»ºä¸€ä¸ªssh key</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012195506157.png" alt="image-20221012195506157" /></p><p>Titleå¯ä»¥éšä¾¿å–ï¼Œç”¨äºæ ‡è¯†ç»™ä½ è‡ªå·±çœ‹ï¼Œä¸‹é¢çš„Keyå°±æ˜¯å¤åˆ¶ä¸‹æ¥çš„å†…å®¹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012195541215.png" alt="image-20221012195541215" /></p><p>å®Œæˆåæ·»åŠ å°±å®Œæˆäº†é…ç½®</p><h3 id="åˆ›å»ºè‡ªå·±çš„ä»“åº“"><a class="markdownIt-Anchor" href="#åˆ›å»ºè‡ªå·±çš„ä»“åº“"></a> åˆ›å»ºè‡ªå·±çš„ä»“åº“</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥åˆ›å»ºè‡ªå·±çš„ä»£ç ä»“åº“å¹¶æŠŠæœ¬åœ°ä»“åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012195714629.png" alt="image-20221012195714629" /></p><p>å»Newä¸€ä¸ªä»“åº“</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012195959441.png" alt="image-20221012195959441" /></p><p>å¡«å†™ä»“åº“åå­—å°±å¯ä»¥åˆ›å»ºäº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012200144465.png" alt="image-20221012200144465" /></p><p>æˆ‘ä»¬å…ˆåœ¨ä¸€ä¸ªä½ æƒ³è¦é€‰å–ä½œä¸ºgitæœ¬åœ°ä»“åº“çš„ä½ç½®åˆ›å»ºæ–‡ä»¶ï¼ˆå†…å®¹éšæ„ï¼‰</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012200343990.png" alt="image-20221012200343990" /></p><p>æ‰“å¼€git bash</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git init</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add .</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&#x27;first commit&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤åˆ¶ä½ çš„gitä»“åº“çš„URL</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote add origin &lt;ä½ çš„ä»£ç ä»“åº“URL&gt;</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch -M main</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push -u origin main</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½ å°±å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„æ–‡ä»¶å‡ºç°åœ¨githubä»“åº“ä¸Šäº†</p><h3 id="å…³é”®å‘½ä»¤çš„è§£é‡Š"><a class="markdownIt-Anchor" href="#å…³é”®å‘½ä»¤çš„è§£é‡Š"></a> å…³é”®å‘½ä»¤çš„è§£é‡Š</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢å‘½ä»¤çš„å…·ä½“å«ä¹‰</p><blockquote><p>git init</p></blockquote><p>åˆå§‹åŒ–ä¸€ä¸ªä»“åº“</p><blockquote><p>git add .</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add &lt;filename&gt; <span class="comment"># æŠŠæ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œâ€˜.â€™è¡¨ç¤ºæŠŠå½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰å†…å®¹åŠ å…¥åˆ°æš‚å­˜åŒº</span></span></span><br></pre></td></tr></table></figure><blockquote><p>git commit</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&#x27;comment content&#x27;</span> <span class="comment"># commitå‘½ä»¤æŠŠæš‚å­˜åŒºçš„å†…å®¹æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œ-mä¸ºè¿™ä¸ªæäº¤æ·»åŠ æ³¨é‡Š</span></span></span><br></pre></td></tr></table></figure><blockquote><p>git remote</p></blockquote><p>æ·»åŠ è¿œç¨‹ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote add origin &lt;ä½ çš„ä»£ç ä»“åº“URL&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤§å®¶æ³¨æ„è¿™é‡Œçš„originå®é™…ä¸Šæ˜¯&lt;ä½ çš„ä»£ç ä»“åº“URL&gt;çš„ä¸€ä¸ªåˆ«å</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥åœ¨æœ€åpushçš„æ—¶å€™æŠŠoriginçš„ä½ç½®æ”¹æˆ&lt;ä½ çš„ä»£ç ä»“åº“URL&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>git branch -M</p></blockquote><p>ç»™å½“å‰åˆ†æ”¯é‡å‘½åï¼ˆé»˜è®¤æ˜¯masterï¼‰</p><blockquote><p>git push</p></blockquote><p>å°†æœ¬åœ°å†…å®¹æäº¤åˆ°è¿œç¨‹ä»“åº“</p><p>è¿™é‡Œåªæä¸€ä¸‹<code>-u</code>å‚æ•°ï¼Œgitåœ¨æäº¤çš„æ—¶å€™éœ€è¦çŸ¥é“è¿œç¨‹ä»“åº“çš„ä½ç½®ï¼Œè¿™ä¸ª<code>-u</code>å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬è¦å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°çš„è¿œç¨‹ä»“åº“çš„ä½ç½®ï¼Œè¿™ä¸ªå‚æ•°åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡pushçš„æ—¶å€™æ·»åŠ ï¼Œåé¢pushçš„è¿‡ç¨‹ä¸­ç›´æ¥<code>git push</code>å°±å¯ä»¥äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€rssã€ttrssæé€Ÿæ­å»ºrssæœåŠ¡</title>
      <link href="/2022/10/12/ttrss%E6%9E%81%E9%80%9F%E6%90%AD%E5%BB%BArss%E6%9C%8D%E5%8A%A1/"/>
      <url>/2022/10/12/ttrss%E6%9E%81%E9%80%9F%E6%90%AD%E5%BB%BArss%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯rss"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯rss"></a> ä»€ä¹ˆæ˜¯rss</h1><p><code>Really Simple Syndication</code>ï¼Œç®€æ˜“èµ„è®¯èšåˆã€‚</p><p>åå­—å¹¶ä¸é‡è¦ï¼Œä½ å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œå¯ä»¥å¸®åŠ©ä½ è®¢é˜…äº’è”ç½‘ä¸Šå„ç§å„æ ·çš„ä¿¡æ¯ï¼Œå°±å¥½åƒå¾®åšä½ è®¢é˜…äº†åšä¸»ï¼Œç„¶åä½ å°±å¯ä»¥ç‰¹åˆ«çš„æ”¶åˆ°å®ƒçš„æ¶ˆæ¯ä¸€æ ·ã€‚åªä¸è¿‡ç°åœ¨ä½ å¯ä»¥è®¢é˜…çš„èŒƒå›´å˜æˆäº†æ‰€æœ‰æ”¯æŒrssçš„ç½‘ç«™</p><p>ä¸‹é¢æˆ‘ä»¬å°±å°è¯•ç€ä½¿ç”¨ttrssæ¥è®¢é˜…è‘—åå¤§ä½¬é˜®ä¸€å³°çš„åšå®¢</p><h1 id="ttrss"><a class="markdownIt-Anchor" href="#ttrss"></a> ttrss</h1><p>æ³¨æ„ï¼Œä»¥ä¸‹çš„rssæœåŠ¡æ²¡æœ‰é…ç½®åŸŸåå’Œhttps</p><h2 id="å¼€å§‹çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹çš„å‡†å¤‡"></a> å¼€å§‹çš„å‡†å¤‡</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€æœ‰ä¸€äº›å¿…è¦çš„å·¥å…·</p><ul><li>docker</li><li>äº‘æœåŠ¡å™¨</li></ul><h2 id="ä»€ä¹ˆæ˜¯ttrss"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯ttrss"></a> ä»€ä¹ˆæ˜¯ttrss</h2><p>ttrsså³<code>tiny tiny rss</code>ï¼Œæ˜¯ä¸€ä¸ªåŸºäºphpçš„å…è´¹å¼€æºçš„rssèšåˆé˜…è¯»å™¨ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä½¿ç”¨<code>docker compose</code>æ¥æ­å»ºæœåŠ¡</p><h2 id="å¼€å§‹æ­å»º"><a class="markdownIt-Anchor" href="#å¼€å§‹æ­å»º"></a> å¼€å§‹æ­å»º</h2><p>é¦–å…ˆåœ¨ä»»æ„çš„åœ°æ–¹åˆ›å»º<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">service.rss:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wangqiru/ttrss:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ttrss</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">181</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SELF_URL_PATH=http://localhost:181/</span> <span class="comment"># please change to your own domain</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_PASS=ttrss</span> <span class="comment"># use the same password defined in `database.postgres`</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PUID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PGID=1000</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">feed-icons:/var/www/feed-icons/</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">public_access</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">service_only</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">database_only</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">service.mercury:</span> <span class="comment"># set Mercury Parser API endpoint to `service.mercury:3000` on TTRSS plugin setting page</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wangqiru/mercury-parser-api:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mercury</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">public_access</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">service_only</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">service.opencc:</span> <span class="comment"># set OpenCC API endpoint to `service.opencc:3000` on TTRSS plugin setting page</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wangqiru/opencc-api-server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">opencc</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NODE_ENV=production</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">service_only</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">database.postgres:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:13-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTGRES_PASSWORD=ttrss</span> <span class="comment"># feel free to change the password</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/postgres/data/:/var/lib/postgresql/data</span> <span class="comment"># persist postgres data to ~/postgres/data/ on the host</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">database_only</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># utility.watchtower:</span></span><br><span class="line">  <span class="comment">#   container_name: watchtower</span></span><br><span class="line">  <span class="comment">#   image: containrrr/watchtower:latest</span></span><br><span class="line">  <span class="comment">#   volumes:</span></span><br><span class="line">  <span class="comment">#     - /var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - WATCHTOWER_CLEANUP=true</span></span><br><span class="line">  <span class="comment">#     - WATCHTOWER_POLL_INTERVAL=86400</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">feed-icons:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">public_access:</span> <span class="comment"># Provide the access for ttrss UI</span></span><br><span class="line">  <span class="attr">service_only:</span> <span class="comment"># Provide the communication network between services only</span></span><br><span class="line">    <span class="attr">internal:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">database_only:</span> <span class="comment"># Provide the communication between ttrss and database only</span></span><br><span class="line">    <span class="attr">internal:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹docker-compose.ymlæ–‡ä»¶</p></blockquote><p>å°†ä¸‹é¢çš„urlæ”¹æˆä½ è®¿é—®è¯¥æœåŠ¡çš„urlï¼Œåœ¨å…¶å®ƒé…ç½®ä¿æŒé»˜è®¤çš„æƒ…å†µä¸‹ï¼ŒæŠŠlocalhostæ”¹æˆæœåŠ¡å™¨IPå³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">SELF_URL_PATH=http://localhost:181/</span> <span class="comment"># please change to your own domain</span></span><br></pre></td></tr></table></figure><p>å¼ºçƒˆå»ºè®®ä½ ä¿®æ”¹è¿™ä¸¤å¤„çš„å¯†ç ï¼ˆè™½ç„¶ä¸ä¿®æ”¹ä¾ç„¶å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯æœ€å¥½ä¸è¦è¿™æ ·åšï¼‰ï¼Œä¿æŒä¸€è‡´å³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">DB_PASS=ttrss</span> <span class="comment"># use the same password defined in `database.postgres`</span></span><br><span class="line"></span><br><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">POSTGRES_PASSWORD=ttrss</span> <span class="comment"># feel free to change the password</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†å½“å‰ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker compose up -d</span></span><br></pre></td></tr></table></figure><p>ç­‰å¾…ä¸€å°æ®µæ—¶é—´å³å¯éƒ¨ç½²æˆåŠŸ</p><h2 id="é…ç½®rssç½‘ç«™"><a class="markdownIt-Anchor" href="#é…ç½®rssç½‘ç«™"></a> é…ç½®rssç½‘ç«™</h2><blockquote><p>ä¿®æ”¹é»˜è®¤å¯†ç </p></blockquote><p>è®¿é—®<code>ip:181</code>ï¼Œé»˜è®¤è´¦å·<code>admin</code>ï¼Œé»˜è®¤å¯†ç <code>password</code>ï¼Œ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/1%7BP(%609FLRYI3OCK)%7B6~%6045H.png" alt="" /></p><p>ç™»å½•ååœ¨ç”¨æˆ·ä½ç½®ä¿®æ”¹å¯†ç </p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221006212555462.png" alt="image-20221006212555462" /></p><p>é…ç½®å¥½å¯†ç ä»¥åæˆ‘ä»¬å¼€å¯APIï¼Œä¸ºä¹‹åæˆ‘ä»¬å¯ä»¥æ‰‹æœºä¸Šé˜…è¯»åšå‡†å¤‡</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221006213433683.png" alt="image-20221006213433683" /></p><p>å†ç„¶åæˆ‘ä»¬æ‰“å¼€è®¾ç½®é…ç½®RSSæº</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221006213607133.png" alt="image-20221006213607133" /></p><p>å¡«å…¥é˜®ä¸€å³°å¤§ä½¬çš„RSSæº</p><p><a href="http://www.ruanyifeng.com/blog/atom.xml">http://www.ruanyifeng.com/blog/atom.xml</a></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221006213642604.png" alt="image-20221006213642604" /></p><p>ç„¶ååˆ·æ–°ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°æ–‡ç« äº†ï¼ˆæˆ‘è¿™é‡Œåœ¨ä¹‹å‰å·²ç»æå‰é…ç½®äº†RSSæºï¼Œæ‰€ä»¥å·²ç»æœ‰äº†æ–‡ç« ï¼‰</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221006213829694.png" alt="image-20221006213829694" /></p><p>å¦‚æœä½ çœ‹åˆ°çš„æ–‡ç« æ˜¯ç›´æ¥å±•å¼€çš„ï¼Œå¯ä»¥åœ¨ä¸€æ—çš„è®¾ç½®ä¸­æŠŠå®ƒæ”¶èµ·</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221006213916201.png" alt="image-20221006213916201" /></p><p>å¥½äº†ï¼Œè‡³æ­¤æˆ‘ä»¬å°±å®Œæˆäº†RSSåœ¨PCç«¯çš„é…ç½®ï¼Œç„¶åæˆ‘ä»¬å†å»é…ç½®æ‰‹æœºç«¯</p><h2 id="æ‰‹æœºç«¯rssé˜…è¯»å™¨"><a class="markdownIt-Anchor" href="#æ‰‹æœºç«¯rssé˜…è¯»å™¨"></a> æ‰‹æœºç«¯RSSé˜…è¯»å™¨</h2><p>é¦–å…ˆä¸‹è½½é˜…è¯»è½¯ä»¶</p><p><a href="https://go-aliyun-oss.oss-cn-hangzhou.aliyuncs.com/FeedMe.apk?Expires=1665134217&amp;OSSAccessKeyId=TMP.3KggvUkN12e6GAYuXtqhEuEfwKroxoxX85jgQpYHMug975JjxjyJJxju6i6sEu6kwjhn1U162cqy9WvzMF7PKrWfhfneP9&amp;Signature=JO2w1YW0ZkynaoF1BgkqPedSqZs%3D">FeedMe</a></p><p>æ‰“å¼€è½¯ä»¶ï¼Œæˆ‘ä»¬åœ¨<code>tiny tiny RSS</code>çš„ä½ç½®è¾“å…¥ä¿¡æ¯</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Screenshot_2022-10-07-17-14-27-742_com.seazon.fee.jpg" alt="Screenshot_2022-10-07-17-14-27-742_com.seazon.fee" /></p><p>åŸŸåå°±æ˜¯<code>http://ip:port</code></p><p>ç™»å½•ä¹‹åæŒ‰ä¸€ä¸‹åˆ·æ–°æŒ‰é’®å°±å¯ä»¥çœ‹åˆ°æ–‡ç« äº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Screenshot_2022-10-07-17-15-33-169_com.seazon.fee.jpg" alt="Screenshot_2022-10-07-17-15-33-169_com.seazon.fee" /></p><p>è¿™æ ·å°±å®Œæˆäº†RSSçš„åŸºæœ¬é…ç½®ï¼Œå¼€å¯ä½ çš„RSSä¹‹æ—…å§</p>]]></content>
      
      
      
        <tags>
            
            <tag> rss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€JavaWebã€åŸºæœ¬åå¢ƒé…ç½®</title>
      <link href="/2022/10/12/JavaWeb%E5%9F%BA%E6%9C%AC%E5%9D%8F%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
      <url>/2022/10/12/JavaWeb%E5%9F%BA%E6%9C%AC%E5%9D%8F%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="é…ç½®tomcat"><a class="markdownIt-Anchor" href="#é…ç½®tomcat"></a> é…ç½®Tomcat</h1><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012153129573.png" alt="image-20221012153129573" /></p><p>ä¸‹è½½Tomcat9æˆ–è€…æ›´ä½ç‰ˆæœ¬ï¼ŒTomcat10çš„åŒ…ç›®å½•ç»“æ„æœ‰è¾ƒå¤§çš„æ”¹å˜ï¼Œæ²¡æœ‰ç†Ÿæ‚‰ä¹‹å‰ä¸å»ºè®®ä½¿ç”¨</p><p><a href="https://tomcat.apache.org/download-90.cgi">Apache TomcatÂ® - Apache Tomcat 9 Software Downloads</a></p><p>ä¸‹è½½å¥½ä¹‹åè§£å‹åˆ°ä»»æ„ç›®å½•é‡Œ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012153302786.png" alt="image-20221012153302786" /></p><p>ç„¶åæŠŠTomcaté…ç½®åˆ°ç¯å¢ƒå˜é‡é‡Œï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸‰ä¸ªå¿…é¡»çš„ç¯å¢ƒå˜é‡</p><ul><li>JAVA_HOMEï¼štomcatç”±javaç¼–å†™ï¼Œå¿…é¡»è¦jdkç¯å¢ƒï¼Œåœ¨å¼€å§‹ä¹‹å‰å°±åº”è¯¥é…ç½®å¥½</li><li>CATALINA_HOMEï¼štomcatçš„æ‰€åœ¨ç›®å½•</li><li>tomcatçš„binç›®å½•</li></ul><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012153708037.png" alt="image-20221012153708037" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012153825082.png" alt="image-20221012153825082" /></p><p>è¿™æ ·å°±å®Œæˆäº†åŸºæœ¬çš„ç¯å¢ƒå˜é‡é…ç½®äº†ï¼Œç„¶åæˆ‘ä»¬æ¥ç®€å•çš„æ£€æµ‹ä¸€ä¸‹ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æˆåŠŸ</p><p>æ‰“å¼€cmdæ§åˆ¶å°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">startup.bat</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012154158959.png" alt="image-20221012154158959" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012154206082.png" alt="image-20221012154206082" /></p><p>è¿™æ ·å°±å¯åŠ¨æˆåŠŸäº†ï¼Œç„¶åæˆ‘ä»¬è®¿é—®<code>localhost:8080</code>ï¼Œå‡ºç°ä»¥ä¸‹é¡µé¢å°±æˆåŠŸäº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012154331045.png" alt="image-20221012154331045" /></p><p>æµ‹è¯•æˆåŠŸå°±å¯ä»¥å…³é—­æœåŠ¡äº†</p><h1 id="é…ç½®maven"><a class="markdownIt-Anchor" href="#é…ç½®maven"></a> é…ç½®maven</h1><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012155135786.png" alt="image-20221012155135786" /></p><p><a href="https://maven.apache.org/download.cgi">Maven â€“ Download Apache Maven</a></p><p>ä¸‹è½½å¥½ä¹‹åè§£å‹åˆ°ä»»åŠ¡ç›®å½•</p><p>éœ€è¦é…ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡</p><ul><li>MAVEN_HOMEï¼šmavenæ‰€åœ¨ç›®å½•</li><li>mavençš„binç›®å½•</li></ul><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012155346953.png" alt="image-20221012155346953" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012155327550.png" alt="image-20221012155327550" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012155408605.png" alt="image-20221012155408605" /></p><p>æ‰“å¼€æ§åˆ¶æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mvn -v</span></span><br></pre></td></tr></table></figure><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012155441330.png" alt="image-20221012155441330" /></p><p>è¿™æ ·mavenå°±é…ç½®å¥½äº†</p><h1 id="åœ¨ideaä¸­ä½¿ç”¨tomcatå’Œmaven"><a class="markdownIt-Anchor" href="#åœ¨ideaä¸­ä½¿ç”¨tomcatå’Œmaven"></a> åœ¨IDEAä¸­ä½¿ç”¨Tomcatå’Œmaven</h1><p>åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œå¦‚æœä½ çš„ç•Œé¢å’Œæˆ‘ä¸ä¸€æ ·ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œåœ¨<code>Archetype</code>è¿™ä¸€é¡¹é€‰æ‹©<code>webapp</code>ç„¶ååˆ›å»ºé¡¹ç›®å°±å¯ä»¥äº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012161710988.png" alt="image-20221012161710988" /></p><p>æ‰“å¼€è®¾ç½®</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012155731409.png" alt="image-20221012155731409" /></p><p>æ‰¾åˆ°mavenè®¾ç½®</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012155823822.png" alt="image-20221012155823822" /></p><p>è®¾ç½®é…ç½®æ–‡ä»¶å’Œä»“åº“ä½ç½®ï¼Œç»™å³è¾¹çš„<code>Override</code>é€‰é¡¹æ‰“å‹¾ï¼Œå¦‚æœæ²¡æœ‰<code>repository</code>ç›®å½•å¯ä»¥æ–°å»ºä¸€ä¸ª</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012160008374.png" alt="image-20221012160008374" /></p><p>åœ¨IDEAä¸­é…ç½®tomcat</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012160102350.png" alt="image-20221012160102350" /></p><p>æ‰¾åˆ°tomcaté€‰é¡¹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012160144792.png" alt="image-20221012160144792" /></p><p>è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹è®¾ç½®æˆtomcatæ‰€åœ¨ç›®å½•å°±å¯ä»¥äº†ï¼Œå¦‚æœä½ é…ç½®å¥½äº†ç¯å¢ƒå˜é‡è¿™é‡Œåº”è¯¥ä¼šè‡ªåŠ¨å‡ºç°ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°å°±æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012160419644.png" alt="image-20221012160419644" /></p><p>ä¸‹é¢æœ‰ä¸€ä¸ªæµè§ˆå™¨çš„é€‰æ‹©ï¼Œåœ¨é¡¹ç›®å¯åŠ¨ä¹‹åä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨æ‰“å¼€ç½‘é¡µï¼Œå¦‚æœæ²¡æœ‰googleå¯ä»¥åˆ‡æ¢ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªåŠŸèƒ½å…³é—­</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012161304523.png" alt="image-20221012161304523" /></p><p>é€‰æ‹©å¥½ä¹‹åç»§ç»­é…ç½®</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012160713348.png" alt="image-20221012160713348" /></p><p>é€‰æ‹©ç¬¬ä¸€ä¸ªå°±ok</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012160738226.png" alt="image-20221012160738226" /></p><p>è®°å½•ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªæ•°å€¼ï¼Œè¿™å°±æ˜¯ä½ çš„webæ ¹ç›®å½•ï¼Œå½“ç„¶è¿™ä¸ªæ ¹ç›®å½•å¾ˆé•¿ï¼Œä¸å¤ªå¥½ç”¨ï¼Œä½ å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ï¼Œè¿™ä¸ªå€¼ä»»æ„</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012160853525.png" alt="image-20221012160853525" /></p><p>å¥½äº†ï¼Œç°åœ¨å°±å·²ç»é…ç½®å¥½äº†æ‰€æœ‰å†…å®¹ï¼Œå¯åŠ¨é¡¹ç›®å§</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012161143532.png" alt="image-20221012161143532" /></p><p>å¦‚æœä½ æ²¡æœ‰å…³é—­è‡ªåŠ¨æ‰“å¼€ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ å·²ç»å¯ä»¥çœ‹åˆ°è¿™ä¸ªç•Œé¢ï¼Œå¦‚æœæ²¡æœ‰æ‰“å¼€ï¼Œ</p><p>è¾“å…¥<code>localhost:8080/ä½ çš„webæ ¹ç›®å½•</code></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221012161529357.png" alt="image-20221012161529357" /></p><p>è‡³æ­¤ï¼Œå·²ç»å®Œå…¨é…ç½®å®Œæˆäº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> tomcat </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€åˆ›æ–°å®è·µã€åˆ›æ–°å®è·µæ€»ç»“1</title>
      <link href="/2022/10/06/%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%931/"/>
      <url>/2022/10/06/%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%931/</url>
      
        <content type="html"><![CDATA[<h1 id="webæœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#webæœåŠ¡å™¨"></a> WebæœåŠ¡å™¨â›µ</h1><blockquote><p>ä»€ä¹ˆæ˜¯WebæœåŠ¡å™¨</p></blockquote><p>WebæœåŠ¡å™¨ä¸€èˆ¬æŒ‡ç½‘ç«™æœåŠ¡å™¨ï¼Œæ˜¯æŒ‡é©»ç•™äºå› ç‰¹ç½‘ä¸ŠæŸç§ç±»å‹è®¡ç®—æœºçš„ç¨‹åºï¼Œå¯ä»¥å¤„ç†æµè§ˆå™¨ç­‰Webå®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶è¿”å›ç›¸åº”å“åº”ï¼Œä¹Ÿå¯ä»¥æ”¾ç½®ç½‘ç«™æ–‡ä»¶ï¼Œè®©å…¨ä¸–ç•Œæµè§ˆï¼›å¯ä»¥æ”¾ç½®æ•°æ®æ–‡ä»¶ï¼Œè®©å…¨ä¸–ç•Œä¸‹è½½ã€‚</p><blockquote><p>WebæœåŠ¡å™¨çš„æœ¬è´¨</p></blockquote><p>WebæœåŠ¡å™¨çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªç¨‹åºï¼Œä¸è¿‡è¿™ä¸ªç¨‹åºæ¯”è¾ƒç‰¹æ®Šï¼Œåœ¨Webä¸­ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªä¸­é—´äººï¼Œå¯ä»¥æ¥å—æ¥è‡ªäºå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™åå°çš„ç¨‹åºå¤„ç†ã€‚</p><p>å†ä»è¿™ä¸ªç¨‹åºçš„è§’åº¦å‡ºå‘ï¼ŒWebæœåŠ¡å™¨å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†å¯¹ç«¯å£çš„ç›‘å¬ï¼Œå®ç°äº†å¯¹åå°åå°ç¨‹åºçš„è°ƒåº¦ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºå®ç°åå°é€»è¾‘</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20221004110318399.png" alt="image-20221004110318399" /></p><h1 id="webæœåŠ¡å™¨æœ‰å“ªäº›ä»¥åŠå®ƒä»¬çš„ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#webæœåŠ¡å™¨æœ‰å“ªäº›ä»¥åŠå®ƒä»¬çš„ç‰¹ç‚¹"></a> WebæœåŠ¡å™¨æœ‰å“ªäº›ï¼Œä»¥åŠå®ƒä»¬çš„ç‰¹ç‚¹ğŸ“²</h1><p>WebæœåŠ¡å™¨å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œå°±åˆ—ä¸¾ä¸€ä¸‹æˆ‘ç”¨è¿‡çš„ï¼Œè®²è®²è‡ªå·±çš„æ„Ÿå—ï¼Œä¹Ÿå°±ä¸ç»†ç»†åˆ—ä¸¾å…¶å®ƒçš„WebæœåŠ¡å™¨äº†</p><blockquote><p>apache</p></blockquote><p>ä¸€ä¸ªç›¸å½“ç»å…¸çš„webæœåŠ¡å™¨ï¼Œå¸¸å¸¸å’Œphpç¯å¢ƒä¸€èµ·å‡ºç°ï¼Œä¸ºphpæä¾›å¼€å‘ç¯å¢ƒï¼Œä½†æ˜¯ç°åœ¨åœ¨å…¶å®ƒé¢†åŸŸç”¨çš„æ¯”è¾ƒå°‘äº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/apache.jpg" alt="" /></p><blockquote><p>nginx</p></blockquote><p>å½“ä¸‹ä¾æ—§ç«çƒ­çš„WebæœåŠ¡å™¨ï¼Œç”±Cè¯­è¨€ç¼–å†™ï¼Œé€Ÿåº¦ç›¸å½“å¿«ï¼Œå¹¶å‘èƒ½åŠ›å¾ˆå¼ºã€‚æ­¤å¤–ï¼Œé™¤äº†ä¸Šé¢è®²çš„WebæœåŠ¡å™¨çš„ç»å…¸åŠŸèƒ½ä»¥å¤–ï¼Œnginxè¿˜æä¾›äº†åå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ï¼ŒåŠ¨é™åˆ†ç¦»ç­‰åŠŸèƒ½ï¼Œåœ¨Webå¼€å‘ä¸­éå¸¸å¸¸è§ï¼Œå³ä¾¿åœ¨å¼€å‘ä¸­å·²ç»ä½¿ç”¨äº†å…¶å®ƒçš„WebæœåŠ¡å™¨ï¼Œç»§ç»­ä½¿ç”¨nginxä½œåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡çš„åœºæ™¯éå¸¸æ™®é</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/download.jpg" alt="" /></p><blockquote><p>tomcat</p></blockquote><p>ä¸€ä¸ªç”±Javaç¼–å†™çš„WebæœåŠ¡å™¨ï¼Œæ˜¯Javaå¼€å‘ä¸­æœ€æµè¡Œçš„WebæœåŠ¡å™¨ä¹‹ä¸€ï¼Œæœ€ä¸»è¦è¿˜æ˜¯è¿™æ¬¾WebæœåŠ¡å™¨å®Œå…¨å¼€æºï¼Œå…è´¹ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­å¤§é‡ä½¿ç”¨</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/tomcat.jpg" alt="" /></p><h1 id="webæµè§ˆå™¨ï¸"><a class="markdownIt-Anchor" href="#webæµè§ˆå™¨ï¸"></a> Webæµè§ˆå™¨ğŸ’‡â€â™€ï¸</h1><p>Webæµè§ˆå™¨å°±æ˜¯ä¸€ä¸ªç”¨æ¥æµè§ˆç½‘ç»œç½‘é¡µçš„è½¯ä»¶ã€‚</p><blockquote><p>è°ˆè°ˆä¸ªäººå¯¹Webæµè§ˆå™¨çš„è®¤çŸ¥</p></blockquote><p>æµè§ˆå™¨æˆ‘æ²¡æœ‰ä»€ä¹ˆæ·±å…¥çš„äº†è§£ï¼Œä»…ä»…ä½œä¸ºä½¿ç”¨è€…è°ˆè°ˆæ„Ÿå—ï¼Œä½œä¸ºä½¿ç”¨è€…ï¼Œæµè§ˆå™¨ç»™æˆ‘çš„æ„Ÿè§‰æ˜¯è¿™æ ·çš„</p><ol><li>è¾“å…¥URIï¼ˆä¸ä¸€å®šæ˜¯æ‰‹åŠ¨è¾“å…¥ï¼‰</li><li>è·å–å†…å®¹å¹¶æ¸²æŸ“ç»™æˆ‘ä»¬çœ‹</li></ol><p>åŸºäºæ­¤ï¼Œæˆ‘è®¤ä¸ºæµè§ˆè‡³å°‘éœ€è¦ä¸¤ä¸ªåŠŸèƒ½</p><ol><li>å¯¹httpï¼Œhttpsç­‰åè®®çš„æ”¯æŒ</li><li>æ”¯æŒå¯¹htmlï¼Œcssï¼Œjsçš„æ¸²æŸ“</li></ol><h1 id="webæµè§ˆå™¨æœ‰å“ªäº›"><a class="markdownIt-Anchor" href="#webæµè§ˆå™¨æœ‰å“ªäº›"></a> Webæµè§ˆå™¨æœ‰å“ªäº›ğŸ“Ÿ</h1><p>è¿˜æ˜¯è°ˆè°ˆæ„Ÿå—å§ï¼Œä¸è¿‡è®¤è¯†ä¸å¤š</p><blockquote><p>IE</p></blockquote><p>è™½ç„¶å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œä½†æ˜¯ä½œä¸ºç«¥å¹´æ—¶ä»£ç”¨çš„æœ€å¤šçš„æµè§ˆå™¨è¿˜æ˜¯å€¼å¾—æä¸€å˜´çš„ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒIEä»è¯ç”Ÿå¼€å§‹ï¼Œå°±å……æ»¡äº†ä¸å…‰å½©ï¼Œé ç€é€†å‘å·¥ç¨‹å’Œwindowså¯¹å¸‚åœºçš„å„æ–­ï¼Œåœ¨æµè§ˆå™¨å¤§æˆ˜ä¸­å‡»è´¥äº†å½“æ—¶çš„ç½‘æ™¯å…¬å¸ã€‚è¿™ç§ä¾èµ–äºå¤–åŠ›çš„èƒœåˆ©ä¸ºæµè§ˆå™¨çš„å‘å±•åŸ‹ä¸‹äº†ä¼ç¬”ï¼Œäººåªæœ‰åœ¨ç«äº‰ä¸­æ‰ä¼šå¿«é€Ÿè¿›æ­¥ï¼Œä¾èµ–ç€windowsåœ¨å…¨çƒçš„ç››è¡Œï¼Œä¸windowsç»‘å®šçš„IEä¸å†éœ€è¦ä¸ä»–äººè¾›è‹¦çš„ç«äº‰ï¼Œåœ¨ä¹‹åçš„20å¹´é‡Œï¼ŒIEæˆåŠŸçš„èµ¢å¾—äº†Webå¼€å‘è€…ä»¬çš„åŒæ¶ï¼ŒIEå›ºæ­¥è‡ªå°ï¼Œä¸ä¸å»å…¼å®¹æµè§ˆå™¨çš„ä¸€äº›æ ‡å‡†ï¼Œè®©å¼€å‘è€…ä»¬å¤§ä¸ºå¤´ç–¼ï¼Œä½†æœ€ç»ˆéšç€æ—¶é—´çš„æ¨ç§»ï¼ŒIEé€€å‡ºå†å²èˆå°ä¼¼ä¹ä¹Ÿè¯æ˜äº†ä¸€ä¸ªé“ç†ï¼Œä¸æ˜¯ä½ çš„ï¼Œç»ˆç©¶ä¼šå¤±å»ã€‚</p><p>å›è¿‡å¤´æ¥çœ‹ï¼Œäº’è”ç½‘å·²ç»ä¸ºå…¨ä¸–ç•Œæ„å»ºèµ·äº†ä¸€å¼ å¤§ç½‘ï¼Œå…¨ä¸–ç•Œçš„ä¿¡æ¯å·²ç»è¢«è¿é€šäº†èµ·æ¥ï¼Œæ­¤åˆ»é¢‡æœ‰äº›æ„Ÿæƒ³ï¼Œå¤šäº†ä¹Ÿä¸è¯´äº†ï¼Œå…ˆè¿™æ ·å§ï¼Œåé¢è¿˜æœ‰å¾ˆå¤šè¦å†™å‘¢</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/IE.jpg" alt="" /></p><blockquote><p>edge</p></blockquote><p>windowsé»˜è®¤æµè§ˆå™¨ï¼Œä»£æ›¿äº†IEï¼Œä½¿ç”¨chromeå†…æ ¸ï¼Œå„é¡¹åŠŸèƒ½éƒ½åœ¨å‘chromeæ ‡é½</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/edge.jpg" alt="" /></p><blockquote><p>chrome</p></blockquote><p>éœ€è¦é­”æ³•æ‰èƒ½ç”¨çš„æµè§ˆå™¨ï¼Œè™½ç„¶æœ‰é­”æ³•ä½†æ˜¯æ„Ÿè§‰edgeçš„å¿…åº”ä¹ŸæŒºå¥½ç”¨çš„ï¼Œæ‰€ä»¥ä¸æ€ä¹ˆä½¿ç”¨</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/chrome.jpg" alt="" /></p><blockquote><p>firefox</p></blockquote><p>linuxæ¡Œé¢ç‰ˆçš„é»˜è®¤æµè§ˆå™¨ï¼Œéå¸¸æ³¨é‡å®‰å…¨æ€§</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/firefox.jpg" alt="" /></p><h1 id="æµè§ˆå™¨appå’Œæ¡Œé¢appçš„åŒºåˆ«ï¸"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨appå’Œæ¡Œé¢appçš„åŒºåˆ«ï¸"></a> æµè§ˆå™¨appå’Œæ¡Œé¢appçš„åŒºåˆ«âš™ï¸</h1><p>è¿™ä¸ªé—®é¢˜çš„åŸé—®é¢˜æ˜¯<code>å®‰è£…ä¸€ä¸ªç½‘ç«™è½¯ä»¶ä¸å®‰è£…ä¸€ä¸ªæ¡Œé¢è½¯ä»¶æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</code></p><p>ä½†æ˜¯æˆ‘æœ‰ç‚¹æ¯å¤ªç†è§£å®‰è£…ç½‘ç«™è½¯ä»¶çš„æ¦‚å¿µï¼Œæ‰€ä»¥å°±æŒ‰ç…§æˆ‘çš„ç†è§£å›ç­”é—®é¢˜</p><blockquote><p>ä½¿ç”¨æ–¹å¼çš„ä¸åŒ</p></blockquote><p>æµè§ˆå™¨è½¯ä»¶æˆ‘ä»¬å¯ä»¥ç›´æ¥åŸºäºæµè§ˆå™¨è®¿é—®ï¼Œä¸éœ€è¦æå‰ä¸‹è½½ã€‚æ¡Œé¢appéœ€è¦æˆ‘ä»¬æå‰ä¸‹è½½å¥½è½¯ä»¶æ‰å¯ä»¥ä½¿ç”¨</p><blockquote><p>åº•å±‚ä¸åŒ</p></blockquote><p>æµè§ˆå™¨è½¯ä»¶æ˜¯ä¾èµ–æµè§ˆå™¨çš„ï¼Œæ‰€ä»¥åº•å±‚æ˜¯jsï¼Œä½†æ˜¯æ¡Œé¢appçš„å¼€å‘åˆ™å¤šç§å¤šæ ·ã€‚</p><p>ä½†æ˜¯åœ¨ç°ä»£å¼€å‘ä¸­ä¹Ÿå¹¶ä¸ç»å¯¹ï¼Œä¾‹å¦‚ä½¿ç”¨<code>electron</code>å¯ä»¥è®©æˆ‘ä»¬ç”¨jså¼€å‘æ¡Œé¢åº”ç”¨ï¼Œä¾‹å¦‚å¸¸ç”¨çš„ç¼–è¾‘å™¨<code>vscode</code>å°±æ˜¯<code>electron</code>çš„ä»£è¡¨ä½œå“ä¹‹ä¸€</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/electron.jpg" alt="" /></p><p>ç›¸å¯¹çš„ï¼Œå¼€å‘æµè§ˆå™¨è½¯ä»¶ä¹Ÿä¸ä¸€å®šè¦ä¾èµ–äºjsï¼Œ<code>WebAssembly</code>æ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œè¿™æˆäº†ä¸€äº›è¯­è¨€çš„ä¸€ä¸ªæ–°çš„ç¼–è¯‘äº†ç›®æ ‡ï¼Œåªè¦ç¼–è¯‘æˆè¿™ç§æ ¼å¼å°±å¯ä»¥åœ¨è®©è½¯ä»¶åœ¨æµè§ˆå™¨ç§è¿è¡Œ</p><blockquote><p>è®²ç‚¹åˆ«çš„</p></blockquote><p>è°ˆè°ˆè®¾è®¡è½¯ä»¶Figmaå’Œsketch</p><p>è¿‘æ—¥ï¼ŒAdobeå®£å¸ƒ200äº¿ç¾å…ƒæ”¶è´­Figmaï¼ŒFigmaæ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç«¯çš„è®¾è®¡è½¯ä»¶ï¼Œè€Œsketchåˆ™æ˜¯ä¸€ä¸ªMacOSåº”ç”¨ï¼ŒFigmaç›¸è¾ƒäºsketchæ˜¯ä¸€ä¸ªéå¸¸å¹´è½»çš„åº”ç”¨ï¼Œè€Œåœ¨ä»Šå¹´ï¼ŒFigmaå·²ç»èµ¢è¿‡äº†sketch</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/figma.jpg" alt="" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/sketch.jpg" alt="" /></p><p>æˆ‘ä¸å¾—ä¸ææåŸç”Ÿåº”ç”¨å’Œæµè§ˆå™¨åº”ç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«ï¼Œé€Ÿåº¦ã€‚è¦çŸ¥é“ï¼ŒåŸç”Ÿåº”ç”¨å¤§å¤šé‡‡ç”¨Cï¼ŒC++ï¼ŒJavaç­‰ç¼–è¯‘å‹é«˜çº§è¯­è¨€ç¼–å†™ï¼Œè€Œjsåˆ™æ˜¯ä¸€ç§è§£é‡Šå‹çš„è„šæœ¬è¯­è¨€ï¼Œæ‰€ä»¥åŸç”Ÿåº”ç”¨çš„é€Ÿåº¦ä¸€èˆ¬æ¥è¯´è‚¯å®šæ˜¯å¿«äºæµè§ˆå™¨åº”ç”¨çš„</p><p>ä½†æ˜¯Figmaç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯<code>Rust</code>ï¼Œ<code>Rust</code>ä½œä¸ºä¸€é—¨ç±»Cçš„æ–°å…´è¯­è¨€ï¼Œå·²ç»åœ¨å¾ˆå¤šæ–¹é¢å±•ç°äº†å¼ºå¤§çš„èƒ½åŠ›ï¼Œå…¶ä¸­ä¸€é¡¹å°±æ˜¯å¯ä»¥ç¼–è¯‘æˆ<code>WebAssembly</code>ï¼Œè¿™è®©æµè§ˆå™¨åº”ç”¨æœ‰äº†æ¥è¿‘åŸç”Ÿçš„é€Ÿåº¦ï¼Œè€ŒFigmaä¹Ÿæ­£æ˜¯å€ŸåŠ©è€…<code>Rust</code>çš„é«˜æ€§èƒ½åœ¨å®ç°äº†é€Ÿåº¦ä¸Šçš„å·¨å¤§æå‡ï¼Œä¸ºäº†å®ƒçš„èƒœåˆ©åšå‡ºå·¨å¤§çš„è´¡çŒ®</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/rust.jpg" alt="" /></p><h1 id="wordpress"><a class="markdownIt-Anchor" href="#wordpress"></a> Wordpress</h1><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/wordpress.jpg" alt="" /></p><p>ä¸€ä¸ªç®€å•æ˜“ç”¨çš„åšå®¢æ¡†æ¶</p><h2 id="å¿…è¦çš„è½¯ä»¶"><a class="markdownIt-Anchor" href="#å¿…è¦çš„è½¯ä»¶"></a> å¿…è¦çš„è½¯ä»¶</h2><blockquote><p>phpå¼€å‘ç¯å¢ƒ</p></blockquote><p>åç«¯ä½¿ç”¨çš„æ˜¯phpï¼Œæ‰€ä»¥å¿…é¡»è¦æœ‰ç›¸åº”çš„å¼€å‘ç¯å¢ƒ</p><blockquote><p>mysql</p></blockquote><p>ç”¨äºå‚¨å­˜æ•°æ®</p><blockquote><p>apacheç­‰webæœåŠ¡å™¨</p></blockquote><p>èµ·åˆ°webæœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œå…·ä½“è§å‰é¢WebæœåŠ¡å™¨ç¯‡</p><h1 id="hexo"><a class="markdownIt-Anchor" href="#hexo"></a> hexo</h1><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/hexo.jpg" alt="" /></p><p>ä¹Ÿæ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„åšå®¢æ¡†æ¶</p><h2 id="å¿…è¦çš„è½¯ä»¶-2"><a class="markdownIt-Anchor" href="#å¿…è¦çš„è½¯ä»¶-2"></a> å¿…è¦çš„è½¯ä»¶</h2><blockquote><p>nodejs</p></blockquote><p>ä½¿ç”¨jsç”Ÿæˆé™æ€ç½‘é¡µï¼Œéœ€è¦nodejsæä¾›ç¯å¢ƒ</p><h2 id="å…³é”®æ­¥éª¤"><a class="markdownIt-Anchor" href="#å…³é”®æ­¥éª¤"></a> å…³é”®æ­¥éª¤</h2><ol><li>ç¼–å†™å¥½markdownæ–‡ä»¶</li><li>ä½¿ç”¨hexoè„šæœ¬å°†markdownç”Ÿæˆå¯¹é‚£ä¸ªçš„é™æ€ç½‘ç«™</li><li>å°†ç½‘é¡µéƒ¨ç½²åˆ°æœåŠ¡å™¨</li></ol><h1 id="hexoå’Œwordpressçš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#hexoå’Œwordpressçš„åŒºåˆ«"></a> hexoå’Œwordpressçš„åŒºåˆ«</h1><blockquote><p>é™æ€ç½‘ç«™ä¸åŠ¨æ€ç½‘ç«™</p></blockquote><ul><li><p>hexoç”Ÿæˆçš„æ˜¯é™æ€htmlæ–‡ä»¶ï¼Œæ— æ³•ä¿®æ”¹ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹åªèƒ½ä¿®æ”¹markdownæºæ–‡ä»¶ç„¶åä½¿ç”¨hexoè„šæœ¬é‡æ–°ç”Ÿæˆå¯¹åº”çš„é™æ€é¡µé¢</p></li><li><p>wordpressåˆ™æ˜¯ä¸€ä¸ªåŠ¨æ€çš„åº”ç”¨ç¨‹åºï¼Œæ¯æ¬¡çš„ç½‘ç«™éƒ½æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ•°æ®ä¿å­˜åœ¨æ•°æ®åº“</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
            <tag> åˆ›æ–°å®è·µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Goã€åœ¨Goä¸­ä½¿ç”¨JWT</title>
      <link href="/2022/10/01/%E5%9C%A8Go%E4%B8%AD%E4%BD%BF%E7%94%A8JWT/"/>
      <url>/2022/10/01/%E5%9C%A8Go%E4%B8%AD%E4%BD%BF%E7%94%A8JWT/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯jwt"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯jwt"></a> ä»€ä¹ˆæ˜¯JWT</h1><p>JWTå³<code>JSON Web Token</code>ï¼Œå·¥ä½œæœºåˆ¶æ˜¯åœ¨ç”¨æˆ·é€šè¿‡é‰´æƒä¹‹åï¼ŒæœåŠ¡ç«¯å‘é€ä¸€ä¸ªJSONä½œä¸ºå‡­è¯ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯åˆæƒé™å¯ä»¥è®¿é—®ä¸€äº›èµ„æº</p><p>JWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- Headerï¼ˆå¤´éƒ¨ï¼‰</span><br><span class="line">åŒ…å«äº†ä¸€äº›å…ƒæ•°æ®</span><br><span class="line">- Payloadï¼ˆè´Ÿè½½ï¼‰</span><br><span class="line">å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®</span><br><span class="line">- Signatureï¼ˆç­¾åï¼‰</span><br><span class="line">å¯¹å‰ä¸¤éƒ¨åˆ†è¿›è¡Œç­¾åï¼Œé˜²æ­¢jwtè¢«ç¯¡æ”¹</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯<code>Payload</code>ä¸­çš„æ•°æ®ä¸ä¼šè¢«åŠ å¯†ï¼Œæ‰€ä»¥ä¸è¦å­˜æ”¾é‡è¦</p><p>ç­¾åä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œæ˜¯ç»å¯¹ä¸å¯æ³„éœ²çš„</p><p>æœ€åï¼ŒæœåŠ¡å™¨ä¼šå¯¹æ•´ä¸ªJSONè¿›è¡ŒåŠ å¯†ï¼Œç„¶åæŠŠåŠ å¯†åçš„æ•°æ®ä¼ å›ç»™å®¢æˆ·ç«¯ï¼Œæœ€åæˆ‘ä»¬æ‹¿åˆ°çš„jwtå¤§æ¦‚æ˜¯è¿™æ ·çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span><br></pre></td></tr></table></figure><h1 id="goä½¿ç”¨jwt"><a class="markdownIt-Anchor" href="#goä½¿ç”¨jwt"></a> GOä½¿ç”¨JWT</h1><p>ä¸‹é¢çš„ä»£ç åŒæ—¶è¢«ä¿å­˜åœ¨githubä»“åº“ä¸­</p><p><a href="https://github.com/jking412/go-example">jking412/go-example: å°demoï¼Œgoçš„æ•´åˆæŠ€æœ¯æ¡ˆä¾‹ (github.com)</a></p><p>æˆ‘ä»¬å…ˆä¸‹è½½ä¸€ç§jwtåŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get <span class="string">&quot;github.com/golang-jwt/jwt&quot;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/golang-jwt/jwt&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http&quot;</span></span><br><span class="line">   <span class="string">&quot;strconv&quot;</span></span><br><span class="line">   <span class="string">&quot;strings&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JWTCustomClaims <span class="keyword">struct</span> &#123;</span><br><span class="line">   UserId <span class="type">int</span></span><br><span class="line">   jwt.StandardClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   http.HandleFunc(<span class="string">&quot;/register&quot;</span>, registerHandler)</span><br><span class="line">   http.HandleFunc(<span class="string">&quot;/login&quot;</span>, loginHandler)</span><br><span class="line">   http.HandleFunc(<span class="string">&quot;/user&quot;</span>, userHandler)</span><br><span class="line">   http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">userHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   token, err := authJWT(r)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      w.Write([]<span class="type">byte</span>(<span class="string">&quot;æƒé™ä¸è¶³&quot;</span>))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   id := <span class="string">&quot;useræ˜¯:&quot;</span> + strconv.Itoa(token.Claims.(*JWTCustomClaims).UserId)</span><br><span class="line">   w.Write([]<span class="type">byte</span>(id))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   token, err := generateToken(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      w.Write([]<span class="type">byte</span>(<span class="string">&quot;æ³¨å†Œå¤±è´¥&quot;</span>))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   w.Write([]<span class="type">byte</span>(token))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">   _, err := authJWT(r)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      w.Write([]<span class="type">byte</span>(<span class="string">&quot;ç™»å½•å¤±è´¥&quot;</span>))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   w.Write([]<span class="type">byte</span>(<span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">authJWT</span><span class="params">(r *http.Request)</span></span> (*jwt.Token, <span class="type">error</span>) &#123;</span><br><span class="line">   tokenString, err := getJwtTokenFromHeader(r)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   token, err := parseToken(tokenString)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> token, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseToken</span><span class="params">(tokenString <span class="type">string</span>)</span></span> (*jwt.Token, <span class="type">error</span>) &#123;</span><br><span class="line">   token, err := jwt.ParseWithClaims(tokenString, &amp;JWTCustomClaims&#123;&#125;, <span class="function"><span class="keyword">func</span><span class="params">(token *jwt.Token)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> []<span class="type">byte</span>(<span class="string">&quot;secret&quot;</span>), <span class="literal">nil</span></span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">return</span> token, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateToken</span><span class="params">(userId <span class="type">int</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">   claims := JWTCustomClaims&#123;</span><br><span class="line">      userId,</span><br><span class="line">      jwt.StandardClaims&#123;</span><br><span class="line">         ExpiresAt: time.Now().Unix() + <span class="number">3600</span>,</span><br><span class="line">         Issuer:    <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line">   token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)</span><br><span class="line">   <span class="keyword">return</span> token.SignedString([]<span class="type">byte</span>(<span class="string">&quot;secret&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getJwtTokenFromHeader</span><span class="params">(r *http.Request)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">   tokenString := r.Header.Get(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">   fmt.Println(tokenString)</span><br><span class="line"></span><br><span class="line">   tokenResult := strings.SplitN(tokenString, <span class="string">&quot; &quot;</span>, <span class="number">2</span>)</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(tokenResult) != <span class="number">2</span> || tokenResult[<span class="number">0</span>] != <span class="string">&quot;Bearer&quot;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;tokenæ ¼å¼é”™è¯¯&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> tokenResult[<span class="number">1</span>], <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªæ˜¯ä¸€ä¸ªç®€å•å®ä¾‹ï¼Œä½“ä¼šä¸€ä¸‹å¦‚ä½•ç”Ÿæˆå’Œè§£æJWT</p><p><code>/register</code>æ¥å£å¯ä»¥åƒå®¢æˆ·ç«¯éšæœºç”Ÿæˆä¸€ä¸ªJWT</p><p><code>/login</code>æ¥å£æ¨¡æ‹Ÿäº†ç”¨æˆ·çš„ç™»å½•</p><p><code>/user</code>æ¨¡æ‹Ÿäº†éœ€è¦JWTé‰´æƒæ‰èƒ½è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹</p><p>å®¢æˆ·ç«¯åœ¨æ‹¿åˆ°JWTä¹‹åï¼Œéœ€è¦æŠŠJWTæ”¾åœ¨è¯·æ±‚å¤´ä¸­çš„<code>Authorization</code>å­—æ®µä¸­ï¼Œ</p><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization:Bearer &lt;æœåŠ¡ç«¯çš„JWT&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ ·JWTçš„ä¸€ä¸ªç®€å•ä½¿ç”¨æµç¨‹å°±ç»“æŸäº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€springbootã€shiroé‰´æƒ</title>
      <link href="/2022/09/28/springboot%E4%BD%BF%E7%94%A8shiro%E5%AE%8C%E6%88%90%E9%89%B4%E6%9D%83/"/>
      <url>/2022/09/28/springboot%E4%BD%BF%E7%94%A8shiro%E5%AE%8C%E6%88%90%E9%89%B4%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<h1 id="shiroæ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#shiroæ˜¯ä»€ä¹ˆ"></a> Shiroæ˜¯ä»€ä¹ˆ</h1><p>shiroæ˜¯javaçš„ä¸€ä¸ªå®‰å…¨æ¡†æ¶ï¼Œå…³äºå®ƒçš„ä¼˜åŠ¿å’Œä¸€äº›åŠŸèƒ½å°±ä¸ç»†è®²äº†</p><h1 id="shiroçš„æ¶æ„"><a class="markdownIt-Anchor" href="#shiroçš„æ¶æ„"></a> Shiroçš„æ¶æ„</h1><p>å…ˆæ”¾ä¸€å¼ ç»å…¸çš„Shiroæ¶æ„å›¾</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/v2-c0841dfc8cb19a94c322eef635371cf6_720w.webp" alt="img" /></p><ul><li>Subjectï¼šå¯ä»¥ç†è§£ä¸ºèµ„æºçš„è¯·æ±‚è€…</li><li>Shiro SecurityManagerï¼šä½œä¸ºä¸€ä¸ªä¸­é—´çš„è¿‡åº¦ï¼Œç®¡ç†ç€shiroå„ç§èµ„æº</li><li>Realmï¼šå­˜æ”¾ç€çœŸæ­£çš„è®¤è¯å’Œæˆæƒä¿¡æ¯</li></ul><h1 id="å¿«é€Ÿå…¥é—¨"><a class="markdownIt-Anchor" href="#å¿«é€Ÿå…¥é—¨"></a> å¿«é€Ÿå…¥é—¨</h1><p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªshiroåœ¨é¡¹ç›®ä¸­åº”ç”¨çš„ç®€å•ä¾‹å­ï¼Œå› ä¸ºæ˜¯shiroçš„å¿«é€Ÿå…¥é—¨ï¼Œæ‰€ä»¥shiroä¹‹å¤–çš„å…¶å®ƒæŠ€æœ¯å¦‚ä½•ä½¿ç”¨åŒ…æ‹¬sqlè¯­å¥çš„ç¼–å†™ä¸ä¼šå»å…·ä½“è®²è§£ï¼Œæ‰€ä»¥å»ºè®®å¼€å§‹å‰æŠŠä»£ç æ‹‰ä¸‹æ¥</p><p>å®Œæ•´ä»£ç è¯·è®¿é—®ä»“åº“</p><p><a href="https://github.com/jking412/java-example">jking412/java-example: ä¸€äº›javaçš„demoï¼Œä¸»è¦æ˜¯springbootæ•´åˆæ¡†æ¶çš„æ¡ˆä¾‹ (github.com)</a></p><h2 id="æ•°æ®åº“çš„è®¾è®¡"><a class="markdownIt-Anchor" href="#æ•°æ®åº“çš„è®¾è®¡"></a> æ•°æ®åº“çš„è®¾è®¡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> goods</span><br><span class="line">(</span><br><span class="line">    id    <span class="type">int</span> auto_increment</span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    name  <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">    price <span class="type">int</span>         <span class="keyword">null</span></span><br><span class="line">)</span><br><span class="line">    <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> sys_permission</span><br><span class="line">(</span><br><span class="line">    permission_id   <span class="type">int</span> auto_increment</span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    permission_name <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">not null</span>,</span><br><span class="line">    permission_desc <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not null</span>,</span><br><span class="line">    permission_url  <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line">    <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> sys_role</span><br><span class="line">(</span><br><span class="line">    role_id   <span class="type">int</span> auto_increment</span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    role_name <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">not null</span>,</span><br><span class="line">    role_desc <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line">    <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> sys_role_permission</span><br><span class="line">(</span><br><span class="line">    role_id       <span class="type">int</span> <span class="keyword">not null</span>,</span><br><span class="line">    permission_id <span class="type">int</span> <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line">    <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> sys_user</span><br><span class="line">(</span><br><span class="line">    user_id       <span class="type">int</span> auto_increment</span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    user_name     <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span>,</span><br><span class="line">    user_password <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span>,</span><br><span class="line">    user_salt     <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line">    <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> sys_user_role</span><br><span class="line">(</span><br><span class="line">    user_id <span class="type">int</span> <span class="keyword">not null</span>,</span><br><span class="line">    role_id <span class="type">int</span> <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line">    <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å…­å¼ è¡¨</p><p>äº”å¼ è¡¨ç”¨äºç³»ç»Ÿçš„å®‰å…¨ç®¡ç†</p><table><thead><tr><th>è¡¨å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>sys_user</td><td>ç”¨æˆ·ä¿¡æ¯</td></tr><tr><td>sys_role</td><td>è§’è‰²</td></tr><tr><td>sys_permission</td><td>æƒé™</td></tr><tr><td>sys_role_permission</td><td>è§’è‰²å’Œæƒé™ä¹‹é—´çš„å…³ç³»</td></tr><tr><td>sys_user_role</td><td>ç”¨æˆ·äºè§’è‰²çš„å…³ç³»</td></tr></tbody></table><p>æœ€åä¸€å¼ goodsè¡¨ç”¨æˆ·æµ‹è¯•ï¼Œå¯ä»¥éšæ„å»º</p><h2 id="ä½¿ç”¨shiro"><a class="markdownIt-Anchor" href="#ä½¿ç”¨shiro"></a> ä½¿ç”¨shiro</h2><p>shiroçš„ä½¿ç”¨å…¶å®ç›¸å½“çš„ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®å¥½ä¸¤ä¸ªç±»å³å¯</p><h3 id="realmé…ç½®"><a class="markdownIt-Anchor" href="#realmé…ç½®"></a> Realmé…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.shirotest.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.shirotest.entity.SysPermission;</span><br><span class="line"><span class="keyword">import</span> com.example.shirotest.entity.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.example.shirotest.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.example.shirotest.mapper.SysPermissionMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.shirotest.mapper.UserInfoMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoMapper userInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysPermissionMapper sysPermissionMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> (UserInfo) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        <span class="type">SimpleAuthorizationInfo</span> <span class="variable">simpleAuthorizationInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthorizationInfo</span>();</span><br><span class="line">        <span class="keyword">for</span>(SysRole role : userInfo.getRoles())&#123;</span><br><span class="line">            simpleAuthorizationInfo.addRole(role.getRole());</span><br><span class="line">            List&lt;SysPermission&gt; sysPermissions = sysPermissionMapper.selectPermissionByRoleId(role.getId());</span><br><span class="line">            <span class="keyword">for</span>(SysPermission sysPermission : sysPermissions)&#123;</span><br><span class="line">                simpleAuthorizationInfo.addStringPermission(sysPermission.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> simpleAuthorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> (String)authenticationToken.getPrincipal();</span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> userInfoMapper.findByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SimpleAuthenticationInfo</span> <span class="variable">simpleAuthenticationInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(userInfo,</span><br><span class="line">                userInfo.getPassword(),</span><br><span class="line">                ByteSource.Util.bytes(userInfo.getSalt()),</span><br><span class="line">                <span class="built_in">this</span>.getName());</span><br><span class="line">        <span class="keyword">return</span> simpleAuthenticationInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®¤è¯å’Œæˆæƒ</p></blockquote><p>è®¤è¯æ˜¯é’ˆå¯¹æŸä¸ªç”¨æˆ·çš„ï¼Œè®¤è¯æˆåŠŸå¯ä»¥è®¤ä¸ºæ˜¯ç™»å½•æˆåŠŸ</p><p>è™½ç„¶ç”¨æˆ·å·²ç»ç»è¿‡äº†ç™»å½•ï¼Œä½†ç”¨æˆ·å¹¶ä¸å¯¹æ‰€æœ‰çš„èµ„æºå…·æœ‰æ“ä½œæƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ</p><p>æˆæƒæ˜¯é’ˆå¯¹å…·ä½“çš„æŸä¸ªæ“ä½œçš„ï¼Œç»™äºˆç”¨æˆ·å…·ä½“çš„æ“ä½œæƒé™</p><blockquote><p>doGetAuthenticationInfo()</p></blockquote><p>å®Œæˆè®¤è¯çš„å‡½æ•°ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨ç™»å½•çš„æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>authenticationToken.getPrincipal()</code>å–å¾—tokenä¸­çš„usernameï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªusernameæ¥å–å‡ºdaoå±‚ä¸­çš„ç”¨æˆ·ç›¸å…³æ•°æ®ï¼Œå¹¶ä¸”æŠŠä»æ•°æ®åº“ä¸­å–å‡ºçš„æ•°æ®æ”¾åˆ°shiroä¸­ï¼Œshiroä¼šæŠŠå¯†ç å’Œtokenä¸­çš„å¯†ç è¿›è¡Œè‡ªåŠ¨æ¯”å¯¹ã€‚</p><p>è¿™é‡Œæ˜¯åœ¨<code>UserController</code>ä¸­çš„ç™»å½•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(map.get(<span class="string">&quot;username&quot;</span>).toString(),map.get(<span class="string">&quot;password&quot;</span>).toString());</span><br><span class="line">subject.login(token);</span><br></pre></td></tr></table></figure><blockquote><p>userInfo.getSalt()</p></blockquote><p>è¿™é‡Œæ˜¯ç”¨æˆ·çš„ç›ï¼Œæˆ‘ä»¬åœ¨å­˜æ”¾ç”¨æˆ·å¯†ç æ—¶ä¼šå¯¹ç”¨æˆ·çš„å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œä½†æ˜¯ç›´æ¥åŠ å¯†çš„æ–¹å¼è¿˜æ˜¯ä¸å¤Ÿå®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™å¯†ç æ·»åŠ ä¸Šä¸€æ®µéšæœºç”Ÿæˆçš„å­—ç¬¦å†åŠ å¯†çš„æ–¹å¼æé«˜ç”¨æˆ·å¯†ç çš„å®‰å…¨æ€§</p><blockquote><p>doGetAuthorizationInfo()</p></blockquote><p>å®Œæˆæˆæƒçš„å‡½æ•°ï¼Œæˆ‘ä»¬æŸ¥è¯¢å‡ºç”¨æˆ·çš„æ‰€æœ‰è§’è‰²ï¼Œç„¶åæŸ¥è¯¢è§’è‰²æ‹¥æœ‰çš„æƒé™ï¼Œç„¶åæœ€åæŠŠè¿™äº›æ•°æ®éƒ½æ·»åŠ éƒ½shiroä¸­</p><h3 id="shiroconfigé…ç½®"><a class="markdownIt-Anchor" href="#shiroconfigé…ç½®"></a> shiroconfigé…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.shirotest.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.credential.HashedCredentialsMatcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shirFilter</span><span class="params">(SecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; filterChainDefinitionMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String,String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é…ç½®ä¸ä¼šè¢«æ‹¦æˆªçš„é“¾æ¥ é¡ºåºåˆ¤æ–­</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/static/**&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">        <span class="comment">// é…ç½®é€€å‡º è¿‡æ»¤å™¨,å…¶ä¸­çš„å…·ä½“çš„é€€å‡ºä»£ç Shiroå·²ç»æ›¿æˆ‘ä»¬å®ç°äº†</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/logout&quot;</span>, <span class="string">&quot;logout&quot;</span>);</span><br><span class="line">        <span class="comment">// &lt;!-- è¿‡æ»¤é“¾å®šä¹‰ï¼Œä»ä¸Šå‘ä¸‹é¡ºåºæ‰§è¡Œï¼Œä¸€èˆ¬å°†/**æ”¾åœ¨æœ€ä¸ºä¸‹è¾¹ --&gt;:è¿™æ˜¯ä¸€ä¸ªå‘å‘¢ï¼Œä¸€ä¸å°å¿ƒä»£ç å°±ä¸å¥½ä½¿äº†;</span></span><br><span class="line">        <span class="comment">// &lt;!-- authc:æ‰€æœ‰urléƒ½å¿…é¡»è®¤è¯é€šè¿‡æ‰å¯ä»¥è®¿é—®; anon:æ‰€æœ‰urléƒ½éƒ½å¯ä»¥åŒ¿åè®¿é—®--&gt;</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line">        <span class="comment">// å¦‚æœä¸è®¾ç½®é»˜è®¤ä¼šè‡ªåŠ¨å¯»æ‰¾Webå·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„&quot;/login.jsp&quot;é¡µé¢</span></span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        <span class="comment">// ç™»å½•æˆåŠŸåè¦è·³è½¬çš„é“¾æ¥</span></span><br><span class="line"><span class="comment">//        shiroFilterFactoryBean.setSuccessUrl(&quot;/index&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æœªæˆæƒç•Œé¢;</span></span><br><span class="line"><span class="comment">//        shiroFilterFactoryBean.setUnauthorizedUrl(&quot;/403&quot;);</span></span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HashedCredentialsMatcher <span class="title function_">hashedCredentialsMatcher</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HashedCredentialsMatcher</span> <span class="variable">hashedCredentialsMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashedCredentialsMatcher</span>();</span><br><span class="line">        hashedCredentialsMatcher.setHashAlgorithmName(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line">        hashedCredentialsMatcher.setHashIterations(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> hashedCredentialsMatcher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(ShiroRealm shiroRealm)</span> &#123;</span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">        securityManager.setRealm(shiroRealm);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroRealm <span class="title function_">shiroRealm</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ShiroRealm</span> <span class="variable">shiroRealm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroRealm</span>();</span><br><span class="line">        shiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());</span><br><span class="line">        <span class="keyword">return</span> shiroRealm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title function_">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">AuthorizationAttributeSourceAdvisor</span> <span class="variable">authorizationAttributeSourceAdvisor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:è§£å†³æƒé™æ³¨è§£ä¸ç”Ÿæ•ˆé—®é¢˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DefaultAdvisorAutoProxyCreator <span class="title function_">getDefaultAdvisorAutoProxyCreator</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultAdvisorAutoProxyCreator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†å†…å®¹å°±æ˜¯ä¸€äº›é…ç½®ï¼Œé…ç½®äº†shiroéœ€è¦çš„bean</p><p>å€¼å¾—ä¸€æçš„æ˜¯æœ€åä¸¤ä¸ªbeanæ˜¯å¯ç”¨shiroçš„æ³¨è§£çš„ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨æ³¨è§£é…ç½®shiroçš„è¿‡ç¨‹ä¸­ä¸€å®šè¦åŠ ä¸Š</p>]]></content>
      
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> shiro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(åäº”)å¯†ç åŠ å¯†å’Œjwtè®¤è¯</title>
      <link href="/2022/09/08/go-api-practice-15/"/>
      <url>/2022/09/08/go-api-practice-15/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get golang.org/x/crypto</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/golang-jwt/jwt</span></span><br></pre></td></tr></table></figure><h1 id="å¼€å§‹ç¼–ç "><a class="markdownIt-Anchor" href="#å¼€å§‹ç¼–ç "></a> å¼€å§‹ç¼–ç </h1><h2 id="å¯†ç åŠ å¯†"><a class="markdownIt-Anchor" href="#å¯†ç åŠ å¯†"></a> å¯†ç åŠ å¯†</h2><p><code>pkg/hash/hash.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> hash</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;golang.org/x/crypto/bcrypt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BcryptHash</span><span class="params">(password <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">   bytes, err := bcrypt.GenerateFromPassword([]<span class="type">byte</span>(password), <span class="number">14</span>)</span><br><span class="line">   logger.LogIf(err)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="type">string</span>(bytes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BcryptCheck</span><span class="params">(password, hash <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   err := bcrypt.CompareHashAndPassword([]<span class="type">byte</span>(hash), []<span class="type">byte</span>(password))</span><br><span class="line">   <span class="keyword">return</span> err == <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BcryptIsHashed</span><span class="params">(str <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">len</span>(str) == <span class="number">60</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯<code>BcryptCheck()</code>å‡½æ•°çš„å‚æ•°ä½ç½®ä¸èƒ½é”™è¯¯ï¼Œå¦åˆ™å‡½æ•°å°†æ— æ³•æ­£å¸¸è¿è¡Œ</p><blockquote><p>æ·»åŠ é’©å­å‡½æ•°</p></blockquote><p><code>app/models/user/user_hooks.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/hash&quot;</span></span><br><span class="line">   <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(userModel *User)</span></span> BeforeSave(tx *gorm.DB) (err <span class="type">error</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> !hash.BcryptIsHashed(userModel.Password) &#123;</span><br><span class="line">      userModel.Password = hash.BcryptHash(userModel.Password)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†<code>gorm</code>çš„é’©å­å‡½æ•°ï¼Œæ³¨æ„å‚æ•°å’Œå‡½æ•°åéƒ½ä¸è¦å‡ºé”™</p><blockquote><p>éªŒè¯å¯†ç </p></blockquote><p><code>app/models/user/user_model.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(userModel *User)</span></span> ComparePassword(_password <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> hash.BcryptCheck(_password, userModel.Password)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•å¯†ç åŠ å¯†"><a class="markdownIt-Anchor" href="#æµ‹è¯•å¯†ç åŠ å¯†"></a> æµ‹è¯•å¯†ç åŠ å¯†</h2><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905082638470.png" alt="" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905082658293.png" alt="" /></p><p>å¯ä»¥çœ‹åˆ°å¯†ç å·²ç»è¢«åŠ å¯†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905082730346.png" alt="" /></p><h2 id="jwtæˆæƒ"><a class="markdownIt-Anchor" href="#jwtæˆæƒ"></a> jwtæˆæƒ</h2><p><code>pkg/jwt/jwt.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jwt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;errors&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   jwtpkg <span class="string">&quot;github.com/golang-jwt/jwt&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/app&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;strings&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">   ErrTokenExpired           <span class="type">error</span> = errors.New(<span class="string">&quot;ä»¤ç‰Œå·²è¿‡æœŸ&quot;</span>)</span><br><span class="line">   ErrTokenExpiredMaxRefresh <span class="type">error</span> = errors.New(<span class="string">&quot;ä»¤ç‰Œå·²è¿‡æœ€å¤§åˆ·æ–°æ—¶é—´&quot;</span>)</span><br><span class="line">   ErrTokenMalformed         <span class="type">error</span> = errors.New(<span class="string">&quot;è¯·æ±‚ä»¤ç‰Œæ ¼å¼æœ‰è¯¯&quot;</span>)</span><br><span class="line">   ErrTokenInvalid           <span class="type">error</span> = errors.New(<span class="string">&quot;è¯·æ±‚ä»¤ç‰Œæ— æ•ˆ&quot;</span>)</span><br><span class="line">   ErrHeaderEmpty            <span class="type">error</span> = errors.New(<span class="string">&quot;éœ€è¦è®¤è¯æ‰èƒ½è®¿é—®ï¼&quot;</span>)</span><br><span class="line">   ErrHeaderMalformed        <span class="type">error</span> = errors.New(<span class="string">&quot;è¯·æ±‚å¤´ä¸­ Authorization æ ¼å¼æœ‰è¯¯&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// JWT å®šä¹‰ä¸€ä¸ªjwtå¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> JWT <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ç§˜é’¥ï¼Œç”¨ä»¥åŠ å¯† JWTï¼Œè¯»å–é…ç½®ä¿¡æ¯ app.key</span></span><br><span class="line">   SignKey []<span class="type">byte</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆ·æ–° Token çš„æœ€å¤§è¿‡æœŸæ—¶é—´</span></span><br><span class="line">   MaxRefresh time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JWTCustomClaims è‡ªå®šä¹‰è½½è·</span></span><br><span class="line"><span class="keyword">type</span> JWTCustomClaims <span class="keyword">struct</span> &#123;</span><br><span class="line">   UserID       <span class="type">string</span> <span class="string">`json:&quot;user_id&quot;`</span></span><br><span class="line">   UserName     <span class="type">string</span> <span class="string">`json:&quot;user_name&quot;`</span></span><br><span class="line">   ExpireAtTime <span class="type">int64</span>  <span class="string">`json:&quot;expire_time&quot;`</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// StandardClaims ç»“æ„ä½“å®ç°äº† Claims æ¥å£ç»§æ‰¿äº†  Valid() æ–¹æ³•</span></span><br><span class="line">   <span class="comment">// JWT è§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µï¼Œæä¾›ä½¿ç”¨:</span></span><br><span class="line">   <span class="comment">// - iss (issuer)ï¼šå‘å¸ƒè€…</span></span><br><span class="line">   <span class="comment">// - sub (subject)ï¼šä¸»é¢˜</span></span><br><span class="line">   <span class="comment">// - iat (Issued At)ï¼šç”Ÿæˆç­¾åçš„æ—¶é—´</span></span><br><span class="line">   <span class="comment">// - exp (expiration time)ï¼šç­¾åè¿‡æœŸæ—¶é—´</span></span><br><span class="line">   <span class="comment">// - aud (audience)ï¼šè§‚ä¼—ï¼Œç›¸å½“äºæ¥å—è€…</span></span><br><span class="line">   <span class="comment">// - nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´</span></span><br><span class="line">   <span class="comment">// - jti (JWT ID)ï¼šç¼–å·</span></span><br><span class="line">   jwtpkg.StandardClaims</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewJWT</span><span class="params">()</span></span> *JWT &#123;</span><br><span class="line">   <span class="keyword">return</span> &amp;JWT&#123;</span><br><span class="line">      SignKey:    []<span class="type">byte</span>(config.GetString(<span class="string">&quot;app.key&quot;</span>)),</span><br><span class="line">      MaxRefresh: time.Duration(config.GetInt64(<span class="string">&quot;jwt.max_refresh_time&quot;</span>)) * time.Minute,</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ParserToken è§£æ Tokenï¼Œä¸­é—´ä»¶ä¸­è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(jwt *JWT)</span></span> ParserToken(c *gin.Context) (*JWTCustomClaims, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">   tokenString, parseErr := jwt.getTokenFromHeader(c)</span><br><span class="line">   <span class="keyword">if</span> parseErr != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, parseErr</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1. è°ƒç”¨ jwt åº“è§£æç”¨æˆ·ä¼ å‚çš„ Token</span></span><br><span class="line">   token, err := jwt.parseTokenString(tokenString)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. è§£æå‡ºé”™</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      validationErr, ok := err.(*jwtpkg.ValidationError)</span><br><span class="line">      <span class="keyword">if</span> ok &#123;</span><br><span class="line">         <span class="keyword">if</span> validationErr.Errors == jwtpkg.ValidationErrorMalformed &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>, ErrTokenMalformed</span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> validationErr.Errors == jwtpkg.ValidationErrorExpired &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>, ErrTokenExpired</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, ErrTokenInvalid</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 3. å°† token ä¸­çš„ claims ä¿¡æ¯è§£æå‡ºæ¥å’Œ JWTCustomClaims æ•°æ®ç»“æ„è¿›è¡Œæ ¡éªŒ</span></span><br><span class="line">   <span class="keyword">if</span> claims, ok := token.Claims.(*JWTCustomClaims); ok &amp;&amp; token.Valid &#123;</span><br><span class="line">      <span class="keyword">return</span> claims, <span class="literal">nil</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span>, ErrTokenInvalid</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RefreshToken æ›´æ–° Tokenï¼Œç”¨ä»¥æä¾› refresh token æ¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(jwt *JWT)</span></span> RefreshToken(c *gin.Context) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1. ä» Header é‡Œè·å– token</span></span><br><span class="line">   tokenString, parseErr := jwt.getTokenFromHeader(c)</span><br><span class="line">   <span class="keyword">if</span> parseErr != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, parseErr</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. è°ƒç”¨ jwt åº“è§£æç”¨æˆ·ä¼ å‚çš„ Token</span></span><br><span class="line">   token, err := jwt.parseTokenString(tokenString)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 3. è§£æå‡ºé”™ï¼ŒæœªæŠ¥é”™è¯æ˜æ˜¯åˆæ³•çš„ Tokenï¼ˆç”šè‡³æœªåˆ°è¿‡æœŸæ—¶é—´ï¼‰</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      validationErr, ok := err.(*jwtpkg.ValidationError)</span><br><span class="line">      <span class="comment">// æ»¡è¶³ refresh çš„æ¡ä»¶ï¼šåªæ˜¯å•ä¸€çš„æŠ¥é”™ ValidationErrorExpired</span></span><br><span class="line">      <span class="keyword">if</span> !ok || validationErr.Errors != jwtpkg.ValidationErrorExpired &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 4. è§£æ JWTCustomClaims çš„æ•°æ®</span></span><br><span class="line">   claims := token.Claims.(*JWTCustomClaims)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 5. æ£€æŸ¥æ˜¯å¦è¿‡äº†ã€æœ€å¤§å…è®¸åˆ·æ–°çš„æ—¶é—´ã€</span></span><br><span class="line">   x := app.TimenowInTimezone().Add(-jwt.MaxRefresh).Unix()</span><br><span class="line">   <span class="keyword">if</span> claims.IssuedAt &gt; x &#123;</span><br><span class="line">      <span class="comment">// ä¿®æ”¹è¿‡æœŸæ—¶é—´</span></span><br><span class="line">      claims.StandardClaims.ExpiresAt = jwt.expireAtTime()</span><br><span class="line">      <span class="keyword">return</span> jwt.createToken(*claims)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, ErrTokenExpiredMaxRefresh</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IssueToken ç”Ÿæˆ  Tokenï¼Œåœ¨ç™»å½•æˆåŠŸæ—¶è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(jwt *JWT)</span></span> IssueToken(userID <span class="type">string</span>, userName <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1. æ„é€ ç”¨æˆ· claims ä¿¡æ¯(è´Ÿè·)</span></span><br><span class="line">   expireAtTime := jwt.expireAtTime()</span><br><span class="line">   claims := JWTCustomClaims&#123;</span><br><span class="line">      userID,</span><br><span class="line">      userName,</span><br><span class="line">      expireAtTime,</span><br><span class="line">      jwtpkg.StandardClaims&#123;</span><br><span class="line">         NotBefore: app.TimenowInTimezone().Unix(), <span class="comment">// ç­¾åç”Ÿæ•ˆæ—¶é—´</span></span><br><span class="line">         IssuedAt:  app.TimenowInTimezone().Unix(), <span class="comment">// é¦–æ¬¡ç­¾åæ—¶é—´ï¼ˆåç»­åˆ·æ–° Token ä¸ä¼šæ›´æ–°ï¼‰</span></span><br><span class="line">         ExpiresAt: expireAtTime,                   <span class="comment">// ç­¾åè¿‡æœŸæ—¶é—´</span></span><br><span class="line">         Issuer:    config.GetString(<span class="string">&quot;app.name&quot;</span>),   <span class="comment">// ç­¾åé¢å‘è€…</span></span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. æ ¹æ® claims ç”Ÿæˆtokenå¯¹è±¡</span></span><br><span class="line">   token, err := jwt.createToken(claims)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.LogIf(err)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createToken åˆ›å»º Tokenï¼Œå†…éƒ¨ä½¿ç”¨ï¼Œå¤–éƒ¨è¯·è°ƒç”¨ IssueToken</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(jwt *JWT)</span></span> createToken(claims JWTCustomClaims) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">   <span class="comment">// ä½¿ç”¨HS256ç®—æ³•è¿›è¡Œtokenç”Ÿæˆ</span></span><br><span class="line">   token := jwtpkg.NewWithClaims(jwtpkg.SigningMethodHS256, claims)</span><br><span class="line">   <span class="keyword">return</span> token.SignedString(jwt.SignKey)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// expireAtTime è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(jwt *JWT)</span></span> expireAtTime() <span class="type">int64</span> &#123;</span><br><span class="line">   timenow := app.TimenowInTimezone()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> expireTime <span class="type">int64</span></span><br><span class="line">   <span class="keyword">if</span> config.GetBool(<span class="string">&quot;app.debug&quot;</span>) &#123;</span><br><span class="line">      expireTime = config.GetInt64(<span class="string">&quot;jwt.debug_expire_time&quot;</span>)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      expireTime = config.GetInt64(<span class="string">&quot;jwt.expire_time&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   expire := time.Duration(expireTime) * time.Minute</span><br><span class="line">   <span class="keyword">return</span> timenow.Add(expire).Unix()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// parseTokenString ä½¿ç”¨ jwtpkg.ParseWithClaims è§£æ Token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(jwt *JWT)</span></span> parseTokenString(tokenString <span class="type">string</span>) (*jwtpkg.Token, <span class="type">error</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> jwtpkg.ParseWithClaims(tokenString, &amp;JWTCustomClaims&#123;&#125;, <span class="function"><span class="keyword">func</span><span class="params">(token *jwtpkg.Token)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> jwt.SignKey, <span class="literal">nil</span></span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getTokenFromHeader ä½¿ç”¨ jwtpkg.ParseWithClaims è§£æ Token</span></span><br><span class="line"><span class="comment">// Authorization:Bearer xxxxx</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(jwt *JWT)</span></span> getTokenFromHeader(c *gin.Context) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">   authHeader := c.Request.Header.Get(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> authHeader == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, ErrHeaderEmpty</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// æŒ‰ç©ºæ ¼åˆ†å‰²</span></span><br><span class="line">   parts := strings.SplitN(authHeader, <span class="string">&quot; &quot;</span>, <span class="number">2</span>)</span><br><span class="line">   <span class="keyword">if</span> !(<span class="built_in">len</span>(parts) == <span class="number">2</span> &amp;&amp; parts[<span class="number">0</span>] == <span class="string">&quot;Bearer&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, ErrHeaderMalformed</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> parts[<span class="number">1</span>], <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å·¥å…·ç±»</p><blockquote><p>æ—¶åŒº</p></blockquote><p><code>pkg/app/app.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TimenowInTimezone</span><span class="params">()</span></span> time.Time &#123;</span><br><span class="line">   chinaTimezone, _ := time.LoadLocation(config.GetString(<span class="string">&quot;app.timezone&quot;</span>))</span><br><span class="line">   <span class="keyword">return</span> time.Now().In(chinaTimezone)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®ä¿¡æ¯</p></blockquote><p><code>config/jwt.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   config.Add(<span class="string">&quot;jwt&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// ä½¿ç”¨ config.GetString(&quot;app.key&quot;)</span></span><br><span class="line">         <span class="comment">// &quot;signing_key&quot;:</span></span><br><span class="line"></span><br><span class="line">         <span class="comment">// è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ˜¯åˆ†é’Ÿï¼Œä¸€èˆ¬ä¸è¶…è¿‡ä¸¤ä¸ªå°æ—¶</span></span><br><span class="line">         <span class="string">&quot;expire_time&quot;</span>: config.Env(<span class="string">&quot;JWT_EXPIRE_TIME&quot;</span>, <span class="number">120</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å…è®¸åˆ·æ–°æ—¶é—´ï¼Œå•ä½åˆ†é’Ÿï¼Œ86400 ä¸ºä¸¤ä¸ªæœˆï¼Œä» Token çš„ç­¾åæ—¶é—´ç®—èµ·</span></span><br><span class="line">         <span class="string">&quot;max_refresh_time&quot;</span>: config.Env(<span class="string">&quot;JWT_MAX_REFRESH_TIME&quot;</span>, <span class="number">86400</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// debug æ¨¡å¼ä¸‹çš„è¿‡æœŸæ—¶é—´ï¼Œæ–¹ä¾¿æœ¬åœ°å¼€å‘è°ƒè¯•</span></span><br><span class="line">         <span class="string">&quot;debug_expire_time&quot;</span>: <span class="number">86400</span>,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è·å¾—å­—ç¬¦ä¸²ID</p></blockquote><p><code>app/models/model.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a BaseModel)</span></span> GetStringID() <span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cast.ToString(a.ID)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨æ§åˆ¶å™¨ä¸­è°ƒç”¨"><a class="markdownIt-Anchor" href="#åœ¨æ§åˆ¶å™¨ä¸­è°ƒç”¨"></a> åœ¨æ§åˆ¶å™¨ä¸­è°ƒç”¨</h2><p><code>app/http/controllers/api/v1/auth/signup_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> SignupUsingPhone(c *gin.Context) &#123;</span><br><span class="line">   request := requests.SignupUsingPhoneRequest&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.SignupUsingPhone); !ok &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   userModel := user.User&#123;</span><br><span class="line">      Name:     request.Name,</span><br><span class="line">      Phone:    request.Phone,</span><br><span class="line">      Password: request.Password,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   userModel.Create()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> userModel.ID &gt; <span class="number">0</span> &#123;</span><br><span class="line">      token := jwt.NewJWT().IssueToken(userModel.GetStringID(), userModel.Name)</span><br><span class="line">      response.CreatedJSON(c, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;token&quot;</span>: token,</span><br><span class="line">         <span class="string">&quot;data&quot;</span>:  userModel,</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      response.Abort500(c, <span class="string">&quot;åˆ›å»ºç”¨æˆ·å¤±è´¥&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> SignupUsingEmail(c *gin.Context) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1. éªŒè¯è¡¨å•</span></span><br><span class="line">   request := requests.SignupUsingEmailRequest&#123;&#125;</span><br><span class="line">   <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.SignupUsingEmail); !ok &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. éªŒè¯æˆåŠŸï¼Œåˆ›å»ºæ•°æ®</span></span><br><span class="line">   userModel := user.User&#123;</span><br><span class="line">      Name:     request.Name,</span><br><span class="line">      Email:    request.Email,</span><br><span class="line">      Password: request.Password,</span><br><span class="line">   &#125;</span><br><span class="line">   userModel.Create()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> userModel.ID &gt; <span class="number">0</span> &#123;</span><br><span class="line">      token := jwt.NewJWT().IssueToken(userModel.GetStringID(), userModel.Name)</span><br><span class="line">      response.CreatedJSON(c, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;token&quot;</span>: token,</span><br><span class="line">         <span class="string">&quot;data&quot;</span>:  userModel,</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      response.Abort500(c, <span class="string">&quot;åˆ›å»ºç”¨æˆ·å¤±è´¥ï¼Œè¯·ç¨åå°è¯•~&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•jwt"><a class="markdownIt-Anchor" href="#æµ‹è¯•jwt"></a> æµ‹è¯•jwt</h2><p>æˆ‘ä»¬ç”¨ä¹‹å‰çš„APIåœ¨æ¥æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼ŒæˆåŠŸå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905083242904.png" alt="" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(åå››)é‚®ç®±å‘é€éªŒè¯ç </title>
      <link href="/2022/09/08/go-api-practice-14/"/>
      <url>/2022/09/08/go-api-practice-14/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><ul><li>å‘é€é‚®ç®±éªŒè¯ç æ—¶è¯·ç¡®ä¿å¼€å¯<code>MailHog</code></li></ul><h1 id="å¼€å§‹ç¼–ç "><a class="markdownIt-Anchor" href="#å¼€å§‹ç¼–ç "></a> å¼€å§‹ç¼–ç </h1><p>æ•´ä½“é€»è¾‘å’Œæ‰‹æœºå‘é€çŸ­ä¿¡å·®ä¸å¤š</p><h2 id="æ¥å—å‰ç«¯æ•°æ®"><a class="markdownIt-Anchor" href="#æ¥å—å‰ç«¯æ•°æ®"></a> æ¥å—å‰ç«¯æ•°æ®</h2><p><code>app/requests/signup_request.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SignupUsingEmailRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   Email           <span class="type">string</span> <span class="string">`json:&quot;email,omitempty&quot; valid:&quot;email&quot;`</span></span><br><span class="line">   VerifyCode      <span class="type">string</span> <span class="string">`json:&quot;verify_code,omitempty&quot; valid:&quot;verify_code&quot;`</span></span><br><span class="line">   Name            <span class="type">string</span> <span class="string">`valid:&quot;name&quot; json:&quot;name&quot;`</span></span><br><span class="line">   Password        <span class="type">string</span> <span class="string">`valid:&quot;password&quot; json:&quot;password,omitempty&quot;`</span></span><br><span class="line">   PasswordConfirm <span class="type">string</span> <span class="string">`valid:&quot;password_confirm&quot; json:&quot;password_confirm,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SignupUsingEmail</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>:            []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;min:4&quot;</span>, <span class="string">&quot;max:30&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;not_exists:users,email&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>:             []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;alpha_num&quot;</span>, <span class="string">&quot;between:3,20&quot;</span>, <span class="string">&quot;not_exists:users,name&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;password&quot;</span>:         []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;min:6&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;password_confirm&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;verify_code&quot;</span>:      []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:6&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:Email ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;min:Email é•¿åº¦éœ€å¤§äº 4&quot;</span>,</span><br><span class="line">         <span class="string">&quot;max:Email é•¿åº¦éœ€å°äº 30&quot;</span>,</span><br><span class="line">         <span class="string">&quot;email:Email æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€&quot;</span>,</span><br><span class="line">         <span class="string">&quot;not_exists:Email å·²è¢«å ç”¨&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:ç”¨æˆ·åä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;alpha_num:ç”¨æˆ·åæ ¼å¼é”™è¯¯ï¼Œåªå…è®¸æ•°å­—å’Œè‹±æ–‡&quot;</span>,</span><br><span class="line">         <span class="string">&quot;between:ç”¨æˆ·åé•¿åº¦éœ€åœ¨ 3~20 ä¹‹é—´&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;password&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:å¯†ç ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;min:å¯†ç é•¿åº¦éœ€å¤§äº 6&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;password_confirm&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:ç¡®è®¤å¯†ç æ¡†ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;verify_code&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:éªŒè¯ç ç­”æ¡ˆå¿…å¡«&quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:éªŒè¯ç é•¿åº¦å¿…é¡»ä¸º 6 ä½çš„æ•°å­—&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   errs := validate(data, rules, messages)</span><br><span class="line"></span><br><span class="line">   _data := data.(*SignupUsingEmailRequest)</span><br><span class="line">   errs = validators.ValidatePasswordConfirm(_data.Password, _data.PasswordConfirm, errs)</span><br><span class="line">   errs = validators.ValidateVerifyCode(_data.Email, _data.VerifyCode, errs)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> errs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶å™¨"><a class="markdownIt-Anchor" href="#æ§åˆ¶å™¨"></a> æ§åˆ¶å™¨</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SignupUsingEmail ä½¿ç”¨ Email + éªŒè¯ç è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> SignupUsingEmail(c *gin.Context) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. éªŒè¯è¡¨å•</span></span><br><span class="line">    request := requests.SignupUsingEmailRequest&#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.SignupUsingEmail); !ok &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. éªŒè¯æˆåŠŸï¼Œåˆ›å»ºæ•°æ®</span></span><br><span class="line">    userModel := user.User&#123;</span><br><span class="line">        Name:     request.Name,</span><br><span class="line">        Email:    request.Email,</span><br><span class="line">        Password: request.Password,</span><br><span class="line">    &#125;</span><br><span class="line">    userModel.Create()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> userModel.ID &gt; <span class="number">0</span> &#123;</span><br><span class="line">        response.CreatedJSON(c, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: userModel,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        response.Abort500(c, <span class="string">&quot;åˆ›å»ºç”¨æˆ·å¤±è´¥ï¼Œè¯·ç¨åå°è¯•~&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨å†Œè·¯ç”±</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">authGroup.POST(<span class="string">&quot;/signup/using-phone&quot;</span>, suc.SignupUsingPhone)</span><br><span class="line">authGroup.POST(<span class="string">&quot;/signup/using-email&quot;</span>, suc.SignupUsingEmail)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905081857051.png" alt="" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905081940831.png" alt="" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(åä¸‰)æ‰‹æœºå·å‘é€çŸ­ä¿¡éªŒè¯ç </title>
      <link href="/2022/09/08/go-api-practice-13/"/>
      <url>/2022/09/08/go-api-practice-13/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><h1 id="ç¼–ç å¼€å§‹"><a class="markdownIt-Anchor" href="#ç¼–ç å¼€å§‹"></a> ç¼–ç å¼€å§‹</h1><h2 id="æ¥å—å‰ç«¯æ•°æ®"><a class="markdownIt-Anchor" href="#æ¥å—å‰ç«¯æ•°æ®"></a> æ¥å—å‰ç«¯æ•°æ®</h2><p><code>app/requests/signup_request.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SignupUsingPhoneRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   Phone           <span class="type">string</span> <span class="string">`json:&quot;phone,omitempty&quot; valid:&quot;phone&quot;`</span></span><br><span class="line">   VerifyCode      <span class="type">string</span> <span class="string">`json:&quot;verify_code,omitempty&quot; valid:&quot;verify_code&quot;`</span></span><br><span class="line">   Name            <span class="type">string</span> <span class="string">`valid:&quot;name&quot; json:&quot;name&quot;`</span></span><br><span class="line">   Password        <span class="type">string</span> <span class="string">`valid:&quot;password&quot; json:&quot;password,omitempty&quot;`</span></span><br><span class="line">   PasswordConfirm <span class="type">string</span> <span class="string">`valid:&quot;password_confirm&quot; json:&quot;password_confirm,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SignupUsingPhone</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>:            []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:11&quot;</span>, <span class="string">&quot;not_exists:users,phone&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>:             []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;alpha_num&quot;</span>, <span class="string">&quot;between:3,20&quot;</span>, <span class="string">&quot;not_exists:users,name&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;password&quot;</span>:         []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;min:6&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;password_confirm&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;verify_code&quot;</span>:      []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:6&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:æ‰‹æœºå·ä¸ºå¿…å¡«é¡¹ï¼Œå‚æ•°åç§° phone&quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:æ‰‹æœºå·é•¿åº¦å¿…é¡»ä¸º 11 ä½çš„æ•°å­—&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:ç”¨æˆ·åä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;alpha_num:ç”¨æˆ·åæ ¼å¼é”™è¯¯ï¼Œåªå…è®¸æ•°å­—å’Œè‹±æ–‡&quot;</span>,</span><br><span class="line">         <span class="string">&quot;between:ç”¨æˆ·åé•¿åº¦éœ€åœ¨ 3~20 ä¹‹é—´&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;password&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:å¯†ç ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;min:å¯†ç é•¿åº¦éœ€å¤§äº 6&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;password_confirm&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:ç¡®è®¤å¯†ç æ¡†ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;verify_code&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:éªŒè¯ç ç­”æ¡ˆå¿…å¡«&quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:éªŒè¯ç é•¿åº¦å¿…é¡»ä¸º 6 ä½çš„æ•°å­—&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   errs := validate(data, rules, messages)</span><br><span class="line"></span><br><span class="line">   _data := data.(*SignupUsingPhoneRequest)</span><br><span class="line">   errs = validators.ValidatePasswordConfirm(_data.Password, _data.PasswordConfirm, errs)</span><br><span class="line">   errs = validators.ValidateVerifyCode(_data.Phone, _data.VerifyCode, errs)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> errs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»å‰ç«¯æ¥å—åˆ°æ•°æ®ï¼Œä¸ºäº†æ»¡è¶³æˆ‘ä»¬çš„è‡ªå®šä¹‰éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ¥æ‹“å±•éªŒè¯åŒ…</p><h2 id="è‡ªå®šä¹‰è§„åˆ™"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰è§„åˆ™"></a> è‡ªå®šä¹‰è§„åˆ™</h2><p><code>app/requests/validators/custom_rules.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> validators</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;errors&quot;</span></span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/thedevsaddam/govalidator&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/database&quot;</span></span><br><span class="line">   <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰è§„åˆ™ not_existsï¼ŒéªŒè¯è¯·æ±‚æ•°æ®å¿…é¡»ä¸å­˜åœ¨äºæ•°æ®åº“ä¸­ã€‚</span></span><br><span class="line">   <span class="comment">// å¸¸ç”¨äºä¿è¯æ•°æ®åº“æŸä¸ªå­—æ®µçš„å€¼å”¯ä¸€ï¼Œå¦‚ç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºå·ã€æˆ–è€…åˆ†ç±»çš„åç§°ã€‚</span></span><br><span class="line">   <span class="comment">// not_exists å‚æ•°å¯ä»¥æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ 2 ä¸ªå‚æ•°ï¼Œä¸€ç§æ˜¯ 3 ä¸ªå‚æ•°ï¼š</span></span><br><span class="line">   <span class="comment">// not_exists:users,email æ£€æŸ¥æ•°æ®åº“è¡¨é‡Œæ˜¯å¦å­˜åœ¨åŒä¸€æ¡ä¿¡æ¯</span></span><br><span class="line">   <span class="comment">// not_exists:users,email,32 æ’é™¤ç”¨æˆ·æ‰ id ä¸º 32 çš„ç”¨æˆ·</span></span><br><span class="line">   govalidator.AddCustomRule(<span class="string">&quot;not_exists&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(field <span class="type">string</span>, rule <span class="type">string</span>, message <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">      rng := strings.Split(strings.TrimPrefix(rule, <span class="string">&quot;not_exists:&quot;</span>), <span class="string">&quot;,&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨åç§°ï¼Œå¦‚ users</span></span><br><span class="line">      tableName := rng[<span class="number">0</span>]</span><br><span class="line">      <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼Œå­—æ®µåç§°ï¼Œå¦‚ email æˆ–è€… phone</span></span><br><span class="line">      dbFiled := rng[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ’é™¤ ID</span></span><br><span class="line">      <span class="keyword">var</span> exceptID <span class="type">string</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(rng) &gt; <span class="number">2</span> &#123;</span><br><span class="line">         exceptID = rng[<span class="number">2</span>]</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç”¨æˆ·è¯·æ±‚è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">      requestValue := value.(<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ‹¼æ¥ SQL</span></span><br><span class="line">      query := database.DB.Table(tableName).Where(dbFiled+<span class="string">&quot; = ?&quot;</span>, requestValue)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœä¼ å‚ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ŒåŠ ä¸Š SQL Where è¿‡æ»¤</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(exceptID) &gt; <span class="number">0</span> &#123;</span><br><span class="line">         query.Where(<span class="string">&quot;id != ?&quot;</span>, exceptID)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">      <span class="keyword">var</span> count <span class="type">int64</span></span><br><span class="line">      query.Count(&amp;count)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éªŒè¯ä¸é€šè¿‡ï¼Œæ•°æ®åº“èƒ½æ‰¾åˆ°å¯¹åº”çš„æ•°æ®</span></span><br><span class="line">      <span class="keyword">if</span> count != <span class="number">0</span> &#123;</span><br><span class="line">         <span class="comment">// å¦‚æœæœ‰è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯çš„è¯</span></span><br><span class="line">         <span class="keyword">if</span> message != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> errors.New(message)</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// é»˜è®¤çš„é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">         <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;%v å·²è¢«å ç”¨&quot;</span>, requestValue)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// éªŒè¯é€šè¿‡</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰éªŒè¯å™¨"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰éªŒè¯å™¨"></a> è‡ªå®šä¹‰éªŒè¯å™¨</h2><p><code>app/requests/validators/custom_validators.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidatePasswordConfirm</span><span class="params">(password, passwordConfirm <span class="type">string</span>, errs <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> password != passwordConfirm &#123;</span><br><span class="line">      errs[<span class="string">&quot;password_confirm&quot;</span>] = <span class="built_in">append</span>(errs[<span class="string">&quot;password_confirm&quot;</span>], <span class="string">&quot;ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸åŒ¹é…ï¼&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> errs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ValidateVerifyCode è‡ªå®šä¹‰è§„åˆ™ï¼ŒéªŒè¯ã€æ‰‹æœº/é‚®ç®±éªŒè¯ç ã€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateVerifyCode</span><span class="params">(key, answer <span class="type">string</span>, errs <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> ok := verifycode.NewVerifyCode().CheckAnswer(key, answer); !ok &#123;</span><br><span class="line">      errs[<span class="string">&quot;verify_code&quot;</span>] = <span class="built_in">append</span>(errs[<span class="string">&quot;verify_code&quot;</span>], <span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> errs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®Œæˆæ§åˆ¶å™¨"><a class="markdownIt-Anchor" href="#å®Œæˆæ§åˆ¶å™¨"></a> å®Œæˆæ§åˆ¶å™¨</h2><p><code>app/http/controllers/api/v1/auth/signup_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SignupUsingPhone ä½¿ç”¨æ‰‹æœºå’ŒéªŒè¯ç è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> SignupUsingPhone(c *gin.Context) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. éªŒè¯è¡¨å•</span></span><br><span class="line">    request := requests.SignupUsingPhoneRequest&#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.SignupUsingPhone); !ok &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. éªŒè¯æˆåŠŸï¼Œåˆ›å»ºæ•°æ®</span></span><br><span class="line">    _user := user.User&#123;</span><br><span class="line">        Name:     request.Name,</span><br><span class="line">        Phone:    request.Phone,</span><br><span class="line">        Password: request.Password,</span><br><span class="line">    &#125;</span><br><span class="line">    _user.Create()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _user.ID &gt; <span class="number">0</span> &#123;</span><br><span class="line">        response.CreatedJSON(c, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: _user,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        response.Abort500(c, <span class="string">&quot;åˆ›å»ºç”¨æˆ·å¤±è´¥ï¼Œè¯·ç¨åå°è¯•~&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ create()æ–¹æ³•</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create åˆ›å»ºç”¨æˆ·ï¼Œé€šè¿‡ User.ID æ¥åˆ¤æ–­æ˜¯å¦åˆ›å»ºæˆåŠŸ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(userModel *User)</span></span> Create() &#123;</span><br><span class="line">    database.DB.Create(&amp;userModel)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ API</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">authGroup.POST(<span class="string">&quot;/signup/email/exist&quot;</span>, suc.IsEmailExist)</span><br><span class="line">authGroup.POST(<span class="string">&quot;/signup/using-phone&quot;</span>, suc.SignupUsingPhone)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2><p>æˆ‘ä»¬è®¾ç½®äº†å¯ä»¥è·³è¿‡éªŒè¯çš„ç‰¹æ®Šæ‰‹æœºå·ï¼Œé‡‡ç”¨è¿™ä¸ªæ‰‹æœºå·æ¥æµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„æ¥å£</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905081236101.png" alt="" /></p><p>æµ‹è¯•ä¸€ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220905081304027.png" alt="" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(åäºŒ)ç”¨é‚®ä»¶æ¥å‘é€éªŒè¯ç </title>
      <link href="/2022/09/08/go-api-practice-12/"/>
      <url>/2022/09/08/go-api-practice-12/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go install github.com/mailhog/MailHog@latest</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/jordan-wright/email</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨mailhogæ¥ä½œä¸ºé‚®ç®±æœåŠ¡å™¨</p><ul><li>SMTPç«¯å£ï¼š1025</li><li>ç½‘é¡µç«¯å£ï¼š8025</li></ul><p>æˆ‘ä»¬å†powershellä½¿ç”¨<code>MailHog</code>å‘½ä»¤å¼€å¯æœåŠ¡</p><h1 id="ç¼–ç "><a class="markdownIt-Anchor" href="#ç¼–ç "></a> ç¼–ç </h1><h2 id="å°è£…mailåŒ…"><a class="markdownIt-Anchor" href="#å°è£…mailåŒ…"></a> å°è£…mailåŒ…</h2><p>æˆ‘ä»¬ä¾ç„¶å…ˆå»å°è£…mailåŒ…</p><p><code>pkg/mail/driver_interface.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mail</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Driver <span class="keyword">interface</span> &#123;</span><br><span class="line">   Send(mail Email, config <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>) <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pkg/mail/driver_smtp.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mail</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   emailPKG <span class="string">&quot;github.com/jordan-wright/email&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;net/smtp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SMTP <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send å®ç° email.Driver interface çš„ Send æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SMTP)</span></span> Send(email Email, config <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line"></span><br><span class="line">   e := emailPKG.NewEmail()</span><br><span class="line"></span><br><span class="line">   e.From = fmt.Sprintf(<span class="string">&quot;%v &lt;%v&gt;&quot;</span>, email.From.Name, email.From.Address)</span><br><span class="line">   e.To = email.To</span><br><span class="line">   e.Bcc = email.Bcc</span><br><span class="line">   e.Cc = email.Cc</span><br><span class="line">   e.Subject = email.Subject</span><br><span class="line">   e.Text = email.Text</span><br><span class="line">   e.HTML = email.HTML</span><br><span class="line"></span><br><span class="line">   logger.DebugJSON(<span class="string">&quot;å‘é€é‚®ä»¶&quot;</span>, <span class="string">&quot;å‘ä»¶è¯¦æƒ…&quot;</span>, e)</span><br><span class="line"></span><br><span class="line">   err := e.Send(</span><br><span class="line">      fmt.Sprintf(<span class="string">&quot;%v:%v&quot;</span>, config[<span class="string">&quot;host&quot;</span>], config[<span class="string">&quot;port&quot;</span>]),</span><br><span class="line"></span><br><span class="line">      smtp.PlainAuth(</span><br><span class="line">         <span class="string">&quot;&quot;</span>,</span><br><span class="line">         config[<span class="string">&quot;username&quot;</span>],</span><br><span class="line">         config[<span class="string">&quot;password&quot;</span>],</span><br><span class="line">         config[<span class="string">&quot;host&quot;</span>],</span><br><span class="line">      ),</span><br><span class="line">   )</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;å‘é€é‚®ä»¶&quot;</span>, <span class="string">&quot;å‘ä»¶å‡ºé”™&quot;</span>, err.Error())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   logger.DebugString(<span class="string">&quot;å‘é€é‚®ä»¶&quot;</span>, <span class="string">&quot;å‘ä»¶æˆåŠŸ&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°äº†æ¥å£</p><p><code>pkg/mail/mail.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mail</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> From <span class="keyword">struct</span> &#123;</span><br><span class="line">   Address <span class="type">string</span></span><br><span class="line">   Name    <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Email <span class="keyword">struct</span> &#123;</span><br><span class="line">   From    From</span><br><span class="line">   To      []<span class="type">string</span></span><br><span class="line">   Bcc     []<span class="type">string</span> <span class="comment">//å¯†é€</span></span><br><span class="line">   Cc      []<span class="type">string</span> <span class="comment">//æŠ„é€</span></span><br><span class="line">   Subject <span class="type">string</span></span><br><span class="line">   Text    []<span class="type">byte</span> <span class="comment">// Plaintext message (optional)</span></span><br><span class="line">   HTML    []<span class="type">byte</span> <span class="comment">// Html message (optional)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Mailer <span class="keyword">struct</span> &#123;</span><br><span class="line">   Driver Driver</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"><span class="keyword">var</span> internalMailer *Mailer</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMailer</span><span class="params">()</span></span> *Mailer &#123;</span><br><span class="line">   once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      internalMailer = &amp;Mailer&#123;</span><br><span class="line">         Driver: &amp;SMTP&#123;&#125;,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">return</span> internalMailer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mailer *Mailer)</span></span> Send(email Email) <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> mailer.Driver.Send(email, config.GetStringMapString(<span class="string">&quot;mail.smtp&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå°è£…äº†å‘é€é‚®ä»¶çš„åŠŸèƒ½åˆ°ä¸€ä¸ª<code>Send</code>å‡½æ•°ä¸­</p><h2 id="mailé…ç½®"><a class="markdownIt-Anchor" href="#mailé…ç½®"></a> mailé…ç½®</h2><p><code>config/mail.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   config.Add(<span class="string">&quot;mail&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// é»˜è®¤æ˜¯ Mailhog çš„é…ç½®</span></span><br><span class="line">         <span class="string">&quot;smtp&quot;</span>: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>:     config.Env(<span class="string">&quot;MAIL_HOST&quot;</span>, <span class="string">&quot;localhost&quot;</span>),</span><br><span class="line">            <span class="string">&quot;port&quot;</span>:     config.Env(<span class="string">&quot;MAIL_PORT&quot;</span>, <span class="number">1025</span>),</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: config.Env(<span class="string">&quot;MAIL_USERNAME&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: config.Env(<span class="string">&quot;MAIL_PASSWORD&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">         &#125;,</span><br><span class="line"></span><br><span class="line">         <span class="string">&quot;from&quot;</span>: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">            <span class="string">&quot;address&quot;</span>: config.Env(<span class="string">&quot;MAIL_FROM_ADDRESS&quot;</span>, <span class="string">&quot;go-api-practice@example.com&quot;</span>),</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:    config.Env(<span class="string">&quot;MAIL_FROM_NAME&quot;</span>, <span class="string">&quot;Go-API-Practice&quot;</span>),</span><br><span class="line">         &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‘é€é‚®ä»¶æ¥å£"><a class="markdownIt-Anchor" href="#å‘é€é‚®ä»¶æ¥å£"></a> å‘é€é‚®ä»¶æ¥å£</h2><p>å’Œå‰é¢å‘é€çŸ­ä¿¡çš„æ¥å£ç±»ä¼¼ï¼Œæˆ‘ä»¬å»å¼€å‘è¿™ä¸ªæ¥å£</p><p><code>pkg/verifycode/verifycode.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(vc *VerifyCode)</span></span> SendEmail(email <span class="type">string</span>) <span class="type">error</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”ŸæˆéªŒè¯ç </span></span><br><span class="line">    code := vc.generateVerifyCode(email)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹ä¾¿æœ¬åœ°å’Œ API è‡ªåŠ¨æµ‹è¯•</span></span><br><span class="line">    <span class="keyword">if</span> !app.IsProduction() &amp;&amp; strings.HasSuffix(email, config.GetString(<span class="string">&quot;verifycode.debug_email_suffix&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    content := fmt.Sprintf(<span class="string">&quot;&lt;h1&gt;æ‚¨çš„ Email éªŒè¯ç æ˜¯ %v &lt;/h1&gt;&quot;</span>, code)</span><br><span class="line">    <span class="comment">// å‘é€é‚®ä»¶</span></span><br><span class="line">    mail.NewMailer().Send(mail.Email&#123;</span><br><span class="line">        From: mail.From&#123;</span><br><span class="line">            Address: config.GetString(<span class="string">&quot;mail.from.address&quot;</span>),</span><br><span class="line">            Name:    config.GetString(<span class="string">&quot;mail.from.name&quot;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">        To:      []<span class="type">string</span>&#123;email&#125;,</span><br><span class="line">        Subject: <span class="string">&quot;Email éªŒè¯ç &quot;</span>,</span><br><span class="line">        HTML:    []<span class="type">byte</span>(content),</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œæ‰‹æœºå‘é€éªŒè¯ç ç±»ä¼¼çš„ï¼Œå¯¹äºç‰¹æ®Šé‚®ç®±å¯ä»¥è·³è¿‡éªŒè¯</p><p><code>app/requests/verify_code_request.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> VerifyCodeEmailRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   CaptchaID     <span class="type">string</span> <span class="string">`json:&quot;captcha_id,omitempty&quot; valid:&quot;captcha_id&quot;`</span></span><br><span class="line">   CaptchaAnswer <span class="type">string</span> <span class="string">`json:&quot;captcha_answer,omitempty&quot; valid:&quot;captcha_answer&quot;`</span></span><br><span class="line"></span><br><span class="line">   Email <span class="type">string</span> <span class="string">`json:&quot;email,omitempty&quot; valid:&quot;email&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// VerifyCodeEmail éªŒè¯è¡¨å•ï¼Œè¿”å›é•¿åº¦ç­‰äºé›¶å³é€šè¿‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">VerifyCodeEmail</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1. å®šåˆ¶è®¤è¯è§„åˆ™</span></span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>:          []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;min:4&quot;</span>, <span class="string">&quot;max:30&quot;</span>, <span class="string">&quot;email&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;captcha_id&quot;</span>:     []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;captcha_answer&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:6&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. å®šåˆ¶é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:Email ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;min:Email é•¿åº¦éœ€å¤§äº 4&quot;</span>,</span><br><span class="line">         <span class="string">&quot;max:Email é•¿åº¦éœ€å°äº 30&quot;</span>,</span><br><span class="line">         <span class="string">&quot;email:Email æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;captcha_id&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:å›¾ç‰‡éªŒè¯ç çš„ ID ä¸ºå¿…å¡«&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;captcha_answer&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:å›¾ç‰‡éªŒè¯ç ç­”æ¡ˆå¿…å¡«&quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:å›¾ç‰‡éªŒè¯ç é•¿åº¦å¿…é¡»ä¸º 6 ä½çš„æ•°å­—&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   errs := validate(data, rules, messages)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å›¾ç‰‡éªŒè¯ç </span></span><br><span class="line">   _data := data.(*VerifyCodeEmailRequest)</span><br><span class="line">   errs = validators.ValidateCaptcha(_data.CaptchaID, _data.CaptchaAnswer, errs)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> errs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»å‰ç«¯ä¸­è¯»å–é‚®ç®±å’ŒéªŒè¯ç ï¼Œç‰¹åˆ«çš„ï¼Œç”±äºæˆ‘ä»¬éªŒè¯<code>captcha</code>éªŒè¯ç çš„ä»£ç éƒ¨åˆ†æ˜¯å…¬å…±çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹å®ƒå°è£…ä¸€å±‚</p><p><code>app/requests/validators/custom_validators.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> validators</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;go-api-practice/pkg/captcha&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateCaptcha</span><span class="params">(captchaID, captchaAnswer <span class="type">string</span>, errs <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> ok := captcha.NewCaptcha().VerifyCaptcha(captchaID, captchaAnswer); !ok &#123;</span><br><span class="line">      errs[<span class="string">&quot;captcha_answer&quot;</span>] = <span class="built_in">append</span>(errs[<span class="string">&quot;captcha_answer&quot;</span>], <span class="string">&quot;å›¾ç‰‡éªŒè¯ç é”™è¯¯&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> errs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¡ºä¾¿æŠŠæ‰‹æœºå·éªŒè¯çš„éƒ¨åˆ†ä¹Ÿä¸€å¹¶ä¿®æ”¹</p><p>æœ€åæˆ‘ä»¬å†å®Œæˆæ§åˆ¶å™¨éƒ¨åˆ†</p><p><code>app/http/controllers/api/v1/auth/verify_code_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(vc *VerifyCodeController)</span></span> SendUsingEmail(c *gin.Context) &#123;</span><br><span class="line">   request := requests.VerifyCodeEmailRequest&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.VerifyCodeEmail); !ok &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   err := verifycode.NewVerifyCode().SendEmail(request.Email)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      response.Abort500(c, <span class="string">&quot;å‘é€å¤±è´¥&quot;</span>)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      response.Success(c)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å†Œæ¥å£</p><p><code>routes/api.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vcc := <span class="built_in">new</span>(auth.VerifyCodeController)</span><br><span class="line">authGroup.POST(<span class="string">&quot;/verify-codes/captcha&quot;</span>, vcc.ShowCaptcha)</span><br><span class="line">authGroup.POST(<span class="string">&quot;/verify-codes/phone&quot;</span>, vcc.SendUsingPhone)</span><br><span class="line">authGroup.POST(<span class="string">&quot;/verify-codes/email&quot;</span>, vcc.SendUsingEmail)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2><p>åˆ›å»ºæ¥å£</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220902154100778.png" alt="" /></p><p>å¦‚æœæˆåŠŸï¼Œç»“æœå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220902154146060.png" alt="" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(åä¸€)åˆ©ç”¨é˜¿é‡Œäº‘å¹³å°å‘é€çŸ­ä¿¡</title>
      <link href="/2022/09/08/go-api-practice-11/"/>
      <url>/2022/09/08/go-api-practice-11/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/KenmyZhang/aliyun-communicate</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ­¤å¤–æˆ‘ä»¬è¿˜éœ€è¦åœ¨é˜¿é‡Œäº‘ç”³è¯·çŸ­ä¿¡æœåŠ¡å¹¶ä¸”è·å–accesskey IDå’Œaccesskey secret</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.learnku.com/uploads/images/202201/03/1/SujCwVOftn.png!large" alt="é˜¿é‡ŒçŸ­ä¿¡å¹³å°" /><img src="https://cdn.learnku.com/uploads/images/202201/03/1/k8BaDVS2Xu.png!large" alt="é˜¿é‡ŒçŸ­ä¿¡å¹³å°" /></p><h1 id="å¼€å§‹ç¼–ç "><a class="markdownIt-Anchor" href="#å¼€å§‹ç¼–ç "></a> å¼€å§‹ç¼–ç </h1><h2 id="å°è£…sms"><a class="markdownIt-Anchor" href="#å°è£…sms"></a> å°è£…sms</h2><p><code>pkg/sms/driver_interface.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sms</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Driver <span class="keyword">interface</span> &#123;</span><br><span class="line">   Send(phone <span class="type">string</span>, message Message, config <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>) <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pkg/sms/driver_aliyun.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sms</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">   aliyunsmsclient <span class="string">&quot;github.com/KenmyZhang/aliyun-communicate&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Aliyun <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Aliyun)</span></span> Send(phone <span class="type">string</span>, message Message, config <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   smsClient := aliyunsmsclient.New(<span class="string">&quot;http://dysmsapi.aliyuncs.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line">   templateParam, err := json.Marshal(message.Data)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Aliyun sms error&quot;</span>, <span class="string">&quot;json.Marshal error&quot;</span>, err.Error())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   logger.DebugJSON(<span class="string">&quot;Aliyun sms&quot;</span>, <span class="string">&quot;config&quot;</span>, config)</span><br><span class="line"></span><br><span class="line">   result, err := smsClient.Execute(</span><br><span class="line">      config[<span class="string">&quot;access_key_id&quot;</span>],</span><br><span class="line">      config[<span class="string">&quot;access_key_secret&quot;</span>],</span><br><span class="line">      phone,</span><br><span class="line">      config[<span class="string">&quot;sign_name&quot;</span>],</span><br><span class="line">      message.Template,</span><br><span class="line">      <span class="type">string</span>(templateParam),</span><br><span class="line">   )</span><br><span class="line"></span><br><span class="line">   logger.DebugJSON(<span class="string">&quot;Aliyun sms&quot;</span>, <span class="string">&quot;request&quot;</span>, smsClient.Request)</span><br><span class="line">   logger.DebugJSON(<span class="string">&quot;Aliyun sms&quot;</span>, <span class="string">&quot;result&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Aliyun sms error&quot;</span>, <span class="string">&quot;Execute error&quot;</span>, err.Error())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   resultJSON, err := json.Marshal(result)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Aliyun sms error&quot;</span>, <span class="string">&quot;json.Marshal error&quot;</span>, err.Error())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> result.IsSuccessful() &#123;</span><br><span class="line">      logger.DebugString(<span class="string">&quot;Aliyun sms&quot;</span>, <span class="string">&quot;success&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Aliyun sms&quot;</span>, <span class="string">&quot;error&quot;</span>, <span class="type">string</span>(resultJSON))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pkg/sms/sms.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sms</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">   Template <span class="type">string</span></span><br><span class="line">   Data     <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span></span><br><span class="line">   Content  <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SMS <span class="keyword">struct</span> &#123;</span><br><span class="line">   Driver Driver</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> internalSMS *SMS</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSMS</span><span class="params">()</span></span> *SMS &#123;</span><br><span class="line">   once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      internalSMS = &amp;SMS&#123;</span><br><span class="line">         Driver: &amp;Aliyun&#123;&#125;,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">return</span> internalSMS</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sms *SMS)</span></span> Send(phone <span class="type">string</span>, message Message) <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> sms.Driver.Send(phone, message, config.GetStringMapString(<span class="string">&quot;sms.aliyun&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæŠŠé˜¿é‡Œäº‘çš„smsåŒ…å°è£…æˆä¸€ä¸ª<code>Send</code>å‡½æ•°</p><h2 id="éªŒè¯æ‰‹æœºéªŒè¯ç "><a class="markdownIt-Anchor" href="#éªŒè¯æ‰‹æœºéªŒè¯ç "></a> éªŒè¯æ‰‹æœºéªŒè¯ç </h2><p>åœ¨è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬è¦æ³¨æ„åœ¨æ•´ä¸ªç”¨æ‰‹æœºå‘é€çŸ­ä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„éªŒè¯ç ï¼Œç”±<code>captcha</code>ç”Ÿæˆçš„éªŒè¯ç å’Œæ‰‹æœºå‘é€çš„éªŒè¯ç ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ¥å®ŒæˆéªŒè¯æ‰‹æœºéªŒè¯ç çš„é€»è¾‘</p><p><code>pkg/verifycode/store_interface.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> verifycode</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Store <span class="keyword">interface</span> &#123;</span><br><span class="line">   Set(id <span class="type">string</span>, value <span class="type">string</span>) <span class="type">bool</span></span><br><span class="line">   Get(id <span class="type">string</span>, clear <span class="type">bool</span>) <span class="type">string</span></span><br><span class="line">   Verify(id, answer <span class="type">string</span>, clear <span class="type">bool</span>) <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„éªŒè¯ç ï¼Œä½†æ˜¯å¤„ç†é€»è¾‘æ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œçš„æ¥å£å’Œ<code>captcha</code>ä¸­çš„<code>Store</code>å®é™…ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°è¿™ä¸ªæ¥å£</p><p><code>pkg/verifycode/store_redis.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> verifycode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/app&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/redis&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RedisStore <span class="keyword">struct</span> &#123;</span><br><span class="line">   RedisClient *redis.RedisClient</span><br><span class="line">   keyPrefix   <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *RedisStore)</span></span> Set(key <span class="type">string</span>, value <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   ExpireTime := time.Minute * time.Duration(config.GetInt64(<span class="string">&quot;verifycode.expire_time&quot;</span>))</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> app.IsLocal() &#123;</span><br><span class="line">      ExpireTime = time.Minute * time.Duration(config.GetInt64(<span class="string">&quot;verifycode.debug.expire_time&quot;</span>))</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> s.RedisClient.Set(s.keyPrefix+key, value, ExpireTime)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *RedisStore)</span></span> Get(key <span class="type">string</span>, clear <span class="type">bool</span>) (value <span class="type">string</span>) &#123;</span><br><span class="line">   key = s.keyPrefix + key</span><br><span class="line">   val := s.RedisClient.Get(key)</span><br><span class="line">   <span class="keyword">if</span> clear &#123;</span><br><span class="line">      s.RedisClient.Del(key)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *RedisStore)</span></span> Verify(key <span class="type">string</span>, answer <span class="type">string</span>, clear <span class="type">bool</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   value := s.Get(key, clear)</span><br><span class="line">   <span class="keyword">return</span> value == answer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä¸<code>captcha</code>ä¸­çš„é€»è¾‘åŸºæœ¬ä¸€è‡´ï¼Œæœ€åå†æŠŠè¿™äº›å‡½æ•°å°è£…åˆ°ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„åŒ…ä¸­</p><p><code>pkg/verifycode/verifycode.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> verifycode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;go-api-practice/helpers&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/app&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/redis&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/sms&quot;</span></span><br><span class="line">   <span class="string">&quot;strings&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> VerifyCode <span class="keyword">struct</span> &#123;</span><br><span class="line">   Store Store</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"><span class="keyword">var</span> internalVerifyCode *VerifyCode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewVerifyCode</span><span class="params">()</span></span> *VerifyCode &#123;</span><br><span class="line">   once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      internalVerifyCode = &amp;VerifyCode&#123;</span><br><span class="line">         Store: &amp;RedisStore&#123;</span><br><span class="line">            RedisClient: redis.Redis,</span><br><span class="line">            keyPrefix:   config.GetString(<span class="string">&quot;app.name&quot;</span>) + <span class="string">&quot;:verifycode:&quot;</span>,</span><br><span class="line">         &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">return</span> internalVerifyCode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(vc *VerifyCode)</span></span> SendSMS(phone <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   code := vc.generateVerifyCode(phone)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> !app.IsProduction() &amp;&amp; strings.HasPrefix(phone, config.GetString(<span class="string">&quot;verifycode.debug_phone_prefix&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> sms.NewSMS().Send(phone, sms.Message&#123;</span><br><span class="line">      Template: config.GetString(<span class="string">&quot;sms.aliyun.template_code&quot;</span>),</span><br><span class="line">      Data: <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;code&quot;</span>: code,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(vc *VerifyCode)</span></span> CheckAnswer(key <span class="type">string</span>, answer <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   logger.DebugJSON(<span class="string">&quot;éªŒè¯ç &quot;</span>, <span class="string">&quot;æ£€æŸ¥éªŒè¯ç &quot;</span>, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;key: answer&#125;)</span><br><span class="line">   <span class="keyword">if</span> !app.IsProduction() &amp;&amp;</span><br><span class="line">      (strings.HasSuffix(key, config.GetString(<span class="string">&quot;verifycode.debug_email_suffix&quot;</span>)) ||</span><br><span class="line">         strings.HasPrefix(key, config.GetString(<span class="string">&quot;verifycode.debug_phone_prefix&quot;</span>))) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> vc.Store.Verify(key, answer, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(vc *VerifyCode)</span></span> generateVerifyCode(key <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">   code := helpers.RandomNumber(config.GetInt(<span class="string">&quot;verifycode.code_length&quot;</span>))</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> app.IsLocal() &#123;</span><br><span class="line">      code = config.GetString(<span class="string">&quot;verifycode.debug_code&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   logger.DebugJSON(<span class="string">&quot;éªŒè¯ç &quot;</span>, <span class="string">&quot;ç”ŸæˆéªŒè¯ç &quot;</span>, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;key: code&#125;)</span><br><span class="line"></span><br><span class="line">   vc.Store.Set(key, code)</span><br><span class="line">   <span class="keyword">return</span> code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !app.IsProduction() &amp;&amp;</span><br><span class="line">(strings.HasSuffix(key, config.GetString(<span class="string">&quot;verifycode.debug_email_suffix&quot;</span>)) ||</span><br><span class="line"> strings.HasPrefix(key, config.GetString(<span class="string">&quot;verifycode.debug_phone_prefix&quot;</span>))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å‰é¢éªŒè¯<code>captcha</code>ç±»ä¼¼ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹äºç‰¹æ®Šçš„é‚®ç®±å’Œæ‰‹æœºå·ï¼Œæˆ‘ä»¬ç›´æ¥æ”¾è¡Œ</p><h2 id="éªŒè¯captchaéªŒè¯ç "><a class="markdownIt-Anchor" href="#éªŒè¯captchaéªŒè¯ç "></a> éªŒè¯captchaéªŒè¯ç </h2><p>åˆšåˆšæˆ‘ä»¬å·²ç»æè¿‡äº†ï¼Œæˆ‘ä»¬é™¤äº†éªŒè¯æ‰‹æœºéªŒè¯ç ï¼Œè¿˜è¦éªŒè¯<code>captcha</code>éªŒè¯ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/thedevsaddam/govalidator&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/captcha&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> VerifyCodePhoneRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   CaptchaID     <span class="type">string</span> <span class="string">`json:&quot;captcha_id,omitempty&quot; valid:&quot;captcha_id&quot;`</span></span><br><span class="line">   CaptchaAnswer <span class="type">string</span> <span class="string">`json:&quot;captcha_answer,omitempty&quot; valid:&quot;captcha_answer&quot;`</span></span><br><span class="line"></span><br><span class="line">   Phone <span class="type">string</span> <span class="string">`json:&quot;phone,omitempty&quot; valid:&quot;phone&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">VerifyCodePhone</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;captcha_id&quot;</span>:     []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;captcha_answer&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:6&quot;</span>&#125;,</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>:          []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:11&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;captcha_id&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:è¯·è¾“å…¥éªŒè¯ç &quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;captcha_answer&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:è¯·è¾“å…¥éªŒè¯ç &quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:éªŒè¯ç é•¿åº¦å¿…é¡»æ˜¯6ä½&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:è¯·è¾“å…¥æ‰‹æœºå·&quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:æ‰‹æœºå·é•¿åº¦å¿…é¡»æ˜¯11ä½&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line">   errs := validate(data, rules, messages)</span><br><span class="line"></span><br><span class="line">   _data := data.(*VerifyCodePhoneRequest)</span><br><span class="line">   <span class="keyword">if</span> ok := captcha.NewCaptcha().VerifyCaptcha(_data.CaptchaID, _data.CaptchaAnswer); !ok &#123;</span><br><span class="line">      errs[<span class="string">&quot;captcha_answer&quot;</span>] = <span class="built_in">append</span>(errs[<span class="string">&quot;captcha_answer&quot;</span>], <span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> errs</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»å‰ç«¯æ¥å—éªŒè¯ç å’Œæ‰‹æœºå·å¹¶ä¸”éªŒè¯å®ƒä»¬</p><h2 id="å®Œæˆæ§åˆ¶å™¨"><a class="markdownIt-Anchor" href="#å®Œæˆæ§åˆ¶å™¨"></a> å®Œæˆæ§åˆ¶å™¨</h2><p>åœ¨æˆ‘ä»¬å®Œæˆä¹‹å‰çš„å·¥å…·åŒ…ä¹‹åï¼Œæ§åˆ¶å™¨å°±å˜å¾—ç®€æ´äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(vc *VerifyCodeController)</span></span> SendUsingPhone(c *gin.Context) &#123;</span><br><span class="line">   request := requests.VerifyCodePhoneRequest&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.VerifyCodePhone); !ok &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok := verifycode.NewVerifyCode().SendSMS(request.Phone); !ok &#123;</span><br><span class="line">      response.Abort500(c, <span class="string">&quot;å‘é€å¤±è´¥&quot;</span>)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      response.Success(c)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬åœ¨è·¯ç”±ä¸­æ³¨å†Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vcc := <span class="built_in">new</span>(auth.VerifyCodeController)</span><br><span class="line">authGroup.POST(<span class="string">&quot;/verify-codes/captcha&quot;</span>, vcc.ShowCaptcha)</span><br><span class="line">authGroup.POST(<span class="string">&quot;/verify-codes/phone&quot;</span>, vcc.SendUsingPhone)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2><p>æˆ‘ä»¬åœ¨apifoxä¸­åˆ›å»ºæ¥å£ï¼Œçœ‹çœ‹çŸ­ä¿¡èƒ½å¦å‘é€æˆåŠŸ</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220902140331279.png" alt="" /></p><p>æˆåŠŸç»“æœå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220902140538586.png" alt="" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(å)ç»Ÿä¸€è¿”å›æ ¼å¼</title>
      <link href="/2022/09/08/go-api-practice-10/"/>
      <url>/2022/09/08/go-api-practice-10/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–°å»ºresponseåŒ…å°è£…è¿”å›å†…å®¹"><a class="markdownIt-Anchor" href="#æ–°å»ºresponseåŒ…å°è£…è¿”å›å†…å®¹"></a> æ–°å»ºresponseåŒ…å°è£…è¿”å›å†…å®¹</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> response</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JSON</span><span class="params">(c *gin.Context, data <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   c.JSON(http.StatusOK, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Success</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">   JSON(c, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Data</span><span class="params">(c *gin.Context, data <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   JSON(c, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;data&quot;</span>:    data,</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Created</span><span class="params">(c *gin.Context, data <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   c.JSON(http.StatusCreated, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;data&quot;</span>:    data,</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreatedJSON</span><span class="params">(c *gin.Context, data <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   c.JSON(http.StatusCreated, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abort404</span><span class="params">(c *gin.Context, msg ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   c.AbortWithStatusJSON(http.StatusNotFound, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: defaultMessage(<span class="string">&quot;Not Found&quot;</span>, msg...),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abort403</span><span class="params">(c *gin.Context, msg ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   c.AbortWithStatusJSON(http.StatusForbidden, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: defaultMessage(<span class="string">&quot;Forbidden&quot;</span>, msg...),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abort500</span><span class="params">(c *gin.Context, msg ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   c.AbortWithStatusJSON(http.StatusInternalServerError, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: defaultMessage(<span class="string">&quot;Internal Server Error&quot;</span>, msg...),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BadRequest</span><span class="params">(c *gin.Context, err <span class="type">error</span>, msg ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   logger.LogIf(err)</span><br><span class="line">   c.AbortWithStatusJSON(http.StatusBadRequest, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: defaultMessage(<span class="string">&quot;Bad Request&quot;</span>, msg...),</span><br><span class="line">      <span class="string">&quot;error&quot;</span>:   err.Error(),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Error</span><span class="params">(c *gin.Context, err <span class="type">error</span>, msg ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   logger.LogIf(err)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> err == gorm.ErrRecordNotFound &#123;</span><br><span class="line">      Abort404(c)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: defaultMessage(<span class="string">&quot;Internal Server Error&quot;</span>, msg...),</span><br><span class="line">      <span class="string">&quot;error&quot;</span>:   err.Error(),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidationError</span><span class="params">(c *gin.Context, errors <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Validation Error&quot;</span>,</span><br><span class="line">      <span class="string">&quot;errors&quot;</span>:  errors,</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unauthorized</span><span class="params">(c *gin.Context, msg ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   c.AbortWithStatusJSON(http.StatusUnauthorized, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: defaultMessage(<span class="string">&quot;Unauthorized&quot;</span>, msg...),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">defaultMessage</span><span class="params">(defaultMsg <span class="type">string</span>, msg ...<span class="type">string</span>)</span></span> (message <span class="type">string</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(msg) == <span class="number">0</span> &#123;</span><br><span class="line">      message = defaultMsg</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      message = msg[<span class="number">0</span>]</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬å†æŠŠå‰é¢çš„è¿”å›å†…å®¹æ”¹æˆæ–°çš„å‡½æ•°ï¼Œè¿™ä¸€éƒ¨åˆ†å°±ä½œä¸ºè¯¾åå†…å®¹ç”±ä½ ä»¬è‡ªå·±å®Œæˆ(ä¸ä¿®æ”¹ä¹Ÿä¸ä¼šå½±å“æ­£å¸¸ä½¿ç”¨)</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(ä¹)ä½¿ç”¨rediså’Œcaptcha</title>
      <link href="/2022/09/08/go-api-practice-9/"/>
      <url>/2022/09/08/go-api-practice-9/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/go-redis/redis/v8</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/mojocn/base64Captcha</span></span><br></pre></td></tr></table></figure><h1 id="å¼€å§‹ç¼–ç "><a class="markdownIt-Anchor" href="#å¼€å§‹ç¼–ç "></a> å¼€å§‹ç¼–ç </h1><h2 id="redisåŒ…"><a class="markdownIt-Anchor" href="#redisåŒ…"></a> redisåŒ…</h2><p><code>pkg/redis/redis.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;context&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RedisClient <span class="keyword">struct</span> &#123;</span><br><span class="line">   Client  *redis.Client</span><br><span class="line">   Context context.Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once sync.Once </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Redis *RedisClient</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConnectRedis</span><span class="params">(address <span class="type">string</span>, username <span class="type">string</span>, password <span class="type">string</span>, db <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;<span class="comment">//ç¡®ä¿å‡½æ•°åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">      Redis = NewClient(address, username, password, db)</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewClient</span><span class="params">(address <span class="type">string</span>, username <span class="type">string</span>, password <span class="type">string</span>, db <span class="type">int</span>)</span></span> *RedisClient &#123;</span><br><span class="line">   rds := &amp;RedisClient&#123;&#125;</span><br><span class="line">   rds.Context = context.Background()</span><br><span class="line">   rds.Client = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">      Addr:     address,</span><br><span class="line">      Username: username,</span><br><span class="line">      Password: password,</span><br><span class="line">      DB:       db,</span><br><span class="line">   &#125;)</span><br><span class="line">   err := rds.Ping()</span><br><span class="line">   logger.LogIf(err)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> rds</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> Ping() <span class="type">error</span> &#123;</span><br><span class="line">   _, err := rds.Client.Ping(rds.Context).Result()</span><br><span class="line">   <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> Set(key <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;, expiration time.Duration) <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> err := rds.Client.Set(rds.Context, key, value, expiration).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.LogIf(err)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> Get(key <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">   result, err := rds.Client.Get(rds.Context, key).Result()</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err != redis.Nil &#123;</span><br><span class="line">         logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Get&quot;</span>, err.Error())</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> Del(key ...<span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> err := rds.Client.Del(rds.Context, key...).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Del&quot;</span>, err.Error())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> Has(key <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   _, err := rds.Client.Get(rds.Context, key).Result()</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> err != redis.Nil &#123;</span><br><span class="line">         logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Has&quot;</span>, err.Error())</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> FlushDB() <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> err := rds.Client.FlushDB(rds.Context).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;FlushDB&quot;</span>, err.Error())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> Increment(parameters ...<span class="keyword">interface</span>&#123;&#125;) <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">switch</span> <span class="built_in">len</span>(parameters) &#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      key := parameters[<span class="number">0</span>].(<span class="type">string</span>)</span><br><span class="line">      <span class="keyword">if</span> err := rds.Client.Incr(rds.Context, key).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Increment&quot;</span>, err.Error())</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">   <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      key := parameters[<span class="number">0</span>].(<span class="type">string</span>)</span><br><span class="line">      value := parameters[<span class="number">1</span>].(<span class="type">int64</span>)</span><br><span class="line">      <span class="keyword">if</span> err := rds.Client.IncrBy(rds.Context, key, value).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Increment&quot;</span>, err.Error())</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Increment&quot;</span>, <span class="string">&quot;parameters error&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rds RedisClient)</span></span> Decrement(parameters ...<span class="keyword">interface</span>&#123;&#125;) <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">switch</span> <span class="built_in">len</span>(parameters) &#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      key := parameters[<span class="number">0</span>].(<span class="type">string</span>)</span><br><span class="line">      <span class="keyword">if</span> err := rds.Client.Decr(rds.Context, key).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Decrement&quot;</span>, err.Error())</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">   <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      key := parameters[<span class="number">0</span>].(<span class="type">string</span>)</span><br><span class="line">      value := parameters[<span class="number">1</span>].(<span class="type">int64</span>)</span><br><span class="line">      <span class="keyword">if</span> err := rds.Client.DecrBy(rds.Context, key, value).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Decrement&quot;</span>, err.Error())</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">      logger.ErrorString(<span class="string">&quot;Redis&quot;</span>, <span class="string">&quot;Decrement&quot;</span>, <span class="string">&quot;parameters error&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹redisåŒ…ä¸­çš„rediså‡½æ•°è¿›è¡Œäº†å°è£…å¹¶ä¸”æ·»åŠ äº†æ—¥å¿—</p><h2 id="redisçš„é…ç½®"><a class="markdownIt-Anchor" href="#redisçš„é…ç½®"></a> redisçš„é…ç½®</h2><p><code>config/redis.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   config.Add(<span class="string">&quot;redis&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line">         <span class="string">&quot;host&quot;</span>:     config.Env(<span class="string">&quot;REDIS_HOST&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>),</span><br><span class="line">         <span class="string">&quot;port&quot;</span>:     config.Env(<span class="string">&quot;REDIS_PORT&quot;</span>, <span class="string">&quot;6379&quot;</span>),</span><br><span class="line">         <span class="string">&quot;password&quot;</span>: config.Env(<span class="string">&quot;REDIS_PASSWORD&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// ä¸šåŠ¡ç±»å­˜å‚¨ä½¿ç”¨ 1 (å›¾ç‰‡éªŒè¯ç ã€çŸ­ä¿¡éªŒè¯ç ã€ä¼šè¯)</span></span><br><span class="line">         <span class="string">&quot;database&quot;</span>: config.Env(<span class="string">&quot;REDIS_MAIN_DB&quot;</span>, <span class="number">1</span>),</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="captchaåŒ…"><a class="markdownIt-Anchor" href="#captchaåŒ…"></a> captchaåŒ…</h2><p>base64Captchaå†…ç½®äº†ä¸€ä¸ªå†…å­˜å‚¨å­˜ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç”¨rediså®ç°å®ƒçš„å‚¨å­˜æ¥å£ï¼Œå…ˆå®ŒæˆcaptchaåŒ…ï¼Œç„¶åå†å®ç°æ¥å£</p><p><code>pkg/captcha/captcha.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> captcha</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/mojocn/base64Captcha&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/app&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/redis&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Captcha <span class="keyword">struct</span> &#123;</span><br><span class="line">   Base64Captcha *base64Captcha.Captcha</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> internalCaptcha *Captcha</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCaptcha</span><span class="params">()</span></span> *Captcha &#123;</span><br><span class="line">   once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      internalCaptcha = &amp;Captcha&#123;&#125;</span><br><span class="line"></span><br><span class="line">      store := RedisStore&#123;</span><br><span class="line">         RedisClient: redis.Redis,</span><br><span class="line">         KeyPrefix:   config.GetString(<span class="string">&quot;app.name&quot;</span>) + <span class="string">&quot;:captcha:&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// é…ç½® base64Captcha é©±åŠ¨ä¿¡æ¯</span></span><br><span class="line">      driver := base64Captcha.NewDriverDigit(</span><br><span class="line">         config.GetInt(<span class="string">&quot;captcha.height&quot;</span>),      <span class="comment">// å®½</span></span><br><span class="line">         config.GetInt(<span class="string">&quot;captcha.width&quot;</span>),       <span class="comment">// é«˜</span></span><br><span class="line">         config.GetInt(<span class="string">&quot;captcha.length&quot;</span>),      <span class="comment">// é•¿åº¦</span></span><br><span class="line">         config.GetFloat64(<span class="string">&quot;captcha.maxskew&quot;</span>), <span class="comment">// æ•°å­—çš„æœ€å¤§å€¾æ–œè§’åº¦</span></span><br><span class="line">         config.GetInt(<span class="string">&quot;captcha.dotcount&quot;</span>),    <span class="comment">// å›¾ç‰‡èƒŒæ™¯é‡Œçš„æ··æ·†ç‚¹æ•°é‡</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      internalCaptcha.Base64Captcha = base64Captcha.NewCaptcha(driver, &amp;store)</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> internalCaptcha</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Captcha)</span></span> GenerateCaptcha() (<span class="type">string</span>, <span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> c.Base64Captcha.Generate()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// VerifyCaptcha éªŒè¯éªŒè¯ç æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Captcha)</span></span> VerifyCaptcha(id <span class="type">string</span>, answer <span class="type">string</span>) (match <span class="type">bool</span>) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ–¹ä¾¿æœ¬åœ°å’Œ API è‡ªåŠ¨æµ‹è¯•</span></span><br><span class="line">   <span class="keyword">if</span> !app.IsProduction() &amp;&amp; id == config.GetString(<span class="string">&quot;captcha.testing_key&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯éªŒè¯åæ˜¯å¦åˆ é™¤ï¼Œæˆ‘ä»¬é€‰æ‹© false</span></span><br><span class="line">   <span class="comment">// è¿™æ ·æ–¹ä¾¿ç”¨æˆ·å¤šæ¬¡æäº¤ï¼Œé˜²æ­¢è¡¨å•æäº¤é”™è¯¯éœ€è¦å¤šæ¬¡è¾“å…¥å›¾ç‰‡éªŒè¯ç </span></span><br><span class="line">   <span class="keyword">return</span> c.Base64Captcha.Verify(id, answer, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¦å»å®ç°captchaçš„å‚¨å­˜æ¥å£ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªæ¥å£çš„å†…å®¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCaptcha</span><span class="params">(driver Driver, store Store)</span></span> *Captcha &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Captcha&#123;Driver: driver, Store: store&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Store <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// Set sets the digits for the captcha id.</span></span><br><span class="line">Set(id <span class="type">string</span>, value <span class="type">string</span>) <span class="type">error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Get returns stored digits for the captcha id. Clear indicates</span></span><br><span class="line"><span class="comment">// whether the captcha must be deleted from the store.</span></span><br><span class="line">Get(id <span class="type">string</span>, clear <span class="type">bool</span>) <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Verify captcha&#x27;s answer directly</span></span><br><span class="line">Verify(id, answer <span class="type">string</span>, clear <span class="type">bool</span>) <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸‰ä¸ªå‡½æ•°</p><p><code>pkg/captcha/store_redis.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> captcha</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;errors&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/redis&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/app&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RedisStore <span class="keyword">struct</span> &#123;</span><br><span class="line">   RedisClient *redis.RedisClient</span><br><span class="line">   KeyPrefix   <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *RedisStore)</span></span> Set(key <span class="type">string</span>, value <span class="type">string</span>) <span class="type">error</span> &#123;</span><br><span class="line">   ExpireTime := time.Minute * time.Duration(config.GetInt64(<span class="string">&quot;captcha.expire_time&quot;</span>))</span><br><span class="line">   <span class="keyword">if</span> app.IsLocal() &#123;</span><br><span class="line">      ExpireTime = time.Minute * time.Duration(config.GetInt64(<span class="string">&quot;captcha.debug_expire_time&quot;</span>))</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok := s.RedisClient.Set(s.KeyPrefix+key, value, ExpireTime); !ok &#123;</span><br><span class="line">      <span class="keyword">return</span> errors.New(<span class="string">&quot;æ— æ³•å­˜å‚¨å›¾ç‰‡éªŒè¯ç ç­”æ¡ˆ&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *RedisStore)</span></span> Get(key <span class="type">string</span>, clear <span class="type">bool</span>) <span class="type">string</span> &#123;</span><br><span class="line">   key = s.KeyPrefix + key</span><br><span class="line">   val := s.RedisClient.Get(key)</span><br><span class="line">   <span class="keyword">if</span> clear &#123;</span><br><span class="line">      s.RedisClient.Del(key)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *RedisStore)</span></span> Verify(key, answer <span class="type">string</span>, clear <span class="type">bool</span>) <span class="type">bool</span> &#123;</span><br><span class="line">   v := s.Get(key, clear)</span><br><span class="line">   <span class="keyword">return</span> v == answer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªå‰ç¼€keyæ¥æé«˜å®‰å…¨æ€§</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹ä¾¿æœ¬åœ°å’Œ API è‡ªåŠ¨æµ‹è¯•</span></span><br><span class="line"><span class="keyword">if</span> !app.IsProduction() &amp;&amp; id == config.GetString(<span class="string">&quot;captcha.testing_key&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨APIçš„æµ‹è¯•è¿‡ç¨‹ä¸­æ¥å›è¾“å…¥éªŒè¯ç ä¸å¤ªæ–¹ä¾¿ï¼Œæ‰€ä»¥å¯¹äºAPIæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒç›´æ¥é€šè¿‡</p><h2 id="captchaé…ç½®"><a class="markdownIt-Anchor" href="#captchaé…ç½®"></a> captchaé…ç½®</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   config.Add(<span class="string">&quot;captcha&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// éªŒè¯ç å›¾ç‰‡é«˜åº¦</span></span><br><span class="line">         <span class="string">&quot;height&quot;</span>: <span class="number">80</span>,</span><br><span class="line"></span><br><span class="line">         <span class="comment">// éªŒè¯ç å›¾ç‰‡å®½åº¦</span></span><br><span class="line">         <span class="string">&quot;width&quot;</span>: <span class="number">240</span>,</span><br><span class="line"></span><br><span class="line">         <span class="comment">// éªŒè¯ç çš„é•¿åº¦</span></span><br><span class="line">         <span class="string">&quot;length&quot;</span>: <span class="number">6</span>,</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æ•°å­—çš„æœ€å¤§å€¾æ–œè§’åº¦</span></span><br><span class="line">         <span class="string">&quot;maxskew&quot;</span>: <span class="number">0.7</span>,</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å›¾ç‰‡èƒŒæ™¯é‡Œçš„æ··æ·†ç‚¹æ•°é‡</span></span><br><span class="line">         <span class="string">&quot;dotcount&quot;</span>: <span class="number">80</span>,</span><br><span class="line"></span><br><span class="line">         <span class="comment">// è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ˜¯åˆ†é’Ÿ</span></span><br><span class="line">         <span class="string">&quot;expire_time&quot;</span>: <span class="number">15</span>,</span><br><span class="line"></span><br><span class="line">         <span class="comment">// debug æ¨¡å¼ä¸‹çš„è¿‡æœŸæ—¶é—´ï¼Œæ–¹ä¾¿æœ¬åœ°å¼€å‘è°ƒè¯•</span></span><br><span class="line">         <span class="string">&quot;debug_expire_time&quot;</span>: <span class="number">10080</span>,</span><br><span class="line"></span><br><span class="line">         <span class="comment">// é production ç¯å¢ƒï¼Œä½¿ç”¨æ­¤ key å¯è·³è¿‡éªŒè¯ï¼Œæ–¹ä¾¿æµ‹è¯•</span></span><br><span class="line">         <span class="string">&quot;testing_key&quot;</span>: <span class="string">&quot;captcha_skip_test&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å›¾ç‰‡éªŒè¯ç æ¥å£"><a class="markdownIt-Anchor" href="#å›¾ç‰‡éªŒè¯ç æ¥å£"></a> å›¾ç‰‡éªŒè¯ç æ¥å£</h2><p><code>app/http/controllers/api/v1/auth/verify_code_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> auth</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">v1 <span class="string">&quot;go-api-practice/app/http/controllers/api/v1&quot;</span></span><br><span class="line"><span class="string">&quot;go-api-practice/app/requests&quot;</span></span><br><span class="line"><span class="string">&quot;go-api-practice/pkg/captcha&quot;</span></span><br><span class="line"><span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line"><span class="string">&quot;go-api-practice/pkg/response&quot;</span></span><br><span class="line"><span class="string">&quot;go-api-practice/pkg/verifycode&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// VerifyCodeController ç”¨æˆ·æ§åˆ¶å™¨</span></span><br><span class="line"><span class="keyword">type</span> VerifyCodeController <span class="keyword">struct</span> &#123;</span><br><span class="line">    v1.BaseAPIController</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ShowCaptcha æ˜¾ç¤ºå›¾ç‰‡éªŒè¯ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(vc *VerifyCodeController)</span></span> ShowCaptcha(c *gin.Context) &#123;</span><br><span class="line">    <span class="comment">// ç”ŸæˆéªŒè¯ç </span></span><br><span class="line">    id, b64s, err := captcha.NewCaptcha().GenerateCaptcha()</span><br><span class="line">    <span class="comment">// è®°å½•é”™è¯¯æ—¥å¿—ï¼Œå› ä¸ºéªŒè¯ç æ˜¯ç”¨æˆ·çš„å…¥å£ï¼Œå‡ºé”™æ—¶åº”è¯¥è®° error ç­‰çº§çš„æ—¥å¿—</span></span><br><span class="line">    logger.LogIf(err)</span><br><span class="line">    <span class="comment">// è¿”å›ç»™ç”¨æˆ·</span></span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;captcha_id&quot;</span>:    id,</span><br><span class="line">        <span class="string">&quot;captcha_image&quot;</span>: b64s,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å†æ³¨å†Œè·¯ç”±æ—¢å¯ä»¥äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘é€éªŒè¯ç </span></span><br><span class="line">vcc := <span class="built_in">new</span>(auth.VerifyCodeController)</span><br><span class="line"><span class="comment">// å›¾ç‰‡éªŒè¯ç ï¼Œéœ€è¦åŠ é™æµ</span></span><br><span class="line">authGroup.POST(<span class="string">&quot;/verify-codes/captcha&quot;</span>, vcc.ShowCaptcha)</span><br></pre></td></tr></table></figure><h1 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h1><p>åœ¨apifoxä¸­å»ºç«‹æ¥å£</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220902104858480.png" alt="" /></p><p>æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220902104946511.png" alt="" /></p><p>æˆ‘ä»¬æŠŠç”Ÿæˆçš„base64ç è½¬æ¢æˆå›¾ç‰‡</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220902105135442.png" alt="" /></p><p>è¿™æ ·å›¾ç‰‡éªŒè¯ç æ¥å£å°±å¼€å‘å¥½äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(å…«)åœ¨ginå’Œgormä¸­ä½¿ç”¨zap</title>
      <link href="/2022/08/28/go-api-practice-8/"/>
      <url>/2022/08/28/go-api-practice-8/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><h1 id="ginæ•´åˆzap"><a class="markdownIt-Anchor" href="#ginæ•´åˆzap"></a> ginæ•´åˆzap</h1><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨<code>gin</code>ä¸­è‡ªå®šä¹‰ä¸­é—´ä»¶çš„å‡½æ•°å—ï¼Œæˆ‘ä»¬å°†è‡ªå®šä¹‰ä¸­é—´ä»¶å¹¶æ•´åˆzapæ¥ä»£æ›¿åŸæ¥çš„ä¸­é—´ä»¶</p><p><code>bootstrap/route.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerGlobalMiddleware</span><span class="params">(router *gin.Engine)</span></span> &#123;</span><br><span class="line">   router.Use(</span><br><span class="line">      middlewares.Recovery(),</span><br><span class="line">      middlewares.Logger(),</span><br><span class="line">   )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„å†…å®¹æ¶‰åŠåˆ°çš„å†…å®¹å¾ˆå¤šï¼Œåªéœ€è¦ç†è§£å¤§æ¦‚å³å¯ï¼Œæ‰€ä»¥è¿™ä¸€éƒ¨åˆ†çš„è®²è§£åªä¼šä»‹ç»å¤§æ¦‚çš„æ€è·¯ã€‚</p><blockquote><p>loggerä¸­é—´ä»¶</p></blockquote><p><code>app/http/middlewares/logger.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> middlewares</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;bytes&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/spf13/cast&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/helpers&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;go.uber.org/zap&quot;</span></span><br><span class="line">   <span class="string">&quot;io&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> responseBodyWriter <span class="keyword">struct</span> &#123;</span><br><span class="line">   gin.ResponseWriter</span><br><span class="line">   body *bytes.Buffer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w responseBodyWriter)</span></span> Write(b []<span class="type">byte</span>) (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">   w.body.Write(b)</span><br><span class="line">   <span class="keyword">return</span> w.ResponseWriter.Write(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logger è®°å½•è¯·æ±‚æ—¥å¿—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Logger</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è·å– response å†…å®¹</span></span><br><span class="line">      w := &amp;responseBodyWriter&#123;body: &amp;bytes.Buffer&#123;&#125;, ResponseWriter: c.Writer&#125;</span><br><span class="line">      c.Writer = w</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è·å–è¯·æ±‚æ•°æ®</span></span><br><span class="line">      <span class="keyword">var</span> requestBody []<span class="type">byte</span></span><br><span class="line">      <span class="keyword">if</span> c.Request.Body != <span class="literal">nil</span> &#123;</span><br><span class="line">         <span class="comment">// c.Request.Body æ˜¯ä¸€ä¸ª buffer å¯¹è±¡ï¼Œåªèƒ½è¯»å–ä¸€æ¬¡</span></span><br><span class="line">         requestBody, _ = io.ReadAll(c.Request.Body)</span><br><span class="line">         <span class="comment">// è¯»å–åï¼Œé‡æ–°èµ‹å€¼ c.Request.Body ï¼Œä»¥ä¾›åç»­çš„å…¶ä»–æ“ä½œ</span></span><br><span class="line">         c.Request.Body = io.NopCloser(bytes.NewBuffer(requestBody))</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è®¾ç½®å¼€å§‹æ—¶é—´</span></span><br><span class="line">      start := time.Now()</span><br><span class="line">      c.Next()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¼€å§‹è®°å½•æ—¥å¿—çš„é€»è¾‘</span></span><br><span class="line">      cost := time.Since(start)</span><br><span class="line">      responStatus := c.Writer.Status()</span><br><span class="line"></span><br><span class="line">      logFields := []zap.Field&#123;</span><br><span class="line">         zap.Int(<span class="string">&quot;status&quot;</span>, responStatus),</span><br><span class="line">         zap.String(<span class="string">&quot;request&quot;</span>, c.Request.Method+<span class="string">&quot; &quot;</span>+c.Request.URL.String()),</span><br><span class="line">         zap.String(<span class="string">&quot;query&quot;</span>, c.Request.URL.RawQuery),</span><br><span class="line">         zap.String(<span class="string">&quot;ip&quot;</span>, c.ClientIP()),</span><br><span class="line">         zap.String(<span class="string">&quot;user-agent&quot;</span>, c.Request.UserAgent()),</span><br><span class="line">         zap.String(<span class="string">&quot;errors&quot;</span>, c.Errors.ByType(gin.ErrorTypePrivate).String()),</span><br><span class="line">         zap.String(<span class="string">&quot;time&quot;</span>, helpers.MicrosecondsStr(cost)),</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> c.Request.Method == <span class="string">&quot;POST&quot;</span> || c.Request.Method == <span class="string">&quot;PUT&quot;</span> || c.Request.Method == <span class="string">&quot;DELETE&quot;</span> &#123;</span><br><span class="line">         <span class="comment">// è¯·æ±‚çš„å†…å®¹</span></span><br><span class="line">         logFields = <span class="built_in">append</span>(logFields, zap.String(<span class="string">&quot;Request Body&quot;</span>, <span class="type">string</span>(requestBody)))</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å“åº”çš„å†…å®¹</span></span><br><span class="line">         logFields = <span class="built_in">append</span>(logFields, zap.String(<span class="string">&quot;Response Body&quot;</span>, w.body.String()))</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> responStatus &gt; <span class="number">400</span> &amp;&amp; responStatus &lt;= <span class="number">499</span> &#123;</span><br><span class="line">         <span class="comment">// é™¤äº† StatusBadRequest ä»¥å¤–ï¼Œwarning æç¤ºä¸€ä¸‹ï¼Œå¸¸è§çš„æœ‰ 403 404ï¼Œå¼€å‘æ—¶éƒ½è¦æ³¨æ„</span></span><br><span class="line">         logger.Warn(<span class="string">&quot;HTTP Warning &quot;</span>+cast.ToString(responStatus), logFields...)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> responStatus &gt;= <span class="number">500</span> &amp;&amp; responStatus &lt;= <span class="number">599</span> &#123;</span><br><span class="line">         <span class="comment">// é™¤äº†å†…éƒ¨é”™è¯¯ï¼Œè®°å½• error</span></span><br><span class="line">         logger.Error(<span class="string">&quot;HTTP Error &quot;</span>+cast.ToString(responStatus), logFields...)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         logger.Debug(<span class="string">&quot;HTTP Access Log&quot;</span>, logFields...)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•°æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>è¯»å–request.body</li><li>æŠŠè¯·æ±‚å‚æ•°å°è£…åˆ°<code>zap.Field</code></li><li>æ ¹æ®å“åº”ç æ¥æ‰“å°ä¸åŒçš„æ—¥å¿—</li></ol><blockquote><p>recoveryä¸­é—´ä»¶</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> middlewares</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;go.uber.org/zap&quot;</span></span><br><span class="line">   <span class="string">&quot;net&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http/httputil&quot;</span></span><br><span class="line">   <span class="string">&quot;os&quot;</span></span><br><span class="line">   <span class="string">&quot;strings&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Recovery ä½¿ç”¨ zap.Error() æ¥è®°å½• Panic å’Œ call stack</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Recovery</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–ç”¨æˆ·çš„è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line">            httpRequest, _ := httputil.DumpRequest(c.Request, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é“¾æ¥ä¸­æ–­ï¼Œå®¢æˆ·ç«¯ä¸­æ–­è¿æ¥ä¸ºæ­£å¸¸è¡Œä¸ºï¼Œä¸éœ€è¦è®°å½•å †æ ˆä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">var</span> brokenPipe <span class="type">bool</span></span><br><span class="line">            <span class="keyword">if</span> ne, ok := err.(*net.OpError); ok &#123;</span><br><span class="line">               <span class="keyword">if</span> se, ok := ne.Err.(*os.SyscallError); ok &#123;</span><br><span class="line">                  errStr := strings.ToLower(se.Error())</span><br><span class="line">                  <span class="keyword">if</span> strings.Contains(errStr, <span class="string">&quot;broken pipe&quot;</span>) || strings.Contains(errStr, <span class="string">&quot;connection reset by peer&quot;</span>) &#123;</span><br><span class="line">                     brokenPipe = <span class="literal">true</span></span><br><span class="line">                  &#125;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// é“¾æ¥ä¸­æ–­çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> brokenPipe &#123;</span><br><span class="line">               logger.Error(c.Request.URL.Path,</span><br><span class="line">                  zap.Time(<span class="string">&quot;time&quot;</span>, time.Now()),</span><br><span class="line">                  zap.Any(<span class="string">&quot;error&quot;</span>, err),</span><br><span class="line">                  zap.String(<span class="string">&quot;request&quot;</span>, <span class="type">string</span>(httpRequest)),</span><br><span class="line">               )</span><br><span class="line">               c.Error(err.(<span class="type">error</span>))</span><br><span class="line">               c.Abort()</span><br><span class="line">               <span class="comment">// é“¾æ¥å·²æ–­å¼€ï¼Œæ— æ³•å†™çŠ¶æ€ç </span></span><br><span class="line">               <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœä¸æ˜¯é“¾æ¥ä¸­æ–­ï¼Œå°±å¼€å§‹è®°å½•å †æ ˆä¿¡æ¯</span></span><br><span class="line">            logger.Error(<span class="string">&quot;recovery from panic&quot;</span>,</span><br><span class="line">               zap.Time(<span class="string">&quot;time&quot;</span>, time.Now()),               <span class="comment">// è®°å½•æ—¶é—´</span></span><br><span class="line">               zap.Any(<span class="string">&quot;error&quot;</span>, err),                      <span class="comment">// è®°å½•é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">               zap.String(<span class="string">&quot;request&quot;</span>, <span class="type">string</span>(httpRequest)), <span class="comment">// è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line">               zap.Stack(<span class="string">&quot;stacktrace&quot;</span>),                    <span class="comment">// è°ƒç”¨å †æ ˆä¿¡æ¯</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿”å› 500 çŠ¶æ€ç </span></span><br><span class="line">            c.AbortWithStatusJSON(http.StatusInternalServerError, gin.H&#123;</span><br><span class="line">               <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•&quot;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;()</span><br><span class="line">      c.Next()</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå·²ç»æœ‰äº†è¯¦è§£çš„æ³¨é‡Šï¼Œä¸åšè§£é‡Šäº†</p><h1 id="gormæ•´åˆzap"><a class="markdownIt-Anchor" href="#gormæ•´åˆzap"></a> gormæ•´åˆzap</h1><p><code>pkg/logger/gorm_logger.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> logger</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;context&quot;</span></span><br><span class="line">   <span class="string">&quot;errors&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/helpers&quot;</span></span><br><span class="line">   <span class="string">&quot;go.uber.org/zap&quot;</span></span><br><span class="line">   <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">   gormlogger <span class="string">&quot;gorm.io/gorm/logger&quot;</span></span><br><span class="line">   <span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">   <span class="string">&quot;runtime&quot;</span></span><br><span class="line">   <span class="string">&quot;strings&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GormLogger <span class="keyword">struct</span> &#123;</span><br><span class="line">   ZapLogger     *zap.Logger</span><br><span class="line">   SlowThreshold time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGormLogger</span><span class="params">()</span></span> GormLogger &#123;</span><br><span class="line">   <span class="keyword">return</span> GormLogger&#123;</span><br><span class="line">      ZapLogger:     Logger,</span><br><span class="line">      SlowThreshold: <span class="number">200</span> * time.Millisecond,</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogMode å®ç° gormlogger.Interface çš„ LogMode æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l GormLogger)</span></span> LogMode(level gormlogger.LogLevel) gormlogger.Interface &#123;</span><br><span class="line">   <span class="keyword">return</span> GormLogger&#123;</span><br><span class="line">      ZapLogger:     l.ZapLogger,</span><br><span class="line">      SlowThreshold: l.SlowThreshold,</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Info å®ç° gormlogger.Interface çš„ Info æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l GormLogger)</span></span> Info(ctx context.Context, str <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">   l.logger().Sugar().Debugf(str, args...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Warn å®ç° gormlogger.Interface çš„ Warn æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l GormLogger)</span></span> Warn(ctx context.Context, str <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">   l.logger().Sugar().Warnf(str, args...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error å®ç° gormlogger.Interface çš„ Error æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l GormLogger)</span></span> Error(ctx context.Context, str <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">   l.logger().Sugar().Errorf(str, args...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trace å®ç° gormlogger.Interface çš„ Trace æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l GormLogger)</span></span> Trace(ctx context.Context, begin time.Time, fc <span class="function"><span class="keyword">func</span><span class="params">()</span></span> (<span class="type">string</span>, <span class="type">int64</span>), err <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è·å–è¿è¡Œæ—¶é—´</span></span><br><span class="line">   elapsed := time.Since(begin)</span><br><span class="line">   <span class="comment">// è·å– SQL è¯·æ±‚å’Œè¿”å›æ¡æ•°</span></span><br><span class="line">   sql, rows := fc()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// é€šç”¨å­—æ®µ</span></span><br><span class="line">   logFields := []zap.Field&#123;</span><br><span class="line">      zap.String(<span class="string">&quot;sql&quot;</span>, sql),</span><br><span class="line">      zap.String(<span class="string">&quot;time&quot;</span>, helpers.MicrosecondsStr(elapsed)),</span><br><span class="line">      zap.Int64(<span class="string">&quot;rows&quot;</span>, rows),</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Gorm é”™è¯¯</span></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// è®°å½•æœªæ‰¾åˆ°çš„é”™è¯¯ä½¿ç”¨ warning ç­‰çº§</span></span><br><span class="line">      <span class="keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) &#123;</span><br><span class="line">         l.logger().Warn(<span class="string">&quot;Database ErrRecordNotFound&quot;</span>, logFields...)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// å…¶ä»–é”™è¯¯ä½¿ç”¨ error ç­‰çº§</span></span><br><span class="line">         logFields = <span class="built_in">append</span>(logFields, zap.Error(err))</span><br><span class="line">         l.logger().Error(<span class="string">&quot;Database Error&quot;</span>, logFields...)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line">   <span class="keyword">if</span> l.SlowThreshold != <span class="number">0</span> &amp;&amp; elapsed &gt; l.SlowThreshold &#123;</span><br><span class="line">      l.logger().Warn(<span class="string">&quot;Database Slow Log&quot;</span>, logFields...)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®°å½•æ‰€æœ‰ SQL è¯·æ±‚</span></span><br><span class="line">   l.logger().Debug(<span class="string">&quot;Database Query&quot;</span>, logFields...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger å†…ç”¨çš„è¾…åŠ©æ–¹æ³•ï¼Œç¡®ä¿ Zap å†…ç½®ä¿¡æ¯ Caller çš„å‡†ç¡®æ€§ï¼ˆå¦‚ paginator/paginator.go:148ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l GormLogger)</span></span> logger() *zap.Logger &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è·³è¿‡ gorm å†…ç½®çš„è°ƒç”¨</span></span><br><span class="line">   <span class="keyword">var</span> (</span><br><span class="line">      gormPackage    = filepath.Join(<span class="string">&quot;gorm.io&quot;</span>, <span class="string">&quot;gorm&quot;</span>)</span><br><span class="line">      zapgormPackage = filepath.Join(<span class="string">&quot;moul.io&quot;</span>, <span class="string">&quot;zapgorm2&quot;</span>)</span><br><span class="line">   )</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å‡å»ä¸€æ¬¡å°è£…ï¼Œä»¥åŠä¸€æ¬¡åœ¨ logger åˆå§‹åŒ–é‡Œæ·»åŠ  zap.AddCallerSkip(1)</span></span><br><span class="line">   clone := l.ZapLogger.WithOptions(zap.AddCallerSkip(<span class="number">-2</span>))</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">2</span>; i &lt; <span class="number">15</span>; i++ &#123;</span><br><span class="line">      _, file, _, ok := runtime.Caller(i)</span><br><span class="line">      <span class="keyword">switch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> !ok:</span><br><span class="line">      <span class="keyword">case</span> strings.HasSuffix(file, <span class="string">&quot;_test.go&quot;</span>):</span><br><span class="line">      <span class="keyword">case</span> strings.Contains(file, gormPackage):</span><br><span class="line">      <span class="keyword">case</span> strings.Contains(file, zapgormPackage):</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">         <span class="comment">// è¿”å›ä¸€ä¸ªé™„å¸¦è·³è¿‡è¡Œå·çš„æ–°çš„ zap logger</span></span><br><span class="line">         <span class="keyword">return</span> clone.WithOptions(zap.AddCallerSkip(i))</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> l.ZapLogger</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå·²ç»æœ‰äº†è¯¦è§£çš„æ³¨é‡Šï¼Œä¸åšè§£é‡Šäº†ï¼Œè¿™ä¸€éƒ¨åˆ†å†…å®¹èƒ½çœ‹æ‡‚å¤šå°‘çœ‹å¤šå°‘å°±è¡Œäº†ï¼Œä¸å¿…è¦åœ¨åˆšå¼€å§‹å­¦ä¹ æ—¶æ‹˜æ³¥äºç»†èŠ‚ï¼Œç­‰ä»¥åæœ‰äº†æ›´å¤šçš„ç»éªŒå†æ¥ææ‡‚ä¹Ÿä¸è¿Ÿ</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(ä¸ƒ)é›†æˆzap</title>
      <link href="/2022/08/28/go-api-practice-7/"/>
      <url>/2022/08/28/go-api-practice-7/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get go.uber.org/zap</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get gopkg.in/natefinch/lumberjack.v2</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†å†…å®¹æˆ‘ä»¬éœ€è¦ä¸Šé¢ä¸¤ä¸ªåŒ…çš„å†…å®¹ï¼Œ<code>zap</code>æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§è€Œä¸”å®Œå–„çš„æ—¥å¿—åŒ…ï¼Œlumberjackåˆ™æ˜¯ä¸€ä¸ªæ—¥å¿—åˆ†å‰²çš„åŒ…ã€‚</p><p>è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹ç”±äºè¾ƒåˆ°äº†è¾ƒä¸ºå…¨é¢çš„ä¸ªæ€§åŒ–é…ç½®ï¼Œæ‰€ä»¥æ–°å†…å®¹ä¼šæ¯”è¾ƒå¤šï¼Œéš¾åº¦ä¸Šä¼šç¨å¤§ï¼Œä½†æ˜¯æ…¢æ…¢æ¥ï¼Œæˆ‘ä»¬å°½å¯èƒ½åœ°æ¢³ç†è¿™é‡Œé¢çš„å†…å®¹ğŸ˜</p><h1 id="å¼€å§‹ç¼–ç "><a class="markdownIt-Anchor" href="#å¼€å§‹ç¼–ç "></a> å¼€å§‹ç¼–ç </h1><h2 id="é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#é…ç½®æ–‡ä»¶"></a> é…ç½®æ–‡ä»¶</h2><p>é…ç½®çš„æ–¹æ³•ä¸å‰é¢çš„æ–¹æ³•ç±»ä¼¼</p><p><code>config/log.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   config.Add(<span class="string">&quot;log&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æ—¥å¿—çº§åˆ«ï¼Œå¿…é¡»æ˜¯ä»¥ä¸‹è¿™äº›é€‰é¡¹ï¼š</span></span><br><span class="line">         <span class="comment">// &quot;debug&quot; â€”â€” ä¿¡æ¯é‡å¤§ï¼Œä¸€èˆ¬è°ƒè¯•æ—¶æ‰“å¼€ã€‚ç³»ç»Ÿæ¨¡å—è¯¦ç»†è¿è¡Œçš„æ—¥å¿—ï¼Œä¾‹å¦‚ HTTP è¯·æ±‚ã€æ•°æ®åº“è¯·æ±‚ã€å‘é€é‚®ä»¶ã€å‘é€çŸ­ä¿¡</span></span><br><span class="line">         <span class="comment">// &quot;info&quot; â€”â€” ä¸šåŠ¡çº§åˆ«çš„è¿è¡Œæ—¥å¿—ï¼Œå¦‚ç”¨æˆ·ç™»å½•ã€ç”¨æˆ·é€€å‡ºã€è®¢å•æ’¤é”€ã€‚</span></span><br><span class="line">         <span class="comment">// &quot;warn&quot; â€”â€” æ„Ÿå…´è¶£ã€éœ€è¦å¼•èµ·å…³æ³¨çš„ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼Œè°ƒè¯•æ—¶å€™æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼ˆå‘½ä»¤è¡Œè¾“å‡ºä¼šæœ‰é«˜äº®ï¼‰ã€‚</span></span><br><span class="line">         <span class="comment">// &quot;error&quot; â€”â€” è®°å½•é”™è¯¯ä¿¡æ¯ã€‚Panic æˆ–è€… Errorã€‚å¦‚æ•°æ®åº“è¿æ¥é”™è¯¯ã€HTTP ç«¯å£è¢«å ç”¨ç­‰ã€‚ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ç­‰çº§ã€‚</span></span><br><span class="line">         <span class="comment">// ä»¥ä¸Šçº§åˆ«ä»ä½åˆ°é«˜ï¼Œlevel å€¼è®¾ç½®çš„çº§åˆ«è¶Šé«˜ï¼Œè®°å½•åˆ°æ—¥å¿—çš„ä¿¡æ¯å°±è¶Šå°‘</span></span><br><span class="line">         <span class="comment">// å¼€å‘æ—¶æ¨èä½¿ç”¨ &quot;debug&quot; æˆ–è€… &quot;info&quot; ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨ &quot;error&quot;</span></span><br><span class="line">         <span class="string">&quot;level&quot;</span>: config.Env(<span class="string">&quot;LOG_LEVEL&quot;</span>, <span class="string">&quot;debug&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æ—¥å¿—çš„ç±»å‹ï¼Œå¯é€‰ï¼š</span></span><br><span class="line">         <span class="comment">// &quot;single&quot; ç‹¬ç«‹çš„æ–‡ä»¶</span></span><br><span class="line">         <span class="comment">// &quot;daily&quot; æŒ‰ç…§æ—¥æœŸæ¯æ—¥ä¸€ä¸ª</span></span><br><span class="line">         <span class="string">&quot;type&quot;</span>: config.Env(<span class="string">&quot;LOG_TYPE&quot;</span>, <span class="string">&quot;single&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">/* ------------------ æ»šåŠ¨æ—¥å¿—é…ç½® ------------------ */</span></span><br><span class="line">         <span class="comment">// æ—¥å¿—æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">         <span class="string">&quot;filename&quot;</span>: config.Env(<span class="string">&quot;LOG_NAME&quot;</span>, <span class="string">&quot;storage/logs/logs.log&quot;</span>),</span><br><span class="line">         <span class="comment">// æ¯ä¸ªæ—¥å¿—æ–‡ä»¶ä¿å­˜çš„æœ€å¤§å°ºå¯¸ å•ä½ï¼šM</span></span><br><span class="line">         <span class="string">&quot;max_size&quot;</span>: config.Env(<span class="string">&quot;LOG_MAX_SIZE&quot;</span>, <span class="number">64</span>),</span><br><span class="line">         <span class="comment">// æœ€å¤šä¿å­˜æ—¥å¿—æ–‡ä»¶æ•°ï¼Œ0 ä¸ºä¸é™ï¼ŒMaxAge åˆ°äº†è¿˜æ˜¯ä¼šåˆ </span></span><br><span class="line">         <span class="string">&quot;max_backup&quot;</span>: config.Env(<span class="string">&quot;LOG_MAX_BACKUP&quot;</span>, <span class="number">5</span>),</span><br><span class="line">         <span class="comment">// æœ€å¤šä¿å­˜å¤šå°‘å¤©ï¼Œ7 è¡¨ç¤ºä¸€å‘¨å‰çš„æ—¥å¿—ä¼šè¢«åˆ é™¤ï¼Œ0 è¡¨ç¤ºä¸åˆ </span></span><br><span class="line">         <span class="string">&quot;max_age&quot;</span>: config.Env(<span class="string">&quot;LOG_MAX_AGE&quot;</span>, <span class="number">30</span>),</span><br><span class="line">         <span class="comment">// æ˜¯å¦å‹ç¼©ï¼Œå‹ç¼©æ—¥å¿—ä¸æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘ä»¬è®¾ç½®ä¸º falseï¼ˆå‹ç¼©å¯èŠ‚çœç©ºé—´ï¼‰</span></span><br><span class="line">         <span class="string">&quot;compress&quot;</span>: config.Env(<span class="string">&quot;LOG_COMPRESS&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>.env</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">.</span></span><br><span class="line"><span class="attr">.</span></span><br><span class="line"><span class="attr">.</span></span><br><span class="line"><span class="attr">LOG_TYPE</span>=<span class="string">daily</span></span><br><span class="line"><span class="attr">LOG_LEVEL</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure><h2 id="zapå·¥å…·åŒ…"><a class="markdownIt-Anchor" href="#zapå·¥å…·åŒ…"></a> zapå·¥å…·åŒ…</h2><p><code>pkg/app/app.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsLocal</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> config.Get(<span class="string">&quot;app.env&quot;</span>) == <span class="string">&quot;local&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsProduction</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> config.Get(<span class="string">&quot;app.env&quot;</span>) == <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsTesting</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> config.Get(<span class="string">&quot;app.env&quot;</span>) == <span class="string">&quot;testing&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒºåˆ«æœ¬åœ°å’Œç”Ÿæˆç¯å¢ƒ</p><p><code>helpers/helpers.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MicrosecondsStr</span><span class="params">(elapsed time.Duration)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%.3fms&quot;</span>, <span class="type">float64</span>(elapsed.Nanoseconds())/<span class="number">1e6</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠæ—¶é—´è½¬æ¢æˆçº³ç§’ï¼Œå¯ä»¥å¯¹ç¨‹åºçš„è¿è¡Œæ—¶é—´æœ‰æ¯”è¾ƒç²¾ç»†çš„æŸ¥çœ‹</p><p><code>pkg/logger/logger.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> logger</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/app&quot;</span></span><br><span class="line">   <span class="string">&quot;go.uber.org/zap&quot;</span></span><br><span class="line">   <span class="string">&quot;go.uber.org/zap/zapcore&quot;</span></span><br><span class="line">   <span class="string">&quot;gopkg.in/natefinch/lumberjack.v2&quot;</span></span><br><span class="line">   <span class="string">&quot;os&quot;</span></span><br><span class="line">   <span class="string">&quot;strings&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Logger *zap.Logger</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitLogger</span><span class="params">(filename <span class="type">string</span>, maxSize, maxBackups, maxAge <span class="type">int</span>, compress <span class="type">bool</span>, logType <span class="type">string</span>, level <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   writeSyncer := getLoggerWriter(filename, maxSize, maxBackups, maxAge, compress, logType)</span><br><span class="line"></span><br><span class="line">   logLevel := <span class="built_in">new</span>(zapcore.Level)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> err := logLevel.UnmarshalText([]<span class="type">byte</span>(level)); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;æ—¥å¿—çº§åˆ«è®¾ç½®é”™è¯¯&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   core := zapcore.NewCore(getEncoder(), writeSyncer, logLevel)</span><br><span class="line"></span><br><span class="line">   Logger = zap.New(core,</span><br><span class="line">      zap.AddCaller(),</span><br><span class="line">      zap.AddCallerSkip(<span class="number">1</span>),</span><br><span class="line">      zap.AddStacktrace(zap.ErrorLevel))</span><br><span class="line"></span><br><span class="line">   zap.ReplaceGlobals(Logger)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getEncoder</span><span class="params">()</span></span> zapcore.Encoder &#123;</span><br><span class="line">   encoderConfig := zapcore.EncoderConfig&#123;</span><br><span class="line">      TimeKey:        <span class="string">&quot;time&quot;</span>,</span><br><span class="line">      LevelKey:       <span class="string">&quot;level&quot;</span>,</span><br><span class="line">      NameKey:        <span class="string">&quot;logger&quot;</span>,</span><br><span class="line">      CallerKey:      <span class="string">&quot;caller&quot;</span>,</span><br><span class="line">      FunctionKey:    zapcore.OmitKey,</span><br><span class="line">      MessageKey:     <span class="string">&quot;message&quot;</span>,</span><br><span class="line">      StacktraceKey:  <span class="string">&quot;stacktrace&quot;</span>,</span><br><span class="line">      LineEnding:     zapcore.DefaultLineEnding,</span><br><span class="line">      EncodeLevel:    zapcore.CapitalLevelEncoder,</span><br><span class="line">      EncodeTime:     customTimeEncoder,</span><br><span class="line">      EncodeDuration: zapcore.SecondsDurationEncoder,</span><br><span class="line">      EncodeCaller:   zapcore.ShortCallerEncoder,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> app.IsLocal() &#123;</span><br><span class="line">      encoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder</span><br><span class="line">      <span class="keyword">return</span> zapcore.NewConsoleEncoder(encoderConfig)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> zapcore.NewJSONEncoder(encoderConfig)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">customTimeEncoder</span><span class="params">(t time.Time, enc zapcore.PrimitiveArrayEncoder)</span></span> &#123;</span><br><span class="line">   enc.AppendString(t.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getLoggerWriter</span><span class="params">(filename <span class="type">string</span>, maxSize, maxBackups, maxAge <span class="type">int</span>, compress <span class="type">bool</span>, logType <span class="type">string</span>)</span></span> zapcore.WriteSyncer &#123;</span><br><span class="line">   <span class="keyword">if</span> logType == <span class="string">&quot;daily&quot;</span> &#123;</span><br><span class="line">      logname := time.Now().Format(<span class="string">&quot;2006-01-02.log&quot;</span>)</span><br><span class="line">      filename = strings.ReplaceAll(filename, <span class="string">&quot;logs.log&quot;</span>, logname)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   lumberJackLogger := &amp;lumberjack.Logger&#123;</span><br><span class="line">      Filename:   filename,</span><br><span class="line">      MaxSize:    maxSize,</span><br><span class="line">      MaxBackups: maxBackups,</span><br><span class="line">      MaxAge:     maxAge,</span><br><span class="line">      Compress:   compress,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> app.IsLocal() &#123;</span><br><span class="line">      <span class="keyword">return</span> zapcore.NewMultiWriteSyncer(zapcore.AddSync(os.Stdout), zapcore.AddSync(lumberJackLogger))</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> zapcore.AddSync(lumberJackLogger)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dump è°ƒè¯•ä¸“ç”¨ï¼Œä¸ä¼šä¸­æ–­ç¨‹åºï¼Œä¼šåœ¨ç»ˆç«¯æ‰“å°å‡º warning æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¼šä½¿ç”¨ json.Marshal è¿›è¡Œæ¸²æŸ“ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment">//         logger.Dump(user.User&#123;Name:&quot;test&quot;&#125;)</span></span><br><span class="line"><span class="comment">//         logger.Dump(user.User&#123;Name:&quot;test&quot;&#125;, &quot;ç”¨æˆ·ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Dump</span><span class="params">(value <span class="keyword">interface</span>&#123;&#125;, msg ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   valueString := jsonString(value)</span><br><span class="line">   <span class="comment">// åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦ä¼ å‚ msg</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(msg) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      Logger.Warn(<span class="string">&quot;Dump&quot;</span>, zap.String(msg[<span class="number">0</span>], valueString))</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Logger.Warn(<span class="string">&quot;Dump&quot;</span>, zap.String(<span class="string">&quot;data&quot;</span>, valueString))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogIf å½“ err != nil æ—¶è®°å½• error ç­‰çº§çš„æ—¥å¿—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LogIf</span><span class="params">(err <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      Logger.Error(<span class="string">&quot;Error Occurred:&quot;</span>, zap.Error(err))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogWarnIf å½“ err != nil æ—¶è®°å½• warning ç­‰çº§çš„æ—¥å¿—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LogWarnIf</span><span class="params">(err <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      Logger.Warn(<span class="string">&quot;Error Occurred:&quot;</span>, zap.Error(err))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogInfoIf å½“ err != nil æ—¶è®°å½• info ç­‰çº§çš„æ—¥å¿—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LogInfoIf</span><span class="params">(err <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      Logger.Info(<span class="string">&quot;Error Occurred:&quot;</span>, zap.Error(err))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Debug è°ƒè¯•æ—¥å¿—ï¼Œè¯¦å°½çš„ç¨‹åºæ—¥å¿—</span></span><br><span class="line"><span class="comment">// è°ƒç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment">//        logger.Debug(&quot;Database&quot;, zap.String(&quot;sql&quot;, sql))</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Debug</span><span class="params">(moduleName <span class="type">string</span>, fields ...zap.Field)</span></span> &#123;</span><br><span class="line">   Logger.Debug(moduleName, fields...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Info å‘ŠçŸ¥ç±»æ—¥å¿—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Info</span><span class="params">(moduleName <span class="type">string</span>, fields ...zap.Field)</span></span> &#123;</span><br><span class="line">   Logger.Info(moduleName, fields...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Warn è­¦å‘Šç±»</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Warn</span><span class="params">(moduleName <span class="type">string</span>, fields ...zap.Field)</span></span> &#123;</span><br><span class="line">   Logger.Warn(moduleName, fields...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error é”™è¯¯æ—¶è®°å½•ï¼Œä¸åº”è¯¥ä¸­æ–­ç¨‹åºï¼ŒæŸ¥çœ‹æ—¥å¿—æ—¶é‡ç‚¹å…³æ³¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Error</span><span class="params">(moduleName <span class="type">string</span>, fields ...zap.Field)</span></span> &#123;</span><br><span class="line">   Logger.Error(moduleName, fields...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fatal çº§åˆ«åŒ Error(), å†™å®Œ log åè°ƒç”¨ os.Exit(1) é€€å‡ºç¨‹åº</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fatal</span><span class="params">(moduleName <span class="type">string</span>, fields ...zap.Field)</span></span> &#123;</span><br><span class="line">   Logger.Fatal(moduleName, fields...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DebugString è®°å½•ä¸€æ¡å­—ç¬¦ä¸²ç±»å‹çš„ debug æ—¥å¿—ï¼Œè°ƒç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment">//         logger.DebugString(&quot;SMS&quot;, &quot;çŸ­ä¿¡å†…å®¹&quot;, string(result.RawResponse))</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DebugString</span><span class="params">(moduleName, name, msg <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   Logger.Debug(moduleName, zap.String(name, msg))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InfoString</span><span class="params">(moduleName, name, msg <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   Logger.Info(moduleName, zap.String(name, msg))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WarnString</span><span class="params">(moduleName, name, msg <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   Logger.Warn(moduleName, zap.String(name, msg))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ErrorString</span><span class="params">(moduleName, name, msg <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   Logger.Error(moduleName, zap.String(name, msg))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FatalString</span><span class="params">(moduleName, name, msg <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   Logger.Fatal(moduleName, zap.String(name, msg))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DebugJSON è®°å½•å¯¹è±¡ç±»å‹çš„ debug æ—¥å¿—ï¼Œä½¿ç”¨ json.Marshal è¿›è¡Œç¼–ç ã€‚è°ƒç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment">//         logger.DebugJSON(&quot;Auth&quot;, &quot;è¯»å–ç™»å½•ç”¨æˆ·&quot;, auth.CurrentUser())</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DebugJSON</span><span class="params">(moduleName, name <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   Logger.Debug(moduleName, zap.String(name, jsonString(value)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InfoJSON</span><span class="params">(moduleName, name <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   Logger.Info(moduleName, zap.String(name, jsonString(value)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WarnJSON</span><span class="params">(moduleName, name <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   Logger.Warn(moduleName, zap.String(name, jsonString(value)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ErrorJSON</span><span class="params">(moduleName, name <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   Logger.Error(moduleName, zap.String(name, jsonString(value)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FatalJSON</span><span class="params">(moduleName, name <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   Logger.Fatal(moduleName, zap.String(name, jsonString(value)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">jsonString</span><span class="params">(value <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">   b, err := json.Marshal(value)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      Logger.Error(<span class="string">&quot;Logger&quot;</span>, zap.String(<span class="string">&quot;JSON marshal error&quot;</span>, err.Error()))</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="type">string</span>(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯zapçš„åˆå§‹åŒ–ï¼Œåä¸€éƒ¨åˆ†æ˜¯å¯¹zapæ–¹æ³•çš„å°è£…æ¥ç”¨äºå¤šç§åœºæ™¯</p><h3 id="zapçš„åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#zapçš„åˆå§‹åŒ–"></a> zapçš„åˆå§‹åŒ–</h3><p>å†…å®¹æœ‰ç‚¹å¤šğŸ˜‡ï¼Œæ…¢æ…¢è§£æ<code>initLogger()</code></p><blockquote><p>å‡½æ•°å‚æ•°</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">filename:æ—¥å¿—æ–‡ä»¶ç”Ÿæˆçš„ä½ç½®</span><br><span class="line">maxSize:æ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°</span><br><span class="line">maxBackups:ä¿å­˜æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§æ•°é‡</span><br><span class="line">maxAge:ä¿å­˜æ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€é•¿æ—¶é—´</span><br><span class="line">compress:æ˜¯å¦å‹ç¼©æ—¥å¿—æ–‡ä»¶,ä¼šå˜æˆå‹ç¼©æ–‡ä»¶</span><br><span class="line">logType:æœ‰&quot;daily&quot;å’Œ&quot;single&quot;ä¸¤ä¸ªé€‰é¡¹ï¼Œ&quot;daily&quot;è¡¨ç¤ºæ¯å¤©ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶,&quot;single&quot;è¡¨ç¤ºå…¨éƒ¨æ—¥å¿—é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­</span><br><span class="line">level:æ‰“å°çš„æ—¥å¿—æ–‡ä»¶çº§åˆ«</span><br></pre></td></tr></table></figure><blockquote><p>getLoggerWriter</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> logType == <span class="string">&quot;daily&quot;</span> &#123;</span><br><span class="line">   logname := time.Now().Format(<span class="string">&quot;2006-01-02.log&quot;</span>)</span><br><span class="line">   filename = strings.ReplaceAll(filename, <span class="string">&quot;logs.log&quot;</span>, logname)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæ¥é»˜è®¤ç”Ÿæˆçš„æ—¥å¿—æ˜¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶<code>logs.log</code>ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®æ—¥å¿—çš„ç§ç±»æ˜¯<code>daily</code>ï¼Œé‚£ä¹ˆå°±é‡æ–°è®¾ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lumberJackLogger := &amp;lumberjack.Logger&#123;</span><br><span class="line">   Filename:   filename,</span><br><span class="line">   MaxSize:    maxSize,</span><br><span class="line">   MaxBackups: maxBackups,</span><br><span class="line">   MaxAge:     maxAge,</span><br><span class="line">   Compress:   compress,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–<code>lumberjack</code></p><blockquote><p>zap.AddSync</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> app.IsLocal() &#123;</span><br><span class="line">   <span class="keyword">return</span> zapcore.NewMultiWriteSyncer(zapcore.AddSync(os.Stdout), zapcore.AddSync(lumberJackLogger))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> zapcore.AddSync(lumberJackLogger)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ æ—¥å¿—çš„è¾“å‡ºæµï¼Œå¦‚æœæ˜¯åœ¨æœ¬åœ°ï¼Œæˆ‘ä»¬è¦æ±‚åœ¨æœ¬åœ°å’Œæ—¥å¿—æ–‡ä»¶ä¸­åŒæ—¶æ‰“å°ï¼Œç”Ÿæˆç¯å¢ƒåªéœ€è¦æ‰“å°åœ¨æ—¥å¿—æ–‡ä»¶ä¸­å°±å¯ä»¥äº†</p><blockquote><p>è·å–æ—¥å¿—ç­‰çº§</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logLevel := <span class="built_in">new</span>(zapcore.Level)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := logLevel.UnmarshalText([]<span class="type">byte</span>(level)); err != <span class="literal">nil</span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;æ—¥å¿—çº§åˆ«è®¾ç½®é”™è¯¯&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•å¯ä»¥è§£æå“ªäº›ç­‰çº§</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *Level)</span></span> UnmarshalText(text []<span class="type">byte</span>) <span class="type">error</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> l == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> errUnmarshalNilLevel</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> !l.unmarshalText(text) &amp;&amp; !l.unmarshalText(bytes.ToLower(text)) &#123;</span><br><span class="line">      <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;unrecognized level: %q&quot;</span>, text)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *Level)</span></span> unmarshalText(text []<span class="type">byte</span>) <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> <span class="type">string</span>(text) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;debug&quot;</span>, <span class="string">&quot;DEBUG&quot;</span>:</span><br><span class="line">*l = DebugLevel</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;info&quot;</span>, <span class="string">&quot;INFO&quot;</span>, <span class="string">&quot;&quot;</span>: <span class="comment">// make the zero value useful</span></span><br><span class="line">*l = InfoLevel</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;warn&quot;</span>, <span class="string">&quot;WARN&quot;</span>:</span><br><span class="line">*l = WarnLevel</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;error&quot;</span>, <span class="string">&quot;ERROR&quot;</span>:</span><br><span class="line">*l = ErrorLevel</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;dpanic&quot;</span>, <span class="string">&quot;DPANIC&quot;</span>:</span><br><span class="line">*l = DPanicLevel</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;panic&quot;</span>, <span class="string">&quot;PANIC&quot;</span>:</span><br><span class="line">*l = PanicLevel</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;fatal&quot;</span>, <span class="string">&quot;FATAL&quot;</span>:</span><br><span class="line">*l = FatalLevel</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æçš„ç­‰çº§åŒ…æ‹¬äº†<code>debug</code>ï¼Œ <code>info</code>ï¼Œ<code>warn</code>ç­‰ï¼Œè§£æè¿‡ç¨‹ä¸­å‘ç°å®ƒä¼šæŠŠå­—ç¬¦ä¸²éƒ½å˜æˆå°å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥æ—¶ä¸å¿…å…³å¿ƒå¤§å°å†™</p><blockquote><p>zapcore.NewCore()</p></blockquote><p>åˆå§‹åŒ–<code>zap.Core</code></p><blockquote><p>getEncoder()</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getEncoder</span><span class="params">()</span></span> zapcore.Encoder &#123;</span><br><span class="line">   encoderConfig := zapcore.EncoderConfig&#123;</span><br><span class="line">      TimeKey:        <span class="string">&quot;time&quot;</span>,</span><br><span class="line">      LevelKey:       <span class="string">&quot;level&quot;</span>,</span><br><span class="line">      NameKey:        <span class="string">&quot;logger&quot;</span>,</span><br><span class="line">      CallerKey:      <span class="string">&quot;caller&quot;</span>,</span><br><span class="line">      FunctionKey:    zapcore.OmitKey,<span class="comment">//å¿½æ‚ è¿™ä¸ªå­—æ®µ</span></span><br><span class="line">      MessageKey:     <span class="string">&quot;message&quot;</span>,</span><br><span class="line">      StacktraceKey:  <span class="string">&quot;stacktrace&quot;</span>,</span><br><span class="line">      LineEnding:     zapcore.DefaultLineEnding,<span class="comment">//é»˜è®¤æ¢è¡Œ&quot;\n&quot;</span></span><br><span class="line">      EncodeLevel:    zapcore.CapitalLevelEncoder,<span class="comment">//ä»¥å¤§å†™å­—æ¯è¾“å‡º</span></span><br><span class="line">      EncodeTime:     customTimeEncoder,<span class="comment">//è‡ªå®šä¹‰æ‰“å°çš„æ—¶é—´æ ¼å¼</span></span><br><span class="line">      EncodeDuration: zapcore.SecondsDurationEncoder,<span class="comment">//æŠŠæ—¶é—´åºåˆ—åŒ–ä½ä»¥ç§’ä¸ºå•ä½çš„æµ®ç‚¹æ•°</span></span><br><span class="line">      EncodeCaller:   zapcore.ShortCallerEncoder,<span class="comment">//åªæ‰“å°è°ƒä¿¡æ¯å‘ç”Ÿçš„æœ€ç»ˆç›®å½•</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> app.IsLocal() &#123;</span><br><span class="line">      encoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder</span><br><span class="line">      <span class="keyword">return</span> zapcore.NewConsoleEncoder(encoderConfig)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> zapcore.NewJSONEncoder(encoderConfig)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦ä½œç”¨æ˜¯åœ¨è¿™é‡Œé…ç½®äº†è¦æ‰“å°å“ªäº›å†…å®¹ä»¥åŠæ‰“å°çš„æ•ˆæœï¼Œåƒ<code>TimeKey</code>ï¼Œ<code>LevelKey</code>ç­‰<code>key</code>å­—æ®µï¼ŒåŠ å…¥æˆ‘ä»¬æ²¡æœ‰é…ç½®è¿™äº›é€‰é¡¹ï¼Œé‚£ä¹ˆæœ€åæ‰“å°çš„ç»“æœä¸­å°†æ²¡æœ‰è¿™äº›å†…å®¹ã€‚</p><blockquote><p>zap.New()</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Logger = zap.New(core,</span><br><span class="line">   zap.AddCaller(),<span class="comment">//æ‰“å°ä¿¡æ¯å‘ç”Ÿçš„ä½ç½®</span></span><br><span class="line">   zap.AddCallerSkip(<span class="number">1</span>),<span class="comment">//æ‰“å°ä½ç½®æ—¶ä»è°ƒç”¨å †æ ˆä¸­å›æº¯ä¸€çº§</span></span><br><span class="line">   zap.AddStacktrace(zap.ErrorLevel))<span class="comment">//åªæœ‰åœ¨Errorä»¥ä¸Šçš„é”™è¯¯æ—¶æ‰ä¼šæ‰“å°å †æ ˆè¿½è¸ª</span></span><br><span class="line"></span><br><span class="line">zap.ReplaceGlobals(Logger)<span class="comment">//æ›¿æ¢å…¨å±€logger</span></span><br></pre></td></tr></table></figure><blockquote><p>caller</p></blockquote><p>åœ¨ä¸Šè¿°çš„è§£é‡Šä¸­ï¼Œ<code>caller</code>è®²çš„æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡åˆ é™¤<code>zap.New()</code>ä¸­çš„å‚æ•°æ¥çœ‹çœ‹è¿™äº›å‚æ•°çš„æ•ˆæœï¼Œæˆ‘ä»¬é‡‡ç”¨Dumpæ¥æµ‹è¯•ï¼Œè¿™ä¸ªå‡½æ•°æš‚æ—¶è¿˜æ²¡æœ‰è®²åˆ°,ä½ å¯ä»¥ç†è§£è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯ç”¨æˆ·è°ƒè¯•æ—¶æ‰“å°æ—¥å¿—çš„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">logInfo</span><span class="params">()</span></span> &#123;</span><br><span class="line">   logger.Dump(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> env <span class="type">string</span></span><br><span class="line">   flag.StringVar(&amp;env, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">   flag.Parse()</span><br><span class="line">   config.InitConfig(env)</span><br><span class="line"></span><br><span class="line">   bootstrap.SetupLogger()</span><br><span class="line"></span><br><span class="line">   logInfo()</span><br><span class="line"></span><br><span class="line">   router := gin.New()</span><br><span class="line"></span><br><span class="line">   bootstrap.SetupDB()</span><br><span class="line"></span><br><span class="line">   bootstrap.SetupRoute(router)</span><br><span class="line"></span><br><span class="line">   gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">   err := router.Run(<span class="string">&quot;:&quot;</span> + config.Get(<span class="string">&quot;app.port&quot;</span>))</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤AddCaller()å’ŒAddCallerSkip()</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2022-08-28 09:25:46     WARN    Dump    &#123;&quot;data&quot;: &quot;\&quot;test\&quot;&quot;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤AddCallerSkip()</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2022-08-28 09:22:45 WARN   logger/logger.go:94    Dump   &#123;&quot;data&quot;: &quot;\&quot;test\&quot;&quot;&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ äº†<code>AddCaller()</code>ä¹‹åï¼Œé‚£ä¹ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ä½ç½®å°±è¢«æ‰“å°å‡ºæ¥äº†ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œå› ä¸ºæ‰“å°æ—¥å¿—è°ƒç”¨çš„æ˜¯<code>pkg</code>åŒ…ä¸­çš„å‡½æ•°ï¼Œåœ¨å®é™…debugè¿‡ç¨‹ä¸­æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœè·³è¿‡è¿™ä¸€çº§ï¼Œé‚£ä¹ˆè¿™æ—¶çš„æ—¥å¿—å°±æœ‰æ‰€ä½œç”¨äº†</p><blockquote><p>å…¨éƒ¨ä¿ç•™</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2022-08-28 09:21:54 WARN   go-api-practice/main.go:18 Dump   &#123;&quot;data&quot;: &quot;\&quot;test\&quot;&quot;&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾å‘ç°æ·»åŠ äº†<code>AddCallerSkip(1)</code>çš„æ—¥å¿—æ›´å…·å®é™…æ„ä¹‰</p><h3 id="zapå‡½æ•°çš„å°è£…"><a class="markdownIt-Anchor" href="#zapå‡½æ•°çš„å°è£…"></a> zapå‡½æ•°çš„å°è£…</h3><p>ä¸éš¾å‘ç°æ‰€æœ‰çš„å·¥å…·ç±»éƒ½æ˜¯å¯¹zapä¸­ä¸€ç»„ç›¸ä¼¼æ–¹æ³•çš„å°è£…ï¼Œæˆ‘å°±æŒ‘é€‰ä¸€ä¸ªæ¥è®²è§£</p><blockquote><p>Logger.Warn()</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(log *Logger)</span></span> Warn(msg <span class="type">string</span>, fields ...Field)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Field <span class="keyword">struct</span> &#123;</span><br><span class="line">Key       <span class="type">string</span></span><br><span class="line">Type      FieldType</span><br><span class="line">Integer   <span class="type">int64</span></span><br><span class="line">String    <span class="type">string</span></span><br><span class="line">Interface <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç±»å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>message</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<code>zap.Field</code>ç»“æ„ä½“ï¼Œå†…å®¹çš„æ ¸å¿ƒå°±æ˜¯é”®å€¼å¯¹ï¼Œåœ¨æœ€åçš„æ—¥å¿—æ‰“å°ä¸­ï¼Œzapä¼šæŠŠ<code>Field</code>å­—æ®µå…¨éƒ¨åºåˆ—åŒ–æˆJSON</p><p>å…¶å®ƒçš„å‡½æ•°éƒ½æ˜¯åœ¨åˆ©ç”¨è¿™äº›æ‰“å°åŠŸèƒ½åšå°è£…ï¼Œæˆ‘å°±ä¸ä¸€ä¸€è®²è§£äº†ğŸ˜</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(å…­)å°è£…éªŒè¯å™¨</title>
      <link href="/2022/08/27/go-api-practice-6/"/>
      <url>/2022/08/27/go-api-practice-6/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><h1 id="æŠ½ç¦»å…¬å…±éƒ¨åˆ†ä»£ç "><a class="markdownIt-Anchor" href="#æŠ½ç¦»å…¬å…±éƒ¨åˆ†ä»£ç "></a> æŠ½ç¦»å…¬å…±éƒ¨åˆ†ä»£ç </h1><h3 id="æŠ½ç¦»éªŒè¯å‡½æ•°ä¸­çš„å…¬å…±éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#æŠ½ç¦»éªŒè¯å‡½æ•°ä¸­çš„å…¬å…±éƒ¨åˆ†"></a> æŠ½ç¦»éªŒè¯å‡½æ•°ä¸­çš„å…¬å…±éƒ¨åˆ†</h3><p>æˆ‘ä»¬å‘ç°å†éªŒè¯æ‰‹æœºå·ç å’Œé‚®ç®±çš„è¿‡ç¨‹ä¸­å¾ˆå¤šä»£ç æ˜¯ç±»ä¼¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æŠ½ç¦»å‡ºæ¥é‡å¤ä½¿ç”¨</p><p><code>app/requests/signup_request.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½®åˆå§‹åŒ–</span></span><br><span class="line">opts := govalidator.Options&#123;</span><br><span class="line">   Data:          data,</span><br><span class="line">   Rules:         rules,</span><br><span class="line">   TagIdentifier: <span class="string">&quot;valid&quot;</span>, <span class="comment">// æ¨¡å‹ä¸­çš„ Struct æ ‡ç­¾æ ‡è¯†ç¬¦</span></span><br><span class="line">   Messages:      messages,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹éªŒè¯</span></span><br><span class="line"><span class="keyword">return</span> govalidator.New(opts).ValidateStruct()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°è¿™ä¸ªéƒ¨åˆ†æ˜¯å®Œå…¨ä¸€è‡´çš„</p><p><code>app/requests/requests.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, rules govalidator.MapData, messages govalidator.MapData)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line">   ops := govalidator.Options&#123;</span><br><span class="line">      Data:          data,</span><br><span class="line">      Rules:         rules,</span><br><span class="line">      TagIdentifier: <span class="string">&quot;valid&quot;</span>,</span><br><span class="line">      Messages:      messages,</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> govalidator.New(ops).ValidateStruct()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŠŠè¿™ä¸€æ®µä»£ç å•ç‹¬å–äº†å‡ºæ¥ï¼Œè¦æ³¨æ„è¿™ä¸ª<code>validate</code>æ˜¯å°å†™å­—æ¯å¼€å¤´çš„ï¼Œæ˜¯ä¸€ä¸ªç§æœ‰å‡½æ•°ï¼Œå¾…ä¼šæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªå…±æœ‰çš„<code>Validate</code>å‡½æ•°ä»¥ä¾›æ§åˆ¶å™¨ä½¿ç”¨</p><h3 id="ä¿®æ”¹åŸæ¥çš„ä»£ç "><a class="markdownIt-Anchor" href="#ä¿®æ”¹åŸæ¥çš„ä»£ç "></a> ä¿®æ”¹åŸæ¥çš„ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SignupPhoneExistRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   Phone <span class="type">string</span> <span class="string">`json:&quot;phone,omitempty&quot; valid:&quot;phone&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateSignupPhoneExist</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯è§„åˆ™</span></span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:11&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯å‡ºé”™æ—¶çš„æç¤º</span></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:æ‰‹æœºå·ä¸ºå¿…å¡«é¡¹ï¼Œå‚æ•°åç§° phone&quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:æ‰‹æœºå·é•¿åº¦å¿…é¡»ä¸º 11 ä½çš„æ•°å­—&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> validate(data, rules, messages)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SignupEmailExistRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   Email <span class="type">string</span> <span class="string">`json:&quot;email,omitempty&quot; valid:&quot;email&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateSignupEmailExist</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯è§„åˆ™</span></span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;min:4&quot;</span>, <span class="string">&quot;max:30&quot;</span>, <span class="string">&quot;email&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯å‡ºé”™æ—¶çš„æç¤º</span></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:Email ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;min:Email é•¿åº¦éœ€å¤§äº 4&quot;</span>,</span><br><span class="line">         <span class="string">&quot;max:Email é•¿åº¦éœ€å°äº 30&quot;</span>,</span><br><span class="line">         <span class="string">&quot;email:Email æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> validate(data, rules, messages)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠå…¬å…±éƒ¨åˆ†ä¿®æ”¹å³å¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æŠ½ç¦»æ§åˆ¶å™¨ä¸­çš„å…¬å…±éƒ¨åˆ†</p><h3 id="æŠ½ç¦»æ§åˆ¶å™¨çš„å…¬å…±éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#æŠ½ç¦»æ§åˆ¶å™¨çš„å…¬å…±éƒ¨åˆ†"></a> æŠ½ç¦»æ§åˆ¶å™¨çš„å…¬å…±éƒ¨åˆ†</h3><p><code>app/http/controllers/api/v1/auth/signup_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§£æ JSON è¯·æ±‚</span></span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindJSON(&amp;request); err != <span class="literal">nil</span> &#123;</span><br><span class="line">   <span class="comment">// è§£æå¤±è´¥ï¼Œè¿”å› 422 çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">   c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="comment">// æ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">   fmt.Println(err.Error())</span><br><span class="line">   <span class="comment">// å‡ºé”™äº†ï¼Œä¸­æ–­è¯·æ±‚</span></span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¡¨å•éªŒè¯</span></span><br><span class="line">errs := requests.ValidateSignupEmailExist(&amp;request, c)</span><br><span class="line"><span class="comment">// errs è¿”å›é•¿åº¦ç­‰äºé›¶å³é€šè¿‡ï¼Œå¤§äº 0 å³æœ‰é”™è¯¯å‘ç”Ÿ</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(errs) &gt; <span class="number">0</span> &#123;</span><br><span class="line">   <span class="comment">// éªŒè¯å¤±è´¥ï¼Œè¿”å› 422 çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">   c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;errors&quot;</span>: errs,</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä¼šæŠŠè¿™ä¸€æ®µä»£ç æŠ½ç¦»</p><p><code>app/requests/requests.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ValidateFunc <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">interface</span>&#123;&#125;, *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Validate</span><span class="params">(c *gin.Context, obj <span class="keyword">interface</span>&#123;&#125;, handler ValidateFunc)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> err := c.ShouldBind(obj); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æ•°æ®æ ¼å¼é”™è¯¯&quot;</span>,</span><br><span class="line">         <span class="string">&quot;error&quot;</span>:   err.Error(),</span><br><span class="line">      &#125;)</span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   errs := handler(obj, c)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(errs) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ä¸Šä¼ çš„æ•°æ®æ ¼å¼å‡ºé”™&quot;</span>,</span><br><span class="line">         <span class="string">&quot;error&quot;</span>:   errs,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨<code>type</code>å®šä¹‰äº†ä¸€ä¸ªæ–°çš„ç±»å‹æ¥å¤„ç†ä¸åŒçš„éªŒè¯è¦æ±‚</p><p>æ¥ä¸‹æ¥å†ä¿®æ”¹æ§åˆ¶å™¨ä¸­çš„ä»£ç å°±éå¸¸æ•´æ´äº†</p><p><code>app/http/controllers/api/v1/auth/signup_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SignupController <span class="keyword">struct</span> &#123;</span><br><span class="line">   v1.BaseController</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> IsPhoneExist(c *gin.Context) &#123;</span><br><span class="line"></span><br><span class="line">   request := requests.SignupPhoneExistRequest&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.ValidateSignupPhoneExist); !ok &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;exist&quot;</span>: user.IsPhoneExist(request.Phone),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> IsEmailExist(c *gin.Context) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆå§‹åŒ–è¯·æ±‚å¯¹è±¡</span></span><br><span class="line">   request := requests.SignupEmailExistRequest&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok := requests.Validate(c, &amp;request, requests.ValidateSignupEmailExist); !ok &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  æ£€æŸ¥æ•°æ®åº“å¹¶è¿”å›å“åº”</span></span><br><span class="line">   c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;exist&quot;</span>: user.IsEmailExist(request.Email),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ç›¸å½“æœ‰å¿…è¦å†ç”¨ä¹‹å‰å†apifoxåˆ›å»ºå¥½çš„æ¥å£å†æ¥è¯·æ±‚ä¸€æ¬¡æ¥ç¡®å®šä½ çš„é‡æ„æ˜¯å¦æˆåŠŸï¼Œè¿™ç§ç¯èŠ‚å¾ˆå®¹æ˜“å‡ºé—®é¢˜ï¼Œåˆ°äº†åé¢å†ä¿®æ”¹å°±æ²¡é‚£ä¹ˆç®€å•äº†ï¼Œè¿™æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œåœ¨æ¯éƒ¨åˆ†å®Œæˆä½ éƒ½å¯ä»¥è¿™æ ·å–éªŒè¯ä½ çš„ä»£ç æ˜¯å¦å¯ä»¥è·‘é€šã€‚</p><p>éªŒè¯æˆåŠŸé‚£ä¹ˆé‡æ„å°±å®Œæˆäº†ï¼Œåœ¨æˆ‘ä»¬å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸çš„é‡æ„æ˜¯æœ‰å¿…è¦çš„ï¼Œåœ¨é¡¹ç›®å¼€å§‹æ—¶ï¼Œä»£ç é‡å¹¶ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„ç»´æŠ¤ï¼Œä½†æ˜¯åŠ å…¥æˆ‘ä»¬ä¸å†åˆæœŸå°±å¯¹è¿™äº›æœ‰å¯èƒ½å˜å¾—è‡ƒè‚¿çš„ä»£ç è¿›è¡Œä¸€äº›å¯èƒ½çš„ç»„ç»‡ï¼Œä»£ç å¾ˆå¿«å°±ä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(äº”)å®ŒæˆéªŒè¯æ‰‹æœºå’Œé‚®ç®±æ˜¯å¦å­˜åœ¨æ¥å£</title>
      <link href="/2022/08/27/go-api-practice-5/"/>
      <url>/2022/08/27/go-api-practice-5/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/thedevsaddam/govalidator</span></span><br></pre></td></tr></table></figure><p>ç®€å•å¥½ç”¨çš„goéªŒè¯åŒ…ï¼Œå¯ä»¥è‡ªå®šä¹‰éªŒè¯è§„åˆ™å’Œé”™è¯¯ä¿¡æ¯</p><h1 id="åˆ›å»ºcontroller"><a class="markdownIt-Anchor" href="#åˆ›å»ºcontroller"></a> åˆ›å»ºcontroller</h1><p><code>app/http/controllers/api/v1/base_api_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BaseController <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œå‰é¢ä¸€æ ·ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªControlleråŸºç±»</p><p><code>app/http/controllers/api/v1/auth/signup_controller.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SignupController <span class="keyword">struct</span> &#123;</span><br><span class="line">   v1.BaseController</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> IsPhoneExist(c *gin.Context) &#123;</span><br><span class="line"></span><br><span class="line">   request := requests.SignupPhoneExistRequest&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;request); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   errs := requests.ValidateSignupPhoneExist(&amp;request, c)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(errs) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;error&quot;</span>: errs,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;exist&quot;</span>: user.IsPhoneExist(request.Phone),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sc *SignupController)</span></span> IsEmailExist(c *gin.Context) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åˆå§‹åŒ–è¯·æ±‚å¯¹è±¡</span></span><br><span class="line">   request := requests.SignupEmailExistRequest&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è§£æ JSON è¯·æ±‚</span></span><br><span class="line">   <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;request); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// è§£æå¤±è´¥ï¼Œè¿”å› 422 çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">      c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// æ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line">      <span class="comment">// å‡ºé”™äº†ï¼Œä¸­æ–­è¯·æ±‚</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è¡¨å•éªŒè¯</span></span><br><span class="line">   errs := requests.ValidateSignupEmailExist(&amp;request, c)</span><br><span class="line">   <span class="comment">// errs è¿”å›é•¿åº¦ç­‰äºé›¶å³é€šè¿‡ï¼Œå¤§äº 0 å³æœ‰é”™è¯¯å‘ç”Ÿ</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(errs) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      <span class="comment">// éªŒè¯å¤±è´¥ï¼Œè¿”å› 422 çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">      c.AbortWithStatusJSON(http.StatusUnprocessableEntity, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;errors&quot;</span>: errs,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  æ£€æŸ¥æ•°æ®åº“å¹¶è¿”å›å“åº”</span></span><br><span class="line">   c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">      <span class="string">&quot;exist&quot;</span>: user.IsEmailExist(request.Email),</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éƒ¨åˆ†éªŒè¯åŒ…ä¸­çš„ç»“æ„ä½“å’Œç›¸å…³å‡½æ•°è¿˜æœªåˆ›å»º</p><p>æ§åˆ¶å™¨ä¸­çš„é€»è¾‘ï¼š</p><ol><li>è§£æå‰ç«¯çš„æ•°æ®åˆ°ç”¨æˆ·æ¨¡å‹</li><li>éªŒè¯è¿™äº›æ•°æ®æ˜¯å¦ç¬¦åˆè§„èŒƒ</li><li>ä»æ•°æ®åº“æ£€æŸ¥æ•°æ®æ˜¯å¦å·²ç»å­˜åœ¨</li></ol><blockquote><p>ShouldBindJSON</p></blockquote><p>æŠŠä¸Šä¸‹æ–‡ä¸­çš„jsonä¿¡æ¯è§£æåˆ°ç»“æ„ä½“ä¸­</p><h1 id="åˆ›å»ºéªŒè¯å‡½æ•°"><a class="markdownIt-Anchor" href="#åˆ›å»ºéªŒè¯å‡½æ•°"></a> åˆ›å»ºéªŒè¯å‡½æ•°</h1><p><code>app/requests/signup_request.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SignupPhoneExistRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   Phone <span class="type">string</span> <span class="string">`json:&quot;phone,omitempty&quot; valid:&quot;phone&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateSignupPhoneExist</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯è§„åˆ™</span></span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;digits:11&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯å‡ºé”™æ—¶çš„æç¤º</span></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;phone&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:æ‰‹æœºå·ä¸ºå¿…å¡«é¡¹ï¼Œå‚æ•°åç§° phone&quot;</span>,</span><br><span class="line">         <span class="string">&quot;digits:æ‰‹æœºå·é•¿åº¦å¿…é¡»ä¸º 11 ä½çš„æ•°å­—&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// é…ç½®åˆå§‹åŒ–</span></span><br><span class="line">   opts := govalidator.Options&#123;</span><br><span class="line">      Data:          data,</span><br><span class="line">      Rules:         rules,</span><br><span class="line">      TagIdentifier: <span class="string">&quot;valid&quot;</span>, <span class="comment">// æ¨¡å‹ä¸­çš„ Struct æ ‡ç­¾æ ‡è¯†ç¬¦</span></span><br><span class="line">      Messages:      messages,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å¼€å§‹éªŒè¯</span></span><br><span class="line">   <span class="keyword">return</span> govalidator.New(opts).ValidateStruct()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šåˆ¶è‡ªå·±æ‰€éœ€çš„éªŒè¯ä¿¡æ¯ï¼Œæœ€åè¿”å›çš„é”™è¯¯ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ªmapä¸­</p><p>éªŒè¯é‚®ç®±çš„ä»£ç ä¸éªŒè¯æ‰‹æœºç±»ä¼¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SignupEmailExistRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">   Email <span class="type">string</span> <span class="string">`json:&quot;email,omitempty&quot; valid:&quot;email&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateSignupEmailExist</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, c *gin.Context)</span></span> <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯è§„åˆ™</span></span><br><span class="line">   rules := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: []<span class="type">string</span>&#123;<span class="string">&quot;required&quot;</span>, <span class="string">&quot;min:4&quot;</span>, <span class="string">&quot;max:30&quot;</span>, <span class="string">&quot;email&quot;</span>&#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è‡ªå®šä¹‰éªŒè¯å‡ºé”™æ—¶çš„æç¤º</span></span><br><span class="line">   messages := govalidator.MapData&#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: []<span class="type">string</span>&#123;</span><br><span class="line">         <span class="string">&quot;required:Email ä¸ºå¿…å¡«é¡¹&quot;</span>,</span><br><span class="line">         <span class="string">&quot;min:Email é•¿åº¦éœ€å¤§äº 4&quot;</span>,</span><br><span class="line">         <span class="string">&quot;max:Email é•¿åº¦éœ€å°äº 30&quot;</span>,</span><br><span class="line">         <span class="string">&quot;email:Email æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// é…ç½®åˆå§‹åŒ–</span></span><br><span class="line">   opts := govalidator.Options&#123;</span><br><span class="line">      Data:          data,</span><br><span class="line">      Rules:         rules,</span><br><span class="line">      TagIdentifier: <span class="string">&quot;valid&quot;</span>, <span class="comment">// æ¨¡å‹ä¸­çš„ Struct æ ‡ç­¾æ ‡è¯†ç¬¦</span></span><br><span class="line">      Messages:      messages,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å¼€å§‹éªŒè¯</span></span><br><span class="line">   <span class="keyword">return</span> govalidator.New(opts).ValidateStruct()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯ä»¥å¤§è‡´ç†è§£è¿™ä¸ªåŒ…çš„ç”¨æ³•ï¼Œè¿˜æ˜¯è¦æé†’ä¸€ç‚¹ï¼Œåœ¨æ¨¡ä»¿ä»£ç è¿‡ç¨‹ä¸­ç»†èŠ‚è¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºé”™çš„ï¼Œä½ å¯ä»¥çœ‹çœ‹æœ‰æ²¡æœ‰ä»¥ä¸‹é—®é¢˜</p><ul><li><code>&amp;</code></li><li><code>:</code></li><li><code>å¤§å°å†™</code></li></ul><p>â€‹â€¦</p><h1 id="åˆ†é…è·¯ç”±"><a class="markdownIt-Anchor" href="#åˆ†é…è·¯ç”±"></a> åˆ†é…è·¯ç”±</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">v1 := router.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123; <span class="comment">//è¿™ä¸ªå¤§æ‹¬å·æ˜¯ä¸ºäº†è®©ç»“æ„æ›´åŠ æ¸…æ™°</span></span><br><span class="line">    v1.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;hello&quot;</span>: <span class="string">&quot;world&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    authGroup := v1.Group(<span class="string">&quot;/auth&quot;</span>)</span><br><span class="line">    &#123; <span class="comment">//è¿™ä¸ªå¤§æ‹¬å·ä¹Ÿæ˜¯ä¸ºäº†è®©ç»“æ„æ›´åŠ æ¸…æ™°</span></span><br><span class="line">        suc := <span class="built_in">new</span>(auth.SignupController)</span><br><span class="line"></span><br><span class="line">        authGroup.POST(<span class="string">&quot;/signup/phone/exist&quot;</span>, suc.IsPhoneExist)</span><br><span class="line">        authGroup.POST(<span class="string">&quot;/signup/email/exist&quot;</span>, suc.IsEmailExist)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h1><p>æˆ‘ä»¬åœ¨apifoxä¸­åˆ›å»ºè¿™ä¸¤ä¸ªauthæ–‡ä»¶å¤¹ï¼Œç„¶åæŠŠè¿™ä¸¤ä¸ªæ¥å£éƒ½æ”¾åœ¨å…¶ä¸­</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220827093243047.png" alt="" /></p><p>è¿™æ˜¯ä¸€ä¸ªé•¿åº¦åªæœ‰10ä½çš„é”™è¯¯æ‰‹æœºå·ï¼Œè¯·æ±‚ç»“æœå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220827093623168.png" alt="" /></p><p>æˆ‘ä»¬å‘æœ«å°¾å¤šæ·»åŠ ä¸€ä¸ª0ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220827093723445.png" alt="" /></p><p>ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®åº“ä¸­æ‰‹åŠ¨åˆ›å»ºåŒ…å«è¿™ä¸ªæ‰‹æœºå·çš„ç”¨æˆ·ç„¶åå†å°è¯•ï¼Œè¿™äº›æµ‹è¯•å°±äº¤ç»™ä½ ä»¬è‡ªå·±äº†</p><ul><li>åˆ›å»ºæ•°æ®åå°è¯•</li><li>è¯·æ±‚é‚®ç®±æ¥å£</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(å››)é›†æˆgorm</title>
      <link href="/2022/08/27/go-api-practice-4/"/>
      <url>/2022/08/27/go-api-practice-4/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get gorm.io/gorm</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get gorm.io/driver/mysql</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä½¿ç”¨gormæ¥ä½¿ç”¨æ•°æ®åº“ï¼Œé¡¹ç›®ä¸­æˆ‘ä»¬ä½¿ç”¨mysqlæ•°æ®åº“</p><h1 id="é›†æˆgorm"><a class="markdownIt-Anchor" href="#é›†æˆgorm"></a> é›†æˆgorm</h1><h3 id="é…ç½®ä¿¡æ¯"><a class="markdownIt-Anchor" href="#é…ç½®ä¿¡æ¯"></a> é…ç½®ä¿¡æ¯</h3><p><code>config/database.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">config.Add(<span class="string">&quot;database&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤æ•°æ®åº“</span></span><br><span class="line"><span class="string">&quot;connection&quot;</span>: config.Env(<span class="string">&quot;DB_CONNECTION&quot;</span>, <span class="string">&quot;mysql&quot;</span>),</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;mysql&quot;</span>: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®åº“è¿æ¥ä¿¡æ¯</span></span><br><span class="line"><span class="string">&quot;host&quot;</span>:     config.Env(<span class="string">&quot;DB_HOST&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>),</span><br><span class="line"><span class="string">&quot;port&quot;</span>:     config.Env(<span class="string">&quot;DB_PORT&quot;</span>, <span class="string">&quot;3306&quot;</span>),</span><br><span class="line"><span class="string">&quot;database&quot;</span>: config.Env(<span class="string">&quot;DB_DATABASE&quot;</span>, <span class="string">&quot;go_api_practice&quot;</span>),</span><br><span class="line"><span class="string">&quot;username&quot;</span>: config.Env(<span class="string">&quot;DB_USERNAME&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line"><span class="string">&quot;password&quot;</span>: config.Env(<span class="string">&quot;DB_PASSWORD&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line"><span class="string">&quot;charset&quot;</span>:  <span class="string">&quot;utf8mb4&quot;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æ± é…ç½®</span></span><br><span class="line"><span class="string">&quot;max_idle_connections&quot;</span>: config.Env(<span class="string">&quot;DB_MAX_IDLE_CONNECTIONS&quot;</span>, <span class="number">100</span>),</span><br><span class="line"><span class="string">&quot;max_open_connections&quot;</span>: config.Env(<span class="string">&quot;DB_MAX_OPEN_CONNECTIONS&quot;</span>, <span class="number">25</span>),</span><br><span class="line"><span class="string">&quot;max_life_seconds&quot;</span>:     config.Env(<span class="string">&quot;DB_MAX_LIFE_SECONDS&quot;</span>, <span class="number">5</span>*<span class="number">60</span>),</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>.env</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">.</span></span><br><span class="line"><span class="attr">.</span></span><br><span class="line"><span class="attr">.</span></span><br><span class="line"><span class="attr">DB_CONNECTION</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">DB_HOST</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">DB_PORT</span>=<span class="string">3306</span></span><br><span class="line"><span class="attr">DB_DATABASE</span>=<span class="string">go_api_practice</span></span><br><span class="line"><span class="attr">DB_USERNAME</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">DB_PASSWORD</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">DB_DEBUG</span>=<span class="string">2</span></span><br></pre></td></tr></table></figure><p>å…ˆç”¨å‰é¢çš„é…ç½®é…ç½®å¥½æ•°æ®åº“ç›¸å…³çš„å‚æ•°</p><h3 id="è¿æ¥æ•°æ®åº“å·¥å…·ç±»"><a class="markdownIt-Anchor" href="#è¿æ¥æ•°æ®åº“å·¥å…·ç±»"></a> è¿æ¥æ•°æ®åº“å·¥å…·ç±»</h3><p><code>pkg/database/database.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DB *gorm.DB</span><br><span class="line"><span class="keyword">var</span> SQLDB *sql.DB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Connect</span><span class="params">(dbConfig gorm.Dialector, _logger gormlogger.Interface)</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">   DB, err = gorm.Open(dbConfig, &amp;gorm.Config&#123;</span><br><span class="line">      Logger: _logger,</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   SQLDB, err = DB.DB()</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨è¿æ¥"><a class="markdownIt-Anchor" href="#å¯åŠ¨è¿æ¥"></a> å¯åŠ¨è¿æ¥</h3><p>å’Œå‰é¢å¯åŠ¨ginçš„æ€è·¯ç±»ä¼¼ï¼Œæˆ‘ä»¬åœ¨<code>bootstrap</code>åŒ…ä¸­ç¼–å†™å¯åŠ¨ç±»</p><p><code>bootstrap/database.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetupDB</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> dbConfig gorm.Dialector</span><br><span class="line">   <span class="keyword">switch</span> config.Get(<span class="string">&quot;database.connection&quot;</span>) &#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="string">&quot;mysql&quot;</span>:</span><br><span class="line">      <span class="comment">// æ„å»º DSN ä¿¡æ¯</span></span><br><span class="line">      dsn := fmt.Sprintf(<span class="string">&quot;%v:%v@tcp(%v:%v)/%v?charset=%v&amp;parseTime=True&amp;multiStatements=true&amp;loc=Local&quot;</span>,</span><br><span class="line">         config.Get(<span class="string">&quot;database.mysql.username&quot;</span>),</span><br><span class="line">         config.Get(<span class="string">&quot;database.mysql.password&quot;</span>),</span><br><span class="line">         config.Get(<span class="string">&quot;database.mysql.host&quot;</span>),</span><br><span class="line">         config.Get(<span class="string">&quot;database.mysql.port&quot;</span>),</span><br><span class="line">         config.Get(<span class="string">&quot;database.mysql.database&quot;</span>),</span><br><span class="line">         config.Get(<span class="string">&quot;database.mysql.charset&quot;</span>),</span><br><span class="line">      )</span><br><span class="line">      dbConfig = mysql.New(mysql.Config&#123;</span><br><span class="line">         DSN: dsn,</span><br><span class="line">      &#125;)</span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">panic</span>(errors.New(<span class="string">&quot;database connection not supported&quot;</span>))</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è¿æ¥æ•°æ®åº“ï¼Œå¹¶è®¾ç½® GORM çš„æ—¥å¿—æ¨¡å¼</span></span><br><span class="line">   database.Connect(dbConfig, logger.Default.LogMode(logger.Info))</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¾ç½®æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">   database.SQLDB.SetMaxOpenConns(config.GetInt(<span class="string">&quot;database.mysql.max_open_connections&quot;</span>))</span><br><span class="line">   <span class="comment">// è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></span><br><span class="line">   database.SQLDB.SetMaxIdleConns(config.GetInt(<span class="string">&quot;database.mysql.max_idle_connections&quot;</span>))</span><br><span class="line">   <span class="comment">// è®¾ç½®æ¯ä¸ªé“¾æ¥çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">   database.SQLDB.SetConnMaxLifetime(time.Duration(config.GetInt(<span class="string">&quot;database.mysql.max_life_seconds&quot;</span>)) * time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šå‰é¢çš„é…ç½®ä¿¡æ¯ï¼Œè¿æ¥æ•°æ®åº“ï¼Œæœ€åæˆ‘ä»¬åœ¨<code>main</code>ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°å³å¯</p><p><code>main.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> env <span class="type">string</span></span><br><span class="line">   flag.StringVar(&amp;env, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">   flag.Parse()</span><br><span class="line">   config.InitConfig(env)</span><br><span class="line"></span><br><span class="line">   router := gin.New()</span><br><span class="line"></span><br><span class="line">   bootstrap.SetupDB()</span><br><span class="line"></span><br><span class="line">   bootstrap.SetupRoute(router)</span><br><span class="line"></span><br><span class="line">   err := router.Run(<span class="string">&quot;:&quot;</span> + config.Get(<span class="string">&quot;app.port&quot;</span>))</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹æ— éæ˜¯é…ç½®ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ€»ä½“ä¸Šæ²¡æœ‰ä»€ä¹ˆéš¾åº¦ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ›å»ºç”¨æˆ·æ¨¡å‹</p><h1 id="åˆ›å»ºç”¨æˆ·æ¨¡å‹"><a class="markdownIt-Anchor" href="#åˆ›å»ºç”¨æˆ·æ¨¡å‹"></a> åˆ›å»ºç”¨æˆ·æ¨¡å‹</h1><p><code>app/models/model.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BaseModel æ¨¡å‹åŸºç±»</span></span><br><span class="line"><span class="keyword">type</span> BaseModel <span class="keyword">struct</span> &#123;</span><br><span class="line">   ID <span class="type">uint64</span> <span class="string">`gorm:&quot;column:id;primaryKey;autoIncrement;&quot; json:&quot;id,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommonTimestampsField æ—¶é—´æˆ³</span></span><br><span class="line"><span class="keyword">type</span> CommonTimestampsField <span class="keyword">struct</span> &#123;</span><br><span class="line">   CreatedAt time.Time <span class="string">`gorm:&quot;column:created_at;index;&quot; json:&quot;created_at,omitempty&quot;`</span></span><br><span class="line">   UpdatedAt time.Time <span class="string">`gorm:&quot;column:updated_at;index;&quot; json:&quot;updated_at,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€äº›åŸºæœ¬çš„å­—æ®µä»¥ä¾›å°†æ¥çš„æ¨¡å‹é‡å¤ä½¿ç”¨</p><p><code>app/models/user/user_model.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User ç”¨æˆ·æ¨¡å‹</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">   models.BaseModel</span><br><span class="line"></span><br><span class="line">   Name     <span class="type">string</span> <span class="string">`json:&quot;name,omitempty&quot;`</span></span><br><span class="line">   Email    <span class="type">string</span> <span class="string">`json:&quot;-&quot;`</span></span><br><span class="line">   Phone    <span class="type">string</span> <span class="string">`json:&quot;-&quot;`</span></span><br><span class="line">   Password <span class="type">string</span> <span class="string">`json:&quot;-&quot;`</span></span><br><span class="line"></span><br><span class="line">   models.CommonTimestampsField</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ç”¨æˆ·æ¨¡å‹ï¼Œæˆ‘ä»¬é¡ºä¾¿ä¸ºè¿™ä¸ªæ¨¡å‹åˆ›å»ºä¸€äº›å¿…è¦çš„å·¥å…·å‡½æ•°</p><p><code>app/models/user/user_util.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsEmailExist</span><span class="params">(email <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> count <span class="type">int64</span></span><br><span class="line">   database.DB.Model(User&#123;&#125;).Where(<span class="string">&quot;email = ?&quot;</span>, email).Count(&amp;count)</span><br><span class="line">   <span class="keyword">return</span> count &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsPhoneExist</span><span class="params">(phone <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> count <span class="type">int64</span></span><br><span class="line">   database.DB.Model(User&#123;&#125;).Where(<span class="string">&quot;phone = ?&quot;</span>, phone).Count(&amp;count)</span><br><span class="line">   <span class="keyword">return</span> count &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ç°é˜¶æ®µçš„æ•°æ®åº“é›†æˆï¼Œæˆ‘ä»¬æ­¤æ—¶è¿˜æ²¡æœ‰åœ¨æ•°æ®åº“ä¸­å»ºç«‹æ•°æ®è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>gorm</code>ä¸­çš„è‡ªåŠ¨è¿ç§»åŠŸèƒ½æ¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨</p><blockquote><p>æ•°æ®åº“è‡ªåŠ¨è¿ç§»</p></blockquote><p><code>bootstrap/database.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetupDB</span><span class="params">()</span></span> &#123;</span><br><span class="line">.</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">   database.DB.AutoMigrate(&amp;user.User&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>gorm</code>ä¼šæ ¹æ®<code>User</code>ç»“æ„ä½“çš„å­—æ®µæ¥è‡ªåŠ¨åˆ›å»ºæ•°æ®è¡¨ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–å·²ç»åˆ›å»ºçš„å­—æ®µï¼Œå¦‚æœä½ å·²ç»è‡ªå·±åˆ›å»ºäº†è‡ªå·±çš„æ•°æ®è¡¨ï¼Œä½ å¯ä»¥åˆ é™¤åé‡è¯•ã€‚</p><p>æœ¬èŠ‚çš„å†…å®¹å¹¶ä¸éš¾ï¼Œä¸»è¦æ˜¯å®Œæˆäº†ä¸€äº›åŸºæœ¬ä¿¡æ¯çš„åˆ›å»ºã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(ä¸‰)é›†æˆviper</title>
      <link href="/2022/08/22/go-api-practice-3/"/>
      <url>/2022/08/22/go-api-practice-3/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><ul><li>viper</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/spf13/viper</span></span><br></pre></td></tr></table></figure><p>viperæ˜¯ä¸€ä¸ªç›¸å½“å¸¸ç”¨çš„é…ç½®ç®¡ç†åŒ…ï¼ŒåŠŸèƒ½ç›¸å½“å¼ºå¤§ã€‚ä½†æ˜¯å¦‚æœä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡è¿™ä¸ªåŒ…ï¼Œç¬¬ä¸€æ¬¡å­¦ä¹ å¯èƒ½æ„Ÿåˆ°ç–‘æƒ‘ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µå»å…ˆå­¦ä¹ viperçš„ç”¨æ³•æˆ–è€…ä¿æŒä¸€å®šçš„ç–‘æƒ‘ã€‚</p><ul><li>cast</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/spf13/cast</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„ç±»å‹è½¬æ¢åŒ…</p><h1 id="ç¼–ç "><a class="markdownIt-Anchor" href="#ç¼–ç "></a> ç¼–ç </h1><h3 id="ç¼–å†™viperå·¥å…·åŒ…"><a class="markdownIt-Anchor" href="#ç¼–å†™viperå·¥å…·åŒ…"></a> ç¼–å†™viperå·¥å…·åŒ…</h3><p><code>pkg/config/config.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/spf13/cast&quot;</span></span><br><span class="line">   viperlib <span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/helpers&quot;</span></span><br><span class="line">   <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> viper *viperlib.Viper</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ConfigFunc <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ConfigFuncs <span class="keyword">map</span>[<span class="type">string</span>]ConfigFunc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   viper = viperlib.New()</span><br><span class="line"></span><br><span class="line">   viper.SetConfigType(<span class="string">&quot;env&quot;</span>)</span><br><span class="line"></span><br><span class="line">   viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"></span><br><span class="line">   viper.SetEnvPrefix(<span class="string">&quot;appenv&quot;</span>)</span><br><span class="line"></span><br><span class="line">   viper.AutomaticEnv()</span><br><span class="line"></span><br><span class="line">   ConfigFuncs = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]ConfigFunc)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitConfig</span><span class="params">(env <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   loadEnv(env)</span><br><span class="line">   loadConfig()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> name, fn := <span class="keyword">range</span> ConfigFuncs &#123;</span><br><span class="line">      viper.Set(name, fn())</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadEnv</span><span class="params">(envSuffix <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   envPath := <span class="string">&quot;.env&quot;</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(envSuffix) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      filePath := envPath + envSuffix</span><br><span class="line">      <span class="keyword">if</span> _, err := os.Stat(filePath); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         envPath = filePath</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   viper.SetConfigName(envPath)</span><br><span class="line">   <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(err)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   viper.WatchConfig()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Env</span><span class="params">(envName <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(defaultValue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> internalGet(envName, defaultValue[<span class="number">0</span>])</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> internalGet(envName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(name <span class="type">string</span>, configFn ConfigFunc)</span></span> &#123;</span><br><span class="line">   ConfigFuncs[name] = configFn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Get</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> GetString(path, defaultValue...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">internalGet</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">   <span class="keyword">if</span> !viper.IsSet(path) || helpers.Empty(viper.Get(path)) &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(defaultValue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> defaultValue[<span class="number">0</span>]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> viper.Get(path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetString</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cast.ToString(internalGet(path, defaultValue...))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetInt</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cast.ToInt(internalGet(path, defaultValue...))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetBool</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cast.ToBool(internalGet(path, defaultValue...))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†…å®¹æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä¸€ç‚¹ç‚¹æ…¢æ…¢è®²</p><blockquote><p>viperå®ä¾‹</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viper = viperlib.New()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>New()</code>æ–¹æ³•å»åˆå§‹åŒ–ä¸€ä¸ª<code>viperå®ä¾‹</code>ï¼Œè¿™æ ·åˆå§‹åŒ–çš„<code>viper</code>ä¼šæœ‰ä¸€äº›é»˜è®¤çš„é…ç½®ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¦æ³¨æ„ï¼Œç‰¹åˆ«çš„ï¼Œä¸è¦å†™æˆä¸€ä¸‹è¿™ç§å½¢å¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viper := viperlib.New()</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span></span> *Viper &#123;</span><br><span class="line">   v := <span class="built_in">new</span>(Viper)</span><br><span class="line">   v.keyDelim = <span class="string">&quot;.&quot;</span></span><br><span class="line">   v.configName = <span class="string">&quot;config&quot;</span></span><br><span class="line">.</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">   <span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çœ‹è¿‡viperçš„å…¥é—¨æ•™ç¨‹ï¼Œé‚£ä¹ˆä½ å°±ä¼šæ˜ç™½è¿™äº›é…ç½®çš„ä½œç”¨ï¼Œå¦‚æœä½ ç°åœ¨è¿˜ä¸èƒ½ç†è§£ï¼Œæˆ‘ä¼šåœ¨ä¸‹é¢ç”¨åˆ°çš„æ—¶å€™åœ¨åŠ ä»¥è¯´æ˜</p><blockquote><p>è®¾ç½®é…ç½®æ–‡ä»¶ç±»å‹å’Œä½ç½®</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigType(<span class="string">&quot;env&quot;</span>)</span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤è¡Œä¸éš¾ç†è§£ï¼Œé…ç½®æ–‡ä»¶ç±»å‹ä¸º<code>env</code>ï¼Œè·¯å¾„ä¸ºå½“å‰ç›®å½•<code>.(ç›¸å¯¹äºmain.go)</code></p><blockquote><p>è‡ªåŠ¨è¯»å–ç¯å¢ƒå˜é‡</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viper.SetEnvPrefix(<span class="string">&quot;appenv&quot;</span>)<span class="comment">//è®¾ç½®äº†é…ç½®æ–‡ä»¶çš„å‰ç¼€</span></span><br><span class="line">viper.AutomaticEnv()<span class="comment">//è‡ªåŠ¨è¯»å–ç¯å¢ƒå˜é‡</span></span><br></pre></td></tr></table></figure><p>å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œæˆ‘æƒ³é…ç½®ç¯å¢ƒå˜é‡å¹¶ä¸é™Œç”Ÿï¼Œå€ŸåŠ©äºgolandå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿé…ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬ä»¥æ­¤æ¥ä¸¾ä¸ªä¾‹å­</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220822101005029.png" alt="" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220822101100635.png" alt="" /></p><p>å¯ä»¥è¿™æ ·æµ‹è¯•</p><p><code>main.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(config.Get(<span class="string">&quot;id&quot;</span>))<span class="comment">//åœ¨mainå‡½æ•°ä¸­åŠ ä¸Š</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ‰“å°å€¼æ˜¯<code>1</code></p><blockquote><p>ConfigFunc</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ConfigFunc <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;<span class="comment">//å®šä¹‰äº†ä¸€ä¸ªç±»å‹ï¼Œè¿™ä¸ªç±»å‹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å€¼æ˜¯map[string]interface&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ConfigFuncs <span class="keyword">map</span>[<span class="type">string</span>]ConfigFunc<span class="comment">//å»ºç«‹äº†ä¸€ä¸ªä»å­—ç¬¦ä¸²å‘ConfigFuncæ˜ å°„çš„map</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¯”è¾ƒè€ƒéªŒGoçš„åŸºç¡€ï¼Œçœ‹ä¸æ‡‚çš„å»å›é¡¾ä¸€ä¸‹<code>type</code>çš„ç”¨æ³•</p><blockquote><p>åˆå§‹åŒ–é…ç½®(è¯»å–é…ç½®)</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitConfig</span><span class="params">(env <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">   loadEnv(env)</span><br><span class="line">   loadConfig()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> name, fn := <span class="keyword">range</span> ConfigFuncs &#123;</span><br><span class="line">      viper.Set(name, fn())</span><br><span class="line">   &#125;</span><br><span class="line">&#125;<span class="comment">//è¿™é‡Œå¾…ä¼šç”¨åˆ°å†ç»†è¯´</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadEnv</span><span class="params">(envSuffix <span class="type">string</span>)</span></span> &#123;<span class="comment">//è¯»å…¥é…ç½®æ–‡ä»¶çš„åç¼€</span></span><br><span class="line">   envPath := <span class="string">&quot;.env&quot;</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(envSuffix) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      filePath := envPath + envSuffix</span><br><span class="line">      <span class="keyword">if</span> _, err := os.Stat(filePath); err != <span class="literal">nil</span> &#123;</span><br><span class="line">         envPath = filePath</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   viper.SetConfigName(envPath)<span class="comment">//é…ç½®æ–‡ä»¶å</span></span><br><span class="line">   <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;<span class="comment">//è¯»å–æ–‡ä»¶</span></span><br><span class="line">      <span class="built_in">panic</span>(err)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   viper.WatchConfig()<span class="comment">//ä¸éœ€è¦é‡æ–°å¯åŠ¨é¡¹ç›®å°±å¯ä»¥æ›´æ”¹å¹¶è¯»å–é…ç½®æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦è®²ä¸€ä¸‹<code>loadEnv</code>ï¼Œè¿™é‡Œçš„åç¼€å¯ä»¥è®©æˆ‘ä»¬æ ¹æ®è¿è¡Œç¯å¢ƒçš„ä¸åŒè¯»å–ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯<code>.env</code>ï¼Œé€šè¿‡åç¼€æˆ‘ä»¬å¯ä»¥è¯»å–<code>.env.test</code>ï¼Œ<code>.env.prod</code>ï¼Œ<code>.env.dev</code>ç­‰</p><p>æ­¤å¤–ï¼Œå¦‚æœä½ æ³¨æ„åˆ°äº†å‰é¢çš„<code>viper.New()</code>ï¼Œä½ å°±ä¼šå‘ç°ä¸‹é¢çš„é…ç½®</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v.configName = <span class="string">&quot;config&quot;</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»è¦æ‰‹åŠ¨è®¾ç½®ä¸€æ¬¡<code>configName</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigName(envPath)</span><br></pre></td></tr></table></figure><p>å¦åˆ™é»˜è®¤çš„å°±æ˜¯<code>config.env(å½“ç„¶ï¼Œå¦‚æœä½ æ„¿æ„è¿™ä¹ˆåšçš„è¯)</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Env</span><span class="params">(envName <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(defaultValue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> internalGet(envName, defaultValue[<span class="number">0</span>])</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> internalGet(envName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(name <span class="type">string</span>, configFn ConfigFunc)</span></span> &#123;</span><br><span class="line">   ConfigFuncs[name] = configFn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²çš„æƒ…å†µæœ€ä¸ºå¸¸è§ï¼Œæˆ‘ä»¬ä¸ºæ­¤å¤šè¿›è¡Œäº†ä¸€æ¬¡å°è£…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Get</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> GetString(path, defaultValue...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œå°è£…äº†ä¸€ä¸ªç§æœ‰çš„Get()</span></span><br><span class="line"><span class="comment">//helpersåŒ…è¿˜æ²¡æœ‰å®Œæˆ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">internalGet</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">   <span class="keyword">if</span> !viper.IsSet(path) || helpers.Empty(viper.Get(path)) &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(defaultValue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> defaultValue[<span class="number">0</span>]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> viper.Get(path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å› ä¸ºviper.Get()è¿”å›çš„æ˜¯ä¸€ä¸ªinterface&#123;&#125;ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬æ­é…castè½¬æ¢æˆæˆ‘ä»¬æƒ³è¦çš„ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetString</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cast.ToString(internalGet(path, defaultValue...))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetInt</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cast.ToInt(internalGet(path, defaultValue...))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetBool</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> cast.ToBool(internalGet(path, defaultValue...))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>Env</code>å’Œå…¶å®ƒå‡½æ•°æˆ‘éƒ½ä¼šåœ¨ä½¿ç”¨çš„æ—¶å€™ç»Ÿä¸€è®²è§£ï¼Œç°åœ¨ç•™ä¸ªå°è±¡å³å¯ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†viperå·¥å…·ç±»ï¼Œä¸‹é¢æˆ‘ä»¬å®Œæˆ<code>helpers</code>çš„å°æ’æ›²ï¼ŒæŠŠæœ€é‡è¦çš„<code>config</code>å†…å®¹ç•™åˆ°æœ€å</p><h3 id="helperså·¥å…·åŒ…"><a class="markdownIt-Anchor" href="#helperså·¥å…·åŒ…"></a> helperså·¥å…·åŒ…</h3><p><code>helpers/helpers.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> helpers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Empty</span><span class="params">(val <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> val == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">   v := reflect.ValueOf(val)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">switch</span> v.Kind() &#123;</span><br><span class="line">   <span class="keyword">case</span> reflect.String, reflect.Array:</span><br><span class="line">      <span class="keyword">return</span> v.Len() == <span class="number">0</span></span><br><span class="line">   <span class="keyword">case</span> reflect.Map, reflect.Slice:</span><br><span class="line">      <span class="keyword">return</span> v.Len() == <span class="number">0</span> || v.IsNil()</span><br><span class="line">   <span class="keyword">case</span> reflect.Bool:</span><br><span class="line">      <span class="keyword">return</span> !v.Bool()</span><br><span class="line">   <span class="keyword">case</span> reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:</span><br><span class="line">      <span class="keyword">return</span> v.Int() == <span class="number">0</span></span><br><span class="line">   <span class="keyword">case</span> reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64:</span><br><span class="line">      <span class="keyword">return</span> v.Uint() == <span class="number">0</span></span><br><span class="line">   <span class="keyword">case</span> reflect.Float32, reflect.Float64:</span><br><span class="line">      <span class="keyword">return</span> v.Float() == <span class="number">0</span></span><br><span class="line">   <span class="keyword">case</span> reflect.Interface, reflect.Ptr:</span><br><span class="line">      <span class="keyword">return</span> v.IsNil()</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> reflect.DeepEqual(val, reflect.Zero(v.Type()).Interface())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>viper.Get()</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>interface&#123;&#125;</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç‰¹åˆ«çš„æ¥å¤„ç†ä¸€ä¸‹å®ƒçš„åˆ¤ç©º</p><p>å…¶ä¸­<code>reflect.DeepEqual()</code>å°±å¯ä»¥å®Œå…¨å®Œæˆè¿™ä¸ªå·¥ä½œäº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reflect.DeepEqual(val, reflect.Zero(v.Type()).Interface())</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç”±äºå…¶ä¸­ç”¨äº†å¾ˆå¤šåå°„æ“ä½œï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å°½å¯èƒ½åœ°å¤„ç†ä¸€äº›è‡ªå·±å¯ä»¥å¤„ç†çš„ç©ºç±»å‹åˆ¤æ–­ï¼Œæ¥åŠ å¿«ç¨‹åºçš„è¿è¡Œé€Ÿåº¦</p><h3 id="å®ŒæˆconfigåŒ…å’Œå¯¹é…ç½®è¿‡ç¨‹åŠ è½½çš„å…¨è§£æ"><a class="markdownIt-Anchor" href="#å®ŒæˆconfigåŒ…å’Œå¯¹é…ç½®è¿‡ç¨‹åŠ è½½çš„å…¨è§£æ"></a> å®ŒæˆconfigåŒ…å’Œå¯¹é…ç½®è¿‡ç¨‹åŠ è½½çš„å…¨è§£æ</h3><p>å…ˆè´´ä¸Šå…¨éƒ¨çš„ä»£ç ï¼Œè¦æ³¨æ„ï¼Œä¹‹å‰çš„<code>config</code>å·¥å…·åŒ…æ˜¯åœ¨<code>pkg</code>ä¸‹çš„ï¼Œç°åœ¨æˆ‘ä»¬è¦åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>config</code>åŒ…</p><p><code>config/app.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   config.Add(<span class="string">&quot;app&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// åº”ç”¨åç§°</span></span><br><span class="line">         <span class="string">&quot;name&quot;</span>: config.Env(<span class="string">&quot;APP_NAME&quot;</span>, <span class="string">&quot;go-api-pratice&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å½“å‰ç¯å¢ƒï¼Œç”¨ä»¥åŒºåˆ†å¤šç¯å¢ƒï¼Œä¸€èˆ¬ä¸º local, stage, production, test</span></span><br><span class="line">         <span class="string">&quot;env&quot;</span>: config.Env(<span class="string">&quot;APP_ENV&quot;</span>, <span class="string">&quot;production&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æ˜¯å¦è¿›å…¥è°ƒè¯•æ¨¡å¼</span></span><br><span class="line">         <span class="string">&quot;debug&quot;</span>: config.Env(<span class="string">&quot;APP_DEBUG&quot;</span>, <span class="literal">false</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// åº”ç”¨æœåŠ¡ç«¯å£</span></span><br><span class="line">         <span class="string">&quot;port&quot;</span>: config.Env(<span class="string">&quot;APP_PORT&quot;</span>, <span class="string">&quot;3000&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// åŠ å¯†ä¼šè¯ã€JWT åŠ å¯†</span></span><br><span class="line">         <span class="string">&quot;key&quot;</span>: config.Env(<span class="string">&quot;APP_KEY&quot;</span>, <span class="string">&quot;33446a9dcf9ea060a0a6532b166da32f304af0de&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// ç”¨ä»¥ç”Ÿæˆé“¾æ¥</span></span><br><span class="line">         <span class="string">&quot;url&quot;</span>: config.Env(<span class="string">&quot;APP_URL&quot;</span>, <span class="string">&quot;http://localhost:3000&quot;</span>),</span><br><span class="line"></span><br><span class="line">         <span class="comment">// è®¾ç½®æ—¶åŒºï¼ŒJWT é‡Œä¼šä½¿ç”¨ï¼Œæ—¥å¿—è®°å½•é‡Œä¹Ÿä¼šä½¿ç”¨åˆ°</span></span><br><span class="line">         <span class="string">&quot;timezone&quot;</span>: config.Env(<span class="string">&quot;TIMEZONE&quot;</span>, <span class="string">&quot;Asia/Shanghai&quot;</span>),</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>config/config.go</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package config</span><br><span class="line"></span><br><span class="line">func Initialize() &#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>.env</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">APP_ENV</span>=<span class="string">local</span></span><br><span class="line"><span class="attr">APP_KEY</span>=<span class="string">zBqYyQrPNaIUsnRhsGtHLivjqiMjBVLS</span></span><br><span class="line"><span class="attr">APP_DEBUG</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">APP_URL</span>=<span class="string">http://localhost:3000</span></span><br><span class="line"><span class="attr">APP_LOG_LEVEL</span>=<span class="string">debug</span></span><br><span class="line"><span class="attr">APP_PORT</span>=<span class="string">3000</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„é…ç½®æ–‡ä»¶åå°±å«åš<code>.env</code></p><h4 id="åŠ è½½è¿‡ç¨‹åˆ†æ"><a class="markdownIt-Anchor" href="#åŠ è½½è¿‡ç¨‹åˆ†æ"></a> åŠ è½½è¿‡ç¨‹åˆ†æ</h4><p>æˆ‘ä»¬ä¼šä»<code>config.Add()</code>å‡½æ•°å¼€å§‹ï¼ŒæŒ‰ç…§å‡½æ•°æ‰§è¡Œæ­¥éª¤åšä¸€æ­¥ä¸€æ­¥çš„åˆ†æï¼Œå‡½æ•°ç»†èŠ‚è¯·è‡ªå·±ç¿»é˜…ä¸Šé¢çš„ä»£ç ï¼Œå¯èƒ½æœ‰ç‚¹ç»•ï¼Œè¯·é™ä¸‹å¿ƒæ¥æ…¢æ…¢çœ‹</p><blockquote><p>config.Add()</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ˜ å°„ï¼Œä»<code>&quot;app&quot;</code>åˆ°ä¸€ä¸ª<code>func() map[string]interface&#123;&#125;</code>å‡½æ•°</p><blockquote><p>loadEnv()</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">viper.SetConfigName(envPath)</span><br><span class="line"><span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">   <span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥viperè¯»å–äº†<code>.env(æˆ–è€…åˆ«çš„ç¯å¢ƒ)</code>æ–‡ä»¶ï¼Œå¹¶ä¸”æŠŠè¿™äº›é”®å€¼å¯¹éƒ½åŠ è½½åˆ°äº†viperä¸­ï¼Œå½¢å¼å¦‚ä¸‹</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app_env</span>=<span class="string">local</span></span><br><span class="line"><span class="attr">...</span></span><br><span class="line"><span class="comment"># æŠŠé”®éƒ½å˜æˆå°å†™</span></span><br><span class="line"><span class="comment"># å®é™…ä¸Šæ˜¯é”®å€¼å¯¹ï¼Œè¿™é‡Œè¡¨ç¤ºä¸€ä¸‹</span></span><br></pre></td></tr></table></figure><blockquote><p>loadConfig()</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> name, fn := <span class="keyword">range</span> ConfigFuncs &#123;</span><br><span class="line">      viper.Set(name, fn())</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å»è°ƒç”¨æ‰€æœ‰çš„<code>ConfigFuncs</code>å‡½æ•°æ¥è®¾ç½®é”®å€¼å¯¹ï¼Œè¿™é‡Œçš„é”®ç›®å‰åªæœ‰<code>&quot;app&quot;</code>ï¼Œç›®å‰å®é™…çš„å†…å®¹æ˜¯è¿™æ ·çš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line"><span class="string">name:XXX</span></span><br><span class="line"><span class="string">env:XXX</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p><code>app</code>ä¸‹é¢çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯<code>fn()</code>çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„è¿”å›å†…å®¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">config.Add(<span class="string">&quot;app&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">       <span class="comment">// åº”ç”¨æœåŠ¡ç«¯å£</span></span><br><span class="line">       <span class="string">&quot;port&quot;</span>: config.Env(<span class="string">&quot;APP_PORT&quot;</span>, <span class="string">&quot;3000&quot;</span>),</span><br><span class="line">       <span class="comment">// è®¾ç½®æ—¶åŒºï¼ŒJWT é‡Œä¼šä½¿ç”¨ï¼Œæ—¥å¿—è®°å½•é‡Œä¹Ÿä¼šä½¿ç”¨åˆ°</span></span><br><span class="line">       <span class="string">&quot;timezone&quot;</span>: config.Env(<span class="string">&quot;TIMEZONE&quot;</span>, <span class="string">&quot;Asia/Shanghai&quot;</span>),</span><br><span class="line">       <span class="comment">// å½“å‰ç¯å¢ƒï¼Œç”¨ä»¥åŒºåˆ†å¤šç¯å¢ƒï¼Œä¸€èˆ¬ä¸º local, stage, production, test</span></span><br><span class="line">       <span class="string">&quot;env&quot;</span>: config.Env(<span class="string">&quot;APP_ENV&quot;</span>, <span class="string">&quot;production&quot;</span>),</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±ä»¥è¿™ä¸ª<code>env</code>ä¸ºä¾‹</p><blockquote><p>config.Env()</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">func Env(envName string, defaultValue ...interface&#123;&#125;) interface&#123;&#125; &#123;</span><br><span class="line">   if len(defaultValue) &gt; 0 &#123;</span><br><span class="line">      return internalGet(envName, defaultValue[0])</span><br><span class="line">   &#125;</span><br><span class="line">   return internalGet(envName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œæ ¹æ®æƒ…å†µè°ƒç”¨<code>internalGet()</code></p><blockquote><p>internalGet()</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">internalGet</span><span class="params">(path <span class="type">string</span>, defaultValue ...<span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">   <span class="keyword">if</span> !viper.IsSet(path) || helpers.Empty(viper.Get(path)) &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(defaultValue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> defaultValue[<span class="number">0</span>]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> viper.Get(path)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†æ˜¯å…³é”®ï¼Œé¦–å…ˆï¼Œæ–¹æ³•ä¼šåˆ¤æ–­è¿™ä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼Œé‚£ä¹ˆæ­¤æ—¶viperå†…éƒ¨å·²ç»è¯»å…¥äº†ä»€ä¹ˆå‘¢ï¼Œ</p><p>æ²¡é”™ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app_env</span>=<span class="string">local</span></span><br><span class="line"><span class="attr">...</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™çš„<code>path</code>æ˜¯<code>APP_ENV(åœ¨Getæ—¶éƒ½ä¼šç»Ÿä¸€è½¬åŒ–æˆå°å†™)</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™é”®å­˜åœ¨ï¼Œè°ƒç”¨<code>viper.Get(path)</code>ï¼Œå€¼ä¸º<code>local</code>ï¼Œæ‰€ä»¥è¿”å›å€¼æ˜¯<code>local</code>ï¼Œé‚£ä¹ˆè¿™æ ·ä¸€ä¸ªé…ç½®å°±ç¡®å®šä¸‹æ¥äº†ï¼Œä¸‹é¢çš„é€»è¾‘éƒ½æ˜¯ç›¸åŒçš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line"><span class="string">name:XXX</span></span><br><span class="line"><span class="string">env:local</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>åä¹‹ï¼ŒåŠ å…¥æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å¦‚æœæ²¡æœ‰<code>app_env=local</code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬è°ƒç”¨å‡½æ•°çš„æ—¶å€™ä¼ å…¥äº†ä¸€ä¸ªé»˜è®¤å€¼<code>production</code>ï¼Œæ‰€ä»¥ï¼ŒåŠ å…¥æˆ‘ä»¬æ²¡æœ‰é…ç½®è¿™ä¸€é¡¹ï¼Œè¿”å›å€¼å°±æ˜¯<code>production</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line"><span class="string">name:XXX</span></span><br><span class="line"><span class="string">env:production</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å…¨éƒ¨çš„åŠ è½½è¿‡ç¨‹äº†ï¼Œå¦‚æœä½ äº†è§£viperï¼Œå°±ä¼šçŸ¥é“<code>viper.Set()</code>çš„ä¼˜å…ˆçº§é«˜äºé…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€åå‘ç°åœ¨è¿™ä¸ªè½¬æ¢ä¸­ï¼Œé…ç½®æ–‡ä»¶éƒ½è¢«åŠ è½½åˆ°äº†<code>viper.Set()</code>ä¸­</p><h3 id="ä½¿ç”¨é…ç½®"><a class="markdownIt-Anchor" href="#ä½¿ç”¨é…ç½®"></a> ä½¿ç”¨é…ç½®</h3><p><code>main.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;flag&quot;</span></span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/bootstrap&quot;</span></span><br><span class="line">   btsconfig <span class="string">&quot;go-api-practice/config&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/pkg/config&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">   btsconfig.Initialize()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> env <span class="type">string</span></span><br><span class="line">   flag.StringVar(&amp;env, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">   flag.Parse()</span><br><span class="line">   config.InitConfig(env)</span><br><span class="line"></span><br><span class="line">   router := gin.New()</span><br><span class="line"></span><br><span class="line">   bootstrap.SetupRoute(router)</span><br><span class="line"></span><br><span class="line">   err := router.Run(<span class="string">&quot;:&quot;</span> + config.Get(<span class="string">&quot;app.port&quot;</span>))</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œæˆ‘ç›¸ä¿¡ä½ ä¾ç„¶å¯èƒ½ä¼šæœ‰å‡ ä¸ªç–‘æƒ‘çš„ç‚¹ï¼Œæˆ‘ä»¬æ¥ä¸€ä¸€è§£ç­”</p><blockquote><p>btsconfig.Initialize()çš„ä½œç”¨</p></blockquote><p>æˆ‘ä»¬çŸ¥é“Goä¸­çš„<code>init()</code>å‡½æ•°ä¼šåœ¨<code>main</code>å‡½æ•°ä¹‹å‰è¢«è°ƒç”¨ï¼Œè€Œå¯¹äºåˆ«çš„åŒ…çš„<code>init()</code>å‡½æ•°è€Œè¨€ï¼Œå®ƒä»¬è¢«è°ƒç”¨çš„æ—¶å€™å°±æ˜¯è¿™ä¸ªåŒ…è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä½ ç»†å¿ƒçš„è¯å°±ä¼šå‘ç°<code>app.go</code>çš„å†…å®¹æ˜¯å†™åœ¨<code>init()</code>å‡½æ•°ä¸­çš„ï¼Œæ‰€ä»¥<code>btsconfig.Initialize()</code>çš„ä½œç”¨å°±æ˜¯è°ƒç”¨<code>config</code>åŒ…ä¸‹çš„æ‰€æœ‰<code>init()</code>å‡½æ•°</p><blockquote><p>å…³äºflagåŒ…</p></blockquote><p>ä½œç”¨æ˜¯è¯»å–å‘½ä»¤è¡Œå‚æ•°ï¼Œè¿™é‡Œå°±ç®€å•çš„è¯´æ˜ä¸€ä¸‹ä½œç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go run main.go --<span class="built_in">env</span> .dev</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬åœ¨è¿è¡Œçš„æ—¶å€™å°±å¯ä»¥è¯»å–<code>.env.dev</code>é…ç½®æ–‡ä»¶å•¦(ç»“åˆInitConfigå‡½æ•°)</p><blockquote><p>å…³äºapp.port</p></blockquote><p>è¿˜è®°å¾—æœ€å‰é¢çš„viperåˆå§‹åŒ–æ—¶çš„<code>viper.New()</code>å—</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v.keyDelim = <span class="string">&quot;.&quot;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºé…ç½®çš„å¤šå±‚åµŒå¥—ï¼Œviperè‡ªæœ‰å®ƒçš„è¯»å–æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>viper.Get()</code>æ—¶ä¸­é—´ç”¨<code>.</code>éš”å¼€</p><p>åˆ°è¿™é‡Œï¼Œviperé›†æˆå°±å®Œæˆäº†ï¼Œè¿™éƒ¨åˆ†å†…å®¹æœ‰äº›å¤æ‚ï¼Œæ…¢æ…¢æ¥ï¼Œä½ å¯ä»¥ä¼‘æ¯ä¸€ä¸‹ï¼Œå¥½å¥½æ€»ç»“ä¸Šé¢çš„å†…å®¹ç„¶åå†å¼€å¯ä¸‹ä¸€èŠ‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(äºŒ)é›†æˆgin</title>
      <link href="/2022/08/22/go-api-practice-2/"/>
      <url>/2022/08/22/go-api-practice-2/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å§‹å‰çš„å‡†å¤‡"><a class="markdownIt-Anchor" href="#å¼€å§‹å‰çš„å‡†å¤‡"></a> å¼€å§‹å‰çš„å‡†å¤‡</h1><ul><li>gin</li></ul><p><code>go get github.com/gin-gonic/gin</code></p><h1 id="ç¼–ç "><a class="markdownIt-Anchor" href="#ç¼–ç "></a> ç¼–ç </h1><h3 id="æ„å»ºmainå‡½æ•°"><a class="markdownIt-Anchor" href="#æ„å»ºmainå‡½æ•°"></a> æ„å»ºmainå‡½æ•°</h3><p><code>main.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   router := gin.New()</span><br><span class="line"></span><br><span class="line">   bootstrap.SetupRoute(router)</span><br><span class="line"></span><br><span class="line">   err := router.Run(<span class="string">&quot;:3000&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šåœ¨<code>bootstrap</code>åŒ…ä¸­çš„<code>SetupRoute()</code>ä¸­åˆå§‹åŒ–<code>router</code>ï¼Œä¸‹é¢æˆ‘ä»¬å»å®Œæˆè¿™ä¸ªå‡½æ•°</p><h3 id="åˆå§‹åŒ–router"><a class="markdownIt-Anchor" href="#åˆå§‹åŒ–router"></a> åˆå§‹åŒ–router</h3><p><code>bootstrap/route.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bootstrap</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;go-api-practice/routes&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetupRoute</span><span class="params">(router *gin.Engine)</span></span> &#123;</span><br><span class="line">   registerGlobalMiddleware(router)</span><br><span class="line">   routes.RegisterAPIRoutes(router)</span><br><span class="line">   setup404Handler(router)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerGlobalMiddleware</span><span class="params">(router *gin.Engine)</span></span> &#123;</span><br><span class="line">   router.Use(</span><br><span class="line">      gin.Recovery(),</span><br><span class="line">      gin.Logger(),</span><br><span class="line">   )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup404Handler</span><span class="params">(router *gin.Engine)</span></span> &#123;</span><br><span class="line">   router.NoRoute(<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">      c.JSON(http.StatusNotFound, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;error_code&quot;</span>:    <span class="number">404</span>,</span><br><span class="line">         <span class="string">&quot;error_message&quot;</span>: <span class="string">&quot;é¡µé¢ä¸å­˜åœ¨&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>registerGlobalMiddleware()</p></blockquote><p><code>registerGlobalMiddleware(router *gin.Engine)</code>ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­æˆ‘ä»¬å»æ³¨å†Œéœ€è¦ä½¿ç”¨çš„ä¸­é—´ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ginè‡ªå¸¦çš„ä¸­é—´ä»¶å³å¯ï¼Œæ­¤å¤–<code>setup404Handler(router *gin.Engine)</code>è®¾ç½®äº†<code>404</code>æ—¶çš„è¿”å›ç»“æœã€‚</p><blockquote><p>gin.H</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> H <span class="keyword">map</span>[<span class="type">string</span>]any</span><br><span class="line"><span class="keyword">type</span> any = <span class="keyword">interface</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>gin.H</code>æ˜¯ä¸€ä¸ª<code>map[string]interface&#123;&#125;</code>ç±»å‹ï¼Œå€ŸåŠ©äº<code>gin.H</code>æˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„æ„å»ºæƒ³è¦è¿”å›çš„JSONæ•°æ®</p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±é…ç½®å¥½äº†æˆ‘ä»¬çš„<code>gin.Engine</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨<code>routes</code>åŒ…ä¸‹çš„<code>api.go</code>ä¸­æ³¨å†Œè·¯ç”±</p><h3 id="æ³¨å†Œè·¯ç”±"><a class="markdownIt-Anchor" href="#æ³¨å†Œè·¯ç”±"></a> æ³¨å†Œè·¯ç”±</h3><p><code>routes/api.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> routes</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">   <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RegisterAPIRoutes</span><span class="params">(router *gin.Engine)</span></span> &#123;</span><br><span class="line">   v1 := router.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line"></span><br><span class="line">   v1.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">      c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">         <span class="string">&quot;hello&quot;</span>: <span class="string">&quot;world&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡è·¯ç”±ç»„çš„å½¢å¼å»æ§åˆ¶APIçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†ä¸åŒç‰ˆæœ¬çš„API</p><h3 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h3><p>é€šè¿‡Apifoxæ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸¤ä¸ªAPI</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220821221623020.png" alt="" /></p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220821221648095.png" alt="" /></p><p>è®¾ç½®å¥½ä¹‹åè¿è¡Œï¼Œå¦‚æœç»“æœå’Œæˆ‘ä»¬é¢„æœŸä¸€è‡´ï¼Œé‚£ä¹ˆå°±æˆåŠŸäº†</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220821221946788.png" alt="" /></p><p>å¦‚æœä½ æµ‹è¯•å¤±è´¥äº†ï¼Œå¯èƒ½æ˜¯é»˜è®¤çš„ç¯å¢ƒç«¯å£é”™äº†ï¼Œä½ å¯ä»¥åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œé…ç½®</p><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/image-20220821222149668.png" alt="" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(ä¸€)é¡¹ç›®åŸºç¡€ä¿¡æ¯å’Œè¯´æ˜</title>
      <link href="/2022/08/21/go-api-practice-1/"/>
      <url>/2022/08/21/go-api-practice-1/</url>
      
        <content type="html"><![CDATA[<h1 id="æ‰€éœ€è¦çš„goè¯­è¨€åŸºç¡€"><a class="markdownIt-Anchor" href="#æ‰€éœ€è¦çš„goè¯­è¨€åŸºç¡€"></a> æ‰€éœ€è¦çš„Goè¯­è¨€åŸºç¡€</h1><p>è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œå…¨é›¶åŸºç¡€çš„Goè¯­è¨€Webé¡¹ç›®æ•™ç¨‹ï¼Œä½ éœ€è¦å¯¹åŒ…æ‹¬ä½†ä¸é™äº<code>gin</code>ï¼Œ<code>gorm</code>ç­‰å¸¸ç”¨æ¡†æ¶æœ‰ä¸€å®šçš„äº†è§£ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ ä¹‹å‰æœ‰è¿‡å…¶å®ƒè¯­è¨€çš„Webå¼€å‘ç»éªŒï¼Œé‚£ä¹ˆæˆ‘ç›¸ä¿¡ä½ ä¹Ÿå¯ä»¥å¾ˆå¿«å­¦ä¼šè¿™äº›å†…å®¹ã€‚å¦‚æœæ²¡æœ‰è¿™äº›åŸºç¡€ï¼Œä½ å¯ä»¥è·Ÿç€æœ¬æ•™ç¨‹åšä¸‹å»ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¯ä¸€éƒ¨åˆ†çš„ç»ƒä¹ ä¸­å†™ä¸Šæ‰€éœ€è¦çš„åŸºç¡€ï¼Œä½ å¯ä»¥è‡ªå·±å»æ‰¾èµ„æ–™å­¦ä¹ ï¼Œä¹Ÿå¯ä»¥çœ‹åšå®¢ä¸­çš„æ•™ç¨‹(å¦‚æœæœ‰çš„è¯)ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œåªè¦æœ‰è€å¿ƒï¼Œå®Œæˆè¿™ä¸ªé¡¹ç›®å¹¶ä¸ä¼šå¤ªå›°éš¾ï¼Œè€Œä¸”ä½ ä¼šå­¦ä¹ åˆ°å¾ˆå¤šğŸ˜ƒã€‚</p><h1 id="è¯´æ˜"><a class="markdownIt-Anchor" href="#è¯´æ˜"></a> è¯´æ˜</h1><ul><li>åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šé‡åˆ°é™Œç”Ÿçš„çŸ¥è¯†å’Œå†…å®¹ï¼Œç¬¬ä¸€éä½¿ç”¨æ—¶ä¸éœ€è¦äº†è§£è¿™äº›å†…å®¹çš„ç»†èŠ‚ï¼Œåœ¨é€‚å½“çš„æ—¶å€™<code>ä¸æ±‚ç”šè§£</code>å¯ä»¥è®©æˆ‘ä»¬çš„å­¦ä¹ è¿›åº¦æ›´åŠ æµç•…</li><li>å®Œæˆè¿™äº›éƒ¨åˆ†çš„æ—¶å€™ï¼Œæˆ‘ä¼šæŒ‰ç…§ç»“æ„ç”±å¤–è€Œå†…çš„è®²è§£ç¼–ç ã€‚ä¹Ÿå°±æ˜¯å†™ä¸‹è¿™ä»½ä»£ç æ—¶å¯èƒ½è¿˜æœ‰ä¸€äº›å‡½æ•°æ²¡æœ‰å®Œæˆï¼Œå¦‚æœä½ ä¸ä¹ æƒ¯è¿™ç§é¡ºåºï¼Œå¯ä»¥å…ˆç¿»åˆ°ä¸‹é¢å®Œæˆè¿™äº›å‡½æ•°</li><li>æ¯ä¸ªä»£ç å—çš„å‰é¢éƒ½ä¼šé™„ä¸Šä»£ç æ‰€åœ¨çš„åŒ…å’Œæ–‡ä»¶çš„ä½ç½®ï¼Œè¯·æŒ‰ç…§è¿™ä¸ªä½ç½®å»å»ºç«‹æ–‡ä»¶ï¼Œæ‰€æœ‰çš„æ–‡ä»¶è¯´æ˜é»˜è®¤éƒ½æ˜¯ä»æ ¹ç›®å½•å¼€å§‹çš„ã€‚</li><li>å¯¹äºä»£ç çš„è®²è§£ï¼Œæˆ‘ä¼šåå‘äºè¿™ä¸ªå·¥å…·åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Œè€Œä¸ä¼šä»é›¶å¼€å§‹å»è®²è§£ä¸€ä¸ªåŒ…æ€ä¹ˆä½¿ç”¨ï¼Œå¦‚æœä½ è¿˜å®Œå…¨ä¸ä¼šï¼Œé‚£ä¹ˆå»ºè®®å…ˆè‡ªå­¦ä¸€ä¸‹åŸºç¡€å†…å®¹</li><li>è¿™æ˜¯GoæŠ€æœ¯è®ºå›ä¸Šçš„ä¸€ä¸ªå®æˆ˜ï¼Œä¸è¿‡æ˜¯ä»˜è´¹çš„ï¼Œå¦‚æœä½ æƒ³è¦å»ä½“éªŒä¸€ä¸‹ï¼Œé‚£ä¹ˆé“¾æ¥å†è¿™é‡Œ<a href="https://learnku.com/courses/go-api/1.19">ã€ŠG02 Go API å®æˆ˜ã€‹ | Go æŠ€æœ¯è®ºå› (learnku.com)</a></li></ul><h1 id="å¼€å§‹ä¹‹å‰ä½ éœ€è¦çš„å‡†å¤‡å’ŒåŸºç¡€"><a class="markdownIt-Anchor" href="#å¼€å§‹ä¹‹å‰ä½ éœ€è¦çš„å‡†å¤‡å’ŒåŸºç¡€"></a> å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦çš„å‡†å¤‡å’ŒåŸºç¡€</h1><ul><li>Goè¯­è¨€çš„åŸºç¡€è¯­æ³•</li><li>æ¥å£è°ƒè¯•å·¥å…·<a href="https://www.apifox.cn/">Apifox</a>(å¦‚æœæ˜¯å…¶å®ƒå·¥å…·ä¹Ÿå¯ä»¥)</li><li>å¼€å‘ç¯å¢ƒ<a href="https://www.jetbrains.com/go/">GoLand</a></li><li>ä¸€é¢—çƒ­çˆ±ç¼–ç¨‹çš„å¿ƒ</li></ul><h1 id="å¸¸è§é—®é¢˜"><a class="markdownIt-Anchor" href="#å¸¸è§é—®é¢˜"></a> å¸¸è§é—®é¢˜</h1><blockquote><p>å·²ç»æŒ‰ç…§è¦æ±‚ä¸‹è½½äº†åŒ…ï¼Œä½†æ˜¯ç¼–è¯‘æ—¶ç¼ºå°‘ä¾èµ–</p></blockquote><p>å¯ä»¥å°è¯•ä½¿ç”¨<code>go mod tidy</code>å»ä¸‹è½½ç¼ºå°‘çš„ä¾èµ–</p><blockquote><p>å‡ºé”™æ—¶æ£€æŸ¥äº†å¾ˆå¤šéä½ çš„ä»£ç å’Œæˆ‘çš„æ ‡å‡†ä»£ç ä¹‹é—´çš„åŒºåˆ«ï¼Œå§‹ç»ˆæ‰¾ä¸åˆ°é—®é¢˜</p></blockquote><p>å¯èƒ½æœ‰å¦‚ä¸‹é—®é¢˜</p><ul><li>ç¯å¢ƒé—®é¢˜ï¼Œç‰ˆæœ¬ä¸åŒ</li><li>æˆ‘çš„åšå®¢å†™é”™äº†ï¼Œå¦‚æœå‘ç°è¿™ä¸ªé—®é¢˜è¯·åé¦ˆç»™æˆ‘ï¼Œæˆ‘ä¼šéå¸¸æ„Ÿè°¢ä½ çš„å¸®åŠ©</li><li>ä»£ç ç›¸åŒï¼Œä½†æ˜¯é¡ºåºé”™äº†ï¼Œæœ‰äº›æ—¶å€™ä¼šé€ æˆä¸€äº›éš¾ä»¥é¢„æ–™çš„é—®é¢˜</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AtCoder Beginner Contest 248</title>
      <link href="/2022/04/17/AtCoder-Beginner-Contest-248/"/>
      <url>/2022/04/17/AtCoder-Beginner-Contest-248/</url>
      
        <content type="html"><![CDATA[<h1 id="atcoder-beginner-contest-248"><a class="markdownIt-Anchor" href="#atcoder-beginner-contest-248"></a> AtCoder Beginner Contest 248</h1><blockquote><p>ä¸‹è½½<a href="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/AtCoder-Beginner-Contest-248.pdf">PDF</a>ï¼Œè·å¾—åˆ«æ ·çš„è§‚çœ‹ä½“éªŒ</p></blockquote><p><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/1650191469761.jpg.jpg" alt=""></p><h2 id="a-lacked-number"><a class="markdownIt-Anchor" href="#a-lacked-number"></a> A - Lacked Number</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å‡º10ä¸ªæ•°å­—ï¼Œè¾“å‡º0~9ä¸­æœªå‡ºç°çš„é‚£ä¸ªæ•°å­—ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>ç»Ÿè®¡æ•°å­—å‡ºç°æƒ…å†µå³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/%28NKG%7D7TF7Z%7EZBHKIM%40E%60EZ5.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">32768</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> cnt[<span class="number">10</span>] = {<span class="number">0</span>};</span><br><span class="line">    std::string s;</span><br><span class="line">    std::cin&gt;&gt;s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> c : s)cnt[c-<span class="string">'0'</span>]++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)<span class="keyword">if</span>(!cnt[i])std::cout&lt;&lt;i;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="b-slimes"><a class="markdownIt-Anchor" href="#b-slimes"></a> B - Slimes</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">A,B,K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>ä¸‰ä¸ªæ•°å­—,æ¯æ¬¡æ“ä½œå¯ä»¥ä½¿<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>A</mi><mo>âˆ—</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">A=A*K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>,è¾“å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>â‰¥</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">A\geq B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>çš„æœ€å°æ¬¡æ•°</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>ç›´æ¥æ¨¡æ‹Ÿå³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mfrac><mi>B</mi><mrow><mi>A</mi><mi>K</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\frac{B}{AK})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/U%7EO%40K272%246%7D2%5DH4N54A%2949E.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">32768</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    ll a,b,k;</span><br><span class="line">    std::cin&gt;&gt;a&gt;&gt;b&gt;&gt;k;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(b &gt; a)cnt++,a *= k;</span><br><span class="line">    std::cout&lt;&lt;cnt;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="c-dice-sum"><a class="markdownIt-Anchor" href="#c-dice-sum"></a> C - Dice Sum</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç°è¦æ±‚æ‰¾åˆ°ä¸€ä¸ªé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>çš„åºåˆ—ï¼Œå¯¹äºå…¶ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š</p><blockquote><ol><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>â‰¤</mo><msub><mi>A</mi><mi>i</mi></msub><mo>â‰¤</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">1\leq A_i\leq M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>A</mi><mi>i</mi></msub><mo>â‰¤</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">\sum _{i=1}^{N}A_i\leq K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2809409999999999em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span></li></ol></blockquote><p>è¯¢é—®æ»¡è¶³è¦æ±‚çš„åºåˆ—ä¸ªæ•°ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>è€ƒè™‘åŠ¨æ€è§„åˆ’</p><p>è®¾æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>N</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>K</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[N][K]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">]</span></span></span></span>ï¼š</p><blockquote><ol><li>ç¬¬ä¸€ç»´è¡¨ç¤ºå½“å‰åºåˆ—é•¿åº¦</li><li>ç¬¬äºŒç»´è¡¨ç¤ºå½“å‰åºåˆ—çš„å’Œ</li><li>æ•°ç»„çš„å€¼è¡¨ç¤ºæ–¹æ¡ˆæ•°</li></ol></blockquote><p>æšä¸¾æ‰€æœ‰é•¿åº¦ä»¥åŠåºåˆ—å’Œï¼Œè¿›è¡ŒçŠ¶æ€è½¬ç§»å³å¯ã€‚</p></blockquote><p>è½¬ç§»æ–¹ç¨‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span> ; j &lt;= m ; j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> o = i + j - <span class="number">1</span>; o &lt;= k ; o++)</span><br><span class="line">            {</span><br><span class="line">                dp[i][o] = (dp[i][o] + dp[i<span class="number">-1</span>][o-j])%mod;</span><br><span class="line">            }</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(NK)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/%28LM%7B4TAT5UY%25N3D8%5DBT%29%7DZC.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">60</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line">ll dp[N][N*N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> n,m,k;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;m&gt;&gt;k;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span> ; j &lt;= m ; j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> o = i + j - <span class="number">1</span>; o &lt;= k ; o++)</span><br><span class="line">            {</span><br><span class="line">                dp[i][o] = (dp[i][o] + dp[i<span class="number">-1</span>][o-j])%mod;</span><br><span class="line">            }</span><br><span class="line">    ll sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = n ; i&lt;= k ; i++)sum = (sum + dp[n][i])%mod;</span><br><span class="line">    std::cout&lt;&lt;sum;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="d-range-count-query"><a class="markdownIt-Anchor" href="#d-range-count-query"></a> D - Range Count Query</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>çš„åºåˆ—ï¼Œå’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ä¸ªè¯¢é—®ï¼Œè¯¢é—®æ ¼å¼å¦‚ä¸‹ï¼š</p><blockquote><p>ç»™å®š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo separator="true">,</mo><mi>R</mi><mo separator="true">,</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">L,R,X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>,è¦æ±‚è¾“å‡ºåºåˆ—ä¸­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span>åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>åŒºé—´å†…å€¼ä¸º$Xçš„ä¸ªæ•°ã€‚</p></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å› ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>â‰¤</mo><msub><mi>A</mi><mi>i</mi></msub><mo>â‰¤</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">1\leq A_i\leq N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„ï¼ŒæŠŠæ¯ä¸€ä¸ªæ•°å­—çš„æ‰€æœ‰ä¸‹æ ‡åˆ†åˆ«å­˜èµ·æ¥ï¼Œç„¶åç”¨äºŒåˆ†è§£å†³è¯¢é—®å³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>q</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(qlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/7%24HC7%7DA5%7E%28SKIB3P%60D%5B35MO.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> n,q;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        v[x].<span class="built_in">push_back</span>(i);</span><br><span class="line">    }</span><br><span class="line">    std::cin&gt;&gt;q;</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> l,r,x;</span><br><span class="line">        std::cin&gt;&gt;l&gt;&gt;r&gt;&gt;x;</span><br><span class="line">        <span class="keyword">auto</span> it1 = std::<span class="built_in">lower_bound</span>(v[x].<span class="built_in">begin</span>(),v[x].<span class="built_in">end</span>(),l);</span><br><span class="line">        <span class="keyword">if</span>(it1==v[x].<span class="built_in">end</span>())</span><br><span class="line">        {</span><br><span class="line">            std::cout&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">auto</span> it2 = std::<span class="built_in">upper_bound</span>(v[x].<span class="built_in">begin</span>(),v[x].<span class="built_in">end</span>(),r);</span><br><span class="line">        <span class="keyword">if</span>(it2==v[x].<span class="built_in">begin</span>())</span><br><span class="line">        {</span><br><span class="line">            std::cout&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        it2--;</span><br><span class="line">        std::cout&lt;&lt;(it2-it1<span class="number">+1</span>)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="e-k-colinear-line"><a class="markdownIt-Anchor" href="#e-k-colinear-line"></a> E - K-colinear Line</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>åœ¨åæ ‡å¹³é¢å†…å­˜åœ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>ä¸ªç‚¹ï¼Œæ¯ä¸ªç‚¹çš„åæ ‡ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X_i,Y_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œè¯¢é—®å­˜åœ¨å¤šå°‘æ¡ä¸åŒçš„ç›´çº¿ï¼Œç©¿è¿‡è‡³å°‘<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>ä¸ªç‚¹ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å› ä¸ºä¸¤ç‚¹å¯ä»¥ç¡®å®šä¸€æ¡ç›´çº¿ï¼Œè€Œä¸”ç‚¹æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>â‰¤</mo><mn>300</mn></mrow><annotation encoding="application/x-tex">N\leq 300</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">0</span><span class="mord">0</span></span></span></span>ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œå¦‚ä¸‹å¤„ç†ï¼š</p><blockquote><ol><li>ä¸¤ä¸¤æšä¸¾æ‰€æœ‰çš„ç‚¹</li><li>åœ¨ç¡®å®šå®Œä¸€æ¡ç›´çº¿åï¼Œæšä¸¾æ‰€æœ‰çš„ç‚¹åˆ¤æ–­è¿™æ¡ç›´çº¿ç©¿è¿‡äº†å¤šå°‘ç‚¹</li></ol></blockquote><p>ä¸‰ä¸ªç‚¹åœ¨ä¸€æ¡ç›´çº¿ä¸Šï¼Œæ˜¾ç„¶æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>A</mi><mi>C</mi></mrow><mo>âƒ—</mo></mover><mo>=</mo><mi>k</mi><mover accent="true"><mrow><mi>A</mi><mi>B</mi></mrow><mo>âƒ—</mo></mover></mrow><annotation encoding="application/x-tex">\vec{AC}=k \vec{AB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663299999999999em;vertical-align:0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663299999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9663299999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663299999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><msub><mi>y</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>y</mi><mn>2</mn></msub></mrow><mrow><msub><mi>x</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mn>2</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><msub><mi>y</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>y</mi><mn>1</mn></msub></mrow><mrow><msub><mi>x</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mn>1</mn></msub></mrow></mfrac><mo>â‡’</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{y_3-y_2}{x_3-x_2}=\frac{y_3-y_1}{x_3-x_1}\Rightarrow(y_3-y_2)(x_3-x_1)=(x_3-x_2)(y_3-y_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2995389999999998em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.854439em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2995389999999998em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.854439em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>å°†æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ç›´çº¿ç»Ÿè®¡å‡ºæ¥å³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/071690%602%28%60YJ%604WK%7DRJ%7BEDI.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">310</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>{</span><br><span class="line">    ll x,y;</span><br><span class="line">}a[N];</span><br><span class="line"><span class="type">bool</span> book[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">OK</span><span class="params">(Node x,Node y,Node z)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">return</span> (z.y-y.y)*(z.x-x.x)==(z.y-x.y)*(z.x-y.x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n,k;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        std::cout&lt;&lt;<span class="string">"Infinity"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;a[i].x&gt;&gt;a[i].y;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = i + <span class="number">1</span> ; j &lt;= n ; j++)</span><br><span class="line">            <span class="keyword">if</span>(!book[i][j])</span><br><span class="line">            {</span><br><span class="line">                <span class="type">int</span> cnt = <span class="number">2</span>;</span><br><span class="line">                std::vector&lt;<span class="type">int</span>&gt; b;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> o = <span class="number">1</span> ; o &lt;= n ; o++)</span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">if</span>(o == i || o == j)<span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">OK</span>(a[i],a[j],a[o]))</span><br><span class="line">                    {</span><br><span class="line">                        cnt++;</span><br><span class="line">                        b.<span class="built_in">push_back</span>(o);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                b.<span class="built_in">push_back</span>(i);</span><br><span class="line">                b.<span class="built_in">push_back</span>(j);</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">auto</span> x : b)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">auto</span> y : b)book[x][y] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span>(cnt &gt;= k)ans++;</span><br><span class="line">            }</span><br><span class="line">    std::cout&lt;&lt;ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="f-keep-connect"><a class="markdownIt-Anchor" href="#f-keep-connect"></a> F - Keep Connect</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å‡ºè¿™æ ·çš„ä¸€ä¸ªè¿é€šå›¾ï¼Œå¯¹äºæ¯ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo stretchy="false">(</mo><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">i(1\leq i\leq n-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œè¾“å‡ºåˆ é™¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>æ¡è¾¹å¹¶ä¸”ä»ç„¶ä¿æŒè¿é€šæ€§çš„æ–¹æ¡ˆæ•°ã€‚<br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/HQBQUN%29N%7E4W1C%24TJQ7Y%28EUU.png" alt=""></p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>è€ƒè™‘åŠ¨æ€è§„åˆ’</p><p>è®¾æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][j][2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">2</span><span class="mclose">]</span></span></span></span>:</p><blockquote><ol><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>è¡¨ç¤ºå‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ç»„ç‚¹</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>è¡¨ç¤ºåˆ é™¤çš„è¾¹æ•°</li><li>ç¬¬ä¸‰ç»´è®°å½•çš„æ˜¯ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ç»„ç‚¹ä¹‹é—´çš„è¿é€šæ€§(ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ç»„çš„ä¸¤ä¸ªç‚¹å½“å‰èƒ½å¦è¿é€š)</li><li>æ•°ç»„å€¼è¡¨ç¤ºæ–¹æ¡ˆæ•°<br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/2.png" alt=""></li></ol></blockquote><p>æˆ‘ä»¬ç”¨ä¸‰ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">bool</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">o</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>å€¼<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a,b,c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">c</span></span></span></span>æ¥ä»£è¡¨ä¸‰æ¡è¾¹ï¼Œè¡¨ç¤ºè¿™æ¡è¾¹æ˜¯å¦åˆ é™¤ã€‚</p><blockquote><ol><li>é‚£ä¹ˆå½“ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ç»„ç‚¹æ˜¯ä¸è¿é€šçš„æ—¶å€™ï¼Œæ˜¾ç„¶æ˜¯è¦ä¿è¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span></span></span></span>ä¸¤æ¡è¾¹éƒ½ç›¸è¿ï¼Œå¦åˆ™æ•´å¼ å›¾å¿…ç„¶å¤±å»è¿é€šæ€§ã€‚</li><li>å½“ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ç»„ç‚¹æ˜¯è¿é€šçš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span></span></span></span>æœ‰ä¸€æ¡è¾¹æ˜¯è¿é€šçš„å³å¯ï¼Œå¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a,b,c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">c</span></span></span></span>ä¸‰è¾¹ä¸­ç›¸è¿äº†è‡³å°‘ä¸¤æ¡è¾¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿è¯ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ç»„ç‚¹æ˜¯è¿é€šçš„ã€‚<br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/3.png" alt=""></li></ol></blockquote></blockquote><p>æœ‰è½¬ç§»æ–¹ç¨‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!k)</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span>(!a||!b)<span class="keyword">continue</span>;</span><br><span class="line">    dp[i<span class="number">+1</span>][j<span class="number">+1</span>-c][c] = (dp[i<span class="number">+1</span>][j<span class="number">+1</span>-dp[i][j][k])%Mod;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span>(!a&amp;&amp;!b)<span class="keyword">continue</span>;</span><br><span class="line">    dp[i<span class="number">+1</span>][j<span class="number">+3</span>-a-b-c][(a+b+c)&gt;=<span class="number">2</span>] = [j<span class="number">+3</span>-a-b-c][(a+b+c)&gt;=<span class="number">2</span>] + dp[i%Mod;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/4%7EXO%5B%25R%29%25A8NHXEKU51HFIJ.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">3010</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line">ll dp[N][N][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>] = dp[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    ll Mod;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;Mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span> ; j &lt;= n ; j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span> ; k &lt; <span class="number">2</span> ; k++)</span><br><span class="line">                <span class="keyword">if</span>(dp[i][j][k])</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> a = <span class="number">0</span> ; a &lt; <span class="number">2</span> ; a++)</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> b = <span class="number">0</span> ; b &lt; <span class="number">2</span> ; b++)</span><br><span class="line">                            <span class="keyword">for</span>(<span class="type">int</span> c = <span class="number">0</span> ; c &lt; <span class="number">2</span> ; c++)</span><br><span class="line">                            {</span><br><span class="line">                               <span class="keyword">if</span>(!k)</span><br><span class="line">                               {</span><br><span class="line">                                   <span class="keyword">if</span>(!a||!b)<span class="keyword">continue</span>;</span><br><span class="line">                                   dp[i<span class="number">+1</span>][j<span class="number">+1</span>-c][c] = (dp[i<span class="number">+1</span>][j<span class="number">+1</span>-c][c] + dp[i][j][k])%Mod;</span><br><span class="line">                               }</span><br><span class="line">                               <span class="keyword">else</span></span><br><span class="line">                               {</span><br><span class="line">                                   <span class="keyword">if</span>(!a&amp;&amp;!b)<span class="keyword">continue</span>;</span><br><span class="line">                                   dp[i<span class="number">+1</span>][j<span class="number">+3</span>-a-b-c][(a+b+c)&gt;=<span class="number">2</span>] = (dp[i<span class="number">+1</span>][j<span class="number">+3</span>-a-b-c][(a+b+c)&gt;=<span class="number">2</span>] + dp[i][j][k])%Mod;</span><br><span class="line">                               }</span><br><span class="line">                            }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; i++)std::cout&lt;&lt;dp[n][i][<span class="number">1</span>]&lt;&lt;<span class="string">' '</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="ex-beautiful-subsequences"><a class="markdownIt-Anchor" href="#ex-beautiful-subsequences"></a> Ex - Beautiful Subsequences</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>çš„å…¨æ’åˆ—,è¯¢é—®æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„åŒºé—´ä¸ªæ•°ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>L</mi><mo>â‰¤</mo><mi>R</mi><mo>â‰¤</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">1\leq L\leq R\leq N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>P</mi><mi>L</mi></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>P</mi><mi>R</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>P</mi><mi>L</mi></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>P</mi><mi>R</mi></msub><mo stretchy="false">)</mo><mo>â‰¤</mo><mi>R</mi><mo>âˆ’</mo><mi>L</mi><mo>+</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">max(P_L,\dots,P_R)-min(P_L,\dots,P_R)\leq R-L+K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span></li></ul></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p><strong>çº¿æ®µæ ‘+å•è°ƒæ ˆï¼š</strong></p><blockquote><ol><li>çº¿æ®µæ ‘ï¼šæˆ‘ä»¬å…ˆå›ºå®šä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>,ç„¶åå°è¯•å»ç»´æŠ¤ä¸€ä¸ªåºåˆ—ï¼Œè¿™ä¸ªåºåˆ—ä¸­çš„ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ä¸ªç‚¹è®°å½•çš„å€¼ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>P</mi><mi>i</mi></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>P</mi><mi>R</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>P</mi><mi>i</mi></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>P</mi><mi>R</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>R</mi><mo>+</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">max(P_i,\dots,P_R)-min(P_i,\dots,P_R)-R+i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ï¼Œå¦‚æœè¿™ä¸ªå€¼<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mo>â‰¤</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">val\leq K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>,é‚£ä¹ˆè¿™ä¸ªç‚¹æ‰€ä»£è¡¨çš„åŒºé—´å°±æ˜¯ä¸€ä¸ªåˆæ³•åŒºé—´ï¼Œæ­¤å¤–ï¼Œå› ä¸ºè¿™ä¸ªåºåˆ—æ˜¯å…¨æ’åˆ—ï¼Œæ‰€ä»¥ä¸éš¾å‘ç°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">val</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>ä¸ä¼šæ˜¯è´Ÿæ•°ã€‚æˆ‘ä»¬ç”¨çº¿æ®µæ ‘å»ç»´æŠ¤è¿™ä¸€æ®µåŒºé—´ï¼ŒåŒºé—´å†…è®°å½•<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">val</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>çš„æœ€å°å€¼ï¼Œå¹¶ä¸”è®°å½•ä¸‹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mn>2</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>v</mi><mi>a</mi><mi>l</mi><mo>+</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">val+1,val+2,\dots,val+k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>çš„ç‚¹çš„ä¸ªæ•°ã€‚<br>ç„¶åå°±å¯ä»¥é€šè¿‡æ ¹èŠ‚ç‚¹çš„ä¿¡æ¯æ¨çŸ¥ç­”æ¡ˆã€‚</li><li>å•è°ƒæ ˆï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡å•è°ƒæ ˆåŠ¨æ€çš„ç¡®å®šåŒºé—´æœ€å€¼ï¼Œç¡®å®šå®Œæœ€å€¼ä»¥åé€šè¿‡çº¿æ®µæ ‘åŒºé—´ä¿®æ”¹å³å¯ã€‚</li></ol></blockquote></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mi>K</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(NKlogN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br><img src="https://skynesserblog.oss-cn-hangzhou.aliyuncs.com/Atcoder/AtCoder%20Beginner%20Contest%20248/AtCoder%20Beginner%20Contest%20248/%7E%7EX0VT2W9%5B%5BW%5D02EUZ9%40%609S.png" alt=""></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">150000</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>{</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    <span class="type">int</span> val,add,cnt[<span class="number">4</span>];</span><br><span class="line">}tr[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> w[N],k;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    tr[u].val = std::<span class="built_in">min</span>(tr[u&lt;&lt;<span class="number">1</span>].val,tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt;= k ; i++)</span><br><span class="line">    {</span><br><span class="line">        tr[u].cnt[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> temp = tr[u].val - tr[u&lt;&lt;<span class="number">1</span>].val + i;</span><br><span class="line">        <span class="keyword">if</span>(temp &gt;= <span class="number">0</span>)tr[u].cnt[i] += tr[u&lt;&lt;<span class="number">1</span>].cnt[temp];</span><br><span class="line">        temp = tr[u].val - tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val + i;</span><br><span class="line">        <span class="keyword">if</span>(temp &gt;= <span class="number">0</span>)tr[u].cnt[i] += tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].cnt[temp];</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(tr[u].add)</span><br><span class="line">    {</span><br><span class="line">        tr[u&lt;&lt;<span class="number">1</span>].val += tr[u].add;</span><br><span class="line">        tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val += tr[u].add;</span><br><span class="line">        tr[u&lt;&lt;<span class="number">1</span>].add += tr[u].add;</span><br><span class="line">        tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].add += tr[u].add;</span><br><span class="line">        tr[u].add = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    {</span><br><span class="line">        tr[u] = {l,r};</span><br><span class="line">        tr[u].cnt[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        tr[u].val = INF;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        tr[u] = {l,r};</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid<span class="number">+1</span>,r);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(l &gt; r)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r)</span><br><span class="line">    {</span><br><span class="line">        tr[u].val += v;</span><br><span class="line">        tr[u].add += v;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">pushdown</span>(u);</span><br><span class="line">        <span class="type">int</span> mid = tr[u].l + tr[u].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l &lt;= mid)<span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>,l,r,v);</span><br><span class="line">        <span class="keyword">if</span>(r &gt; mid)<span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,v);</span><br><span class="line">        <span class="built_in">pushup</span>(u);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;w[i];</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    std::stack&lt;std::pair&lt;std::pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,<span class="type">int</span>&gt;&gt; stk1,stk2;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>,i,i,-INF);</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,i<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">        <span class="type">int</span> x1 = i,x2 = i;</span><br><span class="line">        <span class="keyword">while</span>(!stk<span class="number">1.</span><span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(w[i] &lt; stk<span class="number">1.</span><span class="built_in">top</span>().second)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">modify</span>(<span class="number">1</span>,stk<span class="number">1.</span><span class="built_in">top</span>().first.first,stk<span class="number">1.</span><span class="built_in">top</span>().first.second,stk<span class="number">1.</span><span class="built_in">top</span>().second);</span><br><span class="line">                x1 = stk<span class="number">1.</span><span class="built_in">top</span>().first.first;</span><br><span class="line">                stk<span class="number">1.</span><span class="built_in">pop</span>();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span>(!stk<span class="number">2.</span><span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(w[i] &gt; stk<span class="number">2.</span><span class="built_in">top</span>().second)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">modify</span>(<span class="number">1</span>,stk<span class="number">2.</span><span class="built_in">top</span>().first.first,stk<span class="number">2.</span><span class="built_in">top</span>().first.second,-stk<span class="number">2.</span><span class="built_in">top</span>().second);</span><br><span class="line">                x2 = stk<span class="number">2.</span><span class="built_in">top</span>().first.first;</span><br><span class="line">                stk<span class="number">2.</span><span class="built_in">pop</span>();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        stk<span class="number">1.</span><span class="built_in">push</span>({{x1,i},w[i]});</span><br><span class="line">        stk<span class="number">2.</span><span class="built_in">push</span>({{x2,i},w[i]});</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>,x1,i,-w[i]);</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>,x2,i,w[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> c = <span class="number">0</span> ; c &lt;= k ; c++)</span><br><span class="line">            <span class="keyword">if</span>(tr[<span class="number">1</span>].val + c &lt;= k)ans += tr[<span class="number">1</span>].cnt[c];</span><br><span class="line">    }</span><br><span class="line">    std::cout&lt;&lt;ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤å¤–ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥çœ‹<a href="https://www.bilibili.com/video/BV1v44y1G7qj">dlsçš„è§†é¢‘è®²è§£</a>ï¼Œåœ¨è¿™é‡Œé™„ä¸Šé“¾æ¥</p></blockquote><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="https://www.bilibili.com/video/BV1v44y1G7qj" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"> </iframe></div>]]></content>
      
      
      <categories>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Atcoder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 781 (Div. 2)</title>
      <link href="/2022/04/12/Codeforces-Round-781-Div-2/"/>
      <url>/2022/04/12/Codeforces-Round-781-Div-2/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img-blog.csdnimg.cn/3e0c9e6545784e64b4cf89832e9fc83f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAc2t5bmVzc2Vy,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /></p><hr /><h2 id="a-gcd-vs-lcm"><a class="markdownIt-Anchor" href="#a-gcd-vs-lcm"></a> A. GCD vs LCM</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šæ•°nï¼Œæ‰¾åˆ°a,b,c,då››ä¸ªæ•°æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š</p><blockquote><p>1.<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo>+</mo><mi>d</mi><mo>=</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">a+b+c+d=n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span><br />2.<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>l</mi><mi>c</mi><mi>m</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">gcd(a,b)=lcm(c,d)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">c</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mclose">)</span></span></span></span></p></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å–ç‰¹æ®Šæƒ…å†µï¼Œä»¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">gcd(a,b)=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>å³å¯ã€‚<br />å³æ„é€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>b</mi><mo>=</mo><mi>n</mi><mo>âˆ’</mo><mn>3</mn><mo separator="true">,</mo><mi>c</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>d</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a=1,b=n-3,c=1,d=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>æ‰€éœ€æ—¶é—´ä¸è¾“å…¥è§„æ¨¡æ— å…³:<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/69cc329cf70d4bf98dc95222e120f632.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e2</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    std::cout&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;n<span class="number">-3</span>&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr /><h2 id="b-array-cloning-technique"><a class="markdownIt-Anchor" href="#b-array-cloning-technique"></a> B. Array Cloning Technique</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºnçš„åˆå§‹æ•°ç»„å‰¯æœ¬ï¼Œä½ å¯ä»¥è¿›è¡Œä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š</p><blockquote><ol><li>é€‰æ‹©ä»»æ„ä¸€ä¸ªæ•°ç»„å‰¯æœ¬ï¼Œå°†å…¶å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„æ•°ç»„å‰¯æœ¬ã€‚</li><li>é€‰æ‹©ä¸¤ä¸ªæ•°ç»„å‰¯æœ¬ï¼Œäº¤æ¢å®ƒä»¬çš„ä¸¤ä¸ªå…ƒç´ ã€‚</li></ol></blockquote><p>è¯¢é—®å°†å…¶ä¸­ä»»æ„ä¸€ä¸ªæ•°ç»„å‰¯æœ¬çš„å…¨éƒ¨å…ƒç´ å˜ç›¸åŒçš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><ol><li>é¦–å…ˆï¼Œæˆ‘ä»¬è´ªå¿ƒçš„é€‰æ‹©ç¬¬ä¸€ä¸ªæ•°ç»„å‰¯æœ¬ä½œä¸ºç›®æ ‡ï¼Œå°†è¿™ä¸ªæ•°ç»„çš„å…¨éƒ¨å…ƒç´ å˜æˆç›¸åŒã€‚</li><li>ç„¶åï¼Œæˆ‘ä»¬è®°å½•ä¸‹åˆå§‹æ•°ç»„å‰¯æœ¬ä¸­çš„æœ€å¤§ç›¸åŒæ•°å­—å‡ºç°æ¬¡æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">max</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span></span></span></span>,é‚£ä¹ˆå°†å…¶ä»–æ‰€æœ‰å…ƒç´ å˜æˆç›¸åŒçš„äº¤æ¢(æ“ä½œ1)æ¬¡æ•°æ˜¾ç„¶æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>âˆ’</mo><mi>m</mi><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">n-max</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span></span></span></span>ã€‚</li><li>æ¥ç€æˆ‘ä»¬è®¡ç®—å¤åˆ¶æ•°ç»„å‰¯æœ¬çš„æ¬¡æ•°(æ“ä½œ2)ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°æ¯æ¬¡å¤åˆ¶å¹¶äº¤æ¢ç»“æŸåï¼Œç›¸åŒæ•°çš„ä¸ªæ•°éƒ½ä¼šç¿»å€ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹å¼æ‰¾åˆ°æœ€å°å¤åˆ¶æ¬¡æ•°å³å¯ã€‚</li></ol><p>æœ€åï¼Œå°†æ“ä½œ1å’Œæ“ä½œ2çš„æ¬¡æ•°ç›¸åŠ å³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>ç»Ÿè®¡ç›¸åŒæ•°å­—çš„æœ€å¤§å‡ºç°æ¬¡æ•°ä¸­ä½¿ç”¨äº†mapæ¥å®Œæˆï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/bee7ce6348544de49308edbfe0afd11b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e2</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> max = <span class="number">0</span>;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    std::map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; mp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        mp[x]++;</span><br><span class="line">        <span class="keyword">if</span>(mp[x] &gt; max)max = mp[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>,cnt = n - max;</span><br><span class="line">    <span class="keyword">if</span>(cnt==<span class="number">0</span>)std::cout&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(;max &lt; n;max &lt;&lt;= <span class="number">1</span>)res++;</span><br><span class="line">        res += cnt;</span><br><span class="line">        std::cout&lt;&lt;res&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr /><h2 id="c-tree-infection"><a class="markdownIt-Anchor" href="#c-tree-infection"></a> C. Tree Infection</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€æ£µæ ‘ï¼Œç°åœ¨è¦å»æ„ŸæŸ“è¿™æ£µæ ‘çš„å…¨éƒ¨èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªå•ä½æ—¶é—´å†…æ‰§è¡Œä»¥ä¸‹ä¸¤ç§æ“ä½œ(åŒæ—¶è¿›è¡Œ)ï¼š</p><blockquote><ol><li>å¯¹äºæ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œå¦‚æœä»–çš„æŸä¸ªå­©å­èŠ‚ç‚¹è¢«æ„ŸæŸ“ï¼Œé‚£ä¹ˆå¯ä»¥æ„ŸæŸ“ä¸€ä¸ªå…¶å®ƒå¥åº·çš„å­©å­èŠ‚ç‚¹ã€‚<br />2.ä»»æ„é€‰æ‹©ä¸€ä¸ªå¥åº·çš„èŠ‚ç‚¹ï¼Œå¹¶æ„ŸæŸ“å®ƒã€‚</li></ol></blockquote><p>è¯¢é—®å°†æ•´æ£µæ ‘æ„ŸæŸ“çš„æœ€å°‘æ—¶é—´ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ„ŸæŸ“ä¼ æ’­(æ“ä½œ1)åªä¼šåœ¨ä¸€ä¸ªä¸ª&quot;å­©å­ç¾¤ä½“&quot;ä¸­è¿›è¡Œï¼Œå®é™…ä¸Šæ„ŸæŸ“ä¸æ ‘å¹¶æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠè¿™ä¸€ä¸ªä¸ª&quot;å­©å­ç¾¤ä½“&quot;å–å‡ºæ¥ã€‚<br />è¿˜æ˜¯ä¸¾ä¸ªä¾‹å­(ç¬¬ä¸€ä¸ªæ¡ˆä¾‹)ï¼š</p><blockquote><p>7<br />1 1 1 2 2 4<br />å¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œçš„&quot;ç¾¤ä½“&quot;æœ‰è¿™äº›ï¼š<br />{1},{2,3,4},{5,6},{7}</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å…ˆæŠŠæ‰€æœ‰çš„ç¾¤ä½“æ‰¾å‡ºæ¥ï¼Œç„¶åé‡‡ç”¨è´ªå¿ƒç­–ç•¥ï¼Œä»æ•°é‡å¤§çš„ç¾¤ä½“å¼€å§‹æ„ŸæŸ“ï¼Œé‡‡ç”¨å¦‚ä¸‹åˆ¤æ–­æ–¹æ³•ï¼š</p><blockquote><ol><li>æˆ‘ä»¬ä»å¤§åˆ°å°æ„ŸæŸ“æ‰€æœ‰&quot;ç¾¤ä½“&quot;(ä¾æ¬¡å¯¹æ‰€æœ‰&quot;ç¾¤ä½“&quot;ä½¿ç”¨æ“ä½œ1ä¸€æ¬¡ï¼Œç„¶åè®©å®ƒä»¬å†…éƒ¨ä¼ æ’­)ï¼Œæˆ‘ä»¬è®°å½•ä¸‹å®Œæˆä¸Šè¿°æ“ä½œåæ‰€æœ‰ç¾¤ä½“è¿˜å‰©ä¸‹çš„æœªæ„ŸæŸ“ä¸ªæ•°(å¦‚æœå·²ç»å…¨éƒ¨æ„ŸæŸ“åˆ™ä¸ç”¨ç®¡)ã€‚</li><li>å¦‚æœæ­¤æ—¶è¿˜æœ‰å‰©ä½™èŠ‚ç‚¹æœªè¢«æ„ŸæŸ“ï¼Œæˆ‘ä»¬è®©å®ƒä»¬å†…éƒ¨ä¼ æ’­ï¼Œå¹¶æ‰‹åŠ¨æ„ŸæŸ“å‰©ä½™èŠ‚ç‚¹æœ€å¤šçš„&quot;ç¾¤ä½“&quot;ã€‚</li></ol></blockquote><p>å³åœ¨è´ªå¿ƒåæ¨¡æ‹Ÿæ„ŸæŸ“çš„è¿‡ç¨‹(å®ç°ä¸Šå¯èƒ½è¿˜æ˜¯æœ‰ç‚¹å¤æ‚äº†)ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>ä½¿ç”¨äº†mapå’Œä¼˜å…ˆé˜Ÿåˆ—ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/16d3352593b742aba78eca793a507b5d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e2</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,t = <span class="number">0</span>;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    std::priority_queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">    std::map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; mp;</span><br><span class="line">    mp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        mp[x]++;</span><br><span class="line">    &#125;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; num;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> map : mp)num.<span class="built_in">push_back</span>(map.second);<span class="comment">//ä»å¤§åˆ°å°æ’åº&quot;ç¾¤ä½“&quot;</span></span><br><span class="line">    std::<span class="built_in">sort</span>(num.<span class="built_in">begin</span>(),num.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> val : num)<span class="comment">//ç¬¬ä¸€æ­¥</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(val - <span class="number">1</span> - t &gt; <span class="number">0</span>)que.<span class="built_in">push</span>(val - <span class="number">1</span> - t);</span><br><span class="line">        t++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(que.<span class="built_in">empty</span>()||que.<span class="built_in">top</span>() - res &lt;= <span class="number">0</span>)<span class="keyword">break</span>;<span class="comment">//ç¬¬äºŒæ­¥</span></span><br><span class="line">        que.<span class="built_in">push</span>(que.<span class="built_in">top</span>()<span class="number">-1</span>);</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        res++;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;res+t&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr /><h2 id="d-gcd-guess"><a class="markdownIt-Anchor" href="#d-gcd-guess"></a> D. GCD Guess</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>äº¤äº’é¢˜ï¼š<br />å…ˆè¦çŒœæµ‹ä¸€ä¸ªæ•´æ•°xçš„å¤§å°ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¯¢é—®æœ€å¤š30æ¬¡ï¼š</p><blockquote><p>ç»™å‡ºæ•°å­—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>ï¼Œè¿”å›<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>x</mi><mo separator="true">,</mo><mi>b</mi><mo>+</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">gcd(a+x,b+x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></p></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>30æ¬¡çš„è¯¢é—®æ¬¡æ•°ï¼Œæˆ‘ä»¬åº”è¯¥å°è¯•ä»ä½çš„è§’åº¦å–è§£å†³ã€‚<br />é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆçŸ¥é“æ¯ä¸€ä½å–0è¿˜æ˜¯1å‘¢ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ–¹æ³•ï¼š</p><blockquote><ol><li>å‡è®¾æˆ‘ä»¬å·²çŸ¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mtext>Â </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>Â </mtext><msup><mn>2</mn><mi>k</mi></msup><mo>=</mo><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">x\ mod\ 2^k = ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace">Â </span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace">Â </span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span></span></span></span></li><li>é‚£ä¹ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">x-ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span></span></span></span>çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ä½åº”è¯¥å…¨æ˜¯0</li><li>æˆ‘ä»¬å¯ä»¥ç”¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo separator="true">,</mo><msup><mn>2</mn><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">gcd(x-ans,2^{k+1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0991079999999998em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>æ˜¯å¦ç­‰äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>æ¥åˆ¤æ–­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä½å–0è¿˜æ˜¯1ã€‚</li><li>è‹¥ç­‰äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>ï¼Œåˆ™å–1ï¼Œè‹¥ä¸ç­‰ï¼Œåˆ™å–0ã€‚</li><li>æ­¤æ—¶è¯¢é—®çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">a=-ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span></span></span></span>ï¼Œè€Œè¯¢é—®æ•°åº”è¯¥å¤§äº0ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯¢é—®<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo>+</mo><msup><mn>2</mn><mi>k</mi></msup><mo separator="true">,</mo><msup><mn>2</mn><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">gcd(x-ans+2^{k},2^{k+1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ã€‚</li><li>è‹¥ç­‰äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>ï¼Œåˆ™å–0ï¼Œè‹¥ä¸ç­‰ï¼Œåˆ™å–1ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo>+</mo><msup><mn>2</mn><mi>k</mi></msup><mo separator="true">,</mo><msup><mn>2</mn><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo>+</mo><msup><mn>2</mn><mi>k</mi></msup><mo separator="true">,</mo><msup><mn>2</mn><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>+</mo><mo stretchy="false">(</mo><mi>x</mi><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo>+</mo><msup><mn>2</mn><mi>k</mi></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">gcd(x-ans+2^{k},2^{k+1})=gcd(x-ans+2^{k},2^{k+1}+(x-ans+2^{k}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.043548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>ï¼ˆè¿™ä¸ªè½¬æ¢æ˜¯ä¸ºäº†å‡‘å‡ºaå’Œbï¼‰,æ‰€ä»¥è¯¢é—®ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo>+</mo><msup><mn>2</mn><mi>k</mi></msup><mo separator="true">,</mo><mi>b</mi><mo>=</mo><mo>âˆ’</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo>+</mo><msup><mn>2</mn><mi>k</mi></msup><mo>+</mo><msup><mn>2</mn><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">a=-ans+2^k,b=-ans+2^k+2^{k+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.043548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.932438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>ã€‚</li></ol></blockquote></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>æˆ‘ä»¬æ¯æ¬¡è¯¢é—®å¯ä»¥ç¡®å®šæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>çš„æŸä¸€ä½ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(logn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/62afe2ea13ac4c5bbeec96fc44644586.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e2</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;? &quot;</span>&lt;&lt;x&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;y&lt;&lt;std::endl;</span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line">    std::cin&gt;&gt;res;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= <span class="number">30</span> ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> res = <span class="built_in">query</span>((<span class="number">1</span>&lt;&lt;i<span class="number">-1</span>)-ans,(<span class="number">1</span>&lt;&lt;i)+(<span class="number">1</span>&lt;&lt;i<span class="number">-1</span>)-ans);</span><br><span class="line">        <span class="keyword">if</span>(res != (<span class="number">1</span>&lt;&lt;i<span class="number">-1</span>))ans += (<span class="number">1</span>&lt;&lt;i<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;! &quot;</span>&lt;&lt;ans&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr /><h2 id="e-minimizor"><a class="markdownIt-Anchor" href="#e-minimizor"></a> E. MinimizOR</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œå®šä¹‰èŠ±è´¹ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mtext>Â </mtext><mo stretchy="false">!</mo><mo>=</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_i|a_j(i\ !=j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace">Â </span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span>ï¼Œç°åœ¨ç»™å‡ºqä¸ªè¯¢é—®ï¼š</p><blockquote><p>ç»™å‡ºæ•´æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>ï¼Œæ‰¾å‡ºåŒºé—´å†…çš„æœ€å°èŠ±è´¹ã€‚</p></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>æœ¬é¢˜æœ€é‡è¦çš„æ˜¯è¯æ˜ä¸€ä¸ªæ€§è´¨ï¼š</p><blockquote><p>å¦‚æœåŒºé—´å†…çš„æœ€å¤§æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>&lt;</mo><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">A_{max} &lt; 2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>(å³æœ€å¤§æ•°ä¸è¶…è¿‡kä½),é‚£ä¹ˆç­”æ¡ˆä¸€å®šåœ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªåŒºé—´æœ€å°æ•°å†…æŒ‰ä½æˆ–äº§ç”Ÿã€‚<br />è¯æ˜å¦‚ä¸‹ï¼š</p><blockquote><p>å¯¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>,åªæœ‰0å’Œ1ä¸¤ä¸ªæ•°ï¼Œæ˜¾ç„¶æˆç«‹ã€‚<br />ç°åœ¨æˆ‘ä»¬å°†è®¾ç»“è®ºå¯¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>æˆç«‹ï¼Œæˆ‘ä»¬å°è¯•è¯æ˜å¯¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¹Ÿæˆç«‹ã€‚<br />åˆ†ç±»è®¨è®ºï¼š</p><ol><li>è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä½å…¨æ˜¯1ï¼Œé‚£ä¹ˆç­”æ¡ˆå¿…ç„¶å‡ºç°åœ¨ä¹‹å‰å·²ç»é€‰æ‹©çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªæ•°ä¸­ï¼Œè€Œä¸”æ­¤æ—¶é€‰æ‹©çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªæœ€å°æ•°ä¸ä¹‹å‰åº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚</li><li>è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä½0çš„ä¸ªæ•°å¤§äºç­‰äº2ï¼Œé‚£ä¹ˆç­”æ¡ˆå¿…ç„¶å‡ºç°åœ¨ä¹‹å‰å·²ç»é€‰æ‹©çš„k+1ä¸ªæ•°ä¸­ï¼Œè€Œä¸”æ­¤æ—¶é€‰æ‹©çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªæœ€å°æ•°ä¸ä¹‹å‰åº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚</li><li>è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä½0çš„ä¸ªæ•°æ°å¥½ç­‰äº1ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>åº”è¯¥å–1ï¼Œæ‰€ä»¥ç­”æ¡ˆè¿˜æ˜¯å‡ºç°åœ¨ä¹‹å‰é€‰æ‹©çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªæ•°ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶é€‰æ‹©çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªæœ€å°æ•°ä¸ä¹‹å‰ä¸ä¸€å®šä¸€è‡´ï¼Œå› ä¸ºæœ€åæƒ…å†µå°±æ˜¯ä¹‹å‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä½å…¨æ˜¯1ï¼Œè€Œæ­¤æ—¶<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä½æ˜¯0çš„ä¸€ä¸ªæ•°ä¼šå–ä»£å…¶ä¸­çš„ä¸€ä¸ªæ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªæ—¶å€™è¦å¤šå–ä¸€ä¸ªæ•°ï¼Œå–<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">k+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>ä¸ªæœ€å°æ•°å³å¯ã€‚</li></ol></blockquote></blockquote><blockquote><p>é€šè¿‡ä»¥ä¸Šè¯´æ˜ï¼Œæˆ‘ä»¬è¯æ˜ç»“è®ºï¼š</p><blockquote><p>å¦‚æœåŒºé—´å†…çš„æœ€å¤§æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>&lt;</mo><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">A_{max} &lt; 2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>(å³æœ€å¤§æ•°ä¸è¶…è¿‡kä½),é‚£ä¹ˆç­”æ¡ˆä¸€å®šåœ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ä¸ªåŒºé—´æœ€å°æ•°å†…æŒ‰ä½æˆ–äº§ç”Ÿ</p></blockquote></blockquote><p>ç°åœ¨çš„ä»»åŠ¡å°±æ˜¯æ‰¾åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>åŒºé—´æœ€å°æ•°ï¼Œè¿™ä¸ªå¯ä»¥ç”¨çº¿æ®µæ ‘å®Œæˆã€‚<br />æ­¤å¤–ï¼Œå› ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">A_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„èŒƒå›´å¹¶ä¸ä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯æ¬¡å¹¶ä¸ä¼šçœŸçš„æ±‚å‡ºå®ƒï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½å‡å®šå®ƒåœ¨è¾¹ç•Œæœ€å¤§å€¼<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>=</mo><msup><mn>2</mn><mn>30</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">A_{max}=2^{30}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ï¼Œæ‰€ä»¥æ¯æ¬¡æœ€å¤šæ‰¾åˆ°31ä¸ªæœ€å°æ•°ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>è¿™é¢˜çš„å¸¸æ•°ä¼šç‰¹åˆ«å¤§ï¼Œå› ä¸ºæ¯æ¬¡è¯¢é—®éƒ½éœ€è¦æŸ¥æ‰¾æœ€å¤š31æ¬¡ã€‚<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>m</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo>+</mo><msup><mi>m</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>m</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>r</mi><mo>âˆ’</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mn>31</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(q*(mlogn+m^2))(m=min(r-l+1,31))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">3</span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/4a16027cb1fb4304af68c7cd2afe335e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span><span class="number">+10</span>,M = <span class="number">2e5</span><span class="number">+10</span>,INF = (<span class="number">1ll</span>&lt;&lt;<span class="number">31</span>)<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r,v,id;</span><br><span class="line">&#125;tr[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> w[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    tr[u].v = std::<span class="built_in">min</span>(tr[u&lt;&lt;<span class="number">1</span>].v,tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].v);</span><br><span class="line">    <span class="keyword">if</span>(tr[u&lt;&lt;<span class="number">1</span>].v &lt; tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].v)tr[u].id = tr[u&lt;&lt;<span class="number">1</span>].id;</span><br><span class="line">    <span class="keyword">else</span> tr[u].id = tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        tr[u] = &#123;l,r,w[r],r&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        tr[u] = &#123;l,r&#125;;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid<span class="number">+1</span>,r);</span><br><span class="line">        <span class="built_in">pushup</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; <span class="title">query</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[u].l &gt;= l &amp;&amp; tr[u].r &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_pair</span>(tr[u].v,tr[u].id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = tr[u].l + tr[u].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        std::pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; ans = &#123;INF,INF&#125;;</span><br><span class="line">        <span class="keyword">if</span>(l &lt;= mid)ans = std::<span class="built_in">min</span>(ans,<span class="built_in">query</span>(u&lt;&lt;<span class="number">1</span>,l,r));</span><br><span class="line">        <span class="keyword">if</span>(r &gt; mid)ans = std::<span class="built_in">min</span>(ans,<span class="built_in">query</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r));</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> x,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[u].l==x&amp;&amp;tr[u].r==x)</span><br><span class="line">    &#123;</span><br><span class="line">        tr[u].v = v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = tr[u].l + tr[u].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(x &lt;= mid)<span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>,x,v);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,x,v);</span><br><span class="line">        <span class="built_in">pushup</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,q;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;w[i];</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    std::cin&gt;&gt;q;</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l,r;</span><br><span class="line">        std::vector&lt;<span class="type">int</span>&gt; res,id;</span><br><span class="line">        std::cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= std::<span class="built_in">min</span>(<span class="number">31</span>,r - l + <span class="number">1</span>) ; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            std::pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; temp = <span class="built_in">query</span>(<span class="number">1</span>,l,r);</span><br><span class="line">            res.<span class="built_in">push_back</span>(temp.first);</span><br><span class="line">            id.<span class="built_in">push_back</span>(temp.second);</span><br><span class="line">            <span class="built_in">modify</span>(<span class="number">1</span>,temp.second,INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ans = INF;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; res.<span class="built_in">size</span>() ; i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i + <span class="number">1</span> ; j &lt; res.<span class="built_in">size</span>() ; j++)ans = std::<span class="built_in">min</span>(ans,res[i]|res[j]);</span><br><span class="line">        std::cout&lt;&lt;ans&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> _id : id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">modify</span>(<span class="number">1</span>,_id,w[_id]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Codeforces </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 780 (Div. 3)</title>
      <link href="/2022/04/12/Codeforces-Round-780-Div-3/"/>
      <url>/2022/04/12/Codeforces-Round-780-Div-3/</url>
      
        <content type="html"><![CDATA[<h2 id="a-vasya-and-coins"><a class="markdownIt-Anchor" href="#a-vasya-and-coins"></a> A. Vasya and Coins</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>å°æ˜æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span>æš1å…ƒç¡¬å¸å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>æš2å…ƒç¡¬å¸ï¼Œè¾“å‡ºå°æ˜æ— æ³•æ”¯ä»˜çš„æœ€å°é‡‘é¢ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><ol><li>æ²¡æœ‰1å…ƒç¡¬å¸ï¼š</li></ol><blockquote><p>ç­”æ¡ˆä¸º1</p></blockquote><ol start="2"><li>æœ‰1å…ƒç¡¬å¸ï¼š</li></ol><blockquote><p>ç­”æ¡ˆä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mn>2</mn><mo>âˆ—</mo><mi>b</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a+2*b+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p></blockquote></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/bc0d0d82bbfc435e99dd480b21eb9bd2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">åœ¨è¿™é‡Œæ’å…¥ä»£ç ç‰‡<span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">20</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    std::cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">    <span class="keyword">if</span>(!a)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;a+b*<span class="number">2</span><span class="number">+1</span>&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="b-vlad-and-candies"><a class="markdownIt-Anchor" href="#b-vlad-and-candies"></a> B. Vlad and Candies</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>æœ‰nç§ç³–æœï¼Œæ¯ä¸ªç³–æœæœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä»½ã€‚</p><blockquote><p>æ¯æ¬¡éƒ½åƒæ‰ä»½æ•°æœ€å¤šçš„ç³–æœï¼Œä½†æ˜¯å°æ˜ä¸å¸Œæœ›è¿ç»­ä¸¤æ¬¡åƒä¸€æ ·çš„ç³–æœï¼Œä»–æ˜¯å¦å¯ä»¥æŒ‰ç…§è¿™ä¸ªè¦æ±‚åƒæ‰æ‰€æœ‰ç³–æœã€‚</p></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>åªéœ€è¦è€ƒè™‘æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼å³å¯ã€‚</p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>æœ€å¤§å€¼</mtext><mo>âˆ’</mo><mtext>æ¬¡å¤§å€¼</mtext><mo>&gt;</mo><mn>1</mn><mo>:</mo><mi>N</mi><mi>O</mi></mrow><annotation encoding="application/x-tex">æœ€å¤§å€¼ - æ¬¡å¤§å€¼ &gt; 1:NO</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">æœ€</span><span class="mord cjk_fallback">å¤§</span><span class="mord cjk_fallback">å€¼</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord cjk_fallback">æ¬¡</span><span class="mord cjk_fallback">å¤§</span><span class="mord cjk_fallback">å€¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>æœ€å¤§å€¼</mtext><mo>âˆ’</mo><mtext>æ¬¡å¤§å€¼</mtext><mo>â‰¤</mo><mn>1</mn><mo>:</mo><mi>Y</mi><mi>E</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">æœ€å¤§å€¼ - æ¬¡å¤§å€¼ \leq 1:YES</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">æœ€</span><span class="mord cjk_fallback">å¤§</span><span class="mord cjk_fallback">å€¼</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord cjk_fallback">æ¬¡</span><span class="mord cjk_fallback">å¤§</span><span class="mord cjk_fallback">å€¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></p></blockquote></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/9ea9e5afcc554493a150aa81f7b8dc78.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">20</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> max1 = <span class="number">0</span>,max2 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        <span class="keyword">if</span>(x &gt; max1)std::<span class="built_in">swap</span>(max1,x);</span><br><span class="line">        <span class="keyword">if</span>(x &gt; max2)std::<span class="built_in">swap</span>(max2,x);</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;(max1-max2 &gt; <span class="number">1</span> ?<span class="string">&quot;NO&quot;</span>:<span class="string">&quot;YES&quot;</span>)&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="c-get-an-even-string"><a class="markdownIt-Anchor" href="#c-get-an-even-string"></a> C. Get an Even String</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²Sï¼Œè¦æ±‚ä½ åˆ é™¤æœ€å°‘çš„å­—æ¯ï¼Œè®©å­—ç¬¦ä¸²Sæ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š</p><blockquote><ol><li>é•¿åº¦ä¸ºå¶æ•°</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mtext>ä¸ºå¥‡æ•°</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_{i}=a_{i+1}(iä¸ºå¥‡æ•°)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mord cjk_fallback">ä¸º</span><span class="mord cjk_fallback">å¥‡</span><span class="mord cjk_fallback">æ•°</span><span class="mclose">)</span></span></span></span></li></ol></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬è¦æŠŠç›¸åŒçš„å­—æ¯åŒ¹é…èµ·æ¥ã€‚<br />æˆ‘ä»¬è€ƒè™‘å¦‚ä¸‹è´ªå¿ƒç­–ç•¥:</p><blockquote><p>å½¢å¦‚æµ‹è¯•æ¡ˆä¾‹ï¼šbmefbmuyw</p><ol><li>åˆ é™¤å­—æ¯æœ€å°‘ï¼Œå°±æ˜¯ä¿ç•™å­—æ¯æœ€å¤š</li><li>æˆ‘ä»¬æŠŠä¸Šè¿°å­—ç¬¦ä¸²ä¸­ï¼Œæœ€è¿‘çš„åŒ¹é…å­—æ¯å–å‡ºï¼Œç»„æˆåŒºé—´</li><li>æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mn>6</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1,5],[2,6]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">5</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">6</span><span class="mclose">]</span></span></span></span></li><li>å³åœ¨è¿™äº›åŒºé—´ä¸­ï¼Œæ‰¾åˆ°å°½å¯èƒ½å¤šçš„ä¸ç›¸äº¤åŒºé—´ã€‚</li><li>è€Œé€‰æ‹©çš„æ ‡å‡†å°±æ˜¯å³ç«¯ç‚¹è¶Šå°ï¼Œé‚£ä¹ˆé€‰æ‹©ä¸€å®šæ˜¯è¶Šå¥½çš„ï¼Œå› ä¸ºå³ç«¯ç‚¹è¶Šå°ï¼Œåé¢å¯ä¾›é€‰æ‹©çš„åŒºé—´ä¸€å®šä¼šæ›´å¤šã€‚</li></ol></blockquote><p>æ‰€ä»¥å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ¯å½“å­˜åœ¨ä¸€å¯¹å¯ä»¥åŒ¹é…çš„å­—æ¯ï¼Œæˆ‘ä»¬å°±åŒ¹é…ä»–ä»¬ï¼Œå¹¶æŠŠä»–ä»¬ä¸­é—´çš„å­—æ¯å…¨éƒ¨åˆ é™¤(è®©å³ç«¯ç‚¹å°½å¯èƒ½å°)ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>ä½¿ç”¨äº†mapå»å­˜å­—æ¯ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å¢åŠ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">logn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/8f6c88fb9ac54dd5bf990f59c7c7dc74.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">20</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::map&lt;<span class="type">char</span>,<span class="type">bool</span>&gt; mp;</span><br><span class="line">    std::string s;</span><br><span class="line">    std::cin&gt;&gt;s;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; s.<span class="built_in">size</span>() ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(mp.<span class="built_in">count</span>(s[i]))</span><br><span class="line">        &#123;</span><br><span class="line">            res += <span class="number">2</span>;</span><br><span class="line">            mp.<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> mp[s[i]] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;s.<span class="built_in">size</span>() - res &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="d-maximum-product-strikes-back"><a class="markdownIt-Anchor" href="#d-maximum-product-strikes-back"></a> D. Maximum Product Strikes Back</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œè€Œä¸”å…¶ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ£</mi><msub><mi>a</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><mo>â‰¤</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">|a_{i}|\leq 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>ã€‚<br />è¦æ±‚ä»å³å’Œä»å·¦åˆ é™¤ä¸€å®šä¸ªæ•°çš„å…ƒç´ ï¼Œä½¿å¾—å‰©ä¸‹å…ƒç´ ç›¸ä¹˜ä¹‹ç§¯æœ€å¤§:</p><blockquote><p>é€‰æ‹©<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><br />æ±‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><msubsup><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mi>x</mi></mrow><mrow><mi>n</mi><mo>âˆ’</mo><mi>y</mi></mrow></msubsup><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">max\prod_{i=x}^{n-y}a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.210941em;vertical-align:-0.29971000000000003em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.911231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.2029000000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å› ä¸ºç©ºæ•°ç»„æ˜¯1ï¼Œæ‰€ä»¥0æ˜¯å¿…ç„¶è¢«åˆ é™¤çš„ï¼Œæ‰€ä»¥0æŠŠæ•´ä¸ªæ•°ç»„åˆ’åˆ†æˆäº†è‹¥å¹²ä¸ªåŒºé—´ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªè¿™æ ·çš„åŒºé—´æ±‚å–æœ€å¤§å€¼,å¯¹æ¯ä¸ªåŒºé—´ï¼Œæˆ‘ä»¬åšè¿™æ ·çš„å¤„ç†ï¼š</p><blockquote><ol><li>åŒºé—´çš„å€¼åº”è¯¥ä¿æŒä¸ºæ­£æ•°</li><li>æˆ‘ä»¬è®°å½•åŒºé—´ä¸­è´Ÿæ•°çš„ä¸ªæ•°å’Œ2çš„ä¸ªæ•°</li><li>2çš„ä¸ªæ•°å†³å®šä¹˜ç§¯å¤§å°ï¼Œè´Ÿæ•°ä¸ªæ•°å†³å®šä¹˜ç§¯æ˜¯å¦ä¸ºè´Ÿã€‚</li><li>åœ¨ä¹˜ç§¯å·²ç»æ˜¯æ­£æ•°çš„åŸºç¡€ä¸Šï¼Œé‚£ä¹ˆåŒºé—´çš„æ•°ç•™ä¸‹çš„è¶Šå¤šè‚¯å®šæ˜¯è¶Šå¥½çš„ã€‚</li><li>åŒºé—´å†…è´Ÿæ•°ä¸ªæ•°ä¸ºå¶æ•°ï¼š</li></ol><blockquote><p>ç›´æ¥æŠŠå½“å‰åŒºé—´ä¹˜ç§¯æœ€ä¸ºå¤‡é€‰ç­”æ¡ˆï¼Œä¸æ­¤æ—¶çš„ç­”æ¡ˆç›¸æ¯”ã€‚</p></blockquote></blockquote><blockquote><ol start="6"><li>åŒºé—´å†…è´Ÿæ•°ä¸ªæ•°ä¸ºå¥‡æ•°ï¼š</li></ol><blockquote><p>åˆ†åˆ«ä»å·¦å’Œä»å³å¯»æ‰¾ç¬¬ä¸€ä¸ªè´Ÿæ•°ï¼Œå–ä¸¤è€…æ›´ä¼˜çš„æƒ…å†µã€‚</p></blockquote></blockquote></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/5208dfa82708426c904e25f7540c3cfd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> cnt_two = <span class="number">0</span>,cnt_negative = <span class="number">0</span>,ans = <span class="number">0</span>,last = <span class="number">0</span>;</span><br><span class="line">    std::pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; res;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i] == <span class="number">0</span>||i == n + <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(cnt_negative&amp;<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = last + <span class="number">1</span> ; j &lt; i ; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(a[j] == <span class="number">2</span>||a[j] == <span class="number">-2</span>)t++;</span><br><span class="line">                    <span class="keyword">if</span>(a[j] &lt; <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(cnt_two - t &gt; ans)</span><br><span class="line">                        &#123;</span><br><span class="line">                            ans = cnt_two - t;</span><br><span class="line">                            res = &#123;j, n + <span class="number">1</span> - i&#125;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                t = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = i - <span class="number">1</span>; j &gt; last ; j--)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(a[j] == <span class="number">2</span>||a[j] == <span class="number">-2</span>)t++;</span><br><span class="line">                    <span class="keyword">if</span>(a[j] &lt; <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(cnt_two - t &gt; ans)</span><br><span class="line">                        &#123;</span><br><span class="line">                            ans = cnt_two - t;</span><br><span class="line">                            res = &#123;last,n + <span class="number">1</span> - j&#125;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(cnt_two &gt; ans)</span><br><span class="line">                &#123;</span><br><span class="line">                    ans = cnt_two;</span><br><span class="line">                    res = &#123;last,n + <span class="number">1</span> - i&#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            last = i;</span><br><span class="line">            cnt_negative = cnt_two = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i] == <span class="number">2</span>)cnt_two++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a[i]==<span class="number">-2</span>)cnt_two++,cnt_negative++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a[i]==<span class="number">-1</span>)cnt_negative++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ans == <span class="number">0</span>)std::cout&lt;&lt;n&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span> std::cout&lt;&lt;res.first&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;res.second&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="e-matrix-and-shifts"><a class="markdownIt-Anchor" href="#e-matrix-and-shifts"></a> E. Matrix and Shifts</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>æœ‰ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>âˆ—</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n*n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>çš„çŸ©é˜µï¼Œé‡Œé¢çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯0å’Œ1ï¼Œå¯ä»¥ä»»æ„æ‰§è¡Œä»¥ä¸‹4ç§æ“ä½œ(æ— éœ€ä»»ä½•ä»£ä»·)ï¼š</p><blockquote><ol><li>å…¨ä½“ä¸Šç§»ä¸€è¡Œ(ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œ)</li><li>å…¨ä½“ä¸‹ç§»ä¸€è¡Œ(æœ€åè¡Œåˆ°ç¬¬ä¸€è¡Œ)</li><li>å…¨ä½“å·¦ç§»ä¸€è¡Œ(æœ€å·¦è¾¹ä¸€è¡Œåˆ°æœ€å³è¾¹ä¸€è¡Œ)</li><li>å…¨ä½“å³ç§»ä¸€è¡Œ(æœ€å³è¾¹ä¸€è¡Œåˆ°æœ€å·¦è¾¹ä¸€è¡Œ)</li></ol></blockquote><p>æ“ä½œå®Œåï¼Œæˆ‘ä»¬å¯ä»¥èŠ±è´¹ä¸€ä¸ªä»£ä»·ï¼Œæ‰§è¡Œè¿™æ ·çš„æ“ä½œï¼š</p><blockquote><p>æŠŠæŸä¸ªå…ƒç´ ä»0å˜æˆ1ï¼Œæˆ–è€…ä»1å˜æˆ0ã€‚</p></blockquote><p>è¦æ±‚å˜å®Œä»¥åï¼Œåªæœ‰å¯¹è§’çº¿å…ƒç´ æ˜¯1ï¼Œå…¶ä½™å‡æ˜¯0ã€‚<br />è¾“å‡ºæœ€å°ä»£ä»·ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>æˆ‘ä»¬åªè¦è®©å°½å¯èƒ½å¤šçš„1è½åœ¨å¯¹è§’çº¿ä¸Šå°±å¯ä»¥äº†ã€‚<br />å³ä»¥å¦‚ä¸‹æ–¹å¼éå†çŸ©é˜µï¼š</p><blockquote><p><img src="https://img-blog.csdnimg.cn/d2e71003700a4bc292dfc8863a9ae50a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /><br /><img src="https://img-blog.csdnimg.cn/e4f7a24946154fb7a828022a888efec7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /><br /><img src="https://img-blog.csdnimg.cn/a09800fbeac7420097bd92f9680fd7e2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /><br /><img src="https://img-blog.csdnimg.cn/f75ea7bd70b34ee686f81f1750b310c9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /></p></blockquote><p>è®°å½•ä¸‹ 1 æœ€å¤šçš„æ•°é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">max</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span></span></span></span>ã€‚<br />é‚£ä¹ˆæœ€åè¦ä¿®æ”¹çš„æ•°é‡å°±æ˜¯ï¼š</p><ol><li>åœ¨å¯¹è§’çº¿ä¸Šçš„ 0 å…ƒç´ (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>âˆ’</mo><mi>m</mi><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">n-max</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span></span></span></span>)</li><li>ä¸åœ¨å¯¹è§’çº¿ä¸Šçš„ 1 å…ƒç´ (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi><mo>âˆ’</mo><mi>m</mi><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">cnt-max</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69841em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span></span></span></span>)</li></ol><p>è®°å½•çŸ©é˜µä¸­ 1 çš„ä¸ªæ•°ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cnt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>ï¼š<br />æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>c</mi><mi>n</mi><mi>t</mi><mo>âˆ’</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(n-max)+(cnt-max)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/f3c5de4c7aaa4860be2a12ef2ae468ce.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e3</span><span class="number">+10</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,cnt = <span class="number">0</span>,max = <span class="number">0</span>;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string s;</span><br><span class="line">        std::cin&gt;&gt;s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span> ; j &lt;= n ; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            a[i][j] = s[j<span class="number">-1</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            cnt += (a[i][j] == <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span> ; j &lt;= n ; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> y = j,temp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i][y] == <span class="number">1</span>)temp++;</span><br><span class="line">            y++;</span><br><span class="line">            <span class="keyword">if</span>(y==n<span class="number">+1</span>)y = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        max = std::<span class="built_in">max</span>(max,temp);</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;cnt - max + (n - max)&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="f1-promising-string-easy-version"><a class="markdownIt-Anchor" href="#f1-promising-string-easy-version"></a> F1. Promising String (easy version)</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªç”±â€™+'å’Œâ€˜-â€™ç»„æˆçš„å­—ç¬¦ä¸²Sï¼Œå®šä¹‰æœ‰å¸Œæœ›çš„å­—ç¬¦ä¸²å¦‚ä¸‹ï¼š</p><blockquote><p>å­—ç¬¦ä¸²å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><blockquote><p>ç›¸é‚»çš„ä¸¤ä¸ªâ€™-â€˜å¯ä»¥åˆå¹¶ä¸ºâ€™+â€™</p></blockquote></blockquote><blockquote><p>å¯ä»¥é€šè¿‡ä¸Šè¿°æ“ä½œï¼Œä½¿å¾—å­—ç¬¦ä¸²ä¸­â€™+'å’Œâ€˜-â€™çš„æ•°é‡ç›¸åŒã€‚</p></blockquote><p>è¾“å‡ºå­—ç¬¦ä¸²Sä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å­ä¸²çš„ä¸ªæ•°ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å› ä¸ºæ•°æ®é‡åªæœ‰3000ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æš´åŠ›æšä¸¾æ‰€æœ‰åŒºé—´ã€‚<br />æ£€æŸ¥åŒºé—´åˆæ³•çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><blockquote><ol><li>è®°å½•ä¸‹åŒºé—´ä¸­â€˜+â€˜çš„æ•°é‡cnt1ï¼Œâ€˜-â€˜çš„æ•°é‡cnt0ï¼Œä»¥åŠå¯ä»¥åˆå¹¶çš„å‡å·çš„æœ€å¤§å¯¹æ•°cntã€‚</li><li>å‡è®¾åˆå¹¶çš„å‡å·å¯¹æ•°ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>:</li></ol><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>0</mn></msub><mo>âˆ’</mo><mn>2</mn><mo>âˆ—</mo><mi>x</mi><mo>=</mo><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>1</mn></msub><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">cnt_{0}-2*x=cnt_{1}+x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>0</mn></msub><mo>âˆ’</mo><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mn>3</mn><mo>âˆ—</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">cnt_{0}-cnt_{1}=3*x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span></p></blockquote></blockquote><blockquote><p>é‚£ä¹ˆåªéœ€è¦æ»¡è¶³<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>ä¸ºæ•´æ•°ï¼Œè€Œä¸”<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>â‰¤</mo><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">x \leq cnt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>ï¼ŒåŒºé—´å°±æ˜¯åˆæ³•çš„ã€‚</p></blockquote></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/2d95a67192e148e68097926876261354.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e3</span><span class="number">+10</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    std::string s;</span><br><span class="line">    std::cin&gt;&gt;s;</span><br><span class="line">    <span class="type">bool</span> tag = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> cnt1,cnt0,cnt,res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cnt = <span class="number">0</span>,cnt1 = <span class="number">0</span>,cnt0 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = i ; j &lt; n ; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(s[j] == <span class="string">&#x27;+&#x27;</span>)cnt1++,tag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(tag)</span><br><span class="line">                &#123;</span><br><span class="line">                    cnt++;</span><br><span class="line">                    cnt0++;</span><br><span class="line">                    tag = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    cnt0++;</span><br><span class="line">                    tag = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cnt0==cnt1)res++;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(cnt0 &gt; cnt1 &amp;&amp; (cnt0 - cnt1) % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(cnt &gt;= (cnt0 - cnt1)/<span class="number">3</span> )res++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;res&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Codeforces </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 779 (Div. 2)(Permutationforces)</title>
      <link href="/2022/04/12/Codeforces-Round-779-Div-2-Permutationforces/"/>
      <url>/2022/04/12/Codeforces-Round-779-Div-2-Permutationforces/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img-blog.csdnimg.cn/10dbb89dba6041cbbd91a9c0776d5a27.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /></p><h2 id="a-marin-and-photoshoot"><a class="markdownIt-Anchor" href="#a-marin-and-photoshoot"></a> A. Marin and Photoshoot</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªç”±0å’Œ1ç»„æˆçš„åºåˆ—ï¼Œç°åœ¨å¯ä»¥å¾€è¿™ä¸ªåºåˆ—ä¸­æ·»åŠ 1ï¼Œæ˜¯çš„è¿™ä¸ªåºåˆ—æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š<br />å¯¹äºä»»æ„é•¿åº¦å¤§äºç­‰äº2çš„åŒºé—´ï¼Œè¦æ±‚è¿™ä¸ªåŒºé—´ä¸­1çš„ä¸ªæ•°å¤§äºç­‰äº0çš„ä¸ªæ•°ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>æ·»åŠ 1ï¼Œä½¿å¾—åºåˆ—ä¸­ä¸å­˜åœ¨å¦‚ä¸‹æƒ…å†µï¼š<br />00æˆ–è€…010<br />å³ä¿è¯ä¸¤ä¸ª0ä¹‹é—´çš„è·ç¦»å¤§äºç­‰äº2ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/6789fdb575c8426c9b1f9489886e1a9c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">4</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::string s;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;s;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>,last = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(last==<span class="number">-1</span>)last = i;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(i-last&lt;=<span class="number">2</span>)res += <span class="number">3</span> - (i - last);</span><br><span class="line">                last = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;res&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="b-marin-and-anti-coprime-permutation"><a class="markdownIt-Anchor" href="#b-marin-and-anti-coprime-permutation"></a> B. Marin and Anti-coprime Permutation</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>è¦æ±‚æ„é€ ä¸€ä¸ªé•¿åº¦ä¸ºnçš„å…¨æ’åˆ—ï¼Œæ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ—</mo><msub><mi>p</mi><mn>1</mn></msub><mo separator="true">,</mo><mn>2</mn><mo>âˆ—</mo><msub><mi>p</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo>âˆ—</mo><msub><mi>p</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>n</mi><mo>âˆ—</mo><msub><mi>p</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">gcd(1*p_{1},2*p_{2},\dots n-1*p_{n-1},n*p_{n}) &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.673611em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span><br />è¯¢é—®æœ‰å‡ ç§æ–¹æ¡ˆæ»¡è¶³ä¸Šè¿°è¦æ±‚ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>é€‰å–ä»»æ„çš„kï¼Œé‚£ä¹ˆå­˜åœ¨kçš„å› å­çš„æ•°å¿…ç„¶kçš„å€æ•°ã€‚<br />å› æ­¤ä¸éš¾æ¨çŸ¥nä¸ªæ•°é‡Œé¢åŒ…å«kçš„å› å­çš„æ•°æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">âŒˆ</mo><mfrac><mi>n</mi><mi>k</mi></mfrac><mo fence="true">âŒ‰</mo></mrow><annotation encoding="application/x-tex">\left \lceil \frac{n}{k} \right \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">âŒˆ</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">âŒ‰</span></span></span></span></span></span>ä¸ªï¼Œé‚£ä¹ˆåŠ ä¸Šè¦ä¹˜çš„æ•°ï¼Œæ‰€ä»¥åŒ…å«kçš„å› å­çš„ä¸ªæ•°åº”è¯¥æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>âˆ—</mo><mrow><mo fence="true">âŒˆ</mo><mfrac><mi>n</mi><mi>k</mi></mfrac><mo fence="true">âŒ‰</mo></mrow></mrow><annotation encoding="application/x-tex">2*\left \lceil \frac{n}{k} \right \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">âŒˆ</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">âŒ‰</span></span></span></span></span></span>ä¸ªã€‚<br />æˆ‘ä»¬æˆ‘ä¿è¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>âˆ—</mo><mrow><mo fence="true">âŒˆ</mo><mfrac><mi>n</mi><mi>k</mi></mfrac><mo fence="true">âŒ‰</mo></mrow><mo>â‰¥</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">2*\left \lceil \frac{n}{k} \right \rceil \geq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">âŒˆ</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">âŒ‰</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼Œå› æ­¤åªèƒ½å–k=2ã€‚<br />é‚£ä¹ˆå°±è®©æ‰€æœ‰çš„æ•°ç›¸ä¹˜åä¸ºå¶æ•°ï¼Œå³è®©å¥‡æ•°ä¹˜å¶æ•°ä½ï¼Œå¶æ•°ä¹˜å¥‡æ•°ä½å³å¯ã€‚<br />1.è‹¥nä¸ºå¶æ•°,ç»“æœä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mo>âˆ—</mo><mo stretchy="false">(</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">(\frac{n}{2})!*(\frac{n}{2})!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.095em;vertical-align:-0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.095em;vertical-align:-0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mclose">!</span></span></span></span><br />2.è‹¥nä¸ºå¥‡æ•°ï¼Œç»“æœä¸º0ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/e8aefd71c06b4a2e8496785850636429.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">4</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    ll res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(n&amp;<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n/<span class="number">2</span> ; i++)</span><br><span class="line">        res = (i*res) % mod;</span><br><span class="line">    std::cout&lt;&lt;res*res%mod&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="c-shinju-and-the-lost-permutation"><a class="markdownIt-Anchor" href="#c-shinju-and-the-lost-permutation"></a> C. Shinju and the Lost Permutation</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªå…¨æ’åˆ—ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>p</mi><mn>2</mn></msub><mo>â€¦</mo><msub><mi>p</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>p</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">p_{1},p_{2}\dots p_{n-1},p_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br />å†ç”±è¿™ä¸ªå…¨æ’åˆ—å¯ä»¥å¾—åˆ°å¦ä¸€ä¸ªæ•°ç»„a<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>â€¦</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mtext>Â </mtext><mo stretchy="false">(</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>â‰¤</mo><mi>j</mi><mo>â‰¤</mo><mi>i</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_{1},a_{2}\dots a_{n-1},a_{n},a_{i}=max\ (p_{j}(1\leq j\leq i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mspace">Â </span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><br />å®šä¹‰ c ä¸ºæ•°ç»„aä¸­ä¸åŒæ•°çš„ä¸ªæ•°ï¼Œå¹¶ç§° c æ˜¯æ•°ç»„ a çš„å¹‚ã€‚<br />é‚£ä¹ˆæˆ‘ä»¬æŠŠè¿™ä¸ªæ•°ç»„på…¨ä½“å‘å³ç§»åŠ¨ä¸€ä¸ªå•ä½ï¼Œè¿™æ ·åˆå¯ä»¥ç¡®å®šä¸€ä¸ªæ•°ç»„aï¼Œè¿›è€Œç¡®å®š c çš„å€¼ã€‚<br />æˆ‘ä»¬è®©<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>è¡¨ç¤ºå…¨æ’åˆ—å‘å³ç§»åŠ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>æ¬¡çš„å€¼ã€‚<br />ç°ç»™å®šæ•°ç»„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè¯¢é—®èƒ½å¦å­˜åœ¨å…¨æ’åˆ—ï¼Œä½¿å¾—ç§»åŠ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>æ¬¡çš„å€¼ç­‰äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>äº§ç”Ÿçš„æ•°ç»„ c è¦æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š<br />1.ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘å½“æœ€å¤§æ•°ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªä½ç½®æ—¶ï¼Œæ­¤æ—¶çš„ c å¿…ç„¶æ˜¯ 1ï¼Œä¸”åªæœ‰è¿™ç§æƒ…å†µ c ä¸º 1ã€‚<br />2.å°†1ä¸­çš„å…¨æ’åˆ—å‘å³ç§»åŠ¨ä¸€ä¸ªå•ä½ï¼Œæ­¤æ—¶ c å¿…ç„¶æ˜¯ 2ã€‚<br />3.é‚£ä¹ˆåœ¨ä¹‹åçš„ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œc æ¯æ¬¡æœ€å¤šå¯ä»¥å¢åŠ  1(è¦æ³¨æ„ï¼Œæœ€å¤§æ•°ä»¥åçš„æ•°å¿…ç„¶åªèƒ½ä¸º c æä¾› 1 çš„ è´¡çŒ®)ï¼Œæˆ–è€…å¯ä»¥å‡å°è‹¥å¹²ã€‚<br />å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ c æ˜¯å¦æ»¡è¶³å¦‚ä¸‹æƒ…å†µï¼š<br />1.c = 1 åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªã€‚<br />2.ä»1çš„ä½ç½®å¼€å§‹åˆ¤æ–­ï¼Œæ¯æ¬¡æœ€å¤šåªä¼šå¢åŠ 1ï¼Œæˆ–è€…å‡å°è‹¥å¹²ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/54f6b69552224331bec1551c07d57cb8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span><span class="number">+10</span>,M = N * <span class="number">4</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">-1</span>,cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cin&gt;&gt;a[i];</span><br><span class="line">        <span class="keyword">if</span>(a[i] == <span class="number">1</span>)index = i,cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(index==<span class="number">-1</span>||cnt&gt;<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;NO\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x = index + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(x==n<span class="number">+1</span>)x = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(a[x] - a[index] &gt;= <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout&lt;&lt;<span class="string">&quot;NO\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        index++;</span><br><span class="line">        <span class="keyword">if</span>(index==n<span class="number">+1</span>)index = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;YES\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="d1-388535-easy-version"><a class="markdownIt-Anchor" href="#d1-388535-easy-version"></a> D1. 388535 (Easy Version)</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä»L(L = 0)åˆ°Rçš„ä¸€ä¸ªå…¨æ’åˆ—å’Œä¸€ä¸ªæ•´æ•° x ã€‚ç°åœ¨å¯¹è¿™ä¸ªå…¨æ’åˆ—çš„æ¯ä¸ªæ•°éƒ½æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo>â¨</mo><mi>x</mi><mo stretchy="false">(</mo><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_{i} = a_{i}\bigoplus x(1\leq i \leq n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">â¨</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span><br />ç»™å‡ºæ“ä½œå®Œåçš„æ•°ç»„ï¼Œè¯¢é—®æ˜¯å¦å­˜åœ¨ x ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å› ä¸ºå…¨æ’åˆ—æ˜¯ä»0å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åœ¨æ¯ä¸€ä½æ•°å­—ä¸Š0çš„ä¸ªæ•°å¿…ç„¶å¤§äºç­‰äº1çš„ä¸ªæ•°ï¼Œå› æ­¤æˆ‘ä»¬æˆ‘ä»¬åªè¦ä¿è¯è¿™ä¸€æ¡ä»¶å³å¯æ„é€ å‡ºç­”æ¡ˆ x ï¼š<br />å¯¹äºç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä½ï¼Œæˆ‘ä»¬æ„é€ å¦‚ä¸‹ï¼š<br />1.è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>1</mn></msub><mo>&gt;</mo><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">cnt_{1} &gt; cnt_{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè¯¥ä½å–1<br />2.è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>1</mn></msub><mo>â‰¤</mo><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">cnt_{1} \leq cnt_{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè¯¥ä½å–0</p></blockquote><blockquote><p>ä¸¾ä¾‹ï¼š<br />0~7<br />0000<br />0001<br />0010<br />0011<br />0100<br />0101<br />0110<br />0111<br />æ¯ä¸€ä½ä¸Šæ˜¾ç„¶æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>1</mn></msub><mo>â‰¤</mo><mi>c</mi><mi>n</mi><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">cnt_{1} \leq cnt_{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/e436b793be9a49fc856e7a078975da5e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span><span class="number">+10</span>,M = N * <span class="number">4</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[<span class="number">20</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    std::cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">    <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span> a);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= r - l + <span class="number">1</span> ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span> ; j &lt;= <span class="number">17</span> ; j++)a[j][x&gt;&gt;j&amp;<span class="number">1</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt;= <span class="number">17</span> ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i][<span class="number">1</span>] &gt; a[i][<span class="number">0</span>])res += <span class="number">1</span> &lt;&lt; i;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;res&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Codeforces </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CodeTON Round 1 (Div. 1 + Div. 2, Rated, Prizes)</title>
      <link href="/2022/04/12/CodeTON-Round-1-Div-1-Div-2-Rated-Prizes/"/>
      <url>/2022/04/12/CodeTON-Round-1-Div-1-Div-2-Rated-Prizes/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img-blog.csdnimg.cn/91f06a1f167d48afbbd9ea07cfff4316.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><h1 id="a-good-pairs"><a class="markdownIt-Anchor" href="#a-good-pairs"></a> A. Good Pairs</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºnçš„åºåˆ—ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_{1},a_{2},\dots,a_{n-1},a_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br />ç°åœ¨è¦æ‰¾åˆ°ä¸€å¯¹ä¸‹æ ‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i,j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span>æ»¡è¶³ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ£</mi><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>k</mi></msub><mi mathvariant="normal">âˆ£</mi><mo>+</mo><mi mathvariant="normal">âˆ£</mi><msub><mi>a</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>k</mi></msub><mi mathvariant="normal">âˆ£</mi><mo>=</mo><mi mathvariant="normal">âˆ£</mi><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">|a_{i}-a_{k}|+|a_{j}-a_{k}|=|a_{i}-a_{j}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span></span></span></span><br />å¯¹æ‰€æœ‰çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo stretchy="false">(</mo><mn>1</mn><mo>â‰¤</mo><mi>k</mi><mo>â‰¤</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">k(1\leq k\leq n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>æˆç«‹</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>æ˜¾ç„¶åªè¦<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mtext>å’Œ</mtext><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}å’Œa_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">å’Œ</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯æœ€å¤§å€¼æ˜¯æœ€å°å€¼å³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç :</strong><br /><img src="https://img-blog.csdnimg.cn/e5423e37a0db45089f0223d4c30ba540.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;a[i];</span><br><span class="line">    std::cout&lt;&lt;std::<span class="built_in">max_element</span>(a<span class="number">+1</span>,a<span class="number">+1</span>+n) - a&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;std::<span class="built_in">min_element</span>(a<span class="number">+1</span>,a<span class="number">+1</span>+n)-a&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="b-subtract-operation"><a class="markdownIt-Anchor" href="#b-subtract-operation"></a> B. Subtract Operation</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºnçš„åºåˆ—ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo>â€¦</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_{1},a_{2},a_{3}\dots a_{n-1},a_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br />ç°åœ¨å¯ä»¥ä»ä¸­é€‰æ‹©ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<br />å°†å…¶åˆ é™¤ï¼Œå¹¶è®©å…¶ä½™æ‰€æœ‰æ•°å‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">a{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">i</span></span></span></span></span>ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo>â€¦</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{1}-a_{i},a_{2}-a_{i},a_{3}-a_{i}\dots a_{n-1}-a_{i},a_{n}-a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br />æ‰§è¡Œè¿™æ ·çš„æ“ä½œè‹¥å¹²æ¬¡ï¼Œç›´è‡³åºåˆ—ä¸­åªå‰©ä¸‹ä¸€ä¸ªæ•°ã€‚<br />æ˜¯å¦å­˜åœ¨æŸç§æ“ä½œé¡ºåºï¼Œå¯ä»¥ä½¿æœ€åå‰©ä¸‹çš„æ•°ç­‰äºkã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å‡è®¾æœ€åç•™ä¸‹çš„æ•°æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œæœ€åä¸€æ¬¡åˆ é™¤çš„æ•°æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼ˆåŸåºåˆ—ä¸­çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼‰ï¼Œé‚£ä¹ˆæœ€åç•™ä¸‹æ¥çš„æ•°ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}-a_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</p></blockquote><blockquote><p>è¯æ˜å¦‚ä¸‹ï¼š<br />è®¾ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>æ¬¡åˆ é™¤äº†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå¾—åˆ°ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>a</mi><mn>1</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mn>2</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">]</mo><mo>â€¦</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">]</mo><mo>â€¦</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mi>n</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[a_{1}-a_{i}],[a_{2}-a_{i}]\dots [a_{j}-a_{i}]\dots [a_{n-1}-a_{i}],[a_{n}-a_{i}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>ã€‚<br />è®¾ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>æ¬¡åˆ é™¤äº†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{j}-a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå¾—åˆ°ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>a</mi><mn>1</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mn>2</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo separator="true">,</mo><mo>â€¦</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mi>n</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[a_{1}-a_{i}-(a_{j}-a_{i})],[a_{2}-a_{i}-(a_{j}-a_{i})],\dots [a_{n-1}-a_{i}-(a_{j}-a_{i})],[a_{n}-a_{i}-(a_{j}-a_{i}])</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mclose">)</span></span></span></span>ã€‚<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ’</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">-&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>a</mi><mn>1</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mn>2</mn></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">]</mo><mo>â€¦</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">]</mo><mo separator="true">,</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mi>n</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[a_{1}-a_{j}],[a_{2}-a_{j}]\dots [a_{n-1}-a_{j}],[a_{n}-a_{j}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>ã€‚</p></blockquote><blockquote><p>å› æ­¤ï¼Œæ•´ä¸ªåºåˆ—å‡å°çš„æ•°åªä¸æœ€åä¸€æ¬¡åˆ é™¤æœ‰å…³ã€‚<br />æœ€ç»ˆç•™ä¸‹çš„æ•°å³<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}-a_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br />é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å¯»æ‰¾æ˜¯å¦å­˜åœ¨è¿™æ ·çš„ä¸€å¯¹æ•°ï¼Œæ»¡è¶³<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>a</mi><mi>j</mi></msub><mo>=</mo><mo>=</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">a_{i}-a_{j}==k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>å³å¯ã€‚<br />è¿™é‡Œåœ¨æ’åºåäºŒåˆ†å°±å¯ä»¥å®ŒæˆæŸ¥æ‰¾ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/c755ce0da0ce443da5316a4f1e8f6eeb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,k;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;a[i];</span><br><span class="line">    std::<span class="built_in">sort</span>(a<span class="number">+1</span>,a<span class="number">+1</span>+n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> index = std::<span class="built_in">lower_bound</span>(a<span class="number">+1</span>,a+n<span class="number">+1</span>,a[i]+k) - a;</span><br><span class="line">        <span class="keyword">if</span>(index &lt;= n &amp;&amp; a[index] - a[i] == k)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;YES\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;NO\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="c-make-equal-with-mod"><a class="markdownIt-Anchor" href="#c-make-equal-with-mod"></a> C. Make Equal With Mod</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªåºåˆ—ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo>â€¦</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_{1},a_{2},a_{3}\dots a_{n-1},a_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br />é€‰æ‹©ä¸€ä¸ªæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo stretchy="false">(</mo><mi>x</mi><mo>â‰¥</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x(x\geq 2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span>ï¼Œå¯¹æ‰€æœ‰æ•°å–æ¨¡ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mi mathvariant="normal">%</mi><mi>x</mi><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mi mathvariant="normal">%</mi><mi>x</mi><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mi mathvariant="normal">%</mi><mi>x</mi><mo>â€¦</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mi mathvariant="normal">%</mi><mi>x</mi><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mi mathvariant="normal">%</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">a_{1}\%x,a_{2}\%x,a_{3}\%x\dots a_{n-1}\%x,a_{n}\%x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.958331em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">%</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">%</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">%</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord">%</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">%</span><span class="mord mathnormal">x</span></span></span></span>ã€‚<br />åœ¨è‹¥å¹²æ¬¡æ“ä½œåæ˜¯å¦å¯èƒ½ä½¿æ‰€æœ‰æ•°ç›¸ç­‰ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>ç¬¬ä¸€ç§æƒ…å†µï¼ŒåŸåºåˆ—æ²¡æœ‰1ï¼š<br />æˆ‘ä»¬è€ƒè™‘æŠŠæ‰€æœ‰æ•°å˜æˆ0ï¼Œå³æ¯æ¬¡é€‰æ‹©æœ€å¤§çš„æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œä»¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x = a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>,<br />åˆ™ä¸€æ¬¡æ“ä½œååªæœ‰æœ€å¤§çš„æ•°å˜æˆ0ï¼Œå…¶ä½™æ•°å‡ä¸å˜ã€‚<br />æ‰€ä»¥è¯¥æƒ…å†µä¸€å®šæœ‰è§£ã€‚</p></blockquote><blockquote><p>ç¬¬ä¸€ç§æƒ…å†µï¼ŒåŸåºåˆ—å­˜åœ¨1ï¼š<br />é‚£ä¹ˆæˆ‘ä»¬åªèƒ½è€ƒè™‘æŠŠæ‰€æœ‰æ•°å˜æˆ1ã€‚<br />æ¯æ¬¡é€‰æ‹©æœ€å¤§çš„æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œä»¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x = a_{i} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ï¼Œé‚£ä¹ˆå–æ¨¡åæœ€å¤§æ•°å˜æˆ1ã€‚<br />è‹¥åœ¨æ­¤è¿‡ç¨‹ä¸­åºåˆ—ä¸­å­˜åœ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a_{i} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ï¼Œåˆ™<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a_{i} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>å˜æˆ 0 ï¼Œé‚£ä¹ˆä¸å­˜åœ¨æ–¹æ¡ˆã€‚<br />å¦åˆ™å­˜åœ¨æ–¹æ¡ˆã€‚</p></blockquote><p><img src="https://img-blog.csdnimg.cn/9cc71c654a4a42c9b627500fb7e12ba8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /><br /><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        flag = (a[i]==<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(flag)<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!flag)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;YES\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        flag = <span class="literal">false</span>;</span><br><span class="line">        std::<span class="built_in">sort</span>(a<span class="number">+1</span>,a<span class="number">+1</span>+n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>  i = <span class="number">1</span> ; i &lt; n ; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            flag = (a[i<span class="number">+1</span>] - a[i] == <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(flag)<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout&lt;&lt;<span class="string">&quot;NO\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            std::cout&lt;&lt;<span class="string">&quot;YES\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><h1 id="e-equal-tree-sums"><a class="markdownIt-Anchor" href="#e-equal-tree-sums"></a> E. Equal Tree Sums</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªæ— æ ¹æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªæƒå€¼ï¼Œç°åœ¨æˆ‘ä»¬è¦å¯¹èŠ‚ç‚¹åˆ†é…ä¸€ä¸ªæƒå€¼<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œä½¿å¾—æ— è®ºåˆ é™¤å“ªä¸€ä¸ªç‚¹ï¼Œå‰©ä½™çš„æ¯ä¸ªè¿é€šå—æƒå€¼ä¹‹å’Œç›¸ç­‰ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>ä»ä¸€ä¸ªç‚¹å¼€å§‹éå†æ•´æ£µæ ‘ï¼Œèµ·ç‚¹æŸ“ä¸ºç™½è‰²ã€‚<br />åœ¨éå†çš„æ—¶å€™ï¼Œä¸ç™½è‰²ç›¸é‚»çš„ç‚¹æŸ“ä¸ºé»‘è‰²ï¼Œä¸é»‘è‰²ç›¸é‚»çš„ç‚¹æŸ“ä¸ºç™½è‰²ã€‚<br />æŸ“è‰²å®Œæˆåï¼Œè®¾æ¯ä¸ªç‚¹çš„åº¦æ•°ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">d[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>ï¼Œå¹¶ä»¤ï¼š<br />1.ç™½è‰²ç‚¹çš„æƒå€¼ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ’</mo><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">-d[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span><br />2.é»‘è‰²ç‚¹çš„æƒå€¼ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">d[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span><br />èµ‹å€¼æ˜¾ç„¶åæ‰€æœ‰æ•´æ£µæ ‘çš„æƒå€¼å’Œä¸º0ï¼Œå¹¶ä¸”æ¯æ¡è¾¹å¯¹æƒå€¼å’Œçš„è´¡çŒ®ä¸º0ã€‚</p></blockquote><blockquote><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸€æ¡è¾¹åˆ†è£‚æˆä¸¤æ¡è¾¹ï¼Œä¸€æ¡ç”±é»‘è‰²ç‚¹æŒ‡å‘ç™½è‰²ç‚¹ï¼Œæƒå€¼ä¸º1ï¼Œä¸€æ¡ç”±ç™½è‰²ç‚¹æŒ‡å‘é»‘è‰²ç‚¹ï¼Œæƒå€¼ä¸º-1ï¼Œé‚£ä¹ˆä¸€ä¸ªç™½è‰²ç‚¹çš„æƒå€¼å°±æ˜¯ç”±æ‰€æœ‰è¿™ä¸ªç™½è‰²ç‚¹æŒ‡å‘é»‘è‰²ç‚¹çš„è¾¹åŠ å’Œè€Œæˆã€‚</p></blockquote><blockquote><p>ç°åœ¨è¯æ˜åˆ é™¤ä¸€ä¸ªç‚¹åå‰©ä½™è¿é€šå—æƒå€¼å’Œç›¸ç­‰ï¼š<br />1.å‡è®¾åˆ é™¤äº†ä¸€ä¸ªé»‘ç‚¹ï¼Œæƒå€¼ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">d[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span><br />2.é‚£ä¹ˆå¾ˆæ˜¾ç„¶æ­¤æ—¶æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">d[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>è¿é€šå—<br />3.ç°åœ¨æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„åˆ†è¾¹ï¼Œä¸ºæ¯ä¸ªç‚¹é‡æ–°èµ‹å€¼ï¼Œé‚£ä¹ˆæ¯ä¸ªè¿é€šå—å†…éƒ¨æƒå€¼éƒ½ä¸º0<br />4.å¯¹äºæ‰€æœ‰ä¸é»‘ç‚¹ç›¸è¿çš„ç™½è‰²ç‚¹ï¼Œæƒå€¼ç›¸å·®çš„åªæ˜¯ä¸é»‘ç‚¹ç›¸è¿çš„è¿™ä¸€æ¡è¾¹çš„æƒå€¼ï¼Œå…¶ä½™æ‰€æœ‰ç‚¹æƒå€¼ä¸å˜ã€‚<br />5.æ‰€ä»¥å®é™…ä¸Šæ¯ä¸ªè¿é€šå—å˜åŒ–çš„å’Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>æˆ–<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">1</span></span></span></span>ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>O(n+m)</p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/1a89bea36c614420917506e3f82862dc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> h[N],e[M],ne[M],idx;</span><br><span class="line"><span class="type">int</span> w[N],d[N];</span><br><span class="line"><span class="type">bool</span> color[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b,ne[idx] = h[a],h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa,<span class="type">bool</span> st)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color[u] = st;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[u] ; ~i ; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v = e[i];</span><br><span class="line">        d[u]++;</span><br><span class="line">        <span class="keyword">if</span>(v==fa)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(v,u,st^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)h[i] = <span class="number">-1</span>,d[i] = <span class="number">0</span>;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        std::cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">add</span>(a,b),<span class="built_in">add</span>(b,a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">-1</span>,<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)color[i] == <span class="number">0</span> ? std::cout&lt;&lt;-d[i]&lt;&lt;<span class="string">&quot; &quot;</span>:std::cout&lt;&lt;d[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    std::cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Codeforces </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AtCoder Beginner Contest 245</title>
      <link href="/2022/04/12/AtCoder-Beginner-Contest-245/"/>
      <url>/2022/04/12/AtCoder-Beginner-Contest-245/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img-blog.csdnimg.cn/be3f62f6376d4d898e9a15001524cbf7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /></p><h1 id="a-good-morning"><a class="markdownIt-Anchor" href="#a-good-morning"></a> A - Good morning</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>è¯­æ³•é¢˜ï¼š<br />ç»™å®šä¸¤ä¸ªèµ·åºŠæ—¶é—´ã€‚<br />è‹¥ç¬¬ä¸€ä¸ªæ—©äºç­‰äºç¬¬äºŒä¸ªï¼Œè¾“å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="Red"><mi>T</mi><mi>a</mi><mi>k</mi><mi>a</mi><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">{\color{Red}Takahashi }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;color:Red;">T</span><span class="mord mathnormal" style="color:Red;">a</span><span class="mord mathnormal" style="margin-right:0.03148em;color:Red;">k</span><span class="mord mathnormal" style="color:Red;">a</span><span class="mord mathnormal" style="color:Red;">h</span><span class="mord mathnormal" style="color:Red;">a</span><span class="mord mathnormal" style="color:Red;">s</span><span class="mord mathnormal" style="color:Red;">h</span><span class="mord mathnormal" style="color:Red;">i</span></span></span></span></span>ï¼Œ<br />åä¹‹è¾“å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="Red"><mi>A</mi><mi>o</mi><mi>k</mi><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">{\color{Red}Aoki}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="color:Red;">A</span><span class="mord mathnormal" style="color:Red;">o</span><span class="mord mathnormal" style="margin-right:0.03148em;color:Red;">k</span><span class="mord mathnormal" style="color:Red;">i</span></span></span></span></span>ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>è§ä»£ç </p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/d0468c5126aa40d28e2c3fe5ca1d2158.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e2</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> a,b,c,d;</span><br><span class="line">    std::cin&gt;&gt;a&gt;&gt;b&gt;&gt;c&gt;&gt;d;</span><br><span class="line">    <span class="keyword">if</span>(a*<span class="number">60</span>+b&lt;=c*<span class="number">60</span>+d)std::cout&lt;&lt;<span class="string">&quot;Takahashi&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> std::cout&lt;&lt;<span class="string">&quot;Aoki&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="b-mex"><a class="markdownIt-Anchor" href="#b-mex"></a> B - Mex</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºnçš„åºåˆ—ï¼Œè¾“å‡ºè¿™ä¸ªåºåˆ—ä¸­æœªå‡ºç°çš„æœ€å°è‡ªç„¶æ•°ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>ç”¨ä¸€ä¸ªæ•°ç»„ç»Ÿè®¡æ•°å­—å‡ºç°æ¬¡æ•°ï¼Œç„¶åå¯»æ‰¾è¿™ä¸ªåºåˆ—ä¸­æœªå‡ºç°çš„æœ€å°è‡ªç„¶æ•°ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/d8b1d4bf46df46ff816ee1c4ea000ff9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e3</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        cnt[x]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!cnt[i])</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout&lt;&lt;i;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="c-choose-elements"><a class="markdownIt-Anchor" href="#c-choose-elements"></a> C - Choose Elements</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸¤ä¸ªåºåˆ—å’Œä¸€ä¸ªæ•´æ•°kï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>â€¦</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_{1},a_{2}\dots a_{n-1},a_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>b</mi><mn>2</mn></msub><mo>â€¦</mo><msub><mi>b</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">b_{1},b_{2}\dots b_{n-1},b_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br />è¦æ±‚æ„é€ å‡ºä¸€ä¸ªåºåˆ—ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo>â€¦</mo><msub><mi>c</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>n</mi></msub><mo stretchy="false">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mtext>æˆ–</mtext><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>b</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">c_{1},c_{2}\dots c_{n-1},c_{n}(c_{i}=a_{i}æˆ–c_{i}=b_{i})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">æˆ–</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><br />ä½¿å¾—å¯¹äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">c_{i}(1\leq i \leq n-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>æœ‰:<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>âˆ’</mo><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mi mathvariant="normal">âˆ£</mi><mo>â‰¤</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">|c[i]-c[i+1]|\leq k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å¦‚æœå¯¹äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Â </mtext><mi>i</mi><mtext>Â </mtext><mo stretchy="false">(</mo><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi><mo>âˆ’</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\ i\ (1\leq i\leq n-2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mspace">Â </span><span class="mord mathnormal">i</span><span class="mspace">Â </span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span>éƒ½æ»¡è¶³å¦‚ä¸Šè¦æ±‚ã€‚<br />é‚£ä¹ˆæ˜¾ç„¶æ­¤æ—¶æ˜¯å¦æ»¡è¶³è¦æ±‚åªä¸<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_{n-1},a_{n},b_{n-1},b_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æœ‰å…³ã€‚<br />è¿™ç§æ€§è´¨æ»¡è¶³æ— åæ•ˆæ€§ï¼Œè€ƒè™‘ä½¿ç”¨åŠ¨æ€è§„åˆ’ã€‚<br />æˆ‘ä»¬è®¾æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">2</span><span class="mclose">]</span></span></span></span>ï¼š<br />è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">dp[i][0]=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>è¡¨ç¤ºç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å¯ç”¨<br />è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">dp[i][0]=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>è¡¨ç¤ºç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸å¯ç”¨<br />è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">dp[i][1]=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>è¡¨ç¤ºç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å¯ç”¨<br />è‹¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">dp[i][1]=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>è¡¨ç¤ºç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸å¯ç”¨<br />(è¿™é‡Œå¯èƒ½ç”¨1è¡¨ç¤ºå¯ç”¨æ›´å¥½ï¼Œä½†æ˜¯å½“æ—¶æˆ‘ä¸æƒ³åˆå§‹åŒ–)<br />å³å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è½¬ç§»ï¼š</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt;= n ; i++)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">if</span>(!dp[i<span class="number">-1</span>][<span class="number">0</span>]&amp;&amp;<span class="built_in">abs</span>(a[i]-a[i<span class="number">-1</span>])&lt;=k||!dp[i<span class="number">-1</span>][<span class="number">1</span>]&amp;&amp;<span class="built_in">abs</span>(a[i]-b[i<span class="number">-1</span>])&lt;=k)dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">else</span> dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">if</span>(!dp[i<span class="number">-1</span>][<span class="number">0</span>]&amp;&amp;<span class="built_in">abs</span>(b[i]-a[i<span class="number">-1</span>])&lt;=k||!dp[i<span class="number">-1</span>][<span class="number">1</span>]&amp;&amp;<span class="built_in">abs</span>(b[i]-b[i<span class="number">-1</span>])&lt;=k)dp[i][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">else</span> dp[i][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‚£ä¹ˆæœ€å<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[n][0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span>æˆ–<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[n][1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span></span>å­˜åœ¨ä¸€ä¸ªå¯ç”¨å³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>O(n)</p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/f9e7926d468842efa9801a2fb96ea4eb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N],b[N],dp[N][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> n,k;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;b[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!dp[i<span class="number">-1</span>][<span class="number">0</span>]&amp;&amp;<span class="built_in">abs</span>(a[i]-a[i<span class="number">-1</span>])&lt;=k||!dp[i<span class="number">-1</span>][<span class="number">1</span>]&amp;&amp;<span class="built_in">abs</span>(a[i]-b[i<span class="number">-1</span>])&lt;=k)dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!dp[i<span class="number">-1</span>][<span class="number">0</span>]&amp;&amp;<span class="built_in">abs</span>(b[i]-a[i<span class="number">-1</span>])&lt;=k||!dp[i<span class="number">-1</span>][<span class="number">1</span>]&amp;&amp;<span class="built_in">abs</span>(b[i]-b[i<span class="number">-1</span>])&lt;=k)dp[i][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> dp[i][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!dp[n][<span class="number">0</span>]||!dp[n][<span class="number">1</span>])std::cout&lt;&lt;<span class="string">&quot;Yes&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> std::cout&lt;&lt;<span class="string">&quot;No&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="d-polynomial-division"><a class="markdownIt-Anchor" href="#d-polynomial-division"></a> D - Polynomial division</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>å­˜åœ¨å¤šé¡¹å¼ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msup><mi>x</mi><mn>1</mn></msup><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>x</mi><mn>2</mn></msup><mo>â€¦</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><msup><mi>x</mi><mi>n</mi></msup><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><msup><mi>x</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">a_{0}+a_{1}x^{1}+a_{2}x^{2}\dots a_{n-1}x^{n}+a_{n}x^{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.964108em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0224389999999999em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.814392em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><msup><mi>x</mi><mn>1</mn></msup><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><msup><mi>x</mi><mn>2</mn></msup><mo>â€¦</mo><msub><mi>b</mi><mrow><mi>m</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><msup><mi>x</mi><mi>m</mi></msup><mo>+</mo><msub><mi>b</mi><mi>m</mi></msub><msup><mi>x</mi><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">b_{0}+b_{1}x^{1}+b_{2}x^{2}\dots b_{m-1}x^{m}+b_{m}x^{m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.964108em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0224389999999999em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span></span></span></span><br />å°†ä¸¤ä¸ªå¤šé¡¹å¼ç›¸ä¹˜å¾—åˆ°ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><mo stretchy="false">(</mo><msub><mi>b</mi><mn>1</mn></msub><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><msub><mi>a</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msup><mi>x</mi><mn>1</mn></msup><mo>â€¦</mo><msub><mi>a</mi><mi>n</mi></msub><msub><mi>b</mi><mi>m</mi></msub><msup><mi>x</mi><mi>n</mi></msup><msup><mi>x</mi><mi>m</mi></msup><mo>âˆ’</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">a_{0}b_{0}+(b_{1}a_{0}+b_{0}a_{1})x^{1}\dots a_{n}b_{m}x^{n}x^{m}-&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>0</mn></msub><mo>+</mo><msub><mi>c</mi><mn>1</mn></msub><msup><mi>x</mi><mn>1</mn></msup><mo>â€¦</mo><msub><mi>c</mi><mrow><mi>n</mi><mo>+</mo><mi>m</mi></mrow></msub><msup><mi>x</mi><mi>n</mi></msup><msup><mi>x</mi><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">c_{0}+c_{1}x^{1}\dots c_{n+m}x^{n}x^{m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0224389999999999em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span></span></span></span><br />ç°åœ¨ç»™å‡ºæ‰€æœ‰ç³»æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè¯·è¾“å‡ºæ‰€æœ‰çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</p></blockquote><p><strong>æ€è·¯:</strong></p><blockquote><p>å¼€å§‹æ—¶ï¼Œæœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mfrac><mrow><mi>c</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><mrow><mi>a</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">b[0]=\frac{c[0]}{a[0]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mopen mtight">[</span><span class="mord mtight">0</span><span class="mclose mtight">]</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mopen mtight">[</span><span class="mord mtight">0</span><span class="mclose mtight">]</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ï¼Œå¹¶åšå¦‚ä¸‹å¤„ç†ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>âˆ’</mo><mi>b</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>âˆ—</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">(</mo><mn>0</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">c[i]=c[i]-b[0]*a[i](0\leq i\leq n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ã€‚<br />å¤„ç†å®Œåæ˜¾ç„¶æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mfrac><mrow><mi>c</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><mrow><mi>a</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">b[1]=\frac{c[1]}{a[0]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mopen mtight">[</span><span class="mord mtight">0</span><span class="mclose mtight">]</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mopen mtight">[</span><span class="mord mtight">1</span><span class="mclose mtight">]</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ï¼Œå¹¶é‡å¤ä¸Šè¿°å¤„ç†ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>âˆ’</mo><mi>b</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>âˆ—</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">(</mo><mn>0</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">c[i+1]=c[i+1]-b[1]*a[i](0\leq i\leq n-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ã€‚<br />å› æ­¤æˆ‘ä»¬å¯ä»¥é‡å¤ä¸Šè¿°æ­¥éª¤ç›´è‡³æ±‚å‡ºæ‰€æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mn>0</mn><mo>â‰¤</mo><mi>j</mi><mo>â‰¤</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">b_{j}(0\leq j\leq n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>:<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mfrac><mrow><mi>c</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><mrow><mi>a</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">b[j]=\frac{c[j]}{a[0]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mopen mtight">[</span><span class="mord mtight">0</span><span class="mclose mtight">]</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mopen mtight">[</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mclose mtight">]</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mi>c</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo stretchy="false">]</mo><mo>âˆ’</mo><mi>b</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>âˆ—</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">c[i+j]=c[i+j]-b[j]*a[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nm)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/e951f3e325d84d99ab95cf888bee56de.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N],b[N],c[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = n ; i &gt;= <span class="number">0</span> ; i--)std::cin&gt;&gt;a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = m + n; i &gt;= <span class="number">0</span> ; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cin&gt;&gt;c[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt;= m ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        b[i] = c[i]/a[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span> ; j &lt;= n ; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            c[i+j] -= (b[i] * a[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = m ; i &gt;= <span class="number">0</span> ; i--)std::cout&lt;&lt;b[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="e-wrapping-chocolate"><a class="markdownIt-Anchor" href="#e-wrapping-chocolate"></a> E - Wrapping Chocolate</h1><blockquote><p>é¢˜æ„ï¼š<br />æœ‰nä¸ªå·§å…‹åŠ›ï¼Œå®½åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br />æœ‰mä¸ªç›’å­ï¼Œå®½åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">d_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br />å¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>â‰¤</mo><msub><mi>c</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>i</mi></msub><mo>â‰¤</mo><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}\leq c_{i},b_{i}\leq d_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œé‚£ä¹ˆç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ç›’å­å°±å¯ä»¥è£…ä¸‹ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ä¸ªå·§å…‹åŠ›ã€‚<br />è¯¢é—®æ˜¯å¦å­˜åœ¨ä¸€ç§æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨ç›’å­æŠŠæ‰€æœ‰çš„å·§å…‹åŠ›è£…ä¸‹ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p><s>æ²¡çœ‹æ•°æ®ä¹‹å‰ï¼Œè¿˜æƒ³ç€æš´åŠ›è·‘äºŒåˆ†å›¾æœ€å¤§åŒ¹é…</s><br />æ— åºæŸ¥æ‰¾å¿…ç„¶è¶…æ—¶ï¼Œè€ƒè™‘å¯¹æŸä¸ªå…³é”®å­—æ’åºã€‚<br />æˆ‘ä»¬æŠŠå·§å…‹åŠ›å’Œç›’å­ä¸€èµ·æŒ‰ç…§å®½åº¦é™åºæ’åº(å¦‚æœå®½åº¦ç›¸åŒåˆ™æŠŠç›’å­æ’åœ¨å‰é¢)ï¼Œéå†æ’åºåçš„æ•°ç»„ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªé›†åˆSï¼ŒæŒ‰ç…§å¦‚ä¸‹æ–¹å¼å¤„ç†ï¼š<br /><strong>1.å¦‚æœå½“å‰ä½ç½®ä¸ºç›’å­ï¼šå°†é•¿åº¦<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">d_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>åŠ å…¥é›†åˆã€‚<br />2.å¦‚æœå½“å‰ä½ç½®ä¸ºå·§å…‹åŠ›ï¼šæ‰¾åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>d</mi><mi>i</mi><mo>â‰¥</mo><msub><mi>b</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>d</mi><mi>i</mi></msub><mo>âˆˆ</mo><mi>S</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d_{i}(min(di\geq b_{i}),d_{i}\in S)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">)</span></span></span></span>ï¼Œå¹¶å°†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">d_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>åˆ é™¤ï¼Œå¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œåˆ™ä¸å­˜åœ¨æ–¹æ¡ˆã€‚<br />æ˜“è¯æ˜ä¸Šè¿°æ“ä½œå¯ä»¥å®Œæˆé¢˜ç›®è¦æ±‚ï¼Œä¸Šè¿°æ“ä½œå¯ä»¥ç”¨multisetå®Œæˆã€‚</strong></p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>O(nlogn)</p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/18ae96e3e0704f1b99626ddc99997bae.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">4e5</span><span class="number">+10</span>,M = N * <span class="number">4</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> x,y;</span><br><span class="line">    <span class="type">bool</span> box;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Node &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(a.x == x)<span class="keyword">return</span> a.box &lt; box;</span><br><span class="line">        <span class="keyword">return</span> a.x &lt; x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;a[N];</span><br><span class="line">std::multiset&lt;<span class="type">int</span>&gt; st;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        a[i].x = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        a[i].y = x;</span><br><span class="line">        a[i].box = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = n + <span class="number">1</span> ; i &lt;= m + n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        a[i].x = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = n + <span class="number">1</span> ; i &lt;= m + n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        a[i].y = x;</span><br><span class="line">        a[i].box = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::<span class="built_in">sort</span>(a<span class="number">+1</span>,a<span class="number">+1</span>+n+m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n + m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i].box)</span><br><span class="line">        &#123;</span><br><span class="line">            st.<span class="built_in">insert</span>(a[i].y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> it = st.<span class="built_in">lower_bound</span>(a[i].y);</span><br><span class="line">            <span class="keyword">if</span>(it!=st.<span class="built_in">end</span>())st.<span class="built_in">erase</span>(it);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                std::cout&lt;&lt;<span class="string">&quot;No&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;Yes&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="f-endless-walk"><a class="markdownIt-Anchor" href="#f-endless-walk"></a> F - Endless Walk</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€å¼ æœ‰å‘å›¾ï¼Œå¯»æ‰¾è¿™æ ·çš„ç‚¹ï¼Œæ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š<br />ä»è¿™ä¸ªç‚¹å‡ºå‘ï¼Œå­˜åœ¨ä¸€æ¡æ— é™é•¿çš„è·¯å¾„ã€‚<br />è¾“å‡ºæœ‰å‡ ä¸ªç‚¹æ»¡è¶³ä¸Šè¿°è¦æ±‚ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>æ»¡è¶³ä¸Šè¿°çš„ç‚¹å­˜åœ¨ä¸¤ç§æƒ…å†µï¼š<br /><strong>1.è¯¥ç‚¹åœ¨ç¯å†…<br />2.ä»è¿™ä¸ªç‚¹å‡ºå‘å¯ä»¥èµ°åˆ°ç¯</strong><br />æˆ‘çš„å¤„ç†å¯èƒ½å¤æ‚äº›ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤ï¼š<br />1.å¼ºè¿é€šåˆ†é‡è·‘tarjanç¼©ç‚¹ï¼Œå¯¹äºä»»æ„çš„å¼ºè¿é€šåˆ†é‡ï¼Œè‹¥å†…éƒ¨ç‚¹æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>i</mi></msub><mo>â‰¥</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">size_{i}\geq2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.15em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>ï¼Œåˆ™è¿™äº›ç‚¹éƒ½åœ¨ç¯å†…ã€‚<br />2.è‹¥é€‰æ‹©è¿™æ ·çš„åšæ³•ï¼Œç»†èŠ‚è¾ƒå¤šï¼š<br />ä»å…¶ä»–ç‚¹å¼€å§‹æœç´¢ï¼Œå°è¯•æ˜¯å¦èƒ½èµ°åˆ°ç¯ã€‚<br />å°è¯•é‡‡ç”¨å¦ä¸€ç§æ–¹æ³•ï¼š<br /><strong>å»ºç«‹åå‘å›¾ï¼Œä»ç¯å¼€å§‹æœç´¢ï¼Œå¯¹äºæ‰€æœ‰æœç´¢åˆ°çš„ç‚¹ï¼Œéƒ½æ»¡è¶³è¦æ±‚ã€‚</strong></p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>O(n+m)</p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/440f40aa5eb544b080f1032c70600b7d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">4</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> h[N],hs[N],e[M],ne[M],idx;</span><br><span class="line"><span class="type">int</span> id[N],dfn[N],low[N],stk[N],size[N],scc,top,ts;</span><br><span class="line"><span class="type">bool</span> book[N],vis[N],OK[N];</span><br><span class="line"><span class="type">int</span> res;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> h[],<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b,ne[idx] = h[a],h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dfn[u] = low[u] = ++ts;</span><br><span class="line">    book[u] = <span class="literal">true</span>,stk[++top] = u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[u] ; ~i ; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v = e[i];</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u] = std::<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(book[v])low[u] = std::<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(low[u]==dfn[u])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> temp;</span><br><span class="line">        scc++;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            temp = stk[top--];</span><br><span class="line">            book[temp] = <span class="literal">false</span>;</span><br><span class="line">            id[temp] = scc;</span><br><span class="line">            size[scc]++;</span><br><span class="line">        &#125;<span class="keyword">while</span>(temp!=u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    res++,vis[u] = OK[u] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = hs[u] ; ~i ; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v = e[i];</span><br><span class="line">        <span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="built_in">memset</span>(hs,<span class="number">-1</span>,<span class="keyword">sizeof</span> hs);</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        std::cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">add</span>(h,a,b),<span class="built_in">add</span>(hs,b,a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)<span class="keyword">if</span>(!dfn[i])<span class="built_in">tarjan</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">        <span class="keyword">if</span>(size[id[i]] &gt; <span class="number">1</span>)OK[i] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)<span class="keyword">if</span>(OK[i]&amp;&amp;!vis[i])<span class="built_in">dfs</span>(i);</span><br><span class="line">    std::cout&lt;&lt;res;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="g-foreign-friends"><a class="markdownIt-Anchor" href="#g-foreign-friends"></a> G - Foreign Friends</h1><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç°æœ‰Nä¸ªäººï¼Œè¿™äº›äººå±äºKä¸ªå›½å®¶ï¼Œè¿™Nä¸ªäººä¸­æœ‰Lä¸ªäººæ˜¯å—æ¬¢è¿çš„äººï¼Œè¿™Lä¸ªäººåˆ†åˆ«å±äºä¸åŒçš„å›½å®¶ã€‚<br />å°æ˜æ˜¯ä¸ªä¸­é—´äººï¼Œå­˜åœ¨Må¯¹å…³ç³»ï¼š<br />å°æ˜å¯ä»¥è®©æŸä¸€å¯¹ä¸­çš„ä¸¤ä¸ªäººç›¸äº’è®¤è¯†ï¼Œä½†æ˜¯è¦èŠ±è´¹ä¸€å®šçš„é‡‘é¢ã€‚<br />å¯¹äºè¿™Nä¸ªäººä¸­çš„æ¯ä¸€ä¸ªäºº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œä»–ä»¬éƒ½æƒ³è¦è®¤è¯†ä¸€ä¸ªä¸åœ¨è‡ªå·±å›½å®¶çš„å—æ¬¢è¿çš„äºº,åˆ†åˆ«è¾“å‡ºè¿™Nä¸ªäººæ‰€éœ€çš„æœ€å°èŠ±è´¹ã€‚<br />(è‹¥aè®¤è¯†bï¼Œbè®¤è¯†cï¼Œé‚£ä¹ˆæœ‰aè®¤è¯†c)</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>æ¯”è¾ƒæ˜¾ç„¶çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ€çŸ­è·¯é—®é¢˜,å¯ä»¥ä½¿ç”¨Dijkstra(ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—)ã€‚<br />æ­£å‘è€ƒè™‘è·‘æœ€çŸ­è·¯æ˜¾ç„¶ä¸è¡Œï¼Œæˆ‘ä»¬åå‘è€ƒè™‘è®©æ¯ä¸ªå—æ¬¢è¿çš„äººå»è®¤è¯†æ¯ä¸€ä¸ªäººï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœè®©æ¯ä¸ªå—æ¬¢è¿çš„äººå»è·‘æœ€çŸ­è·¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿä¼šè¾¾åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>L</mi><mi>N</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(LNlogN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>ï¼Œä½†æ˜¯è¿™é¢˜æ¯”è¾ƒç‰¹æ®Šï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹è€ƒè™‘ï¼š<br /><strong>1.æˆ‘ä»¬æŠŠæ‰€æœ‰å—æ¬¢è¿çš„äººæ”¾åœ¨ä¼˜å…ˆé˜Ÿåˆ—é‡ŒåŒæ—¶è·‘æœ€çŸ­è·¯ï¼Œå¹¶è®°å½•ä»–ä»¬æ‰€å±çš„å›½å®¶,åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬é€šè¿‡è®°å½•ï¼Œä¿è¯æ¯ä¸ªå›½å®¶åªä¼šæ›´æ–°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸€æ¬¡ã€‚<br />2.é‚£ä¹ˆå½“äºº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>è¢«ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡å–å‡ºçš„æ—¶å€™ï¼Œæ‰€éœ€çš„èŠ±è´¹åˆ†åˆ«æ˜¯æœ€å°ï¼Œæ¬¡å°çš„ï¼Œå¹¶ä¸”æ›´æ–°è¿™ä¸¤æ¬¡çš„å›½å®¶ä¸åŒã€‚å› ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>åªä¼šå±äºä¸€ä¸ªå›½å®¶ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæœ€å°æ•°ä¸­ä¸€å®šæœ‰ä¸€ä¸ªå’Œè‡ªå·±çš„å›½å®¶ä¸åŒã€‚<br />3.å¦‚æœä¸æ›´æ–°æœ€å°å€¼çš„å›½å®¶ä¸åŒï¼Œè¾“å‡ºæœ€å°å€¼å³å¯ï¼Œåä¹‹è¾“å‡ºæ¬¡å°å€¼ã€‚</strong></p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>O(nlogn)</p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/6b704365f2614635921b42b08cbfc72e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">4</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    ll dist;</span><br><span class="line">    <span class="type">int</span> u,city;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt;(<span class="type">const</span> Node &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a.dist &lt; dist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> h[N],e[N],ne[N],w[N],idx;</span><br><span class="line"><span class="type">int</span> vis[N],city[N],type[N];</span><br><span class="line">ll dist1[N],dist2[N];</span><br><span class="line"><span class="type">int</span> n,m,k,l;</span><br><span class="line">std::priority_queue&lt;<span class="keyword">struct</span> Node&gt; que;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b,ne[idx] = h[a],w[idx] = c,h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dijkstra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!que.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> temp = que.<span class="built_in">top</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(vis[temp.u] &lt; <span class="number">2</span> &amp;&amp; type[temp.u] != temp.city)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(vis[temp.u] == <span class="number">0</span>) type[temp.u] = temp.city,dist1[temp.u] = temp.dist;</span><br><span class="line">            <span class="keyword">else</span> dist2[temp.u] = temp.dist;</span><br><span class="line">            vis[temp.u]++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = h[temp.u] ; ~i ; i = ne[i])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> v = e[i];</span><br><span class="line">                que.<span class="built_in">push</span>(&#123;temp.dist+w[i],v,temp.city&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;m&gt;&gt;k&gt;&gt;l;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;city[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= l ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        std::cin&gt;&gt;x;</span><br><span class="line">        que.<span class="built_in">push</span>(&#123;<span class="number">0ll</span>,x,city[x]&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(m--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a,b,c;</span><br><span class="line">        std::cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">        <span class="built_in">add</span>(a,b,c),<span class="built_in">add</span>(b,a,c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Dijkstra</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(type[i] != city[i]&amp;&amp;dist1[i])std::cout&lt;&lt;dist1[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(dist2[i])std::cout&lt;&lt;dist2[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">        <span class="keyword">else</span> std::cout&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Atcoder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AtCoder Beginner Contest 246</title>
      <link href="/2022/04/12/AtCoder-Beginner-Contest-246/"/>
      <url>/2022/04/12/AtCoder-Beginner-Contest-246/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img-blog.csdnimg.cn/575e994279a24ffb92a1ea7a71037e04.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAdGltZXJfY2F0Y2g=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" /></p><hr /><h2 id="a-four-points"><a class="markdownIt-Anchor" href="#a-four-points"></a> A - Four Points</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å‡ºä¸‰ä¸ªç‚¹ï¼Œæ‰¾åˆ°ä¸€ä¸ªç‚¹ï¼Œè®©è¿™4ä¸ªç‚¹ç»„æˆä¸€ä¸ªçŸ©å½¢</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>åˆ†åˆ«æ‰¾åˆ°æ¨ªçºµåæ ‡ä¸­åªæœ‰ä¸€ä¸ªçš„å€¼ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/c6d852d3d1ed4e5e8f7a483db5acfcf3.png" alt="!åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°(https://img-blog.csdnimg.cn/aa8cfb2912ee42e683d85a44" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e2</span><span class="number">+5</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">int</span> x,y,ans_x = <span class="number">0</span>,ans_y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= <span class="number">3</span> ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        ans_x ^= x,ans_y ^= y;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;ans_x&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;ans_y;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr /><h2 id="b-get-closer"><a class="markdownIt-Anchor" href="#b-get-closer"></a> B - Get Closer</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å‡ºä¸€ä¸ªå‘é‡ï¼Œå°†å…¶å˜æˆå•ä½å‘é‡ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å°†å‘é‡é™¤ä»¥ä»–çš„æ¨¡å³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/ee08775b42d546c99946cc23b4231b2d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e2</span><span class="number">+5</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.10f %.10f&quot;</span>,x / <span class="built_in">sqrt</span>(x*x+y*y),y / <span class="built_in">sqrt</span>(x*x+y*y));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr /><h2 id="c-coupon"><a class="markdownIt-Anchor" href="#c-coupon"></a> C - Coupon</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šnä¸ªå•†å“ï¼Œæ¯ä¸ªå•†å“çš„ä»·æ ¼æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œç°åœ¨æœ‰kå¼ ä¼˜æƒ åˆ¸ï¼Œæ¯å¼ ä¼˜æƒ åˆ¸å¯ä»¥å‡å°‘æŸä¸ªå•†å“xå…ƒ(ä¸å¾—ä½äº0)ï¼Œè¯¢é—®è´­ä¹°å…¨éƒ¨å•†å“çš„æœ€å°èŠ±è´¹ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>å…ˆä¿è¯ä¸æµªè´¹ä¼˜æƒ åˆ¸çš„æƒ…å†µä¸‹ï¼ŒæŠŠå°½å¯èƒ½å¤šçš„å•†å“ä»·æ ¼å‡å…åˆ°xå…ƒä»¥ä¸‹ï¼Œç„¶åå¦‚æœè¿˜æœ‰ä¼˜æƒ åˆ¸å‰©ä½™ï¼Œæˆ‘ä»¬å¯¹å‰©ä¸‹çš„å•†å“ä»·æ ¼ä»é«˜åˆ°ä½ä½¿ç”¨ä¼˜æƒ åˆ¸ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    <span class="type">int</span> n,k,x;</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;k&gt;&gt;x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cin&gt;&gt;a[i];</span><br><span class="line">        <span class="keyword">if</span>(k == <span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(k &gt;= a[i]/x)</span><br><span class="line">        &#123;</span><br><span class="line">            k -= a[i]/x;</span><br><span class="line">            a[i] %= x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            a[i] -= k * x;</span><br><span class="line">            k = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ll sum = <span class="number">0</span>;</span><br><span class="line">    std::<span class="built_in">sort</span>(a<span class="number">+1</span>,a<span class="number">+1</span>+n,std::<span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> + k ; i &lt;= n ; i++)sum += a[i];</span><br><span class="line">    std::cout&lt;&lt;sum;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr /><h2 id="d-2-variable-function"><a class="markdownIt-Anchor" href="#d-2-variable-function"></a> D - 2-variable Function</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªæ•°nï¼Œæ‰¾åˆ°ä¸€ä¸ªæ•°xï¼Œæ»¡è¶³ä¸‹åˆ—ä¸¤ä¸ªæ¡ä»¶ï¼š</p><blockquote><ol><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>â‰¥</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">x\geq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆƒ</mi><mi>a</mi><mi mathvariant="normal">âˆƒ</mi><mi>b</mi><mo separator="true">,</mo><mtext>ä½¿å¾—</mtext><mi>x</mi><mo>=</mo><msup><mi>a</mi><mn>3</mn></msup><mo>+</mo><msup><mi>a</mi><mn>2</mn></msup><mi>b</mi><mo>+</mo><mi>a</mi><msup><mi>b</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>3</mn></msup><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo>âˆˆ</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\exists a\exists b,ä½¿å¾—x=a^3+a^2b+ab^2+b^3(a,b\in N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">âˆƒ</span><span class="mord mathnormal">a</span><span class="mord">âˆƒ</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">ä½¿</span><span class="mord cjk_fallback">å¾—</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></li></ol></blockquote></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆµ</mo><mi>n</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>18</mn></msup></mrow><annotation encoding="application/x-tex">\because n\leq 10^{18}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69224em;vertical-align:0em;"></span><span class="mrel amsrm">âˆµ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">8</span></span></span></span></span></span></span></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ´</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">\therefore a,b\leq10^{6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69224em;vertical-align:0em;"></span><span class="mrel amsrm">âˆ´</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span><br />æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä»å°åˆ°å¤§æšä¸¾<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span>ï¼Œä»å¤§åˆ°å°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>ï¼Œä»è€Œæšä¸¾å‡ºæ‰€æœ‰çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msup><mi>a</mi><mn>3</mn></msup><mo>+</mo><msup><mi>a</mi><mn>2</mn></msup><mi>b</mi><mo>+</mo><mi>a</mi><msup><mi>b</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>3</mn></msup><mo>â‰¥</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">x=a^3+a^2b+ab^2+b^3\geq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.950078em;vertical-align:-0.13597em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼Œå¹¶ä»ä¸­æ‰¾åˆ°æœ€å°å€¼ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mroot><mi>n</mi><mn>3</mn></mroot><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\sqrt[3]{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord sqrt"><span class="root"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6585560000000001em;"><span style="top:-2.836336em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size6 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8002800000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">n</span></span></span><span style="top:-2.76028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.23972em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/78966db3a96845ca92c3d9d25cc195ee.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1500</span><span class="number">+10</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    ll n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    ll res = <span class="number">1e18</span>;</span><br><span class="line">    ll j = <span class="number">1e6</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i = <span class="number">0</span> ; i &lt;= <span class="number">1e6</span> ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ll temp = i*i*i+i*i*j+i*j*j+j*j*j;</span><br><span class="line">        <span class="keyword">while</span>(temp &gt;= n &amp;&amp; j &gt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            res = std::<span class="built_in">min</span>(res,temp);</span><br><span class="line">            j--;</span><br><span class="line">            temp = i*i*i+i*i*j+i*j*j+j*j*j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;res;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr /><h2 id="e-bishop-2"><a class="markdownIt-Anchor" href="#e-bishop-2"></a> E - Bishop 2</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å‡ºä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>âˆ—</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n*n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>çš„åœ°å›¾ï¼Œå…¶ä¸­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mi mathvariant="normal">.</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;.&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">.</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>æ˜¯å¹³åœ°ï¼Œå…¶ä¸­#æ˜¯éšœç¢ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªèµ·ç‚¹å’Œç»ˆç‚¹ï¼Œåœ¨ä¸è·¨è¶Šéšœç¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¾€å·¦ä¸Šï¼Œå³ä¸Šï¼Œå³ä¸‹ï¼Œå·¦ä¸‹å››ä¸ªæ–œè§’æ–¹å‘ä¸€æ¬¡ç§»åŠ¨ä»»æ„ä¸ªå•ä½ï¼Œè¯¢é—®ä»èµ·ç‚¹ç§»åŠ¨åˆ°ç»ˆç‚¹çš„æœ€å°æ­¥æ•°ï¼Œè‹¥ä¸å­˜åœ¨è·¯å¾„ï¼Œåˆ™è¾“å‡º-1ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>ä¿®æ”¹æ­£å¸¸BFSçš„æ‹“å±•æ–¹å¼å³å¯ï¼Œæ¯æ¬¡æ‹“å±•çš„æ—¶å€™æŠŠå››ä¸ªæ–œè§’æ–¹å‘å¯ä»¥æ‹“å±•çš„ç‚¹å…¨éƒ¨æ‹“å±•ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/5b9ac310fc3746399327794cbd0739f2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1500</span><span class="number">+10</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">1e9</span><span class="number">+7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> x,y,step;</span><br><span class="line">&#125;que[N*N];</span><br><span class="line"><span class="type">char</span> a[N][N];</span><br><span class="line"><span class="type">bool</span> book[N][N];</span><br><span class="line"><span class="type">int</span> ne[<span class="number">4</span>][<span class="number">2</span>] = &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="type">int</span> n,start_x,start_y,end_x,end_y;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">OK</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">1</span>||y&lt;<span class="number">1</span>||x&gt;n||y&gt;n||a[x][y]==<span class="string">&#x27;#&#x27;</span>)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> head = <span class="number">0</span>,tail = <span class="number">-1</span>;</span><br><span class="line">    que[++tail] = &#123;start_x,start_y,<span class="number">0</span>&#125;;</span><br><span class="line">    book[start_x][start_y] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span>(tail&gt;=head)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> temp = que[head++];</span><br><span class="line">        <span class="keyword">if</span>(temp.x == end_x &amp;&amp; temp.y == end_y)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout&lt;&lt;temp.step;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">4</span> ; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> tx = temp.x + ne[i][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> ty = temp.y + ne[i][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">OK</span>(tx,ty))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(!book[tx][ty])que[++tail] = &#123;tx,ty,temp.step<span class="number">+1</span>&#125;;</span><br><span class="line">                book[tx][ty] = <span class="literal">true</span>;</span><br><span class="line">                tx += ne[i][<span class="number">0</span>];</span><br><span class="line">                ty += ne[i][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//    std::ios::sync_with_stdio(false);</span></span><br><span class="line"><span class="comment">//    std::cin.tie(nullptr);</span></span><br><span class="line"><span class="comment">//    std::cout.tie(nullptr);</span></span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;start_x&gt;&gt;start_y&gt;&gt;end_x&gt;&gt;end_y;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n ; i++)std::cin&gt;&gt;(a[i]<span class="number">+1</span>);</span><br><span class="line">    <span class="built_in">bfs</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr /><h2 id="f-typewriter"><a class="markdownIt-Anchor" href="#f-typewriter"></a> F - typewriter</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å‡ºnä¸ªé”®ç›˜ï¼Œæ¯ä¸ªé”®ç›˜å¯ä»¥æ‰“å°å­—æ¯ç”±ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œç°åœ¨è¦æ‰“å°ä¸€ä¸ªé•¿åº¦ä¸ºLçš„å­—ç¬¦ä¸²ï¼Œæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªé”®ç›˜æ‰“å°å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ‰“å°å‡ºå¤šå°‘ä¸åŒçš„å­—ç¬¦ä¸²ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>åº”ç”¨å®¹æ–¥åŸç†ï¼Œä»¥n=3ä¸ºä¾‹ï¼š</p><blockquote><p>ans =<br />+ï¼ˆåªä½¿ç”¨ç¬¬ä¸€ä¸ªé”®ç›˜ï¼‰+ï¼ˆåªä½¿ç”¨ç¬¬äºŒä¸ªé”®ç›˜ï¼‰+ï¼ˆåªä½¿ç”¨ç¬¬ä¸‰ä¸ªé”®ç›˜ï¼‰-ï¼ˆåªä½¿ç”¨ç¬¬ä¸€ä¸ªé”®ç›˜å’Œç¬¬äºŒä¸ªé”®ç›˜å…±æœ‰çš„å­—æ¯æ‰“å°ï¼‰-ï¼ˆåªä½¿ç”¨ç¬¬ä¸€ä¸ªé”®ç›˜å’Œç¬¬ä¸‰ä¸ªé”®ç›˜å…±æœ‰çš„å­—æ¯æ‰“å°ï¼‰-ï¼ˆåªä½¿ç”¨ç¬¬äºŒä¸ªé”®ç›˜å’Œç¬¬ä¸‰ä¸ªé”®ç›˜å…±æœ‰çš„å­—æ¯æ‰“å°ï¼‰+ï¼ˆä½¿ç”¨æ‰€ç”¨é”®ç›˜å…±æœ‰çš„å­—æ¯æ‰“å°ï¼‰ã€‚</p></blockquote><p>å› æ­¤æˆ‘ä»¬åªéœ€è¦æšä¸¾ä¸Šè¿°æ‰€æœ‰æƒ…å†µï¼Œæ±‚å‡ºç­”æ¡ˆå³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p>Nä¸ªå­—æ¯æ‰€èƒ½æ‰“å°çš„é•¿åº¦ä¸ºLçš„å­—ç¬¦ä¸²çš„ä¸ªæ•°ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mi>L</mi></msup></mrow><annotation encoding="application/x-tex">N^{L}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span></span></span></span></span></span></span></span></span></span></span></span>ã€‚<br />ä½¿ç”¨å¿«é€Ÿå¹‚ä¼šèŠ±è´¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>L</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(logL)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">L</span><span class="mclose">)</span></span></span></span>çš„æ—¶é—´ã€‚<br />æ­¤å¤–ï¼Œæšä¸¾æ‰€æœ‰çš„æƒ…å†µæ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mi>n</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(2^n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><br />æ‰€ä»¥æ€»æ—¶é—´å¤æ‚åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mi>n</mi></msup><mi>l</mi><mi>o</mi><mi>g</mi><mi>L</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(2^nlogL)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">L</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/2130c6d073b9419daf26d8453aaa2b3a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">30</span>,M = <span class="number">2e4</span><span class="number">+10</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> temp[N],a[N][N];</span><br><span class="line">ll ans,n,len;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">quickPow</span><span class="params">(ll x,ll k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>)res = (x * res) % mod;</span><br><span class="line">        x = x * x % mod;</span><br><span class="line">        k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> cnt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u==n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(cnt==<span class="number">0</span>)<span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++)<span class="keyword">if</span>(temp[i])count++;</span><br><span class="line">        <span class="keyword">if</span>(cnt&amp;<span class="number">1</span>)ans = (ans + <span class="built_in">quickPow</span>(count,len)) % mod;</span><br><span class="line">        <span class="keyword">else</span> ans = (ans - <span class="built_in">quickPow</span>(count,len) + mod) % mod;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(u<span class="number">+1</span>,cnt);</span><br><span class="line">    <span class="type">bool</span> last[N];</span><br><span class="line">    <span class="built_in">memcpy</span>(last,temp,<span class="keyword">sizeof</span> temp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++)temp[i] &amp;= a[u][i];</span><br><span class="line">    <span class="built_in">dfs</span>(u<span class="number">+1</span>,cnt<span class="number">+1</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(temp,last,<span class="keyword">sizeof</span> temp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;len;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string s;</span><br><span class="line">        std::cin&gt;&gt;s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span> ; j &lt; s.<span class="built_in">size</span>() ; j++) a[i][s[j]-<span class="string">&#x27;a&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++)temp[i] = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    std::cout&lt;&lt;ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr /><h2 id="g-game-on-tree-3"><a class="markdownIt-Anchor" href="#g-game-on-tree-3"></a> G - Game on Tree 3</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€æ£µæ ¹ä¸º1çš„æ ‘ï¼Œé™¤äº†æ ¹ï¼Œæ¯ä¸ªç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œç°åœ¨å°æ˜å’Œå°çº¢ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ç©ä¸€ä¸ªæ¸¸æˆï¼š</p><blockquote><ol><li>å°çº¢ä»»æ„é€‰æ‹©ä¸€ä¸ªç‚¹ï¼ŒæŠŠè¿™ä¸ªç‚¹çš„æƒå€¼å˜ä¸º0</li><li>å°æ˜ä»å½“å‰ç‚¹å‡ºå‘ï¼Œå¯ä»¥èµ°åˆ°ä»»æ„ä¸€ä¸ªå„¿å­èŠ‚ç‚¹</li><li>ç„¶åå°æ˜å¯ä»¥å†³å®šæ˜¯å¦ç»“æŸæ¸¸æˆ(å¦‚æœå°æ˜åœ¨å¶å­èŠ‚ç‚¹åˆ™å¿…é¡»ç»“æŸæ¸¸æˆ)</li></ol></blockquote><p>æœ€åå°æ˜è·å¾—çš„åˆ†æ•°å°±æ˜¯å°æ˜æ‰€åœ¨ç‚¹çš„æƒå€¼ï¼Œå°æ˜å¸Œæœ›è·å¾—çš„åˆ†æ•°å°½å¯èƒ½å¾—é«˜ï¼Œå°çº¢å¸Œæœ›å°æ˜è·å¾—çš„åˆ†æ•°å°½å¯èƒ½çš„ä½,å‡è®¾ä¸¤äººéƒ½è¶³å¤Ÿèªæ˜çš„æƒ…å†µä¸‹(å³æ€»æ˜¯åšå‡ºå¯¹å½“å‰æœ€æœ‰åˆ©çš„æ“ä½œ)ï¼Œå°æ˜å¯ä»¥è·å¾—çš„æœ€å¤§åˆ†æ•°æ˜¯å¤šå°‘ã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>ä½¿ç”¨åŠ¨æ€è§„åˆ’(æ ‘å½¢dp)å’ŒäºŒåˆ†ç­”æ¡ˆã€‚<br />è€ƒè™‘å¯¹äºæŸä¸€ä¸ªåˆ†æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>ï¼Œå°æ˜æ˜¯å¦å­˜åœ¨æ–¹æ¡ˆå¯ä»¥è·å¾—æ¯”<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>å¤§çš„åˆ†æ•°ï¼š</p><blockquote><p>æˆ‘ä»¬ä»¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>u</mi></msub><mo>â‰¥</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">w_u\geq x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>çš„ç‚¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">v_u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸º1ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>u</mi></msub><mo>&lt;</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">w_u&lt; x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>çš„ç‚¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">v_u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸º0ï¼Œã€‚<br />å¦‚æœè¦ä½¿å°æ˜æ— æ³•è·å¾—åˆ†æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>ï¼Œé‚£ä¹ˆå¿…é¡»è¦ä½¿è¿™äº›ä¸º1çš„ç‚¹å˜æˆ0ï¼Œæˆ‘ä»¬å‡è®¾<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>ä¸ºå°æ˜åœ¨ç‚¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>å¼€å§‹æ¸¸æˆå°çº¢æ‰€éœ€è¦çš„æ¶ˆé™¤æ¬¡æ•°ã€‚<br />é‚£ä¹ˆå¯¹äºæŸä¸ªç‚¹çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å¼å­æ±‚å‡ºï¼š</p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><msub><mi>v</mi><mi>i</mi></msub><mo>+</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><msub><mo>âˆ‘</mo><mi>c</mi></msub><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>c</mi><mo>âˆˆ</mo><mi>c</mi><mi>h</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>r</mi><mi>e</mi><msub><mi>n</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">dp[i]=v_i+max(0,\sum_{c}dp[c]-1)(c\in children_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0016819999999999613em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p></blockquote></blockquote><blockquote><p>å¦‚æœå½“å‰ç‚¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">v_i=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>,é‚£ä¹ˆè‚¯å®šæ˜¯è¦æ¶ˆé™¤çš„ï¼Œåœ¨å°æ˜èµ°åˆ°å„¿å­èŠ‚ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€æ¬¡æ¶ˆé™¤æœºä¼š(å¼€å§‹æ¸¸æˆæ—¶å°çº¢æ˜¯å…ˆæ‰‹)ï¼Œæ‰€ä»¥è¿˜è¦åŠ ä¸Š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mo>âˆ‘</mo><mi>c</mi></msub><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(max(\sum_{c}dp[c]-1,0))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0016819999999999613em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>ã€‚</p></blockquote><blockquote><p>æœ€åå¯ä»¥æ±‚å¾—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span>ï¼Œå¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo stretchy="false">!</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">dp[0]!=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>ï¼Œé‚£ä¹ˆå°æ˜æ˜¯å¯ä»¥è·å¾—ä¸€ä¸ªæ¯”<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>å¤§çš„åˆ†æ•°çš„ã€‚</p></blockquote><p>æœ€åç”¨äºŒåˆ†æ‰¾åˆ°æœ€å¤§å€¼å³å¯ã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>m</mi><mi>a</mi><mi>x</mi><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlog(maxA_i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/395c1cd329ad486dbbf7fd4a6aa145a7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> h[N],e[M],ne[M],idx;</span><br><span class="line"><span class="type">int</span> w[N],dp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b,ne[idx] = h[a],h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dp[u] = (w[u] &gt;= val);</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[u] ; ~i ; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v = e[i];</span><br><span class="line">        <span class="keyword">if</span>(v==fa)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(v,u,val);</span><br><span class="line">        sum += dp[v];</span><br><span class="line">    &#125;</span><br><span class="line">    dp[u] += std::<span class="built_in">max</span>(<span class="number">0</span>,sum<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">-1</span>,val);</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">1</span>] != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="type">int</span> max = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt;= n ; i++)std::cin&gt;&gt;w[i],max = std::<span class="built_in">max</span>(max,w[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        std::cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">add</span>(a,b),<span class="built_in">add</span>(b,a);</span><br><span class="line">    &#125;</span><br><span class="line">    w[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> L = <span class="number">0</span>,R = max;</span><br><span class="line">    <span class="keyword">while</span>(R&gt;L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = L + R + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid))L = mid;</span><br><span class="line">        <span class="keyword">else</span> R = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;L;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr /><h2 id="ex-01-queries"><a class="markdownIt-Anchor" href="#ex-01-queries"></a> Ex - 01? Queries</h2><p><strong>é¢˜æ„ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªç”±â€™0â€™,â€˜1â€™å’Œâ€™?'ç»„æˆçš„å­—ç¬¦ä¸²,æˆ‘ä»¬å¯ä»¥ä»»æ„å¾—å°†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mo stretchy="false">?</mo><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;?&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">?</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>æ›¿æ¢æˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;0&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>æˆ–<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;1&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>,æ±‚å­—ç¬¦ä¸²çš„æ‰€æœ‰å­ä¸²å¯ä»¥å½¢æˆçš„ä¸åŒçš„01ä¸²æœ‰å¤šå°‘ç§ã€‚<br />ç°åœ¨å­˜åœ¨qä¸ªæ“ä½œ,æ¯æ¬¡æ“ä½œå°†ç¬¬xä¸ªå­—ç¬¦å˜æˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mo separator="true">,</mo><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mn>1</mn><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mtext>æˆ–</mtext><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mo stretchy="false">?</mo><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">&#x27;0&#x27;,&#x27;1&#x27;æˆ–&#x27;?&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct"><span class="mpunct">,</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord cjk_fallback">æˆ–</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">?</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>,è¯¢é—®æ¯æ¬¡æ“ä½œåçš„ç­”æ¡ˆã€‚</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><blockquote><p>æˆ‘ä»¬å…ˆè€ƒè™‘åœ¨æŸç§æƒ…å†µä¸‹çš„01ä¸²ç§æ•°ã€‚<br />è€ƒè™‘åŠ¨æ€è§„åˆ’,å®šä¹‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mtext>å’Œ</mtext><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][0]å’Œdp[i][1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mord cjk_fallback">å’Œ</span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span></span>åˆ†åˆ«è¡¨ç¤ºå‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ä¸ªå­—æ¯æ‰€èƒ½ç»„æˆçš„ä»¥0ç»“å°¾çš„å’Œä»¥1ç»“å°¾çš„ç§æ•°ã€‚<br />é‚£ä¹ˆåº”è¯¥æœ‰å¦‚ä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹:</p><blockquote><ol><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s[i]=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>+</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">dp[i][0]=dp[i-1][0]+dp[i-1][1]+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][1]=dp[i-1][1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s[i]=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][0]=dp[i-1][0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">dp[i][1]=dp[i-1][1]+dp[i-1][0]+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>Â </mtext><mo stretchy="false">?</mo></mrow><annotation encoding="application/x-tex">s[i]= \ ?</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace">Â </span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mclose">?</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>+</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">dp[i][0]=dp[i-1][0]+dp[i-1][1]+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">dp[i][1]=dp[i-1][1]+dp[i-1][0]+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></li></ol></blockquote><p>æˆ‘ä»¬å°†ä¸Šè¿°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ç”¨çŸ©é˜µè¡¨ç¤º:</p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msub><mi>A</mi><msub><mi>s</mi><mi>i</mi></msub></msub><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} dp[i][0] \\dp[i][1] \\1  \end{bmatrix}=A_{s_{i}}\begin{bmatrix} dp[i-1][0]\\ dp[i-1][1]\\1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span></span></span></span><br />åˆ†åˆ«çš„,å¯¹äºä¸åŒçš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><msub><mi>s</mi><mi>i</mi></msub></msub></mrow><annotation encoding="application/x-tex">A_{s_{i}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span>,æœ‰:</p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mn>0</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">s[i]=0:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><msub><mi>s</mi><mi>i</mi></msub></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">A_{s_{i}}=\begin{bmatrix}1&amp; 1 &amp;1 \\ 0&amp;1  &amp; 0\\ 0&amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mn>1</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">s[i]=1:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><msub><mi>s</mi><mi>i</mi></msub></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">A_{s_{i}}=\begin{bmatrix}1&amp; 0 &amp;0 \\ 1&amp;1  &amp; 1\\ 0&amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>Â </mtext><mo stretchy="false">?</mo><mo>:</mo></mrow><annotation encoding="application/x-tex">s[i]=\ ?:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace">Â </span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mclose">?</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><msub><mi>s</mi><mi>i</mi></msub></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">A_{s_{i}}=\begin{bmatrix}1&amp; 1 &amp;1 \\ 1&amp;1  &amp; 1\\ 0&amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span></span></span></span></p></blockquote></blockquote><blockquote><p>æ­¤å¤–æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msub><mi>A</mi><msub><mi>s</mi><mi>i</mi></msub></msub><msub><mi>A</mi><msub><mi>s</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></msub><mo>â€¦</mo><msub><mi>A</mi><msub><mi>s</mi><mn>1</mn></msub></msub><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msub><mi>A</mi><msub><mi>s</mi><mi>i</mi></msub></msub><msub><mi>A</mi><msub><mi>s</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></msub><mo>â€¦</mo><msub><mi>A</mi><msub><mi>s</mi><mn>1</mn></msub></msub><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} dp[i][0] \\dp[i][1] \\1  \end{bmatrix}=A_{s_{i}}A_{s_{i-1}}\dots A_{s_{1}}\begin{bmatrix} dp[0][0]\\ dp[0][1]\\1 \end{bmatrix}=A_{s_{i}}A_{s_{i-1}}\dots A_{s_{1}}\begin{bmatrix} 0\\ 0\\1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.291765em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.6010299999999997em;vertical-align:-1.55002em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.291765em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span></span></span></span></p></blockquote><p>æˆ‘ä»¬å¯ä»¥ç”¨çº¿æ®µæ ‘ç»´æŠ¤æ¯ä¸€ä¸ªçŸ©é˜µ,è¿™æ ·ä¿®æ”¹æ“ä½œå¯ä»¥åœ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">logn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span></span></span></span>æ—¶é—´å†…å®Œæˆã€‚</p></blockquote><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>q</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(qlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p></blockquote><p><strong>ACä»£ç ï¼š</strong><br /><img src="https://img-blog.csdnimg.cn/bc5a7997abb347ce8011788c81a0cddc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span><span class="number">+10</span>,M = N * <span class="number">2</span>,INF = <span class="number">0x3f3f3f3f</span>,mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    ll a[<span class="number">3</span>][<span class="number">3</span>];</span><br><span class="line">&#125;tr[N*<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n,q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(tr[u].a,<span class="number">0</span>,<span class="keyword">sizeof</span> tr[u].a);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">3</span> ; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">3</span> ; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span> ; k &lt; <span class="number">3</span> ; k++)</span><br><span class="line">                tr[u].a[i][j] = (tr[u].a[i][j] + tr[u&lt;&lt;<span class="number">1</span>].a[i][k]*tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].a[k][j])%mod;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">assign</span><span class="params">(Node &amp;root,<span class="type">char</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(ch==<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">0</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        root.a[<span class="number">2</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        tr[u] = &#123;l,r&#125;;</span><br><span class="line">        <span class="built_in">assign</span>(tr[u],s[r]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        tr[u] = &#123;l,r&#125;;</span><br><span class="line">        <span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid<span class="number">+1</span>,r);</span><br><span class="line">        <span class="built_in">pushup</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> x,<span class="type">char</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tr[u].l==x&amp;&amp;tr[u].r==x)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">assign</span>(tr[u],ch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = tr[u].l + tr[u].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(x &lt;= mid)<span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>,x,ch);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,x,ch);</span><br><span class="line">        <span class="built_in">pushup</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cin&gt;&gt;n&gt;&gt;q;</span><br><span class="line">    std::cin&gt;&gt;(s<span class="number">+1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="type">char</span> ch;</span><br><span class="line">        std::cin&gt;&gt;x&gt;&gt;ch;</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>,x,ch);</span><br><span class="line">        std::cout&lt;&lt;(tr[<span class="number">1</span>].a[<span class="number">0</span>][<span class="number">2</span>]+tr[<span class="number">1</span>].a[<span class="number">1</span>][<span class="number">2</span>])%mod&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr />]]></content>
      
      
      <categories>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Atcoder </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
